const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/browserAll-D0zBCthv.js","assets/webworkerAll-CJvFXm1Y.js","assets/colorToUniform-BXaCBwVl.js","assets/WebGPURenderer-r8ndJw-i.js","assets/SharedSystems-C-FP0RJu.js","assets/WebGLRenderer-CTmAMSnT.js"])))=>i.map(i=>d[i]);
var Mf=Object.defineProperty;var cl=i=>{throw TypeError(i)};var Of=(i,t,e)=>t in i?Mf(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var S=(i,t,e)=>Of(i,typeof t!="symbol"?t+"":t,e),hl=(i,t,e)=>t.has(i)||cl("Cannot "+e);var Et=(i,t,e)=>(hl(i,t,"read from private field"),e?e.call(i):t.get(i)),Ei=(i,t,e)=>t.has(i)?cl("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),Ps=(i,t,e,s)=>(hl(i,t,"write to private field"),s?s.call(i,e):t.set(i,e),e);function vf(i,t){for(var e=0;e<t.length;e++){const s=t[e];if(typeof s!="string"&&!Array.isArray(s)){for(const n in s)if(n!=="default"&&!(n in i)){const r=Object.getOwnPropertyDescriptor(s,n);r&&Object.defineProperty(i,n,r.get?r:{enumerable:!0,get:()=>s[n]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(n){if(n.ep)return;n.ep=!0;const r=e(n);fetch(n.href,r)}})();function Ch(i,t){return function(){return i.apply(t,arguments)}}const{toString:Pf}=Object.prototype,{getPrototypeOf:Pa}=Object,{iterator:Fr,toStringTag:Rh}=Symbol,Br=(i=>t=>{const e=Pf.call(t);return i[e]||(i[e]=e.slice(8,-1).toLowerCase())})(Object.create(null)),qe=i=>(i=i.toLowerCase(),t=>Br(t)===i),Ur=i=>t=>typeof t===i,{isArray:Rs}=Array,ps=Ur("undefined");function Tn(i){return i!==null&&!ps(i)&&i.constructor!==null&&!ps(i.constructor)&&ye(i.constructor.isBuffer)&&i.constructor.isBuffer(i)}const wh=qe("ArrayBuffer");function Lf(i){let t;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?t=ArrayBuffer.isView(i):t=i&&i.buffer&&wh(i.buffer),t}const Nf=Ur("string"),ye=Ur("function"),Ih=Ur("number"),En=i=>i!==null&&typeof i=="object",Df=i=>i===!0||i===!1,tr=i=>{if(Br(i)!=="object")return!1;const t=Pa(i);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Rh in i)&&!(Fr in i)},kf=i=>{if(!En(i)||Tn(i))return!1;try{return Object.keys(i).length===0&&Object.getPrototypeOf(i)===Object.prototype}catch{return!1}},Hf=qe("Date"),Ff=qe("File"),Bf=qe("Blob"),Uf=qe("FileList"),Gf=i=>En(i)&&ye(i.pipe),jf=i=>{let t;return i&&(typeof FormData=="function"&&i instanceof FormData||ye(i.append)&&((t=Br(i))==="formdata"||t==="object"&&ye(i.toString)&&i.toString()==="[object FormData]"))},Wf=qe("URLSearchParams"),[Vf,zf,$f,Yf]=["ReadableStream","Request","Response","Headers"].map(qe),Xf=i=>i.trim?i.trim():i.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function _n(i,t,{allOwnKeys:e=!1}={}){if(i===null||typeof i>"u")return;let s,n;if(typeof i!="object"&&(i=[i]),Rs(i))for(s=0,n=i.length;s<n;s++)t.call(null,i[s],s,i);else{if(Tn(i))return;const r=e?Object.getOwnPropertyNames(i):Object.keys(i),o=r.length;let a;for(s=0;s<o;s++)a=r[s],t.call(null,i[a],a,i)}}function Mh(i,t){if(Tn(i))return null;t=t.toLowerCase();const e=Object.keys(i);let s=e.length,n;for(;s-- >0;)if(n=e[s],t===n.toLowerCase())return n;return null}const Fi=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Oh=i=>!ps(i)&&i!==Fi;function Wo(){const{caseless:i,skipUndefined:t}=Oh(this)&&this||{},e={},s=(n,r)=>{const o=i&&Mh(e,r)||r;tr(e[o])&&tr(n)?e[o]=Wo(e[o],n):tr(n)?e[o]=Wo({},n):Rs(n)?e[o]=n.slice():(!t||!ps(n))&&(e[o]=n)};for(let n=0,r=arguments.length;n<r;n++)arguments[n]&&_n(arguments[n],s);return e}const qf=(i,t,e,{allOwnKeys:s}={})=>(_n(t,(n,r)=>{e&&ye(n)?i[r]=Ch(n,e):i[r]=n},{allOwnKeys:s}),i),Kf=i=>(i.charCodeAt(0)===65279&&(i=i.slice(1)),i),Zf=(i,t,e,s)=>{i.prototype=Object.create(t.prototype,s),i.prototype.constructor=i,Object.defineProperty(i,"super",{value:t.prototype}),e&&Object.assign(i.prototype,e)},Jf=(i,t,e,s)=>{let n,r,o;const a={};if(t=t||{},i==null)return t;do{for(n=Object.getOwnPropertyNames(i),r=n.length;r-- >0;)o=n[r],(!s||s(o,i,t))&&!a[o]&&(t[o]=i[o],a[o]=!0);i=e!==!1&&Pa(i)}while(i&&(!e||e(i,t))&&i!==Object.prototype);return t},Qf=(i,t,e)=>{i=String(i),(e===void 0||e>i.length)&&(e=i.length),e-=t.length;const s=i.indexOf(t,e);return s!==-1&&s===e},tp=i=>{if(!i)return null;if(Rs(i))return i;let t=i.length;if(!Ih(t))return null;const e=new Array(t);for(;t-- >0;)e[t]=i[t];return e},ep=(i=>t=>i&&t instanceof i)(typeof Uint8Array<"u"&&Pa(Uint8Array)),ip=(i,t)=>{const s=(i&&i[Fr]).call(i);let n;for(;(n=s.next())&&!n.done;){const r=n.value;t.call(i,r[0],r[1])}},sp=(i,t)=>{let e;const s=[];for(;(e=i.exec(t))!==null;)s.push(e);return s},np=qe("HTMLFormElement"),rp=i=>i.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,s,n){return s.toUpperCase()+n}),ul=(({hasOwnProperty:i})=>(t,e)=>i.call(t,e))(Object.prototype),op=qe("RegExp"),vh=(i,t)=>{const e=Object.getOwnPropertyDescriptors(i),s={};_n(e,(n,r)=>{let o;(o=t(n,r,i))!==!1&&(s[r]=o||n)}),Object.defineProperties(i,s)},ap=i=>{vh(i,(t,e)=>{if(ye(i)&&["arguments","caller","callee"].indexOf(e)!==-1)return!1;const s=i[e];if(ye(s)){if(t.enumerable=!1,"writable"in t){t.writable=!1;return}t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+e+"'")})}})},lp=(i,t)=>{const e={},s=n=>{n.forEach(r=>{e[r]=!0})};return Rs(i)?s(i):s(String(i).split(t)),e},cp=()=>{},hp=(i,t)=>i!=null&&Number.isFinite(i=+i)?i:t;function up(i){return!!(i&&ye(i.append)&&i[Rh]==="FormData"&&i[Fr])}const dp=i=>{const t=new Array(10),e=(s,n)=>{if(En(s)){if(t.indexOf(s)>=0)return;if(Tn(s))return s;if(!("toJSON"in s)){t[n]=s;const r=Rs(s)?[]:{};return _n(s,(o,a)=>{const l=e(o,n+1);!ps(l)&&(r[a]=l)}),t[n]=void 0,r}}return s};return e(i,0)},fp=qe("AsyncFunction"),pp=i=>i&&(En(i)||ye(i))&&ye(i.then)&&ye(i.catch),Ph=((i,t)=>i?setImmediate:t?((e,s)=>(Fi.addEventListener("message",({source:n,data:r})=>{n===Fi&&r===e&&s.length&&s.shift()()},!1),n=>{s.push(n),Fi.postMessage(e,"*")}))(`axios@${Math.random()}`,[]):e=>setTimeout(e))(typeof setImmediate=="function",ye(Fi.postMessage)),mp=typeof queueMicrotask<"u"?queueMicrotask.bind(Fi):typeof process<"u"&&process.nextTick||Ph,gp=i=>i!=null&&ye(i[Fr]),G={isArray:Rs,isArrayBuffer:wh,isBuffer:Tn,isFormData:jf,isArrayBufferView:Lf,isString:Nf,isNumber:Ih,isBoolean:Df,isObject:En,isPlainObject:tr,isEmptyObject:kf,isReadableStream:Vf,isRequest:zf,isResponse:$f,isHeaders:Yf,isUndefined:ps,isDate:Hf,isFile:Ff,isBlob:Bf,isRegExp:op,isFunction:ye,isStream:Gf,isURLSearchParams:Wf,isTypedArray:ep,isFileList:Uf,forEach:_n,merge:Wo,extend:qf,trim:Xf,stripBOM:Kf,inherits:Zf,toFlatObject:Jf,kindOf:Br,kindOfTest:qe,endsWith:Qf,toArray:tp,forEachEntry:ip,matchAll:sp,isHTMLForm:np,hasOwnProperty:ul,hasOwnProp:ul,reduceDescriptors:vh,freezeMethods:ap,toObjectSet:lp,toCamelCase:rp,noop:cp,toFiniteNumber:hp,findKey:Mh,global:Fi,isContextDefined:Oh,isSpecCompliantForm:up,toJSONObject:dp,isAsyncFn:fp,isThenable:pp,setImmediate:Ph,asap:mp,isIterable:gp};function gt(i,t,e,s,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=i,this.name="AxiosError",t&&(this.code=t),e&&(this.config=e),s&&(this.request=s),n&&(this.response=n,this.status=n.status?n.status:null)}G.inherits(gt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:G.toJSONObject(this.config),code:this.code,status:this.status}}});const Lh=gt.prototype,Nh={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(i=>{Nh[i]={value:i}});Object.defineProperties(gt,Nh);Object.defineProperty(Lh,"isAxiosError",{value:!0});gt.from=(i,t,e,s,n,r)=>{const o=Object.create(Lh);G.toFlatObject(i,o,function(h){return h!==Error.prototype},c=>c!=="isAxiosError");const a=i&&i.message?i.message:"Error",l=t==null&&i?i.code:t;return gt.call(o,a,l,e,s,n),i&&o.cause==null&&Object.defineProperty(o,"cause",{value:i,configurable:!0}),o.name=i&&i.name||"Error",r&&Object.assign(o,r),o};const yp=null;function Vo(i){return G.isPlainObject(i)||G.isArray(i)}function Dh(i){return G.endsWith(i,"[]")?i.slice(0,-2):i}function dl(i,t,e){return i?i.concat(t).map(function(n,r){return n=Dh(n),!e&&r?"["+n+"]":n}).join(e?".":""):t}function Sp(i){return G.isArray(i)&&!i.some(Vo)}const Tp=G.toFlatObject(G,{},null,function(t){return/^is[A-Z]/.test(t)});function Gr(i,t,e){if(!G.isObject(i))throw new TypeError("target must be an object");t=t||new FormData,e=G.toFlatObject(e,{metaTokens:!0,dots:!1,indexes:!1},!1,function(y,g){return!G.isUndefined(g[y])});const s=e.metaTokens,n=e.visitor||h,r=e.dots,o=e.indexes,l=(e.Blob||typeof Blob<"u"&&Blob)&&G.isSpecCompliantForm(t);if(!G.isFunction(n))throw new TypeError("visitor must be a function");function c(m){if(m===null)return"";if(G.isDate(m))return m.toISOString();if(G.isBoolean(m))return m.toString();if(!l&&G.isBlob(m))throw new gt("Blob is not supported. Use a Buffer instead.");return G.isArrayBuffer(m)||G.isTypedArray(m)?l&&typeof Blob=="function"?new Blob([m]):Buffer.from(m):m}function h(m,y,g){let E=m;if(m&&!g&&typeof m=="object"){if(G.endsWith(y,"{}"))y=s?y:y.slice(0,-2),m=JSON.stringify(m);else if(G.isArray(m)&&Sp(m)||(G.isFileList(m)||G.endsWith(y,"[]"))&&(E=G.toArray(m)))return y=Dh(y),E.forEach(function(_,b){!(G.isUndefined(_)||_===null)&&t.append(o===!0?dl([y],b,r):o===null?y:y+"[]",c(_))}),!1}return Vo(m)?!0:(t.append(dl(g,y,r),c(m)),!1)}const u=[],d=Object.assign(Tp,{defaultVisitor:h,convertValue:c,isVisitable:Vo});function f(m,y){if(!G.isUndefined(m)){if(u.indexOf(m)!==-1)throw Error("Circular reference detected in "+y.join("."));u.push(m),G.forEach(m,function(E,T){(!(G.isUndefined(E)||E===null)&&n.call(t,E,G.isString(T)?T.trim():T,y,d))===!0&&f(E,y?y.concat(T):[T])}),u.pop()}}if(!G.isObject(i))throw new TypeError("data must be an object");return f(i),t}function fl(i){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(i).replace(/[!'()~]|%20|%00/g,function(s){return t[s]})}function La(i,t){this._pairs=[],i&&Gr(i,this,t)}const kh=La.prototype;kh.append=function(t,e){this._pairs.push([t,e])};kh.toString=function(t){const e=t?function(s){return t.call(this,s,fl)}:fl;return this._pairs.map(function(n){return e(n[0])+"="+e(n[1])},"").join("&")};function Ep(i){return encodeURIComponent(i).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function Hh(i,t,e){if(!t)return i;const s=e&&e.encode||Ep;G.isFunction(e)&&(e={serialize:e});const n=e&&e.serialize;let r;if(n?r=n(t,e):r=G.isURLSearchParams(t)?t.toString():new La(t,e).toString(s),r){const o=i.indexOf("#");o!==-1&&(i=i.slice(0,o)),i+=(i.indexOf("?")===-1?"?":"&")+r}return i}class pl{constructor(){this.handlers=[]}use(t,e,s){return this.handlers.push({fulfilled:t,rejected:e,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(t){this.handlers[t]&&(this.handlers[t]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(t){G.forEach(this.handlers,function(s){s!==null&&t(s)})}}const Fh={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},_p=typeof URLSearchParams<"u"?URLSearchParams:La,bp=typeof FormData<"u"?FormData:null,xp=typeof Blob<"u"?Blob:null,Ap={isBrowser:!0,classes:{URLSearchParams:_p,FormData:bp,Blob:xp},protocols:["http","https","file","blob","url","data"]},Na=typeof window<"u"&&typeof document<"u",zo=typeof navigator=="object"&&navigator||void 0,Cp=Na&&(!zo||["ReactNative","NativeScript","NS"].indexOf(zo.product)<0),Rp=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",wp=Na&&window.location.href||"http://localhost",Ip=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Na,hasStandardBrowserEnv:Cp,hasStandardBrowserWebWorkerEnv:Rp,navigator:zo,origin:wp},Symbol.toStringTag,{value:"Module"})),le={...Ip,...Ap};function Mp(i,t){return Gr(i,new le.classes.URLSearchParams,{visitor:function(e,s,n,r){return le.isNode&&G.isBuffer(e)?(this.append(s,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)},...t})}function Op(i){return G.matchAll(/\w+|\[(\w*)]/g,i).map(t=>t[0]==="[]"?"":t[1]||t[0])}function vp(i){const t={},e=Object.keys(i);let s;const n=e.length;let r;for(s=0;s<n;s++)r=e[s],t[r]=i[r];return t}function Bh(i){function t(e,s,n,r){let o=e[r++];if(o==="__proto__")return!0;const a=Number.isFinite(+o),l=r>=e.length;return o=!o&&G.isArray(n)?n.length:o,l?(G.hasOwnProp(n,o)?n[o]=[n[o],s]:n[o]=s,!a):((!n[o]||!G.isObject(n[o]))&&(n[o]=[]),t(e,s,n[o],r)&&G.isArray(n[o])&&(n[o]=vp(n[o])),!a)}if(G.isFormData(i)&&G.isFunction(i.entries)){const e={};return G.forEachEntry(i,(s,n)=>{t(Op(s),n,e,0)}),e}return null}function Pp(i,t,e){if(G.isString(i))try{return(t||JSON.parse)(i),G.trim(i)}catch(s){if(s.name!=="SyntaxError")throw s}return(e||JSON.stringify)(i)}const bn={transitional:Fh,adapter:["xhr","http","fetch"],transformRequest:[function(t,e){const s=e.getContentType()||"",n=s.indexOf("application/json")>-1,r=G.isObject(t);if(r&&G.isHTMLForm(t)&&(t=new FormData(t)),G.isFormData(t))return n?JSON.stringify(Bh(t)):t;if(G.isArrayBuffer(t)||G.isBuffer(t)||G.isStream(t)||G.isFile(t)||G.isBlob(t)||G.isReadableStream(t))return t;if(G.isArrayBufferView(t))return t.buffer;if(G.isURLSearchParams(t))return e.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),t.toString();let a;if(r){if(s.indexOf("application/x-www-form-urlencoded")>-1)return Mp(t,this.formSerializer).toString();if((a=G.isFileList(t))||s.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return Gr(a?{"files[]":t}:t,l&&new l,this.formSerializer)}}return r||n?(e.setContentType("application/json",!1),Pp(t)):t}],transformResponse:[function(t){const e=this.transitional||bn.transitional,s=e&&e.forcedJSONParsing,n=this.responseType==="json";if(G.isResponse(t)||G.isReadableStream(t))return t;if(t&&G.isString(t)&&(s&&!this.responseType||n)){const o=!(e&&e.silentJSONParsing)&&n;try{return JSON.parse(t,this.parseReviver)}catch(a){if(o)throw a.name==="SyntaxError"?gt.from(a,gt.ERR_BAD_RESPONSE,this,null,this.response):a}}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:le.classes.FormData,Blob:le.classes.Blob},validateStatus:function(t){return t>=200&&t<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};G.forEach(["delete","get","head","post","put","patch"],i=>{bn.headers[i]={}});const Lp=G.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Np=i=>{const t={};let e,s,n;return i&&i.split(`
`).forEach(function(o){n=o.indexOf(":"),e=o.substring(0,n).trim().toLowerCase(),s=o.substring(n+1).trim(),!(!e||t[e]&&Lp[e])&&(e==="set-cookie"?t[e]?t[e].push(s):t[e]=[s]:t[e]=t[e]?t[e]+", "+s:s)}),t},ml=Symbol("internals");function Ls(i){return i&&String(i).trim().toLowerCase()}function er(i){return i===!1||i==null?i:G.isArray(i)?i.map(er):String(i)}function Dp(i){const t=Object.create(null),e=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=e.exec(i);)t[s[1]]=s[2];return t}const kp=i=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(i.trim());function to(i,t,e,s,n){if(G.isFunction(s))return s.call(this,t,e);if(n&&(t=e),!!G.isString(t)){if(G.isString(s))return t.indexOf(s)!==-1;if(G.isRegExp(s))return s.test(t)}}function Hp(i){return i.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(t,e,s)=>e.toUpperCase()+s)}function Fp(i,t){const e=G.toCamelCase(" "+t);["get","set","has"].forEach(s=>{Object.defineProperty(i,s+e,{value:function(n,r,o){return this[s].call(this,t,n,r,o)},configurable:!0})})}let Se=class{constructor(t){t&&this.set(t)}set(t,e,s){const n=this;function r(a,l,c){const h=Ls(l);if(!h)throw new Error("header name must be a non-empty string");const u=G.findKey(n,h);(!u||n[u]===void 0||c===!0||c===void 0&&n[u]!==!1)&&(n[u||l]=er(a))}const o=(a,l)=>G.forEach(a,(c,h)=>r(c,h,l));if(G.isPlainObject(t)||t instanceof this.constructor)o(t,e);else if(G.isString(t)&&(t=t.trim())&&!kp(t))o(Np(t),e);else if(G.isObject(t)&&G.isIterable(t)){let a={},l,c;for(const h of t){if(!G.isArray(h))throw TypeError("Object iterator must return a key-value pair");a[c=h[0]]=(l=a[c])?G.isArray(l)?[...l,h[1]]:[l,h[1]]:h[1]}o(a,e)}else t!=null&&r(e,t,s);return this}get(t,e){if(t=Ls(t),t){const s=G.findKey(this,t);if(s){const n=this[s];if(!e)return n;if(e===!0)return Dp(n);if(G.isFunction(e))return e.call(this,n,s);if(G.isRegExp(e))return e.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(t,e){if(t=Ls(t),t){const s=G.findKey(this,t);return!!(s&&this[s]!==void 0&&(!e||to(this,this[s],s,e)))}return!1}delete(t,e){const s=this;let n=!1;function r(o){if(o=Ls(o),o){const a=G.findKey(s,o);a&&(!e||to(s,s[a],a,e))&&(delete s[a],n=!0)}}return G.isArray(t)?t.forEach(r):r(t),n}clear(t){const e=Object.keys(this);let s=e.length,n=!1;for(;s--;){const r=e[s];(!t||to(this,this[r],r,t,!0))&&(delete this[r],n=!0)}return n}normalize(t){const e=this,s={};return G.forEach(this,(n,r)=>{const o=G.findKey(s,r);if(o){e[o]=er(n),delete e[r];return}const a=t?Hp(r):String(r).trim();a!==r&&delete e[r],e[a]=er(n),s[a]=!0}),this}concat(...t){return this.constructor.concat(this,...t)}toJSON(t){const e=Object.create(null);return G.forEach(this,(s,n)=>{s!=null&&s!==!1&&(e[n]=t&&G.isArray(s)?s.join(", "):s)}),e}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([t,e])=>t+": "+e).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(t){return t instanceof this?t:new this(t)}static concat(t,...e){const s=new this(t);return e.forEach(n=>s.set(n)),s}static accessor(t){const s=(this[ml]=this[ml]={accessors:{}}).accessors,n=this.prototype;function r(o){const a=Ls(o);s[a]||(Fp(n,o),s[a]=!0)}return G.isArray(t)?t.forEach(r):r(t),this}};Se.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);G.reduceDescriptors(Se.prototype,({value:i},t)=>{let e=t[0].toUpperCase()+t.slice(1);return{get:()=>i,set(s){this[e]=s}}});G.freezeMethods(Se);function eo(i,t){const e=this||bn,s=t||e,n=Se.from(s.headers);let r=s.data;return G.forEach(i,function(a){r=a.call(e,r,n.normalize(),t?t.status:void 0)}),n.normalize(),r}function Uh(i){return!!(i&&i.__CANCEL__)}function ws(i,t,e){gt.call(this,i??"canceled",gt.ERR_CANCELED,t,e),this.name="CanceledError"}G.inherits(ws,gt,{__CANCEL__:!0});function Gh(i,t,e){const s=e.config.validateStatus;!e.status||!s||s(e.status)?i(e):t(new gt("Request failed with status code "+e.status,[gt.ERR_BAD_REQUEST,gt.ERR_BAD_RESPONSE][Math.floor(e.status/100)-4],e.config,e.request,e))}function Bp(i){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(i);return t&&t[1]||""}function Up(i,t){i=i||10;const e=new Array(i),s=new Array(i);let n=0,r=0,o;return t=t!==void 0?t:1e3,function(l){const c=Date.now(),h=s[r];o||(o=c),e[n]=l,s[n]=c;let u=r,d=0;for(;u!==n;)d+=e[u++],u=u%i;if(n=(n+1)%i,n===r&&(r=(r+1)%i),c-o<t)return;const f=h&&c-h;return f?Math.round(d*1e3/f):void 0}}function Gp(i,t){let e=0,s=1e3/t,n,r;const o=(c,h=Date.now())=>{e=h,n=null,r&&(clearTimeout(r),r=null),i(...c)};return[(...c)=>{const h=Date.now(),u=h-e;u>=s?o(c,h):(n=c,r||(r=setTimeout(()=>{r=null,o(n)},s-u)))},()=>n&&o(n)]}const ur=(i,t,e=3)=>{let s=0;const n=Up(50,250);return Gp(r=>{const o=r.loaded,a=r.lengthComputable?r.total:void 0,l=o-s,c=n(l),h=o<=a;s=o;const u={loaded:o,total:a,progress:a?o/a:void 0,bytes:l,rate:c||void 0,estimated:c&&a&&h?(a-o)/c:void 0,event:r,lengthComputable:a!=null,[t?"download":"upload"]:!0};i(u)},e)},gl=(i,t)=>{const e=i!=null;return[s=>t[0]({lengthComputable:e,total:i,loaded:s}),t[1]]},yl=i=>(...t)=>G.asap(()=>i(...t)),jp=le.hasStandardBrowserEnv?((i,t)=>e=>(e=new URL(e,le.origin),i.protocol===e.protocol&&i.host===e.host&&(t||i.port===e.port)))(new URL(le.origin),le.navigator&&/(msie|trident)/i.test(le.navigator.userAgent)):()=>!0,Wp=le.hasStandardBrowserEnv?{write(i,t,e,s,n,r){const o=[i+"="+encodeURIComponent(t)];G.isNumber(e)&&o.push("expires="+new Date(e).toGMTString()),G.isString(s)&&o.push("path="+s),G.isString(n)&&o.push("domain="+n),r===!0&&o.push("secure"),document.cookie=o.join("; ")},read(i){const t=document.cookie.match(new RegExp("(^|;\\s*)("+i+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove(i){this.write(i,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Vp(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}function zp(i,t){return t?i.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):i}function jh(i,t,e){let s=!Vp(t);return i&&(s||e==!1)?zp(i,t):t}const Sl=i=>i instanceof Se?{...i}:i;function Yi(i,t){t=t||{};const e={};function s(c,h,u,d){return G.isPlainObject(c)&&G.isPlainObject(h)?G.merge.call({caseless:d},c,h):G.isPlainObject(h)?G.merge({},h):G.isArray(h)?h.slice():h}function n(c,h,u,d){if(G.isUndefined(h)){if(!G.isUndefined(c))return s(void 0,c,u,d)}else return s(c,h,u,d)}function r(c,h){if(!G.isUndefined(h))return s(void 0,h)}function o(c,h){if(G.isUndefined(h)){if(!G.isUndefined(c))return s(void 0,c)}else return s(void 0,h)}function a(c,h,u){if(u in t)return s(c,h);if(u in i)return s(void 0,c)}const l={url:r,method:r,data:r,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(c,h,u)=>n(Sl(c),Sl(h),u,!0)};return G.forEach(Object.keys({...i,...t}),function(h){const u=l[h]||n,d=u(i[h],t[h],h);G.isUndefined(d)&&u!==a||(e[h]=d)}),e}const Wh=i=>{const t=Yi({},i);let{data:e,withXSRFToken:s,xsrfHeaderName:n,xsrfCookieName:r,headers:o,auth:a}=t;if(t.headers=o=Se.from(o),t.url=Hh(jh(t.baseURL,t.url,t.allowAbsoluteUrls),i.params,i.paramsSerializer),a&&o.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):""))),G.isFormData(e)){if(le.hasStandardBrowserEnv||le.hasStandardBrowserWebWorkerEnv)o.setContentType(void 0);else if(G.isFunction(e.getHeaders)){const l=e.getHeaders(),c=["content-type","content-length"];Object.entries(l).forEach(([h,u])=>{c.includes(h.toLowerCase())&&o.set(h,u)})}}if(le.hasStandardBrowserEnv&&(s&&G.isFunction(s)&&(s=s(t)),s||s!==!1&&jp(t.url))){const l=n&&r&&Wp.read(r);l&&o.set(n,l)}return t},$p=typeof XMLHttpRequest<"u",Yp=$p&&function(i){return new Promise(function(e,s){const n=Wh(i);let r=n.data;const o=Se.from(n.headers).normalize();let{responseType:a,onUploadProgress:l,onDownloadProgress:c}=n,h,u,d,f,m;function y(){f&&f(),m&&m(),n.cancelToken&&n.cancelToken.unsubscribe(h),n.signal&&n.signal.removeEventListener("abort",h)}let g=new XMLHttpRequest;g.open(n.method.toUpperCase(),n.url,!0),g.timeout=n.timeout;function E(){if(!g)return;const _=Se.from("getAllResponseHeaders"in g&&g.getAllResponseHeaders()),A={data:!a||a==="text"||a==="json"?g.responseText:g.response,status:g.status,statusText:g.statusText,headers:_,config:i,request:g};Gh(function(R){e(R),y()},function(R){s(R),y()},A),g=null}"onloadend"in g?g.onloadend=E:g.onreadystatechange=function(){!g||g.readyState!==4||g.status===0&&!(g.responseURL&&g.responseURL.indexOf("file:")===0)||setTimeout(E)},g.onabort=function(){g&&(s(new gt("Request aborted",gt.ECONNABORTED,i,g)),g=null)},g.onerror=function(b){const A=b&&b.message?b.message:"Network Error",C=new gt(A,gt.ERR_NETWORK,i,g);C.event=b||null,s(C),g=null},g.ontimeout=function(){let b=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const A=n.transitional||Fh;n.timeoutErrorMessage&&(b=n.timeoutErrorMessage),s(new gt(b,A.clarifyTimeoutError?gt.ETIMEDOUT:gt.ECONNABORTED,i,g)),g=null},r===void 0&&o.setContentType(null),"setRequestHeader"in g&&G.forEach(o.toJSON(),function(b,A){g.setRequestHeader(A,b)}),G.isUndefined(n.withCredentials)||(g.withCredentials=!!n.withCredentials),a&&a!=="json"&&(g.responseType=n.responseType),c&&([d,m]=ur(c,!0),g.addEventListener("progress",d)),l&&g.upload&&([u,f]=ur(l),g.upload.addEventListener("progress",u),g.upload.addEventListener("loadend",f)),(n.cancelToken||n.signal)&&(h=_=>{g&&(s(!_||_.type?new ws(null,i,g):_),g.abort(),g=null)},n.cancelToken&&n.cancelToken.subscribe(h),n.signal&&(n.signal.aborted?h():n.signal.addEventListener("abort",h)));const T=Bp(n.url);if(T&&le.protocols.indexOf(T)===-1){s(new gt("Unsupported protocol "+T+":",gt.ERR_BAD_REQUEST,i));return}g.send(r||null)})},Xp=(i,t)=>{const{length:e}=i=i?i.filter(Boolean):[];if(t||e){let s=new AbortController,n;const r=function(c){if(!n){n=!0,a();const h=c instanceof Error?c:this.reason;s.abort(h instanceof gt?h:new ws(h instanceof Error?h.message:h))}};let o=t&&setTimeout(()=>{o=null,r(new gt(`timeout ${t} of ms exceeded`,gt.ETIMEDOUT))},t);const a=()=>{i&&(o&&clearTimeout(o),o=null,i.forEach(c=>{c.unsubscribe?c.unsubscribe(r):c.removeEventListener("abort",r)}),i=null)};i.forEach(c=>c.addEventListener("abort",r));const{signal:l}=s;return l.unsubscribe=()=>G.asap(a),l}},qp=function*(i,t){let e=i.byteLength;if(e<t){yield i;return}let s=0,n;for(;s<e;)n=s+t,yield i.slice(s,n),s=n},Kp=async function*(i,t){for await(const e of Zp(i))yield*qp(e,t)},Zp=async function*(i){if(i[Symbol.asyncIterator]){yield*i;return}const t=i.getReader();try{for(;;){const{done:e,value:s}=await t.read();if(e)break;yield s}}finally{await t.cancel()}},Tl=(i,t,e,s)=>{const n=Kp(i,t);let r=0,o,a=l=>{o||(o=!0,s&&s(l))};return new ReadableStream({async pull(l){try{const{done:c,value:h}=await n.next();if(c){a(),l.close();return}let u=h.byteLength;if(e){let d=r+=u;e(d)}l.enqueue(new Uint8Array(h))}catch(c){throw a(c),c}},cancel(l){return a(l),n.return()}},{highWaterMark:2})},El=64*1024,{isFunction:Mn}=G,Jp=(({Request:i,Response:t})=>({Request:i,Response:t}))(G.global),{ReadableStream:_l,TextEncoder:bl}=G.global,xl=(i,...t)=>{try{return!!i(...t)}catch{return!1}},Qp=i=>{i=G.merge.call({skipUndefined:!0},Jp,i);const{fetch:t,Request:e,Response:s}=i,n=t?Mn(t):typeof fetch=="function",r=Mn(e),o=Mn(s);if(!n)return!1;const a=n&&Mn(_l),l=n&&(typeof bl=="function"?(m=>y=>m.encode(y))(new bl):async m=>new Uint8Array(await new e(m).arrayBuffer())),c=r&&a&&xl(()=>{let m=!1;const y=new e(le.origin,{body:new _l,method:"POST",get duplex(){return m=!0,"half"}}).headers.has("Content-Type");return m&&!y}),h=o&&a&&xl(()=>G.isReadableStream(new s("").body)),u={stream:h&&(m=>m.body)};n&&["text","arrayBuffer","blob","formData","stream"].forEach(m=>{!u[m]&&(u[m]=(y,g)=>{let E=y&&y[m];if(E)return E.call(y);throw new gt(`Response type '${m}' is not supported`,gt.ERR_NOT_SUPPORT,g)})});const d=async m=>{if(m==null)return 0;if(G.isBlob(m))return m.size;if(G.isSpecCompliantForm(m))return(await new e(le.origin,{method:"POST",body:m}).arrayBuffer()).byteLength;if(G.isArrayBufferView(m)||G.isArrayBuffer(m))return m.byteLength;if(G.isURLSearchParams(m)&&(m=m+""),G.isString(m))return(await l(m)).byteLength},f=async(m,y)=>{const g=G.toFiniteNumber(m.getContentLength());return g??d(y)};return async m=>{let{url:y,method:g,data:E,signal:T,cancelToken:_,timeout:b,onDownloadProgress:A,onUploadProgress:C,responseType:R,headers:O,withCredentials:M="same-origin",fetchOptions:w}=Wh(m),I=t||fetch;R=R?(R+"").toLowerCase():"text";let L=Xp([T,_&&_.toAbortSignal()],b),D=null;const N=L&&L.unsubscribe&&(()=>{L.unsubscribe()});let U;try{if(C&&c&&g!=="get"&&g!=="head"&&(U=await f(O,E))!==0){let H=new e(y,{method:"POST",body:E,duplex:"half"}),k;if(G.isFormData(E)&&(k=H.headers.get("content-type"))&&O.setContentType(k),H.body){const[F,z]=gl(U,ur(yl(C)));E=Tl(H.body,El,F,z)}}G.isString(M)||(M=M?"include":"omit");const v=r&&"credentials"in e.prototype,P={...w,signal:L,method:g.toUpperCase(),headers:O.normalize().toJSON(),body:E,duplex:"half",credentials:v?M:void 0};D=r&&new e(y,P);let q=await(r?I(D,w):I(y,P));const $=h&&(R==="stream"||R==="response");if(h&&(A||$&&N)){const H={};["status","statusText","headers"].forEach(X=>{H[X]=q[X]});const k=G.toFiniteNumber(q.headers.get("content-length")),[F,z]=A&&gl(k,ur(yl(A),!0))||[];q=new s(Tl(q.body,El,F,()=>{z&&z(),N&&N()}),H)}R=R||"text";let et=await u[G.findKey(u,R)||"text"](q,m);return!$&&N&&N(),await new Promise((H,k)=>{Gh(H,k,{data:et,headers:Se.from(q.headers),status:q.status,statusText:q.statusText,config:m,request:D})})}catch(v){throw N&&N(),v&&v.name==="TypeError"&&/Load failed|fetch/i.test(v.message)?Object.assign(new gt("Network Error",gt.ERR_NETWORK,m,D),{cause:v.cause||v}):gt.from(v,v&&v.code,m,D)}}},tm=new Map,Vh=i=>{let t=i?i.env:{};const{fetch:e,Request:s,Response:n}=t,r=[s,n,e];let o=r.length,a=o,l,c,h=tm;for(;a--;)l=r[a],c=h.get(l),c===void 0&&h.set(l,c=a?new Map:Qp(t)),h=c;return c};Vh();const $o={http:yp,xhr:Yp,fetch:{get:Vh}};G.forEach($o,(i,t)=>{if(i){try{Object.defineProperty(i,"name",{value:t})}catch{}Object.defineProperty(i,"adapterName",{value:t})}});const Al=i=>`- ${i}`,em=i=>G.isFunction(i)||i===null||i===!1,zh={getAdapter:(i,t)=>{i=G.isArray(i)?i:[i];const{length:e}=i;let s,n;const r={};for(let o=0;o<e;o++){s=i[o];let a;if(n=s,!em(s)&&(n=$o[(a=String(s)).toLowerCase()],n===void 0))throw new gt(`Unknown adapter '${a}'`);if(n&&(G.isFunction(n)||(n=n.get(t))))break;r[a||"#"+o]=n}if(!n){const o=Object.entries(r).map(([l,c])=>`adapter ${l} `+(c===!1?"is not supported by the environment":"is not available in the build"));let a=e?o.length>1?`since :
`+o.map(Al).join(`
`):" "+Al(o[0]):"as no adapter specified";throw new gt("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return n},adapters:$o};function io(i){if(i.cancelToken&&i.cancelToken.throwIfRequested(),i.signal&&i.signal.aborted)throw new ws(null,i)}function Cl(i){return io(i),i.headers=Se.from(i.headers),i.data=eo.call(i,i.transformRequest),["post","put","patch"].indexOf(i.method)!==-1&&i.headers.setContentType("application/x-www-form-urlencoded",!1),zh.getAdapter(i.adapter||bn.adapter,i)(i).then(function(s){return io(i),s.data=eo.call(i,i.transformResponse,s),s.headers=Se.from(s.headers),s},function(s){return Uh(s)||(io(i),s&&s.response&&(s.response.data=eo.call(i,i.transformResponse,s.response),s.response.headers=Se.from(s.response.headers))),Promise.reject(s)})}const $h="1.12.2",jr={};["object","boolean","number","function","string","symbol"].forEach((i,t)=>{jr[i]=function(s){return typeof s===i||"a"+(t<1?"n ":" ")+i}});const Rl={};jr.transitional=function(t,e,s){function n(r,o){return"[Axios v"+$h+"] Transitional option '"+r+"'"+o+(s?". "+s:"")}return(r,o,a)=>{if(t===!1)throw new gt(n(o," has been removed"+(e?" in "+e:"")),gt.ERR_DEPRECATED);return e&&!Rl[o]&&(Rl[o]=!0,console.warn(n(o," has been deprecated since v"+e+" and will be removed in the near future"))),t?t(r,o,a):!0}};jr.spelling=function(t){return(e,s)=>(console.warn(`${s} is likely a misspelling of ${t}`),!0)};function im(i,t,e){if(typeof i!="object")throw new gt("options must be an object",gt.ERR_BAD_OPTION_VALUE);const s=Object.keys(i);let n=s.length;for(;n-- >0;){const r=s[n],o=t[r];if(o){const a=i[r],l=a===void 0||o(a,r,i);if(l!==!0)throw new gt("option "+r+" must be "+l,gt.ERR_BAD_OPTION_VALUE);continue}if(e!==!0)throw new gt("Unknown option "+r,gt.ERR_BAD_OPTION)}}const ir={assertOptions:im,validators:jr},Qe=ir.validators;let zi=class{constructor(t){this.defaults=t||{},this.interceptors={request:new pl,response:new pl}}async request(t,e){try{return await this._request(t,e)}catch(s){if(s instanceof Error){let n={};Error.captureStackTrace?Error.captureStackTrace(n):n=new Error;const r=n.stack?n.stack.replace(/^.+\n/,""):"";try{s.stack?r&&!String(s.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+r):s.stack=r}catch{}}throw s}}_request(t,e){typeof t=="string"?(e=e||{},e.url=t):e=t||{},e=Yi(this.defaults,e);const{transitional:s,paramsSerializer:n,headers:r}=e;s!==void 0&&ir.assertOptions(s,{silentJSONParsing:Qe.transitional(Qe.boolean),forcedJSONParsing:Qe.transitional(Qe.boolean),clarifyTimeoutError:Qe.transitional(Qe.boolean)},!1),n!=null&&(G.isFunction(n)?e.paramsSerializer={serialize:n}:ir.assertOptions(n,{encode:Qe.function,serialize:Qe.function},!0)),e.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?e.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:e.allowAbsoluteUrls=!0),ir.assertOptions(e,{baseUrl:Qe.spelling("baseURL"),withXsrfToken:Qe.spelling("withXSRFToken")},!0),e.method=(e.method||this.defaults.method||"get").toLowerCase();let o=r&&G.merge(r.common,r[e.method]);r&&G.forEach(["delete","get","head","post","put","patch","common"],m=>{delete r[m]}),e.headers=Se.concat(o,r);const a=[];let l=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(e)===!1||(l=l&&y.synchronous,a.unshift(y.fulfilled,y.rejected))});const c=[];this.interceptors.response.forEach(function(y){c.push(y.fulfilled,y.rejected)});let h,u=0,d;if(!l){const m=[Cl.bind(this),void 0];for(m.unshift(...a),m.push(...c),d=m.length,h=Promise.resolve(e);u<d;)h=h.then(m[u++],m[u++]);return h}d=a.length;let f=e;for(;u<d;){const m=a[u++],y=a[u++];try{f=m(f)}catch(g){y.call(this,g);break}}try{h=Cl.call(this,f)}catch(m){return Promise.reject(m)}for(u=0,d=c.length;u<d;)h=h.then(c[u++],c[u++]);return h}getUri(t){t=Yi(this.defaults,t);const e=jh(t.baseURL,t.url,t.allowAbsoluteUrls);return Hh(e,t.params,t.paramsSerializer)}};G.forEach(["delete","get","head","options"],function(t){zi.prototype[t]=function(e,s){return this.request(Yi(s||{},{method:t,url:e,data:(s||{}).data}))}});G.forEach(["post","put","patch"],function(t){function e(s){return function(r,o,a){return this.request(Yi(a||{},{method:t,headers:s?{"Content-Type":"multipart/form-data"}:{},url:r,data:o}))}}zi.prototype[t]=e(),zi.prototype[t+"Form"]=e(!0)});let sm=class Yh{constructor(t){if(typeof t!="function")throw new TypeError("executor must be a function.");let e;this.promise=new Promise(function(r){e=r});const s=this;this.promise.then(n=>{if(!s._listeners)return;let r=s._listeners.length;for(;r-- >0;)s._listeners[r](n);s._listeners=null}),this.promise.then=n=>{let r;const o=new Promise(a=>{s.subscribe(a),r=a}).then(n);return o.cancel=function(){s.unsubscribe(r)},o},t(function(r,o,a){s.reason||(s.reason=new ws(r,o,a),e(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(t){if(this.reason){t(this.reason);return}this._listeners?this._listeners.push(t):this._listeners=[t]}unsubscribe(t){if(!this._listeners)return;const e=this._listeners.indexOf(t);e!==-1&&this._listeners.splice(e,1)}toAbortSignal(){const t=new AbortController,e=s=>{t.abort(s)};return this.subscribe(e),t.signal.unsubscribe=()=>this.unsubscribe(e),t.signal}static source(){let t;return{token:new Yh(function(n){t=n}),cancel:t}}};function nm(i){return function(e){return i.apply(null,e)}}function rm(i){return G.isObject(i)&&i.isAxiosError===!0}const Yo={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Yo).forEach(([i,t])=>{Yo[t]=i});function Xh(i){const t=new zi(i),e=Ch(zi.prototype.request,t);return G.extend(e,zi.prototype,t,{allOwnKeys:!0}),G.extend(e,t,null,{allOwnKeys:!0}),e.create=function(n){return Xh(Yi(i,n))},e}const Ut=Xh(bn);Ut.Axios=zi;Ut.CanceledError=ws;Ut.CancelToken=sm;Ut.isCancel=Uh;Ut.VERSION=$h;Ut.toFormData=Gr;Ut.AxiosError=gt;Ut.Cancel=Ut.CanceledError;Ut.all=function(t){return Promise.all(t)};Ut.spread=nm;Ut.isAxiosError=rm;Ut.mergeConfig=Yi;Ut.AxiosHeaders=Se;Ut.formToJSON=i=>Bh(G.isHTMLForm(i)?new FormData(i):i);Ut.getAdapter=zh.getAdapter;Ut.HttpStatusCode=Yo;Ut.default=Ut;const{Axios:fC,AxiosError:pC,CanceledError:mC,isCancel:gC,CancelToken:yC,VERSION:SC,all:TC,Cancel:EC,isAxiosError:_C,spread:bC,toFormData:xC,AxiosHeaders:AC,HttpStatusCode:CC,formToJSON:RC,getAdapter:wC,mergeConfig:IC}=Ut,Zt=class Zt{static initDatabase(){return new Promise((t,e)=>{const s=window.indexedDB.open("settingsDB",2);s.onupgradeneeded=n=>{Zt.db=n.target.result,console.log("DB updgrade success"),n.oldVersion<1&&Zt.db.createObjectStore("skins",{autoIncrement:!0}),n.oldVersion<2&&Zt.db.createObjectStore("defaultSkins")},s.onerror=()=>{console.error("The"),e(s.error)},s.onsuccess=()=>{Zt.db=s.result,console.log("DB request success"),t()}})}static readObjStore(){return new Promise((t,e)=>{const n=Zt.db.transaction("skins","readonly").objectStore("skins");n.getAll().onsuccess=r=>{t(r.target.result)},n.getAll().onerror=r=>{e(r)}})}static readObjStoreAtKey(t){return new Promise((e,s)=>{const o=Zt.db.transaction("skins","readonly").objectStore("skins").get(t);o.onsuccess=a=>{e(o.result)},o.onerror=a=>{s(o.error)}})}static removeFromObjStore(t){return new Promise((e,s)=>{let o=Zt.db.transaction("skins","readwrite").objectStore("skins").delete(+t);o.onsuccess=a=>{console.log("Deleted skin from IDB",a.target.result),e()},o.onerror=()=>{console.error("Cannot delete skin from IDB. Please delete skin manually from DevTools.",o.error),s(o.error)}})}static addToObjStore(t){return new Promise((e,s)=>{let o=Zt.db.transaction("skins","readwrite").objectStore("skins").add(t);o.onsuccess=()=>{console.log("Skin added to IDB",o.result),e()},o.onerror=()=>{console.error("Cannot add skin to IDB",o.error),s(o.error)}})}static setupSkins(t){return new Promise((e,s)=>{let o=Zt.db.transaction("defaultSkins","readwrite").objectStore("defaultSkins").add({base64s:{},samples:{}},t);o.onsuccess=()=>{console.log(`Initialized ${t} to IDB`,o.result),e()},o.onerror=()=>{console.error(`Cannot add ${t} to IDB`,o.error),s(o.error)}})}static async getDefaults(t,e,s){return new Promise(async(n,r)=>{var h;let o=Zt.db.transaction("defaultSkins","readwrite"),a=o.objectStore("defaultSkins");(await this.getAllDefaultKeys()).includes(s)||((h=this.skinSetupPromises)[s]??(h[s]=Zt.setupSkins(s)),await this.skinSetupPromises[s]),o=Zt.db.transaction("defaultSkins","readwrite"),a=o.objectStore("defaultSkins");const c=a.get(s);c.onsuccess=async u=>{const d=u.target.result;if(document.querySelector("#loadingText").innerHTML=`Initializing: Default Skins.
(${s}: ${e})
Might take a while on first load.`,d[t][e]){n(d[t][e]);return}if(t==="base64s"){const y=await K1(`/static/${s}/${e}.png`);d[t][e]=y,console.log(d),o=Zt.db.transaction("defaultSkins","readwrite"),a=o.objectStore("defaultSkins");const g=a.put(d,s);g.onsuccess=()=>{console.log(`Initialized ${s}/${e} to IDB`,g.result),n(y)},g.onerror=()=>{console.error(`Cannot add ${s} to IDB`,g.error),r(g.error)};return}const f=(await Ut.get(`/static/${s}/${e}.wav`,{responseType:"arraybuffer"})).data;d[t][e]=f,o=Zt.db.transaction("defaultSkins","readwrite"),a=o.objectStore("defaultSkins");const m=a.put(d,s);m.onsuccess=()=>{console.log(`Initialized ${s}/${e} to IDB`,m.result),n(f)},m.onerror=()=>{console.error(`Cannot add ${s} to IDB`,m.error),r(m.error)}},c.onerror=u=>{r(c.error)}})}static getAllKeys(){return new Promise((t,e)=>{const n=Zt.db.transaction("skins","readonly").objectStore("skins");n.getAllKeys().onsuccess=r=>{t(r.target.result)},n.getAllKeys().onerror=r=>{e(r)}})}static getAllDefaultKeys(){return new Promise((t,e)=>{const n=Zt.db.transaction("defaultSkins","readonly").objectStore("defaultSkins");n.getAllKeys().onsuccess=r=>{t(r.target.result)},n.getAllKeys().onerror=r=>{e(r)}})}};S(Zt,"db",null),S(Zt,"skinSetupPromises",{});let qt=Zt;const om="modulepreload",am=function(i){return"/dist/"+i},wl={},dr=function(t,e,s){let n=Promise.resolve();if(e&&e.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));n=Promise.allSettled(e.map(l=>{if(l=am(l),l in wl)return;wl[l]=!0;const c=l.endsWith(".css"),h=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${h}`))return;const u=document.createElement("link");if(u.rel=c?"stylesheet":om,c||(u.as="script"),u.crossOrigin="",u.href=l,a&&u.setAttribute("nonce",a),document.head.appendChild(u),c)return new Promise((d,f)=>{u.addEventListener("load",d),u.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${l}`)))})}))}function r(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return n.then(o=>{for(const a of o||[])a.status==="rejected"&&r(a.reason);return t().catch(r)})};var lt=(i=>(i.Application="application",i.WebGLPipes="webgl-pipes",i.WebGLPipesAdaptor="webgl-pipes-adaptor",i.WebGLSystem="webgl-system",i.WebGPUPipes="webgpu-pipes",i.WebGPUPipesAdaptor="webgpu-pipes-adaptor",i.WebGPUSystem="webgpu-system",i.CanvasSystem="canvas-system",i.CanvasPipesAdaptor="canvas-pipes-adaptor",i.CanvasPipes="canvas-pipes",i.Asset="asset",i.LoadParser="load-parser",i.ResolveParser="resolve-parser",i.CacheParser="cache-parser",i.DetectionParser="detection-parser",i.MaskEffect="mask-effect",i.BlendMode="blend-mode",i.TextureSource="texture-source",i.Environment="environment",i.ShapeBuilder="shape-builder",i.Batcher="batcher",i))(lt||{});const Xo=i=>{if(typeof i=="function"||typeof i=="object"&&i.extension){if(!i.extension)throw new Error("Extension class must have an extension object");i={...typeof i.extension!="object"?{type:i.extension}:i.extension,ref:i}}if(typeof i=="object")i={...i};else throw new Error("Invalid extension type");return typeof i.type=="string"&&(i.type=[i.type]),i},On=(i,t)=>Xo(i).priority??t,ne={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...i){return i.map(Xo).forEach(t=>{t.type.forEach(e=>{var s,n;return(n=(s=this._removeHandlers)[e])==null?void 0:n.call(s,t)})}),this},add(...i){return i.map(Xo).forEach(t=>{t.type.forEach(e=>{var r,o;const s=this._addHandlers,n=this._queue;s[e]?(o=s[e])==null||o.call(s,t):(n[e]=n[e]||[],(r=n[e])==null||r.push(t))})}),this},handle(i,t,e){var o;const s=this._addHandlers,n=this._removeHandlers;if(s[i]||n[i])throw new Error(`Extension type ${i} already has a handler`);s[i]=t,n[i]=e;const r=this._queue;return r[i]&&((o=r[i])==null||o.forEach(a=>t(a)),delete r[i]),this},handleByMap(i,t){return this.handle(i,e=>{e.name&&(t[e.name]=e.ref)},e=>{e.name&&delete t[e.name]})},handleByNamedList(i,t,e=-1){return this.handle(i,s=>{t.findIndex(r=>r.name===s.name)>=0||(t.push({name:s.name,value:s.ref}),t.sort((r,o)=>On(o.value,e)-On(r.value,e)))},s=>{const n=t.findIndex(r=>r.name===s.name);n!==-1&&t.splice(n,1)})},handleByList(i,t,e=-1){return this.handle(i,s=>{t.includes(s.ref)||(t.push(s.ref),t.sort((n,r)=>On(r,e)-On(n,e)))},s=>{const n=t.indexOf(s.ref);n!==-1&&t.splice(n,1)})},mixin(i,...t){for(const e of t)Object.defineProperties(i.prototype,Object.getOwnPropertyDescriptors(e))}},lm={extension:{type:lt.Environment,name:"browser",priority:-1},test:()=>!0,load:async()=>{await dr(()=>import("./browserAll-D0zBCthv.js"),__vite__mapDeps([0,1,2]))}},cm={extension:{type:lt.Environment,name:"webworker",priority:0},test:()=>typeof self<"u"&&self.WorkerGlobalScope!==void 0,load:async()=>{await dr(()=>import("./webworkerAll-CJvFXm1Y.js"),__vite__mapDeps([1,2]))}};class re{constructor(t,e,s){this._x=e||0,this._y=s||0,this._observer=t}clone(t){return new re(t??this._observer,this._x,this._y)}set(t=0,e=t){return(this._x!==t||this._y!==e)&&(this._x=t,this._y=e,this._observer._onUpdate(this)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this._observer._onUpdate(this)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[pixi.js/math:ObservablePoint x=${this._x} y=${this._y} scope=${this._observer}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this._observer._onUpdate(this))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this._observer._onUpdate(this))}}var js=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Wr(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function hm(i){if(i.__esModule)return i;var t=i.default;if(typeof t=="function"){var e=function s(){return this instanceof s?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(i).forEach(function(s){var n=Object.getOwnPropertyDescriptor(i,s);Object.defineProperty(e,s,n.get?n:{enumerable:!0,get:function(){return i[s]}})}),e}var qh={exports:{}};(function(i){var t=Object.prototype.hasOwnProperty,e="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(e=!1));function n(l,c,h){this.fn=l,this.context=c,this.once=h||!1}function r(l,c,h,u,d){if(typeof h!="function")throw new TypeError("The listener must be a function");var f=new n(h,u||l,d),m=e?e+c:c;return l._events[m]?l._events[m].fn?l._events[m]=[l._events[m],f]:l._events[m].push(f):(l._events[m]=f,l._eventsCount++),l}function o(l,c){--l._eventsCount===0?l._events=new s:delete l._events[c]}function a(){this._events=new s,this._eventsCount=0}a.prototype.eventNames=function(){var c=[],h,u;if(this._eventsCount===0)return c;for(u in h=this._events)t.call(h,u)&&c.push(e?u.slice(1):u);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(h)):c},a.prototype.listeners=function(c){var h=e?e+c:c,u=this._events[h];if(!u)return[];if(u.fn)return[u.fn];for(var d=0,f=u.length,m=new Array(f);d<f;d++)m[d]=u[d].fn;return m},a.prototype.listenerCount=function(c){var h=e?e+c:c,u=this._events[h];return u?u.fn?1:u.length:0},a.prototype.emit=function(c,h,u,d,f,m){var y=e?e+c:c;if(!this._events[y])return!1;var g=this._events[y],E=arguments.length,T,_;if(g.fn){switch(g.once&&this.removeListener(c,g.fn,void 0,!0),E){case 1:return g.fn.call(g.context),!0;case 2:return g.fn.call(g.context,h),!0;case 3:return g.fn.call(g.context,h,u),!0;case 4:return g.fn.call(g.context,h,u,d),!0;case 5:return g.fn.call(g.context,h,u,d,f),!0;case 6:return g.fn.call(g.context,h,u,d,f,m),!0}for(_=1,T=new Array(E-1);_<E;_++)T[_-1]=arguments[_];g.fn.apply(g.context,T)}else{var b=g.length,A;for(_=0;_<b;_++)switch(g[_].once&&this.removeListener(c,g[_].fn,void 0,!0),E){case 1:g[_].fn.call(g[_].context);break;case 2:g[_].fn.call(g[_].context,h);break;case 3:g[_].fn.call(g[_].context,h,u);break;case 4:g[_].fn.call(g[_].context,h,u,d);break;default:if(!T)for(A=1,T=new Array(E-1);A<E;A++)T[A-1]=arguments[A];g[_].fn.apply(g[_].context,T)}}return!0},a.prototype.on=function(c,h,u){return r(this,c,h,u,!1)},a.prototype.once=function(c,h,u){return r(this,c,h,u,!0)},a.prototype.removeListener=function(c,h,u,d){var f=e?e+c:c;if(!this._events[f])return this;if(!h)return o(this,f),this;var m=this._events[f];if(m.fn)m.fn===h&&(!d||m.once)&&(!u||m.context===u)&&o(this,f);else{for(var y=0,g=[],E=m.length;y<E;y++)(m[y].fn!==h||d&&!m[y].once||u&&m[y].context!==u)&&g.push(m[y]);g.length?this._events[f]=g.length===1?g[0]:g:o(this,f)}return this},a.prototype.removeAllListeners=function(c){var h;return c?(h=e?e+c:c,this._events[h]&&o(this,h)):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=e,a.EventEmitter=a,i.exports=a})(qh);var um=qh.exports;const Ke=Wr(um),dm=Math.PI*2,fm=180/Math.PI,pm=Math.PI/180;let me=class Kh{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new Kh(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}toString(){return`[pixi.js/math:Point x=${this.x} y=${this.y}]`}static get shared(){return so.x=0,so.y=0,so}};const so=new me;class At{constructor(t=1,e=0,s=0,n=1,r=0,o=0){this.array=null,this.a=t,this.b=e,this.c=s,this.d=n,this.tx=r,this.ty=o}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,s,n,r,o){return this.a=t,this.b=e,this.c=s,this.d=n,this.tx=r,this.ty=o,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const s=e||this.array;return t?(s[0]=this.a,s[1]=this.b,s[2]=0,s[3]=this.c,s[4]=this.d,s[5]=0,s[6]=this.tx,s[7]=this.ty,s[8]=1):(s[0]=this.a,s[1]=this.c,s[2]=this.tx,s[3]=this.b,s[4]=this.d,s[5]=this.ty,s[6]=0,s[7]=0,s[8]=1),s}apply(t,e){e=e||new me;const s=t.x,n=t.y;return e.x=this.a*s+this.c*n+this.tx,e.y=this.b*s+this.d*n+this.ty,e}applyInverse(t,e){e=e||new me;const s=this.a,n=this.b,r=this.c,o=this.d,a=this.tx,l=this.ty,c=1/(s*o+r*-n),h=t.x,u=t.y;return e.x=o*c*h+-r*c*u+(l*r-a*o)*c,e.y=s*c*u+-n*c*h+(-l*s+a*n)*c,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),s=Math.sin(t),n=this.a,r=this.c,o=this.tx;return this.a=n*e-this.b*s,this.b=n*s+this.b*e,this.c=r*e-this.d*s,this.d=r*s+this.d*e,this.tx=o*e-this.ty*s,this.ty=o*s+this.ty*e,this}append(t){const e=this.a,s=this.b,n=this.c,r=this.d;return this.a=t.a*e+t.b*n,this.b=t.a*s+t.b*r,this.c=t.c*e+t.d*n,this.d=t.c*s+t.d*r,this.tx=t.tx*e+t.ty*n+this.tx,this.ty=t.tx*s+t.ty*r+this.ty,this}appendFrom(t,e){const s=t.a,n=t.b,r=t.c,o=t.d,a=t.tx,l=t.ty,c=e.a,h=e.b,u=e.c,d=e.d;return this.a=s*c+n*u,this.b=s*h+n*d,this.c=r*c+o*u,this.d=r*h+o*d,this.tx=a*c+l*u+e.tx,this.ty=a*h+l*d+e.ty,this}setTransform(t,e,s,n,r,o,a,l,c){return this.a=Math.cos(a+c)*r,this.b=Math.sin(a+c)*r,this.c=-Math.sin(a-l)*o,this.d=Math.cos(a-l)*o,this.tx=t-(s*this.a+n*this.c),this.ty=e-(s*this.b+n*this.d),this}prepend(t){const e=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const s=this.a,n=this.c;this.a=s*t.a+this.b*t.c,this.b=s*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,s=this.b,n=this.c,r=this.d,o=t.pivot,a=-Math.atan2(-n,r),l=Math.atan2(s,e),c=Math.abs(a+l);return c<1e-5||Math.abs(dm-c)<1e-5?(t.rotation=l,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=a,t.skew.y=l),t.scale.x=Math.sqrt(e*e+s*s),t.scale.y=Math.sqrt(n*n+r*r),t.position.x=this.tx+(o.x*e+o.y*n),t.position.y=this.ty+(o.x*s+o.y*r),t}invert(){const t=this.a,e=this.b,s=this.c,n=this.d,r=this.tx,o=t*n-e*s;return this.a=n/o,this.b=-e/o,this.c=-s/o,this.d=t/o,this.tx=(s*this.ty-n*r)/o,this.ty=-(t*this.ty-e*r)/o,this}isIdentity(){return this.a===1&&this.b===0&&this.c===0&&this.d===1&&this.tx===0&&this.ty===0}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new At;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}equals(t){return t.a===this.a&&t.b===this.b&&t.c===this.c&&t.d===this.d&&t.tx===this.tx&&t.ty===this.ty}toString(){return`[pixi.js:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return gm.identity()}static get shared(){return mm.identity()}}const mm=new At,gm=new At,Ni=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Di=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],ki=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],Hi=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],qo=[],Zh=[],vn=Math.sign;function ym(){for(let i=0;i<16;i++){const t=[];qo.push(t);for(let e=0;e<16;e++){const s=vn(Ni[i]*Ni[e]+ki[i]*Di[e]),n=vn(Di[i]*Ni[e]+Hi[i]*Di[e]),r=vn(Ni[i]*ki[e]+ki[i]*Hi[e]),o=vn(Di[i]*ki[e]+Hi[i]*Hi[e]);for(let a=0;a<16;a++)if(Ni[a]===s&&Di[a]===n&&ki[a]===r&&Hi[a]===o){t.push(a);break}}}for(let i=0;i<16;i++){const t=new At;t.set(Ni[i],Di[i],ki[i],Hi[i],0,0),Zh.push(t)}}ym();const kt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:i=>Ni[i],uY:i=>Di[i],vX:i=>ki[i],vY:i=>Hi[i],inv:i=>i&8?i&15:-i&7,add:(i,t)=>qo[i][t],sub:(i,t)=>qo[i][kt.inv(t)],rotate180:i=>i^4,isVertical:i=>(i&3)===2,byDirection:(i,t)=>Math.abs(i)*2<=Math.abs(t)?t>=0?kt.S:kt.N:Math.abs(t)*2<=Math.abs(i)?i>0?kt.E:kt.W:t>0?i>0?kt.SE:kt.SW:i>0?kt.NE:kt.NW,matrixAppendRotationInv:(i,t,e=0,s=0)=>{const n=Zh[kt.inv(t)];n.tx=e,n.ty=s,i.append(n)},transformRectCoords:(i,t,e,s)=>{const{x:n,y:r,width:o,height:a}=i,{x:l,y:c,width:h,height:u}=t;return e===kt.E?(s.set(n+l,r+c,o,a),s):e===kt.S?s.set(h-r-a+l,n+c,a,o):e===kt.W?s.set(h-n-o+l,u-r-a+c,o,a):e===kt.N?s.set(r+l,u-n-o+c,a,o):s.set(n+l,r+c,o,a)}},Pn=[new me,new me,new me,new me];class Ot{constructor(t=0,e=0,s=0,n=0){this.type="rectangle",this.x=Number(t),this.y=Number(e),this.width=Number(s),this.height=Number(n)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}isEmpty(){return this.left===this.right||this.top===this.bottom}static get EMPTY(){return new Ot(0,0,0,0)}clone(){return new Ot(this.x,this.y,this.width,this.height)}copyFromBounds(t){return this.x=t.minX,this.y=t.minY,this.width=t.maxX-t.minX,this.height=t.maxY-t.minY,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height}strokeContains(t,e,s,n=.5){const{width:r,height:o}=this;if(r<=0||o<=0)return!1;const a=this.x,l=this.y,c=s*(1-n),h=s-c,u=a-c,d=a+r+c,f=l-c,m=l+o+c,y=a+h,g=a+r-h,E=l+h,T=l+o-h;return t>=u&&t<=d&&e>=f&&e<=m&&!(t>y&&t<g&&e>E&&e<T)}intersects(t,e){if(!e){const O=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=O)return!1;const w=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>w}const s=this.left,n=this.right,r=this.top,o=this.bottom;if(n<=s||o<=r)return!1;const a=Pn[0].set(t.left,t.top),l=Pn[1].set(t.left,t.bottom),c=Pn[2].set(t.right,t.top),h=Pn[3].set(t.right,t.bottom);if(c.x<=a.x||l.y<=a.y)return!1;const u=Math.sign(e.a*e.d-e.b*e.c);if(u===0||(e.apply(a,a),e.apply(l,l),e.apply(c,c),e.apply(h,h),Math.max(a.x,l.x,c.x,h.x)<=s||Math.min(a.x,l.x,c.x,h.x)>=n||Math.max(a.y,l.y,c.y,h.y)<=r||Math.min(a.y,l.y,c.y,h.y)>=o))return!1;const d=u*(l.y-a.y),f=u*(a.x-l.x),m=d*s+f*r,y=d*n+f*r,g=d*s+f*o,E=d*n+f*o;if(Math.max(m,y,g,E)<=d*a.x+f*a.y||Math.min(m,y,g,E)>=d*h.x+f*h.y)return!1;const T=u*(a.y-c.y),_=u*(c.x-a.x),b=T*s+_*r,A=T*n+_*r,C=T*s+_*o,R=T*n+_*o;return!(Math.max(b,A,C,R)<=T*a.x+_*a.y||Math.min(b,A,C,R)>=T*h.x+_*h.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2,this}fit(t){const e=Math.max(this.x,t.x),s=Math.min(this.x+this.width,t.x+t.width),n=Math.max(this.y,t.y),r=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(s-e,0),this.y=n,this.height=Math.max(r-n,0),this}ceil(t=1,e=.001){const s=Math.ceil((this.x+this.width-e)*t)/t,n=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=s-this.x,this.height=n-this.y,this}scale(t,e=t){return this.x*=t,this.y*=e,this.width*=t,this.height*=e,this}enlarge(t){const e=Math.min(this.x,t.x),s=Math.max(this.x+this.width,t.x+t.width),n=Math.min(this.y,t.y),r=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=s-e,this.y=n,this.height=r-n,this}getBounds(t){return t||(t=new Ot),t.copyFrom(this),t}containsRect(t){if(this.width<=0||this.height<=0)return!1;const e=t.x,s=t.y,n=t.x+t.width,r=t.y+t.height;return e>=this.x&&e<this.x+this.width&&s>=this.y&&s<this.y+this.height&&n>=this.x&&n<this.x+this.width&&r>=this.y&&r<this.y+this.height}set(t,e,s,n){return this.x=t,this.y=e,this.width=s,this.height=n,this}toString(){return`[pixi.js/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}const no={default:-1};function Xt(i="default"){return no[i]===void 0&&(no[i]=-1),++no[i]}const Il=new Set,Rt="8.0.0",Sm="8.3.4",rs={quiet:!1,noColor:!1},dt=(i,t,e=3)=>{if(rs.quiet||Il.has(t))return;let s=new Error().stack;const n=`${t}
Deprecated since v${i}`,r=typeof console.groupCollapsed=="function"&&!rs.noColor;typeof s>"u"?console.warn("PixiJS Deprecation Warning: ",n):(s=s.split(`
`).splice(e).join(`
`),r?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",n),console.warn(s),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",n),console.warn(s))),Il.add(t)};Object.defineProperties(dt,{quiet:{get:()=>rs.quiet,set:i=>{rs.quiet=i},enumerable:!0,configurable:!1},noColor:{get:()=>rs.noColor,set:i=>{rs.noColor=i},enumerable:!0,configurable:!1}});const Jh=()=>{};function ms(i){return i+=i===0?1:0,--i,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,i|=i>>>16,i+1}function Ml(i){return!(i&i-1)&&!!i}function Qh(i){const t={};for(const e in i)i[e]!==void 0&&(t[e]=i[e]);return t}const Ol=Object.create(null);function Tm(i){const t=Ol[i];return t===void 0&&(Ol[i]=Xt("resource")),t}const tu=class eu extends Ke{constructor(t={}){super(),this._resourceType="textureSampler",this._touched=0,this._maxAnisotropy=1,this.destroyed=!1,t={...eu.defaultOptions,...t},this.addressMode=t.addressMode,this.addressModeU=t.addressModeU??this.addressModeU,this.addressModeV=t.addressModeV??this.addressModeV,this.addressModeW=t.addressModeW??this.addressModeW,this.scaleMode=t.scaleMode,this.magFilter=t.magFilter??this.magFilter,this.minFilter=t.minFilter??this.minFilter,this.mipmapFilter=t.mipmapFilter??this.mipmapFilter,this.lodMinClamp=t.lodMinClamp,this.lodMaxClamp=t.lodMaxClamp,this.compare=t.compare,this.maxAnisotropy=t.maxAnisotropy??1}set addressMode(t){this.addressModeU=t,this.addressModeV=t,this.addressModeW=t}get addressMode(){return this.addressModeU}set wrapMode(t){dt(Rt,"TextureStyle.wrapMode is now TextureStyle.addressMode"),this.addressMode=t}get wrapMode(){return this.addressMode}set scaleMode(t){this.magFilter=t,this.minFilter=t,this.mipmapFilter=t}get scaleMode(){return this.magFilter}set maxAnisotropy(t){this._maxAnisotropy=Math.min(t,16),this._maxAnisotropy>1&&(this.scaleMode="linear")}get maxAnisotropy(){return this._maxAnisotropy}get _resourceId(){return this._sharedResourceId||this._generateResourceId()}update(){this.emit("change",this),this._sharedResourceId=null}_generateResourceId(){const t=`${this.addressModeU}-${this.addressModeV}-${this.addressModeW}-${this.magFilter}-${this.minFilter}-${this.mipmapFilter}-${this.lodMinClamp}-${this.lodMaxClamp}-${this.compare}-${this._maxAnisotropy}`;return this._sharedResourceId=Tm(t),this._resourceId}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this.removeAllListeners()}};tu.defaultOptions={addressMode:"clamp-to-edge",scaleMode:"linear"};let gs=tu;const iu=class su extends Ke{constructor(t={}){super(),this.options=t,this.uid=Xt("textureSource"),this._resourceType="textureSource",this._resourceId=Xt("resource"),this.uploadMethodId="unknown",this._resolution=1,this.pixelWidth=1,this.pixelHeight=1,this.width=1,this.height=1,this.sampleCount=1,this.mipLevelCount=1,this.autoGenerateMipmaps=!1,this.format="rgba8unorm",this.dimension="2d",this.antialias=!1,this._touched=0,this._batchTick=-1,this._textureBindLocation=-1,t={...su.defaultOptions,...t},this.label=t.label??"",this.resource=t.resource,this.autoGarbageCollect=t.autoGarbageCollect,this._resolution=t.resolution,t.width?this.pixelWidth=t.width*this._resolution:this.pixelWidth=this.resource?this.resourceWidth??1:1,t.height?this.pixelHeight=t.height*this._resolution:this.pixelHeight=this.resource?this.resourceHeight??1:1,this.width=this.pixelWidth/this._resolution,this.height=this.pixelHeight/this._resolution,this.format=t.format,this.dimension=t.dimensions,this.mipLevelCount=t.mipLevelCount,this.autoGenerateMipmaps=t.autoGenerateMipmaps,this.sampleCount=t.sampleCount,this.antialias=t.antialias,this.alphaMode=t.alphaMode,this.style=new gs(Qh(t)),this.destroyed=!1,this._refreshPOT()}get source(){return this}get style(){return this._style}set style(t){var e,s;this.style!==t&&((e=this._style)==null||e.off("change",this._onStyleChange,this),this._style=t,(s=this._style)==null||s.on("change",this._onStyleChange,this),this._onStyleChange())}set maxAnisotropy(t){this._style.maxAnisotropy=t}get maxAnisotropy(){return this._style.maxAnisotropy}get addressMode(){return this._style.addressMode}set addressMode(t){this._style.addressMode=t}get repeatMode(){return this._style.addressMode}set repeatMode(t){this._style.addressMode=t}get magFilter(){return this._style.magFilter}set magFilter(t){this._style.magFilter=t}get minFilter(){return this._style.minFilter}set minFilter(t){this._style.minFilter=t}get mipmapFilter(){return this._style.mipmapFilter}set mipmapFilter(t){this._style.mipmapFilter=t}get lodMinClamp(){return this._style.lodMinClamp}set lodMinClamp(t){this._style.lodMinClamp=t}get lodMaxClamp(){return this._style.lodMaxClamp}set lodMaxClamp(t){this._style.lodMaxClamp=t}_onStyleChange(){this.emit("styleChange",this)}update(){if(this.resource){const t=this._resolution;if(this.resize(this.resourceWidth/t,this.resourceHeight/t))return}this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._style&&(this._style.destroy(),this._style=null),this.uploadMethodId=null,this.resource=null,this.removeAllListeners()}unload(){this._resourceId=Xt("resource"),this.emit("change",this),this.emit("unload",this)}get resourceWidth(){const{resource:t}=this;return t.naturalWidth||t.videoWidth||t.displayWidth||t.width}get resourceHeight(){const{resource:t}=this;return t.naturalHeight||t.videoHeight||t.displayHeight||t.height}get resolution(){return this._resolution}set resolution(t){this._resolution!==t&&(this._resolution=t,this.width=this.pixelWidth/t,this.height=this.pixelHeight/t)}resize(t,e,s){s||(s=this._resolution),t||(t=this.width),e||(e=this.height);const n=Math.round(t*s),r=Math.round(e*s);return this.width=n/s,this.height=r/s,this._resolution=s,this.pixelWidth===n&&this.pixelHeight===r?!1:(this._refreshPOT(),this.pixelWidth=n,this.pixelHeight=r,this.emit("resize",this),this._resourceId=Xt("resource"),this.emit("change",this),!0)}updateMipmaps(){this.autoGenerateMipmaps&&this.mipLevelCount>1&&this.emit("updateMipmaps",this)}set wrapMode(t){this._style.wrapMode=t}get wrapMode(){return this._style.wrapMode}set scaleMode(t){this._style.scaleMode=t}get scaleMode(){return this._style.scaleMode}_refreshPOT(){this.isPowerOfTwo=Ml(this.pixelWidth)&&Ml(this.pixelHeight)}static test(t){throw new Error("Unimplemented")}};iu.defaultOptions={resolution:1,format:"bgra8unorm",alphaMode:"premultiply-alpha-on-upload",dimensions:"2d",mipLevelCount:1,autoGenerateMipmaps:!1,sampleCount:1,antialias:!1,autoGarbageCollect:!1};let Ne=iu;class Da extends Ne{constructor(t){const e=t.resource||new Float32Array(t.width*t.height*4);let s=t.format;s||(e instanceof Float32Array?s="rgba32float":e instanceof Int32Array||e instanceof Uint32Array?s="rgba32uint":e instanceof Int16Array||e instanceof Uint16Array?s="rgba16uint":(e instanceof Int8Array,s="bgra8unorm")),super({...t,resource:e,format:s}),this.uploadMethodId="buffer"}static test(t){return t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}Da.extension=lt.TextureSource;const vl=new At;class Em{constructor(t,e){this.mapCoord=new At,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,typeof e>"u"?this.clampMargin=t.width<10?0:.5:this.clampMargin=e,this.isSimple=!1,this.texture=t}get texture(){return this._texture}set texture(t){var e;this.texture!==t&&((e=this._texture)==null||e.removeListener("update",this.update,this),this._texture=t,this._texture.addListener("update",this.update,this),this.update())}multiplyUvs(t,e){e===void 0&&(e=t);const s=this.mapCoord;for(let n=0;n<t.length;n+=2){const r=t[n],o=t[n+1];e[n]=r*s.a+o*s.c+s.tx,e[n+1]=r*s.b+o*s.d+s.ty}return e}update(){const t=this._texture;this._updateID++;const e=t.uvs;this.mapCoord.set(e.x1-e.x0,e.y1-e.y0,e.x3-e.x0,e.y3-e.y0,e.x0,e.y0);const s=t.orig,n=t.trim;n&&(vl.set(s.width/n.width,0,0,s.height/n.height,-n.x/n.width,-n.y/n.height),this.mapCoord.append(vl));const r=t.source,o=this.uClampFrame,a=this.clampMargin/r._resolution,l=this.clampOffset/r._resolution;return o[0]=(t.frame.x+a+l)/r.width,o[1]=(t.frame.y+a+l)/r.height,o[2]=(t.frame.x+t.frame.width-a+l)/r.width,o[3]=(t.frame.y+t.frame.height-a+l)/r.height,this.uClampOffset[0]=this.clampOffset/r.pixelWidth,this.uClampOffset[1]=this.clampOffset/r.pixelHeight,this.isSimple=t.frame.width===r.width&&t.frame.height===r.height&&t.rotate===0,!0}}let _t=class extends Ke{constructor({source:t,label:e,frame:s,orig:n,trim:r,defaultAnchor:o,defaultBorders:a,rotate:l,dynamic:c}={}){if(super(),this.uid=Xt("texture"),this.uvs={x0:0,y0:0,x1:0,y1:0,x2:0,y2:0,x3:0,y3:0},this.frame=new Ot,this.noFrame=!1,this.dynamic=!1,this.isTexture=!0,this.label=e,this.source=(t==null?void 0:t.source)??new Ne,this.noFrame=!s,s)this.frame.copyFrom(s);else{const{width:h,height:u}=this._source;this.frame.width=h,this.frame.height=u}this.orig=n||this.frame,this.trim=r,this.rotate=l??0,this.defaultAnchor=o,this.defaultBorders=a,this.destroyed=!1,this.dynamic=c||!1,this.updateUvs()}set source(t){this._source&&this._source.off("resize",this.update,this),this._source=t,t.on("resize",this.update,this),this.emit("update",this)}get source(){return this._source}get textureMatrix(){return this._textureMatrix||(this._textureMatrix=new Em(this)),this._textureMatrix}get width(){return this.orig.width}get height(){return this.orig.height}updateUvs(){const{uvs:t,frame:e}=this,{width:s,height:n}=this._source,r=e.x/s,o=e.y/n,a=e.width/s,l=e.height/n;let c=this.rotate;if(c){const h=a/2,u=l/2,d=r+h,f=o+u;c=kt.add(c,kt.NW),t.x0=d+h*kt.uX(c),t.y0=f+u*kt.uY(c),c=kt.add(c,2),t.x1=d+h*kt.uX(c),t.y1=f+u*kt.uY(c),c=kt.add(c,2),t.x2=d+h*kt.uX(c),t.y2=f+u*kt.uY(c),c=kt.add(c,2),t.x3=d+h*kt.uX(c),t.y3=f+u*kt.uY(c)}else t.x0=r,t.y0=o,t.x1=r+a,t.y1=o,t.x2=r+a,t.y2=o+l,t.x3=r,t.y3=o+l}destroy(t=!1){this._source&&t&&(this._source.destroy(),this._source=null),this._textureMatrix=null,this.destroyed=!0,this.emit("destroy",this),this.removeAllListeners()}update(){this.noFrame&&(this.frame.width=this._source.width,this.frame.height=this._source.height),this.updateUvs(),this.emit("update",this)}get baseTexture(){return dt(Rt,"Texture.baseTexture is now Texture.source"),this._source}};_t.EMPTY=new _t({label:"EMPTY",source:new Ne({label:"EMPTY"})});_t.EMPTY.destroy=Jh;_t.WHITE=new _t({source:new Da({resource:new Uint8Array([255,255,255,255]),width:1,height:1,alphaMode:"premultiply-alpha-on-upload",label:"WHITE"}),label:"WHITE"});_t.WHITE.destroy=Jh;function _m(i,t,e){const{width:s,height:n}=e.orig,r=e.trim;if(r){const o=r.width,a=r.height;i.minX=r.x-t._x*s,i.maxX=i.minX+o,i.minY=r.y-t._y*n,i.maxY=i.minY+a}else i.minX=-t._x*s,i.maxX=i.minX+s,i.minY=-t._y*n,i.maxY=i.minY+n}const Pl=new At;class ze{constructor(t=1/0,e=1/0,s=-1/0,n=-1/0){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=Pl,this.minX=t,this.minY=e,this.maxX=s,this.maxY=n}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}get rectangle(){this._rectangle||(this._rectangle=new Ot);const t=this._rectangle;return this.minX>this.maxX||this.minY>this.maxY?(t.x=0,t.y=0,t.width=0,t.height=0):t.copyFromBounds(this),t}clear(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=Pl,this}set(t,e,s,n){this.minX=t,this.minY=e,this.maxX=s,this.maxY=n}addFrame(t,e,s,n,r){r||(r=this.matrix);const o=r.a,a=r.b,l=r.c,c=r.d,h=r.tx,u=r.ty;let d=this.minX,f=this.minY,m=this.maxX,y=this.maxY,g=o*t+l*e+h,E=a*t+c*e+u;g<d&&(d=g),E<f&&(f=E),g>m&&(m=g),E>y&&(y=E),g=o*s+l*e+h,E=a*s+c*e+u,g<d&&(d=g),E<f&&(f=E),g>m&&(m=g),E>y&&(y=E),g=o*t+l*n+h,E=a*t+c*n+u,g<d&&(d=g),E<f&&(f=E),g>m&&(m=g),E>y&&(y=E),g=o*s+l*n+h,E=a*s+c*n+u,g<d&&(d=g),E<f&&(f=E),g>m&&(m=g),E>y&&(y=E),this.minX=d,this.minY=f,this.maxX=m,this.maxY=y}addRect(t,e){this.addFrame(t.x,t.y,t.x+t.width,t.y+t.height,e)}addBounds(t,e){this.addFrame(t.minX,t.minY,t.maxX,t.maxY,e)}addBoundsMask(t){this.minX=this.minX>t.minX?this.minX:t.minX,this.minY=this.minY>t.minY?this.minY:t.minY,this.maxX=this.maxX<t.maxX?this.maxX:t.maxX,this.maxY=this.maxY<t.maxY?this.maxY:t.maxY}applyMatrix(t){const e=this.minX,s=this.minY,n=this.maxX,r=this.maxY,{a:o,b:a,c:l,d:c,tx:h,ty:u}=t;let d=o*e+l*s+h,f=a*e+c*s+u;this.minX=d,this.minY=f,this.maxX=d,this.maxY=f,d=o*n+l*s+h,f=a*n+c*s+u,this.minX=d<this.minX?d:this.minX,this.minY=f<this.minY?f:this.minY,this.maxX=d>this.maxX?d:this.maxX,this.maxY=f>this.maxY?f:this.maxY,d=o*e+l*r+h,f=a*e+c*r+u,this.minX=d<this.minX?d:this.minX,this.minY=f<this.minY?f:this.minY,this.maxX=d>this.maxX?d:this.maxX,this.maxY=f>this.maxY?f:this.maxY,d=o*n+l*r+h,f=a*n+c*r+u,this.minX=d<this.minX?d:this.minX,this.minY=f<this.minY?f:this.minY,this.maxX=d>this.maxX?d:this.maxX,this.maxY=f>this.maxY?f:this.maxY}fit(t){return this.minX<t.left&&(this.minX=t.left),this.maxX>t.right&&(this.maxX=t.right),this.minY<t.top&&(this.minY=t.top),this.maxY>t.bottom&&(this.maxY=t.bottom),this}fitBounds(t,e,s,n){return this.minX<t&&(this.minX=t),this.maxX>e&&(this.maxX=e),this.minY<s&&(this.minY=s),this.maxY>n&&(this.maxY=n),this}pad(t,e=t){return this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e,this}ceil(){return this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this}clone(){return new ze(this.minX,this.minY,this.maxX,this.maxY)}scale(t,e=t){return this.minX*=t,this.minY*=e,this.maxX*=t,this.maxY*=e,this}get x(){return this.minX}set x(t){const e=this.maxX-this.minX;this.minX=t,this.maxX=t+e}get y(){return this.minY}set y(t){const e=this.maxY-this.minY;this.minY=t,this.maxY=t+e}get width(){return this.maxX-this.minX}set width(t){this.maxX=this.minX+t}get height(){return this.maxY-this.minY}set height(t){this.maxY=this.minY+t}get left(){return this.minX}get right(){return this.maxX}get top(){return this.minY}get bottom(){return this.maxY}get isPositive(){return this.maxX-this.minX>0&&this.maxY-this.minY>0}get isValid(){return this.minX+this.minY!==1/0}addVertexData(t,e,s,n){let r=this.minX,o=this.minY,a=this.maxX,l=this.maxY;n||(n=this.matrix);const c=n.a,h=n.b,u=n.c,d=n.d,f=n.tx,m=n.ty;for(let y=e;y<s;y+=2){const g=t[y],E=t[y+1],T=c*g+u*E+f,_=h*g+d*E+m;r=T<r?T:r,o=_<o?_:o,a=T>a?T:a,l=_>l?_:l}this.minX=r,this.minY=o,this.maxX=a,this.maxY=l}containsPoint(t,e){return this.minX<=t&&this.minY<=e&&this.maxX>=t&&this.maxY>=e}toString(){return`[pixi.js:Bounds minX=${this.minX} minY=${this.minY} maxX=${this.maxX} maxY=${this.maxY} width=${this.width} height=${this.height}]`}copyFrom(t){return this.minX=t.minX,this.minY=t.minY,this.maxX=t.maxX,this.maxY=t.maxY,this}}var bm={grad:.9,turn:360,rad:360/(2*Math.PI)},ai=function(i){return typeof i=="string"?i.length>0:typeof i=="number"},ee=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=Math.pow(10,t)),Math.round(e*i)/e+0},Me=function(i,t,e){return t===void 0&&(t=0),e===void 0&&(e=1),i>e?e:i>t?i:t},nu=function(i){return(i=isFinite(i)?i%360:0)>0?i:i+360},Ll=function(i){return{r:Me(i.r,0,255),g:Me(i.g,0,255),b:Me(i.b,0,255),a:Me(i.a)}},ro=function(i){return{r:ee(i.r),g:ee(i.g),b:ee(i.b),a:ee(i.a,3)}},xm=/^#([0-9a-f]{3,8})$/i,Ln=function(i){var t=i.toString(16);return t.length<2?"0"+t:t},ru=function(i){var t=i.r,e=i.g,s=i.b,n=i.a,r=Math.max(t,e,s),o=r-Math.min(t,e,s),a=o?r===t?(e-s)/o:r===e?2+(s-t)/o:4+(t-e)/o:0;return{h:60*(a<0?a+6:a),s:r?o/r*100:0,v:r/255*100,a:n}},ou=function(i){var t=i.h,e=i.s,s=i.v,n=i.a;t=t/360*6,e/=100,s/=100;var r=Math.floor(t),o=s*(1-e),a=s*(1-(t-r)*e),l=s*(1-(1-t+r)*e),c=r%6;return{r:255*[s,a,o,o,l,s][c],g:255*[l,s,s,a,o,o][c],b:255*[o,o,l,s,s,a][c],a:n}},Nl=function(i){return{h:nu(i.h),s:Me(i.s,0,100),l:Me(i.l,0,100),a:Me(i.a)}},Dl=function(i){return{h:ee(i.h),s:ee(i.s),l:ee(i.l),a:ee(i.a,3)}},kl=function(i){return ou((e=(t=i).s,{h:t.h,s:(e*=((s=t.l)<50?s:100-s)/100)>0?2*e/(s+e)*100:0,v:s+e,a:t.a}));var t,e,s},tn=function(i){return{h:(t=ru(i)).h,s:(n=(200-(e=t.s))*(s=t.v)/100)>0&&n<200?e*s/100/(n<=100?n:200-n)*100:0,l:n/2,a:t.a};var t,e,s,n},Am=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Cm=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Rm=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,wm=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Ko={string:[[function(i){var t=xm.exec(i);return t?(i=t[1]).length<=4?{r:parseInt(i[0]+i[0],16),g:parseInt(i[1]+i[1],16),b:parseInt(i[2]+i[2],16),a:i.length===4?ee(parseInt(i[3]+i[3],16)/255,2):1}:i.length===6||i.length===8?{r:parseInt(i.substr(0,2),16),g:parseInt(i.substr(2,2),16),b:parseInt(i.substr(4,2),16),a:i.length===8?ee(parseInt(i.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(i){var t=Rm.exec(i)||wm.exec(i);return t?t[2]!==t[4]||t[4]!==t[6]?null:Ll({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(i){var t=Am.exec(i)||Cm.exec(i);if(!t)return null;var e,s,n=Nl({h:(e=t[1],s=t[2],s===void 0&&(s="deg"),Number(e)*(bm[s]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return kl(n)},"hsl"]],object:[[function(i){var t=i.r,e=i.g,s=i.b,n=i.a,r=n===void 0?1:n;return ai(t)&&ai(e)&&ai(s)?Ll({r:Number(t),g:Number(e),b:Number(s),a:Number(r)}):null},"rgb"],[function(i){var t=i.h,e=i.s,s=i.l,n=i.a,r=n===void 0?1:n;if(!ai(t)||!ai(e)||!ai(s))return null;var o=Nl({h:Number(t),s:Number(e),l:Number(s),a:Number(r)});return kl(o)},"hsl"],[function(i){var t=i.h,e=i.s,s=i.v,n=i.a,r=n===void 0?1:n;if(!ai(t)||!ai(e)||!ai(s))return null;var o=function(a){return{h:nu(a.h),s:Me(a.s,0,100),v:Me(a.v,0,100),a:Me(a.a)}}({h:Number(t),s:Number(e),v:Number(s),a:Number(r)});return ou(o)},"hsv"]]},Hl=function(i,t){for(var e=0;e<t.length;e++){var s=t[e][0](i);if(s)return[s,t[e][1]]}return[null,void 0]},Im=function(i){return typeof i=="string"?Hl(i.trim(),Ko.string):typeof i=="object"&&i!==null?Hl(i,Ko.object):[null,void 0]},oo=function(i,t){var e=tn(i);return{h:e.h,s:Me(e.s+100*t,0,100),l:e.l,a:e.a}},ao=function(i){return(299*i.r+587*i.g+114*i.b)/1e3/255},Fl=function(i,t){var e=tn(i);return{h:e.h,s:e.s,l:Me(e.l+100*t,0,100),a:e.a}},Zo=function(){function i(t){this.parsed=Im(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return i.prototype.isValid=function(){return this.parsed!==null},i.prototype.brightness=function(){return ee(ao(this.rgba),2)},i.prototype.isDark=function(){return ao(this.rgba)<.5},i.prototype.isLight=function(){return ao(this.rgba)>=.5},i.prototype.toHex=function(){return t=ro(this.rgba),e=t.r,s=t.g,n=t.b,o=(r=t.a)<1?Ln(ee(255*r)):"","#"+Ln(e)+Ln(s)+Ln(n)+o;var t,e,s,n,r,o},i.prototype.toRgb=function(){return ro(this.rgba)},i.prototype.toRgbString=function(){return t=ro(this.rgba),e=t.r,s=t.g,n=t.b,(r=t.a)<1?"rgba("+e+", "+s+", "+n+", "+r+")":"rgb("+e+", "+s+", "+n+")";var t,e,s,n,r},i.prototype.toHsl=function(){return Dl(tn(this.rgba))},i.prototype.toHslString=function(){return t=Dl(tn(this.rgba)),e=t.h,s=t.s,n=t.l,(r=t.a)<1?"hsla("+e+", "+s+"%, "+n+"%, "+r+")":"hsl("+e+", "+s+"%, "+n+"%)";var t,e,s,n,r},i.prototype.toHsv=function(){return t=ru(this.rgba),{h:ee(t.h),s:ee(t.s),v:ee(t.v),a:ee(t.a,3)};var t},i.prototype.invert=function(){return ti({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},i.prototype.saturate=function(t){return t===void 0&&(t=.1),ti(oo(this.rgba,t))},i.prototype.desaturate=function(t){return t===void 0&&(t=.1),ti(oo(this.rgba,-t))},i.prototype.grayscale=function(){return ti(oo(this.rgba,-1))},i.prototype.lighten=function(t){return t===void 0&&(t=.1),ti(Fl(this.rgba,t))},i.prototype.darken=function(t){return t===void 0&&(t=.1),ti(Fl(this.rgba,-t))},i.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},i.prototype.alpha=function(t){return typeof t=="number"?ti({r:(e=this.rgba).r,g:e.g,b:e.b,a:t}):ee(this.rgba.a,3);var e},i.prototype.hue=function(t){var e=tn(this.rgba);return typeof t=="number"?ti({h:t,s:e.s,l:e.l,a:e.a}):ee(e.h)},i.prototype.isEqual=function(t){return this.toHex()===ti(t).toHex()},i}(),ti=function(i){return i instanceof Zo?i:new Zo(i)},Bl=[],Mm=function(i){i.forEach(function(t){Bl.indexOf(t)<0&&(t(Zo,Ko),Bl.push(t))})};function Om(i,t){var e={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},s={};for(var n in e)s[e[n]]=n;var r={};i.prototype.toName=function(o){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,l,c=s[this.toHex()];if(c)return c;if(o!=null&&o.closest){var h=this.toRgb(),u=1/0,d="black";if(!r.length)for(var f in e)r[f]=new i(e[f]).toRgb();for(var m in e){var y=(a=h,l=r[m],Math.pow(a.r-l.r,2)+Math.pow(a.g-l.g,2)+Math.pow(a.b-l.b,2));y<u&&(u=y,d=m)}return d}},t.string.push([function(o){var a=o.toLowerCase(),l=a==="transparent"?"#0000":e[a];return l?new i(l).toRgb():null},"name"])}Mm([Om]);const ys=class Ws{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof Ws)this._value=this._cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set Color#value to null");(this._value===null||!this._isSourceEqual(this._value,t))&&(this._value=this._cloneSource(t),this._normalize(this._value))}}get value(){return this._value}_cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}_isSourceEqual(t,e){const s=typeof t;if(s!==typeof e)return!1;if(s==="number"||s==="string"||t instanceof Number)return t===e;if(Array.isArray(t)&&Array.isArray(e)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(e))return t.length!==e.length?!1:t.every((r,o)=>r===e[o]);if(t!==null&&e!==null){const r=Object.keys(t),o=Object.keys(e);return r.length!==o.length?!1:r.every(a=>t[a]===e[a])}return t===e}toRgba(){const[t,e,s,n]=this._components;return{r:t,g:e,b:s,a:n}}toRgb(){const[t,e,s]=this._components;return{r:t,g:e,b:s}}toRgbaString(){const[t,e,s]=this.toUint8RgbArray();return`rgba(${t},${e},${s},${this.alpha})`}toUint8RgbArray(t){const[e,s,n]=this._components;return this._arrayRgb||(this._arrayRgb=[]),t||(t=this._arrayRgb),t[0]=Math.round(e*255),t[1]=Math.round(s*255),t[2]=Math.round(n*255),t}toArray(t){this._arrayRgba||(this._arrayRgba=[]),t||(t=this._arrayRgba);const[e,s,n,r]=this._components;return t[0]=e,t[1]=s,t[2]=n,t[3]=r,t}toRgbArray(t){this._arrayRgb||(this._arrayRgb=[]),t||(t=this._arrayRgb);const[e,s,n]=this._components;return t[0]=e,t[1]=s,t[2]=n,t}toNumber(){return this._int}toBgrNumber(){const[t,e,s]=this.toUint8RgbArray();return(s<<16)+(e<<8)+t}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[e,s,n,r]=Ws._temp.setValue(t)._components;return this._components[0]*=e,this._components[1]*=s,this._components[2]*=n,this._components[3]*=r,this._refreshInt(),this._value=null,this}premultiply(t,e=!0){return e&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this._refreshInt(),this._value=null,this}toPremultiplied(t,e=!0){if(t===1)return(255<<24)+this._int;if(t===0)return e?0:this._int;let s=this._int>>16&255,n=this._int>>8&255,r=this._int&255;return e&&(s=s*t+.5|0,n=n*t+.5|0,r=r*t+.5|0),(t*255<<24)+(s<<16)+(n<<8)+r}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const e=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-e.length)+e}setAlpha(t){return this._components[3]=this._clamp(t),this}_normalize(t){let e,s,n,r;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){const o=t;e=(o>>16&255)/255,s=(o>>8&255)/255,n=(o&255)/255,r=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[e,s,n,r=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[e,s,n,r=255]=t,e/=255,s/=255,n/=255,r/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){const a=Ws.HEX_PATTERN.exec(t);a&&(t=`#${a[2]}`)}const o=ti(t);o.isValid()&&({r:e,g:s,b:n,a:r}=o.rgba,e/=255,s/=255,n/=255)}if(e!==void 0)this._components[0]=e,this._components[1]=s,this._components[2]=n,this._components[3]=r,this._refreshInt();else throw new Error(`Unable to convert color ${t}`)}_refreshInt(){this._clamp(this._components);const[t,e,s]=this._components;this._int=(t*255<<16)+(e*255<<8)+(s*255|0)}_clamp(t,e=0,s=1){return typeof t=="number"?Math.min(Math.max(t,e),s):(t.forEach((n,r)=>{t[r]=Math.min(Math.max(n,e),s)}),t)}static isColorLike(t){return typeof t=="number"||typeof t=="string"||t instanceof Number||t instanceof Ws||Array.isArray(t)||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Float32Array||t.r!==void 0&&t.g!==void 0&&t.b!==void 0||t.r!==void 0&&t.g!==void 0&&t.b!==void 0&&t.a!==void 0||t.h!==void 0&&t.s!==void 0&&t.l!==void 0||t.h!==void 0&&t.s!==void 0&&t.l!==void 0&&t.a!==void 0||t.h!==void 0&&t.s!==void 0&&t.v!==void 0||t.h!==void 0&&t.s!==void 0&&t.v!==void 0&&t.a!==void 0}};ys.shared=new ys;ys._temp=new ys;ys.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let Kt=ys;const vm={cullArea:null,cullable:!1,cullableChildren:!0};let lo=0;const Ul=500;function Bt(...i){lo!==Ul&&(lo++,lo===Ul?console.warn("PixiJS Warning: too many warnings, no more warnings will be reported to the console by PixiJS."):console.warn("PixiJS Warning: ",...i))}const xn={_registeredResources:new Set,register(i){this._registeredResources.add(i)},unregister(i){this._registeredResources.delete(i)},release(){this._registeredResources.forEach(i=>i.clear())},get registeredCount(){return this._registeredResources.size},isRegistered(i){return this._registeredResources.has(i)},reset(){this._registeredResources.clear()}};class Pm{constructor(t,e){this._pool=[],this._count=0,this._index=0,this._classType=t,e&&this.prepopulate(e)}prepopulate(t){for(let e=0;e<t;e++)this._pool[this._index++]=new this._classType;this._count+=t}get(t){var s;let e;return this._index>0?e=this._pool[--this._index]:e=new this._classType,(s=e.init)==null||s.call(e,t),e}return(t){var e;(e=t.reset)==null||e.call(t),this._pool[this._index++]=t}get totalSize(){return this._count}get totalFree(){return this._index}get totalUsed(){return this._count-this._index}clear(){if(this._pool.length>0&&this._pool[0].destroy)for(let t=0;t<this._index;t++)this._pool[t].destroy();this._pool.length=0,this._count=0,this._index=0}}class Lm{constructor(){this._poolsByClass=new Map}prepopulate(t,e){this.getPool(t).prepopulate(e)}get(t,e){return this.getPool(t).get(e)}return(t){this.getPool(t.constructor).return(t)}getPool(t){return this._poolsByClass.has(t)||this._poolsByClass.set(t,new Pm(t)),this._poolsByClass.get(t)}stats(){const t={};return this._poolsByClass.forEach(e=>{const s=t[e._classType.name]?e._classType.name+e._classType.ID:e._classType.name;t[s]={free:e.totalFree,used:e.totalUsed,size:e.totalSize}}),t}clear(){this._poolsByClass.forEach(t=>t.clear()),this._poolsByClass.clear()}}const Oe=new Lm;xn.register(Oe);const Nm={get isCachedAsTexture(){var i;return!!((i=this.renderGroup)!=null&&i.isCachedAsTexture)},cacheAsTexture(i){typeof i=="boolean"&&i===!1?this.disableRenderGroup():(this.enableRenderGroup(),this.renderGroup.enableCacheAsTexture(i===!0?{}:i))},updateCacheTexture(){var i;(i=this.renderGroup)==null||i.updateCacheTexture()},get cacheAsBitmap(){return this.isCachedAsTexture},set cacheAsBitmap(i){dt("v8.6.0","cacheAsBitmap is deprecated, use cacheAsTexture instead."),this.cacheAsTexture(i)}};function Dm(i,t,e){const s=i.length;let n;if(t>=s||e===0)return;e=t+e>s?s-t:e;const r=s-e;for(n=t;n<r;++n)i[n]=i[n+e];i.length=r}const km={allowChildren:!0,removeChildren(i=0,t){var r;const e=t??this.children.length,s=e-i,n=[];if(s>0&&s<=e){for(let a=e-1;a>=i;a--){const l=this.children[a];l&&(n.push(l),l.parent=null)}Dm(this.children,i,e);const o=this.renderGroup||this.parentRenderGroup;o&&o.removeChildren(n);for(let a=0;a<n.length;++a){const l=n[a];(r=l.parentRenderLayer)==null||r.detach(l),this.emit("childRemoved",l,this,a),n[a].emit("removed",this)}return n.length>0&&this._didViewChangeTick++,n}else if(s===0&&this.children.length===0)return n;throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},removeChildAt(i){const t=this.getChildAt(i);return this.removeChild(t)},getChildAt(i){if(i<0||i>=this.children.length)throw new Error(`getChildAt: Index (${i}) does not exist.`);return this.children[i]},setChildIndex(i,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);this.getChildIndex(i),this.addChildAt(i,t)},getChildIndex(i){const t=this.children.indexOf(i);if(t===-1)throw new Error("The supplied Container must be a child of the caller");return t},addChildAt(i,t){this.allowChildren||dt(Rt,"addChildAt: Only Containers will be allowed to add children in v8.0.0");const{children:e}=this;if(t<0||t>e.length)throw new Error(`${i}addChildAt: The index ${t} supplied is out of bounds ${e.length}`);if(i.parent){const n=i.parent.children.indexOf(i);if(i.parent===this&&n===t)return i;n!==-1&&i.parent.children.splice(n,1)}t===e.length?e.push(i):e.splice(t,0,i),i.parent=this,i.didChange=!0,i._updateFlags=15;const s=this.renderGroup||this.parentRenderGroup;return s&&s.addChild(i),this.sortableChildren&&(this.sortDirty=!0),this.emit("childAdded",i,this,t),i.emit("added",this),i},swapChildren(i,t){if(i===t)return;const e=this.getChildIndex(i),s=this.getChildIndex(t);this.children[e]=t,this.children[s]=i;const n=this.renderGroup||this.parentRenderGroup;n&&(n.structureDidChange=!0),this._didContainerChangeTick++},removeFromParent(){var i;(i=this.parent)==null||i.removeChild(this)},reparentChild(...i){return i.length===1?this.reparentChildAt(i[0],this.children.length):(i.forEach(t=>this.reparentChildAt(t,this.children.length)),i[0])},reparentChildAt(i,t){if(i.parent===this)return this.setChildIndex(i,t),i;const e=i.worldTransform.clone();i.removeFromParent(),this.addChildAt(i,t);const s=this.worldTransform.clone();return s.invert(),e.prepend(s),i.setFromMatrix(e),i},replaceChild(i,t){i.updateLocalTransform(),this.addChildAt(t,this.getChildIndex(i)),t.setFromMatrix(i.localTransform),t.updateLocalTransform(),this.removeChild(i)}},Hm={collectRenderables(i,t,e){this.parentRenderLayer&&this.parentRenderLayer!==e||this.globalDisplayStatus<7||!this.includeInBuild||(this.sortableChildren&&this.sortChildren(),this.isSimple?this.collectRenderablesSimple(i,t,e):this.renderGroup?t.renderPipes.renderGroup.addRenderGroup(this.renderGroup,i):this.collectRenderablesWithEffects(i,t,e))},collectRenderablesSimple(i,t,e){const s=this.children,n=s.length;for(let r=0;r<n;r++)s[r].collectRenderables(i,t,e)},collectRenderablesWithEffects(i,t,e){const{renderPipes:s}=t;for(let n=0;n<this.effects.length;n++){const r=this.effects[n];s[r.pipe].push(r,this,i)}this.collectRenderablesSimple(i,t,e);for(let n=this.effects.length-1;n>=0;n--){const r=this.effects[n];s[r.pipe].pop(r,this,i)}}};class Gl{constructor(){this.pipe="filter",this.priority=1}destroy(){for(let t=0;t<this.filters.length;t++)this.filters[t].destroy();this.filters=null,this.filterArea=null}}class Fm{constructor(){this._effectClasses=[],this._tests=[],this._initialized=!1}init(){this._initialized||(this._initialized=!0,this._effectClasses.forEach(t=>{this.add({test:t.test,maskClass:t})}))}add(t){this._tests.push(t)}getMaskEffect(t){this._initialized||this.init();for(let e=0;e<this._tests.length;e++){const s=this._tests[e];if(s.test(t))return Oe.get(s.maskClass,t)}return t}returnMaskEffect(t){Oe.return(t)}}const Jo=new Fm;ne.handleByList(lt.MaskEffect,Jo._effectClasses);const Bm={_maskEffect:null,_maskOptions:{inverse:!1},_filterEffect:null,effects:[],_markStructureAsChanged(){const i=this.renderGroup||this.parentRenderGroup;i&&(i.structureDidChange=!0)},addEffect(i){this.effects.indexOf(i)===-1&&(this.effects.push(i),this.effects.sort((e,s)=>e.priority-s.priority),this._markStructureAsChanged(),this._updateIsSimple())},removeEffect(i){const t=this.effects.indexOf(i);t!==-1&&(this.effects.splice(t,1),this._markStructureAsChanged(),this._updateIsSimple())},set mask(i){const t=this._maskEffect;(t==null?void 0:t.mask)!==i&&(t&&(this.removeEffect(t),Jo.returnMaskEffect(t),this._maskEffect=null),i!=null&&(this._maskEffect=Jo.getMaskEffect(i),this.addEffect(this._maskEffect)))},get mask(){var i;return(i=this._maskEffect)==null?void 0:i.mask},setMask(i){this._maskOptions={...this._maskOptions,...i},i.mask&&(this.mask=i.mask),this._markStructureAsChanged()},set filters(i){var r;!Array.isArray(i)&&i&&(i=[i]);const t=this._filterEffect||(this._filterEffect=new Gl);i=i;const e=(i==null?void 0:i.length)>0,s=((r=t.filters)==null?void 0:r.length)>0,n=e!==s;i=Array.isArray(i)?i.slice(0):i,t.filters=Object.freeze(i),n&&(e?this.addEffect(t):(this.removeEffect(t),t.filters=i??null))},get filters(){var i;return(i=this._filterEffect)==null?void 0:i.filters},set filterArea(i){this._filterEffect||(this._filterEffect=new Gl),this._filterEffect.filterArea=i},get filterArea(){var i;return(i=this._filterEffect)==null?void 0:i.filterArea}},Um={label:null,get name(){return dt(Rt,"Container.name property has been removed, use Container.label instead"),this.label},set name(i){dt(Rt,"Container.name property has been removed, use Container.label instead"),this.label=i},getChildByName(i,t=!1){return this.getChildByLabel(i,t)},getChildByLabel(i,t=!1){const e=this.children;for(let s=0;s<e.length;s++){const n=e[s];if(n.label===i||i instanceof RegExp&&i.test(n.label))return n}if(t)for(let s=0;s<e.length;s++){const r=e[s].getChildByLabel(i,!0);if(r)return r}return null},getChildrenByLabel(i,t=!1,e=[]){const s=this.children;for(let n=0;n<s.length;n++){const r=s[n];(r.label===i||i instanceof RegExp&&i.test(r.label))&&e.push(r)}if(t)for(let n=0;n<s.length;n++)s[n].getChildrenByLabel(i,!0,e);return e}},fe=Oe.getPool(At),fi=Oe.getPool(ze),Gm=new At,jm={getFastGlobalBounds(i,t){t||(t=new ze),t.clear(),this._getGlobalBoundsRecursive(!!i,t,this.parentRenderLayer),t.isValid||t.set(0,0,0,0);const e=this.renderGroup||this.parentRenderGroup;return t.applyMatrix(e.worldTransform),t},_getGlobalBoundsRecursive(i,t,e){let s=t;if(i&&this.parentRenderLayer&&this.parentRenderLayer!==e||this.localDisplayStatus!==7||!this.measurable)return;const n=!!this.effects.length;if((this.renderGroup||n)&&(s=fi.get().clear()),this.boundsArea)t.addRect(this.boundsArea,this.worldTransform);else{if(this.renderPipeId){const o=this.bounds;s.addFrame(o.minX,o.minY,o.maxX,o.maxY,this.groupTransform)}const r=this.children;for(let o=0;o<r.length;o++)r[o]._getGlobalBoundsRecursive(i,s,e)}if(n){let r=!1;const o=this.renderGroup||this.parentRenderGroup;for(let a=0;a<this.effects.length;a++)this.effects[a].addBounds&&(r||(r=!0,s.applyMatrix(o.worldTransform)),this.effects[a].addBounds(s,!0));r&&s.applyMatrix(o.worldTransform.copyTo(Gm).invert()),t.addBounds(s),fi.return(s)}else this.renderGroup&&(t.addBounds(s,this.relativeGroupTransform),fi.return(s))}};function au(i,t,e){e.clear();let s,n;return i.parent?t?s=i.parent.worldTransform:(n=fe.get().identity(),s=ka(i,n)):s=At.IDENTITY,lu(i,e,s,t),n&&fe.return(n),e.isValid||e.set(0,0,0,0),e}function lu(i,t,e,s){var a,l;if(!i.visible||!i.measurable)return;let n;s?n=i.worldTransform:(i.updateLocalTransform(),n=fe.get(),n.appendFrom(i.localTransform,e));const r=t,o=!!i.effects.length;if(o&&(t=fi.get().clear()),i.boundsArea)t.addRect(i.boundsArea,n);else{const c=i.bounds;c&&!c.isEmpty()&&(t.matrix=n,t.addBounds(c));for(let h=0;h<i.children.length;h++)lu(i.children[h],t,n,s)}if(o){for(let c=0;c<i.effects.length;c++)(l=(a=i.effects[c]).addBounds)==null||l.call(a,t);r.addBounds(t,At.IDENTITY),fi.return(t)}s||fe.return(n)}function ka(i,t){const e=i.parent;return e&&(ka(e,t),e.updateLocalTransform(),t.append(e.localTransform)),t}function cu(i,t){if(i===16777215||!t)return t;if(t===16777215||!i)return i;const e=i>>16&255,s=i>>8&255,n=i&255,r=t>>16&255,o=t>>8&255,a=t&255,l=e*r/255|0,c=s*o/255|0,h=n*a/255|0;return(l<<16)+(c<<8)+h}const jl=16777215;function Wl(i,t){return i===jl?t:t===jl?i:cu(i,t)}function sr(i){return((i&255)<<16)+(i&65280)+(i>>16&255)}const Wm={getGlobalAlpha(i){if(i)return this.renderGroup?this.renderGroup.worldAlpha:this.parentRenderGroup?this.parentRenderGroup.worldAlpha*this.alpha:this.alpha;let t=this.alpha,e=this.parent;for(;e;)t*=e.alpha,e=e.parent;return t},getGlobalTransform(i=new At,t){if(t)return i.copyFrom(this.worldTransform);this.updateLocalTransform();const e=ka(this,fe.get().identity());return i.appendFrom(this.localTransform,e),fe.return(e),i},getGlobalTint(i){if(i)return this.renderGroup?sr(this.renderGroup.worldColor):this.parentRenderGroup?sr(Wl(this.localColor,this.parentRenderGroup.worldColor)):this.tint;let t=this.localColor,e=this.parent;for(;e;)t=Wl(t,e.localColor),e=e.parent;return sr(t)}};function hu(i,t,e){return t.clear(),e||(e=At.IDENTITY),uu(i,t,e,i,!0),t.isValid||t.set(0,0,0,0),t}function uu(i,t,e,s,n){var l,c;let r;if(n)r=fe.get(),r=e.copyTo(r);else{if(!i.visible||!i.measurable)return;i.updateLocalTransform();const h=i.localTransform;r=fe.get(),r.appendFrom(h,e)}const o=t,a=!!i.effects.length;if(a&&(t=fi.get().clear()),i.boundsArea)t.addRect(i.boundsArea,r);else{i.renderPipeId&&(t.matrix=r,t.addBounds(i.bounds));const h=i.children;for(let u=0;u<h.length;u++)uu(h[u],t,r,s,!1)}if(a){for(let h=0;h<i.effects.length;h++)(c=(l=i.effects[h]).addLocalBounds)==null||c.call(l,t,s);o.addBounds(t,At.IDENTITY),fi.return(t)}fe.return(r)}function du(i,t){const e=i.children;for(let s=0;s<e.length;s++){const n=e[s],r=n.uid,o=(n._didViewChangeTick&65535)<<16|n._didContainerChangeTick&65535,a=t.index;(t.data[a]!==r||t.data[a+1]!==o)&&(t.data[t.index]=r,t.data[t.index+1]=o,t.didChange=!0),t.index=a+2,n.children.length&&du(n,t)}return t.didChange}const Vm=new At,zm={_localBoundsCacheId:-1,_localBoundsCacheData:null,_setWidth(i,t){const e=Math.sign(this.scale.x)||1;t!==0?this.scale.x=i/t*e:this.scale.x=e},_setHeight(i,t){const e=Math.sign(this.scale.y)||1;t!==0?this.scale.y=i/t*e:this.scale.y=e},getLocalBounds(){this._localBoundsCacheData||(this._localBoundsCacheData={data:[],index:1,didChange:!1,localBounds:new ze});const i=this._localBoundsCacheData;return i.index=1,i.didChange=!1,i.data[0]!==this._didViewChangeTick&&(i.didChange=!0,i.data[0]=this._didViewChangeTick),du(this,i),i.didChange&&hu(this,i.localBounds,Vm),i.localBounds},getBounds(i,t){return au(this,i,t||new ze)}},$m={_onRender:null,set onRender(i){const t=this.renderGroup||this.parentRenderGroup;if(!i){this._onRender&&(t==null||t.removeOnRender(this)),this._onRender=null;return}this._onRender||t==null||t.addOnRender(this),this._onRender=i},get onRender(){return this._onRender}},Ym={_zIndex:0,sortDirty:!1,sortableChildren:!1,get zIndex(){return this._zIndex},set zIndex(i){this._zIndex!==i&&(this._zIndex=i,this.depthOfChildModified())},depthOfChildModified(){this.parent&&(this.parent.sortableChildren=!0,this.parent.sortDirty=!0),this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0)},sortChildren(){this.sortDirty&&(this.sortDirty=!1,this.children.sort(Xm))}};function Xm(i,t){return i._zIndex-t._zIndex}const qm={getGlobalPosition(i=new me,t=!1){return this.parent?this.parent.toGlobal(this._position,i,t):(i.x=this._position.x,i.y=this._position.y),i},toGlobal(i,t,e=!1){const s=this.getGlobalTransform(fe.get(),e);return t=s.apply(i,t),fe.return(s),t},toLocal(i,t,e,s){t&&(i=t.toGlobal(i,e,s));const n=this.getGlobalTransform(fe.get(),s);return e=n.applyInverse(i,e),fe.return(n),e}};class fu{constructor(){this.uid=Xt("instructionSet"),this.instructions=[],this.instructionSize=0,this.renderables=[],this.gcTick=0}reset(){this.instructionSize=0}destroy(){this.instructions.length=0,this.renderables.length=0,this.renderPipes=null,this.gcTick=0}add(t){this.instructions[this.instructionSize++]=t}log(){this.instructions.length=this.instructionSize,console.table(this.instructions,["type","action"])}}let Km=0;class Zm{constructor(t){this._poolKeyHash=Object.create(null),this._texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this.textureStyle=new gs(this.textureOptions)}createTexture(t,e,s){const n=new Ne({...this.textureOptions,width:t,height:e,resolution:1,antialias:s,autoGarbageCollect:!1});return new _t({source:n,label:`texturePool_${Km++}`})}getOptimalTexture(t,e,s=1,n){let r=Math.ceil(t*s-1e-6),o=Math.ceil(e*s-1e-6);r=ms(r),o=ms(o);const a=(r<<17)+(o<<1)+(n?1:0);this._texturePool[a]||(this._texturePool[a]=[]);let l=this._texturePool[a].pop();return l||(l=this.createTexture(r,o,n)),l.source._resolution=s,l.source.width=r/s,l.source.height=o/s,l.source.pixelWidth=r,l.source.pixelHeight=o,l.frame.x=0,l.frame.y=0,l.frame.width=t,l.frame.height=e,l.updateUvs(),this._poolKeyHash[l.uid]=a,l}getSameSizeTexture(t,e=!1){const s=t.source;return this.getOptimalTexture(t.width,t.height,s._resolution,e)}returnTexture(t,e=!1){const s=this._poolKeyHash[t.uid];e&&(t.source.style=this.textureStyle),this._texturePool[s].push(t)}clear(t){if(t=t!==!1,t)for(const e in this._texturePool){const s=this._texturePool[e];if(s)for(let n=0;n<s.length;n++)s[n].destroy(!0)}this._texturePool={}}}const Ss=new Zm;xn.register(Ss);class Jm{constructor(){this.renderPipeId="renderGroup",this.root=null,this.canBundle=!1,this.renderGroupParent=null,this.renderGroupChildren=[],this.worldTransform=new At,this.worldColorAlpha=4294967295,this.worldColor=16777215,this.worldAlpha=1,this.childrenToUpdate=Object.create(null),this.updateTick=0,this.gcTick=0,this.childrenRenderablesToUpdate={list:[],index:0},this.structureDidChange=!0,this.instructionSet=new fu,this._onRenderContainers=[],this.textureNeedsUpdate=!0,this.isCachedAsTexture=!1,this._matrixDirty=7}init(t){this.root=t,t._onRender&&this.addOnRender(t),t.didChange=!0;const e=t.children;for(let s=0;s<e.length;s++){const n=e[s];n._updateFlags=15,this.addChild(n)}}enableCacheAsTexture(t={}){this.textureOptions=t,this.isCachedAsTexture=!0,this.textureNeedsUpdate=!0}disableCacheAsTexture(){this.isCachedAsTexture=!1,this.texture&&(Ss.returnTexture(this.texture,!0),this.texture=null)}updateCacheTexture(){this.textureNeedsUpdate=!0;const t=this._parentCacheAsTextureRenderGroup;t&&!t.textureNeedsUpdate&&t.updateCacheTexture()}reset(){this.renderGroupChildren.length=0;for(const t in this.childrenToUpdate){const e=this.childrenToUpdate[t];e.list.fill(null),e.index=0}this.childrenRenderablesToUpdate.index=0,this.childrenRenderablesToUpdate.list.fill(null),this.root=null,this.updateTick=0,this.structureDidChange=!0,this._onRenderContainers.length=0,this.renderGroupParent=null,this.disableCacheAsTexture()}get localTransform(){return this.root.localTransform}addRenderGroupChild(t){t.renderGroupParent&&t.renderGroupParent._removeRenderGroupChild(t),t.renderGroupParent=this,this.renderGroupChildren.push(t)}_removeRenderGroupChild(t){const e=this.renderGroupChildren.indexOf(t);e>-1&&this.renderGroupChildren.splice(e,1),t.renderGroupParent=null}addChild(t){if(this.structureDidChange=!0,t.parentRenderGroup=this,t.updateTick=-1,t.parent===this.root?t.relativeRenderGroupDepth=1:t.relativeRenderGroupDepth=t.parent.relativeRenderGroupDepth+1,t.didChange=!0,this.onChildUpdate(t),t.renderGroup){this.addRenderGroupChild(t.renderGroup);return}t._onRender&&this.addOnRender(t);const e=t.children;for(let s=0;s<e.length;s++)this.addChild(e[s])}removeChild(t){if(this.structureDidChange=!0,t._onRender&&(t.renderGroup||this.removeOnRender(t)),t.parentRenderGroup=null,t.renderGroup){this._removeRenderGroupChild(t.renderGroup);return}const e=t.children;for(let s=0;s<e.length;s++)this.removeChild(e[s])}removeChildren(t){for(let e=0;e<t.length;e++)this.removeChild(t[e])}onChildUpdate(t){let e=this.childrenToUpdate[t.relativeRenderGroupDepth];e||(e=this.childrenToUpdate[t.relativeRenderGroupDepth]={index:0,list:[]}),e.list[e.index++]=t}updateRenderable(t){t.globalDisplayStatus<7||(this.instructionSet.renderPipes[t.renderPipeId].updateRenderable(t),t.didViewUpdate=!1)}onChildViewUpdate(t){this.childrenRenderablesToUpdate.list[this.childrenRenderablesToUpdate.index++]=t}get isRenderable(){return this.root.localDisplayStatus===7&&this.worldAlpha>0}addOnRender(t){this._onRenderContainers.push(t)}removeOnRender(t){this._onRenderContainers.splice(this._onRenderContainers.indexOf(t),1)}runOnRender(t){for(let e=0;e<this._onRenderContainers.length;e++)this._onRenderContainers[e]._onRender(t)}destroy(){this.disableCacheAsTexture(),this.renderGroupParent=null,this.root=null,this.childrenRenderablesToUpdate=null,this.childrenToUpdate=null,this.renderGroupChildren=null,this._onRenderContainers=null,this.instructionSet=null}getChildren(t=[]){const e=this.root.children;for(let s=0;s<e.length;s++)this._getChildren(e[s],t);return t}_getChildren(t,e=[]){if(e.push(t),t.renderGroup)return e;const s=t.children;for(let n=0;n<s.length;n++)this._getChildren(s[n],e);return e}invalidateMatrices(){this._matrixDirty=7}get inverseWorldTransform(){return this._matrixDirty&1?(this._matrixDirty&=-2,this._inverseWorldTransform||(this._inverseWorldTransform=new At),this._inverseWorldTransform.copyFrom(this.worldTransform).invert()):this._inverseWorldTransform}get textureOffsetInverseTransform(){return this._matrixDirty&2?(this._matrixDirty&=-3,this._textureOffsetInverseTransform||(this._textureOffsetInverseTransform=new At),this._textureOffsetInverseTransform.copyFrom(this.inverseWorldTransform).translate(-this._textureBounds.x,-this._textureBounds.y)):this._textureOffsetInverseTransform}get inverseParentTextureTransform(){if(!(this._matrixDirty&4))return this._inverseParentTextureTransform;this._matrixDirty&=-5;const t=this._parentCacheAsTextureRenderGroup;return t?(this._inverseParentTextureTransform||(this._inverseParentTextureTransform=new At),this._inverseParentTextureTransform.copyFrom(this.worldTransform).prepend(t.inverseWorldTransform).translate(-t._textureBounds.x,-t._textureBounds.y)):this.worldTransform}get cacheToLocalTransform(){return this.isCachedAsTexture?this.textureOffsetInverseTransform:this._parentCacheAsTextureRenderGroup?this._parentCacheAsTextureRenderGroup.textureOffsetInverseTransform:null}}function Qm(i,t,e={}){for(const s in t)!e[s]&&t[s]!==void 0&&(i[s]=t[s])}const co=new re(null),Nn=new re(null),ho=new re(null,1,1),Dn=new re(null),Vl=1,t0=2,uo=4;let ut=class pu extends Ke{constructor(t={}){var e,s;super(),this.uid=Xt("renderable"),this._updateFlags=15,this.renderGroup=null,this.parentRenderGroup=null,this.parentRenderGroupIndex=0,this.didChange=!1,this.didViewUpdate=!1,this.relativeRenderGroupDepth=0,this.children=[],this.parent=null,this.includeInBuild=!0,this.measurable=!0,this.isSimple=!0,this.updateTick=-1,this.localTransform=new At,this.relativeGroupTransform=new At,this.groupTransform=this.relativeGroupTransform,this.destroyed=!1,this._position=new re(this,0,0),this._scale=ho,this._pivot=Nn,this._origin=Dn,this._skew=co,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._rotation=0,this.localColor=16777215,this.localAlpha=1,this.groupAlpha=1,this.groupColor=16777215,this.groupColorAlpha=4294967295,this.localBlendMode="inherit",this.groupBlendMode="normal",this.localDisplayStatus=7,this.globalDisplayStatus=7,this._didContainerChangeTick=0,this._didViewChangeTick=0,this._didLocalTransformChangeId=-1,this.effects=[],Qm(this,t,{children:!0,parent:!0,effects:!0}),(e=t.children)==null||e.forEach(n=>this.addChild(n)),(s=t.parent)==null||s.addChild(this)}static mixin(t){dt("8.8.0","Container.mixin is deprecated, please use extensions.mixin instead."),ne.mixin(pu,t)}set _didChangeId(t){this._didViewChangeTick=t>>12&4095,this._didContainerChangeTick=t&4095}get _didChangeId(){return this._didContainerChangeTick&4095|(this._didViewChangeTick&4095)<<12}addChild(...t){if(this.allowChildren||dt(Rt,"addChild: Only Containers will be allowed to add children in v8.0.0"),t.length>1){for(let n=0;n<t.length;n++)this.addChild(t[n]);return t[0]}const e=t[0],s=this.renderGroup||this.parentRenderGroup;return e.parent===this?(this.children.splice(this.children.indexOf(e),1),this.children.push(e),s&&(s.structureDidChange=!0),e):(e.parent&&e.parent.removeChild(e),this.children.push(e),this.sortableChildren&&(this.sortDirty=!0),e.parent=this,e.didChange=!0,e._updateFlags=15,s&&s.addChild(e),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this),this._didViewChangeTick++,e._zIndex!==0&&e.depthOfChildModified(),e)}removeChild(...t){if(t.length>1){for(let n=0;n<t.length;n++)this.removeChild(t[n]);return t[0]}const e=t[0],s=this.children.indexOf(e);return s>-1&&(this._didViewChangeTick++,this.children.splice(s,1),this.renderGroup?this.renderGroup.removeChild(e):this.parentRenderGroup&&this.parentRenderGroup.removeChild(e),e.parentRenderLayer&&e.parentRenderLayer.detach(e),e.parent=null,this.emit("childRemoved",e,this,s),e.emit("removed",this)),e}_onUpdate(t){t&&t===this._skew&&this._updateSkew(),this._didContainerChangeTick++,!this.didChange&&(this.didChange=!0,this.parentRenderGroup&&this.parentRenderGroup.onChildUpdate(this))}set isRenderGroup(t){!!this.renderGroup!==t&&(t?this.enableRenderGroup():this.disableRenderGroup())}get isRenderGroup(){return!!this.renderGroup}enableRenderGroup(){if(this.renderGroup)return;const t=this.parentRenderGroup;t==null||t.removeChild(this),this.renderGroup=Oe.get(Jm,this),this.groupTransform=At.IDENTITY,t==null||t.addChild(this),this._updateIsSimple()}disableRenderGroup(){if(!this.renderGroup)return;const t=this.parentRenderGroup;t==null||t.removeChild(this),Oe.return(this.renderGroup),this.renderGroup=null,this.groupTransform=this.relativeGroupTransform,t==null||t.addChild(this),this._updateIsSimple()}_updateIsSimple(){this.isSimple=!this.renderGroup&&this.effects.length===0}get worldTransform(){return this._worldTransform||(this._worldTransform=new At),this.renderGroup?this._worldTransform.copyFrom(this.renderGroup.worldTransform):this.parentRenderGroup&&this._worldTransform.appendFrom(this.relativeGroupTransform,this.parentRenderGroup.worldTransform),this._worldTransform}get x(){return this._position.x}set x(t){this._position.x=t}get y(){return this._position.y}set y(t){this._position.y=t}get position(){return this._position}set position(t){this._position.copyFrom(t)}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this._onUpdate(this._skew))}get angle(){return this.rotation*fm}set angle(t){this.rotation=t*pm}get pivot(){return this._pivot===Nn&&(this._pivot=new re(this,0,0)),this._pivot}set pivot(t){this._pivot===Nn&&(this._pivot=new re(this,0,0),this._origin!==Dn&&Bt("Setting both a pivot and origin on a Container is not recommended. This can lead to unexpected behavior if not handled carefully.")),typeof t=="number"?this._pivot.set(t):this._pivot.copyFrom(t)}get skew(){return this._skew===co&&(this._skew=new re(this,0,0)),this._skew}set skew(t){this._skew===co&&(this._skew=new re(this,0,0)),this._skew.copyFrom(t)}get scale(){return this._scale===ho&&(this._scale=new re(this,1,1)),this._scale}set scale(t){this._scale===ho&&(this._scale=new re(this,0,0)),typeof t=="string"&&(t=parseFloat(t)),typeof t=="number"?this._scale.set(t):this._scale.copyFrom(t)}get origin(){return this._origin===Dn&&(this._origin=new re(this,0,0)),this._origin}set origin(t){this._origin===Dn&&(this._origin=new re(this,0,0),this._pivot!==Nn&&Bt("Setting both a pivot and origin on a Container is not recommended. This can lead to unexpected behavior if not handled carefully.")),typeof t=="number"?this._origin.set(t):this._origin.copyFrom(t)}get width(){return Math.abs(this.scale.x*this.getLocalBounds().width)}set width(t){const e=this.getLocalBounds().width;this._setWidth(t,e)}get height(){return Math.abs(this.scale.y*this.getLocalBounds().height)}set height(t){const e=this.getLocalBounds().height;this._setHeight(t,e)}getSize(t){t||(t={});const e=this.getLocalBounds();return t.width=Math.abs(this.scale.x*e.width),t.height=Math.abs(this.scale.y*e.height),t}setSize(t,e){const s=this.getLocalBounds();typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,s.width),e!==void 0&&this._setHeight(e,s.height)}_updateSkew(){const t=this._rotation,e=this._skew;this._cx=Math.cos(t+e._y),this._sx=Math.sin(t+e._y),this._cy=-Math.sin(t-e._x),this._sy=Math.cos(t-e._x)}updateTransform(t){return this.position.set(typeof t.x=="number"?t.x:this.position.x,typeof t.y=="number"?t.y:this.position.y),this.scale.set(typeof t.scaleX=="number"?t.scaleX||1:this.scale.x,typeof t.scaleY=="number"?t.scaleY||1:this.scale.y),this.rotation=typeof t.rotation=="number"?t.rotation:this.rotation,this.skew.set(typeof t.skewX=="number"?t.skewX:this.skew.x,typeof t.skewY=="number"?t.skewY:this.skew.y),this.pivot.set(typeof t.pivotX=="number"?t.pivotX:this.pivot.x,typeof t.pivotY=="number"?t.pivotY:this.pivot.y),this.origin.set(typeof t.originX=="number"?t.originX:this.origin.x,typeof t.originY=="number"?t.originY:this.origin.y),this}setFromMatrix(t){t.decompose(this)}updateLocalTransform(){const t=this._didContainerChangeTick;if(this._didLocalTransformChangeId===t)return;this._didLocalTransformChangeId=t;const e=this.localTransform,s=this._scale,n=this._pivot,r=this._origin,o=this._position,a=s._x,l=s._y,c=n._x,h=n._y,u=-r._x,d=-r._y;e.a=this._cx*a,e.b=this._sx*a,e.c=this._cy*l,e.d=this._sy*l,e.tx=o._x-(c*e.a+h*e.c)+(u*e.a+d*e.c)-u,e.ty=o._y-(c*e.b+h*e.d)+(u*e.b+d*e.d)-d}set alpha(t){t!==this.localAlpha&&(this.localAlpha=t,this._updateFlags|=Vl,this._onUpdate())}get alpha(){return this.localAlpha}set tint(t){const s=Kt.shared.setValue(t??16777215).toBgrNumber();s!==this.localColor&&(this.localColor=s,this._updateFlags|=Vl,this._onUpdate())}get tint(){return sr(this.localColor)}set blendMode(t){this.localBlendMode!==t&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=t0,this.localBlendMode=t,this._onUpdate())}get blendMode(){return this.localBlendMode}get visible(){return!!(this.localDisplayStatus&2)}set visible(t){const e=t?2:0;(this.localDisplayStatus&2)!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=uo,this.localDisplayStatus^=2,this._onUpdate())}get culled(){return!(this.localDisplayStatus&4)}set culled(t){const e=t?0:4;(this.localDisplayStatus&4)!==e&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=uo,this.localDisplayStatus^=4,this._onUpdate())}get renderable(){return!!(this.localDisplayStatus&1)}set renderable(t){const e=t?1:0;(this.localDisplayStatus&1)!==e&&(this._updateFlags|=uo,this.localDisplayStatus^=1,this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._onUpdate())}get isRenderable(){return this.localDisplayStatus===7&&this.groupAlpha>0}destroy(t=!1){var n;if(this.destroyed)return;this.destroyed=!0;let e;if(this.children.length&&(e=this.removeChildren(0,this.children.length)),this.removeFromParent(),this.parent=null,this._maskEffect=null,this._filterEffect=null,this.effects=null,this._position=null,this._scale=null,this._pivot=null,this._origin=null,this._skew=null,this.emit("destroyed",this),this.removeAllListeners(),(typeof t=="boolean"?t:t==null?void 0:t.children)&&e)for(let r=0;r<e.length;++r)e[r].destroy(t);(n=this.renderGroup)==null||n.destroy(),this.renderGroup=null}};ne.mixin(ut,km,jm,qm,$m,zm,Bm,Um,Ym,vm,Nm,Wm,Hm);class An extends ut{constructor(t){super(t),this.canBundle=!0,this.allowChildren=!1,this._roundPixels=0,this._lastUsed=-1,this._gpuData=Object.create(null),this._bounds=new ze(0,1,0,0),this._boundsDirty=!0}get bounds(){return this._boundsDirty?(this.updateBounds(),this._boundsDirty=!1,this._bounds):this._bounds}get roundPixels(){return!!this._roundPixels}set roundPixels(t){this._roundPixels=t?1:0}containsPoint(t){const e=this.bounds,{x:s,y:n}=t;return s>=e.minX&&s<=e.maxX&&n>=e.minY&&n<=e.maxY}onViewUpdate(){if(this._didViewChangeTick++,this._boundsDirty=!0,this.didViewUpdate)return;this.didViewUpdate=!0;const t=this.renderGroup||this.parentRenderGroup;t&&t.onChildViewUpdate(this)}destroy(t){var e,s;super.destroy(t),this._bounds=null;for(const n in this._gpuData)(s=(e=this._gpuData[n]).destroy)==null||s.call(e);this._gpuData=null}collectRenderablesSimple(t,e,s){const{renderPipes:n}=e;n.blendMode.pushBlendMode(this,this.groupBlendMode,t),n[this.renderPipeId].addRenderable(this,t),this.didViewUpdate=!1;const o=this.children,a=o.length;for(let l=0;l<a;l++)o[l].collectRenderables(t,e,s);n.blendMode.popBlendMode(t)}}class Mt extends An{constructor(t=_t.EMPTY){t instanceof _t&&(t={texture:t});const{texture:e=_t.EMPTY,anchor:s,roundPixels:n,width:r,height:o,...a}=t;super({label:"Sprite",...a}),this.renderPipeId="sprite",this.batched=!0,this._visualBounds={minX:0,maxX:1,minY:0,maxY:0},this._anchor=new re({_onUpdate:()=>{this.onViewUpdate()}}),s?this.anchor=s:e.defaultAnchor&&(this.anchor=e.defaultAnchor),this.texture=e,this.allowChildren=!1,this.roundPixels=n??!1,r!==void 0&&(this.width=r),o!==void 0&&(this.height=o)}static from(t,e=!1){return t instanceof _t?new Mt(t):new Mt(_t.from(t,e))}set texture(t){t||(t=_t.EMPTY);const e=this._texture;e!==t&&(e&&e.dynamic&&e.off("update",this.onViewUpdate,this),t.dynamic&&t.on("update",this.onViewUpdate,this),this._texture=t,this._width&&this._setWidth(this._width,this._texture.orig.width),this._height&&this._setHeight(this._height,this._texture.orig.height),this.onViewUpdate())}get texture(){return this._texture}get visualBounds(){return _m(this._visualBounds,this._anchor,this._texture),this._visualBounds}get sourceBounds(){return dt("8.6.1","Sprite.sourceBounds is deprecated, use visualBounds instead."),this.visualBounds}updateBounds(){const t=this._anchor,e=this._texture,s=this._bounds,{width:n,height:r}=e.orig;s.minX=-t._x*n,s.maxX=s.minX+n,s.minY=-t._y*r,s.maxY=s.minY+r}destroy(t=!1){if(super.destroy(t),typeof t=="boolean"?t:t==null?void 0:t.texture){const s=typeof t=="boolean"?t:t==null?void 0:t.textureSource;this._texture.destroy(s)}this._texture=null,this._visualBounds=null,this._bounds=null,this._anchor=null,this._gpuData=null}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this._setWidth(t,this._texture.orig.width),this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this._setHeight(t,this._texture.orig.height),this._height=t}getSize(t){return t||(t={}),t.width=Math.abs(this.scale.x)*this._texture.orig.width,t.height=Math.abs(this.scale.y)*this._texture.orig.height,t}setSize(t,e){typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,this._texture.orig.width),e!==void 0&&this._setHeight(e,this._texture.orig.height)}}const e0=new ze;function mu(i,t,e){const s=e0;i.measurable=!0,au(i,e,s),t.addBoundsMask(s),i.measurable=!1}function gu(i,t,e){const s=fi.get();i.measurable=!0;const n=fe.get().identity(),r=yu(i,e,n);hu(i,s,r),i.measurable=!1,t.addBoundsMask(s),fe.return(n),fi.return(s)}function yu(i,t,e){return i?(i!==t&&(yu(i.parent,t,e),i.updateLocalTransform(),e.append(i.localTransform)),e):(Bt("Mask bounds, renderable is not inside the root container"),e)}class Su{constructor(t){this.priority=0,this.inverse=!1,this.pipe="alphaMask",t!=null&&t.mask&&this.init(t.mask)}init(t){this.mask=t,this.renderMaskToTexture=!(t instanceof Mt),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask=null}addBounds(t,e){this.inverse||mu(this.mask,t,e)}addLocalBounds(t,e){gu(this.mask,t,e)}containsPoint(t,e){const s=this.mask;return e(s,t)}destroy(){this.reset()}static test(t){return t instanceof Mt}}Su.extension=lt.MaskEffect;class Tu{constructor(t){this.priority=0,this.pipe="colorMask",t!=null&&t.mask&&this.init(t.mask)}init(t){this.mask=t}destroy(){}static test(t){return typeof t=="number"}}Tu.extension=lt.MaskEffect;class Eu{constructor(t){this.priority=0,this.pipe="stencilMask",t!=null&&t.mask&&this.init(t.mask)}init(t){this.mask=t,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null}addBounds(t,e){mu(this.mask,t,e)}addLocalBounds(t,e){gu(this.mask,t,e)}containsPoint(t,e){const s=this.mask;return e(s,t)}destroy(){this.reset()}static test(t){return t instanceof ut}}Eu.extension=lt.MaskEffect;const i0={createCanvas:(i,t)=>{const e=document.createElement("canvas");return e.width=i,e.height=t,e},createImage:()=>new Image,getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(i,t)=>fetch(i,t),parseXML:i=>new DOMParser().parseFromString(i,"text/xml")};let zl=i0;const Wt={get(){return zl},set(i){zl=i}};class _u extends Ne{constructor(t){t.resource||(t.resource=Wt.get().createCanvas()),t.width||(t.width=t.resource.width,t.autoDensity||(t.width/=t.resolution)),t.height||(t.height=t.resource.height,t.autoDensity||(t.height/=t.resolution)),super(t),this.uploadMethodId="image",this.autoDensity=t.autoDensity,this.resizeCanvas(),this.transparent=!!t.transparent}resizeCanvas(){this.autoDensity&&"style"in this.resource&&(this.resource.style.width=`${this.width}px`,this.resource.style.height=`${this.height}px`),(this.resource.width!==this.pixelWidth||this.resource.height!==this.pixelHeight)&&(this.resource.width=this.pixelWidth,this.resource.height=this.pixelHeight)}resize(t=this.width,e=this.height,s=this._resolution){const n=super.resize(t,e,s);return n&&this.resizeCanvas(),n}static test(t){return globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement||globalThis.OffscreenCanvas&&t instanceof OffscreenCanvas}get context2D(){return this._context2D||(this._context2D=this.resource.getContext("2d"))}}_u.extension=lt.TextureSource;class Xi extends Ne{constructor(t){super(t),this.uploadMethodId="image",this.autoGarbageCollect=!0}static test(t){return globalThis.HTMLImageElement&&t instanceof HTMLImageElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||globalThis.VideoFrame&&t instanceof VideoFrame}}Xi.extension=lt.TextureSource;var Qo=(i=>(i[i.INTERACTION=50]="INTERACTION",i[i.HIGH=25]="HIGH",i[i.NORMAL=0]="NORMAL",i[i.LOW=-25]="LOW",i[i.UTILITY=-50]="UTILITY",i))(Qo||{});class fo{constructor(t,e=null,s=0,n=!1){this.next=null,this.previous=null,this._destroyed=!1,this._fn=t,this._context=e,this.priority=s,this._once=n}match(t,e=null){return this._fn===t&&this._context===e}emit(t){this._fn&&(this._context?this._fn.call(this._context,t):this._fn(t));const e=this.next;return this._once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this._fn=null,this._context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const bu=class Te{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new fo(null,null,1/0),this.deltaMS=1/Te.targetFPMS,this.elapsedMS=1/Te.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,s=Qo.NORMAL){return this._addListener(new fo(t,e,s))}addOnce(t,e,s=Qo.NORMAL){return this._addListener(new fo(t,e,s,!0))}_addListener(t){let e=this._head.next,s=this._head;if(!e)t.connect(s);else{for(;e;){if(t.priority>e.priority){t.connect(s);break}s=e,e=e.next}t.previous||t.connect(s)}return this._startIfPossible(),this}remove(t,e){let s=this._head.next;for(;s;)s.match(t,e)?s=s.destroy():s=s.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const r=t-this._lastFrame|0;if(r<this._minElapsedMS)return;this._lastFrame=t-r%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*Te.targetFPMS;const s=this._head;let n=s.next;for(;n;)n=n.emit(this);s.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),s=Math.min(Math.max(0,e)/1e3,Te.targetFPMS);this._maxElapsedMS=1/s}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!Te._shared){const t=Te._shared=new Te;t.autoStart=!0,t._protected=!0}return Te._shared}static get system(){if(!Te._system){const t=Te._system=new Te;t.autoStart=!0,t._protected=!0}return Te._system}};bu.targetFPMS=.06;let kn=bu,po;async function xu(){return po??(po=(async()=>{var o;const t=Wt.get().createCanvas(1,1).getContext("webgl");if(!t)return"premultiply-alpha-on-upload";const e=await new Promise(a=>{const l=document.createElement("video");l.onloadeddata=()=>a(l),l.onerror=()=>a(null),l.autoplay=!1,l.crossOrigin="anonymous",l.preload="auto",l.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",l.load()});if(!e)return"premultiply-alpha-on-upload";const s=t.createTexture();t.bindTexture(t.TEXTURE_2D,s);const n=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,n),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e);const r=new Uint8Array(4);return t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,r),t.deleteFramebuffer(n),t.deleteTexture(s),(o=t.getExtension("WEBGL_lose_context"))==null||o.loseContext(),r[0]<=r[3]?"premultiplied-alpha":"premultiply-alpha-on-upload"})()),po}const Vr=class Au extends Ne{constructor(t){super(t),this.isReady=!1,this.uploadMethodId="video",t={...Au.defaultOptions,...t},this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this.alphaMode=t.alphaMode??"premultiply-alpha-on-upload",this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onCanPlayThrough=this._onCanPlayThrough.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),t.autoLoad!==!1&&this.load()}updateFrame(){if(!this.destroyed){if(this._updateFPS){const t=kn.shared.elapsedMS*this.resource.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t)}(!this._updateFPS||this._msToNextUpdate<=0)&&(this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0),this.isValid&&this.update()}}_videoFrameRequestCallback(){this.updateFrame(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback)}get isValid(){return!!this.resource.videoWidth&&!!this.resource.videoHeight}async load(){if(this._load)return this._load;const t=this.resource,e=this.options;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._mediaReady():(e.preload||t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlayThrough),t.addEventListener("error",this._onError,!0)),this.alphaMode=await xu(),this._load=new Promise((s,n)=>{this.isValid?s(this):(this._resolve=s,this._reject=n,e.preloadTimeoutMs!==void 0&&(this._preloadTimeout=setTimeout(()=>{this._onError(new ErrorEvent(`Preload exceeded timeout of ${e.preloadTimeoutMs}ms`))})),t.load())}),this._load}_onError(t){this.resource.removeEventListener("error",this._onError,!0),this.emit("error",t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.resource;return!t.paused&&!t.ended}_isSourceReady(){return this.resource.readyState>2}_onPlayStart(){this.isValid||this._mediaReady(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0)}_onCanPlay(){this.resource.removeEventListener("canplay",this._onCanPlay),this._mediaReady()}_onCanPlayThrough(){this.resource.removeEventListener("canplaythrough",this._onCanPlay),this._preloadTimeout&&(clearTimeout(this._preloadTimeout),this._preloadTimeout=void 0),this._mediaReady()}_mediaReady(){const t=this.resource;this.isValid&&(this.isReady=!0,this.resize(t.videoWidth,t.videoHeight)),this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0,this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.resource.play()}destroy(){this._configureAutoUpdate();const t=this.resource;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlayThrough),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.destroy()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.resource.requestVideoFrameCallback?(this._isConnectedToTicker&&(kn.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(kn.shared.add(this.updateFrame,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(kn.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement}};Vr.extension=lt.TextureSource;Vr.defaultOptions={...Ne.defaultOptions,autoLoad:!0,autoPlay:!0,updateFPS:0,crossorigin:!0,loop:!1,muted:!0,playsinline:!0,preload:!1};Vr.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let en=Vr;const Ge=(i,t,e=!1)=>(Array.isArray(i)||(i=[i]),t?i.map(s=>typeof s=="string"||e?t(s):s):i);class s0{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e||Bt(`[Assets] Asset id ${t} was not found in the Cache`),e}set(t,e){const s=Ge(t);let n;for(let l=0;l<this.parsers.length;l++){const c=this.parsers[l];if(c.test(e)){n=c.getCacheableAssets(s,e);break}}const r=new Map(Object.entries(n||{}));n||s.forEach(l=>{r.set(l,e)});const o=[...r.keys()],a={cacheKeys:o,keys:s};s.forEach(l=>{this._cacheMap.set(l,a)}),o.forEach(l=>{const c=n?n[l]:e;this._cache.has(l)&&this._cache.get(l)!==c&&Bt("[Cache] already has key:",l),this._cache.set(l,r.get(l))})}remove(t){if(!this._cacheMap.has(t)){Bt(`[Assets] Asset id ${t} was not found in the Cache`);return}const e=this._cacheMap.get(t);e.cacheKeys.forEach(n=>{this._cache.delete(n)}),e.keys.forEach(n=>{this._cacheMap.delete(n)})}get parsers(){return this._parsers}}const Vt=new s0,ta=[];ne.handleByList(lt.TextureSource,ta);function Cu(i={}){const t=i&&i.resource,e=t?i.resource:i,s=t?i:{resource:i};for(let n=0;n<ta.length;n++){const r=ta[n];if(r.test(e))return new r(s)}throw new Error(`Could not find a source type for resource: ${s.resource}`)}function n0(i={},t=!1){const e=i&&i.resource,s=e?i.resource:i,n=e?i:{resource:i};if(!t&&Vt.has(s))return Vt.get(s);const r=new _t({source:Cu(n)});return r.on("destroy",()=>{Vt.has(s)&&Vt.remove(s)}),t||Vt.set(s,r),r}function r0(i,t=!1){return typeof i=="string"?Vt.get(i):i instanceof Ne?new _t({source:i}):n0(i,t)}_t.from=r0;Ne.from=Cu;ne.add(Su,Tu,Eu,en,Xi,_u,Da);var vi=(i=>(i[i.Low=0]="Low",i[i.Normal=1]="Normal",i[i.High=2]="High",i))(vi||{});function De(i){if(typeof i!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(i)}`)}function Ns(i){return i.split("?")[0].split("#")[0]}function o0(i){return i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function a0(i,t,e){return i.replace(new RegExp(o0(t),"g"),e)}function l0(i,t){let e="",s=0,n=-1,r=0,o=-1;for(let a=0;a<=i.length;++a){if(a<i.length)o=i.charCodeAt(a);else{if(o===47)break;o=47}if(o===47){if(!(n===a-1||r===1))if(n!==a-1&&r===2){if(e.length<2||s!==2||e.charCodeAt(e.length-1)!==46||e.charCodeAt(e.length-2)!==46){if(e.length>2){const l=e.lastIndexOf("/");if(l!==e.length-1){l===-1?(e="",s=0):(e=e.slice(0,l),s=e.length-1-e.lastIndexOf("/")),n=a,r=0;continue}}else if(e.length===2||e.length===1){e="",s=0,n=a,r=0;continue}}}else e.length>0?e+=`/${i.slice(n+1,a)}`:e=i.slice(n+1,a),s=a-n-1;n=a,r=0}else o===46&&r!==-1?++r:r=-1}return e}const be={toPosix(i){return a0(i,"\\","/")},isUrl(i){return/^https?:/.test(this.toPosix(i))},isDataUrl(i){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(i)},isBlobUrl(i){return i.startsWith("blob:")},hasProtocol(i){return/^[^/:]+:/.test(this.toPosix(i))},getProtocol(i){De(i),i=this.toPosix(i);const t=/^file:\/\/\//.exec(i);if(t)return t[0];const e=/^[^/:]+:\/{0,2}/.exec(i);return e?e[0]:""},toAbsolute(i,t,e){if(De(i),this.isDataUrl(i)||this.isBlobUrl(i))return i;const s=Ns(this.toPosix(t??Wt.get().getBaseUrl())),n=Ns(this.toPosix(e??this.rootname(s)));return i=this.toPosix(i),i.startsWith("/")?be.join(n,i.slice(1)):this.isAbsolute(i)?i:this.join(s,i)},normalize(i){if(De(i),i.length===0)return".";if(this.isDataUrl(i)||this.isBlobUrl(i))return i;i=this.toPosix(i);let t="";const e=i.startsWith("/");this.hasProtocol(i)&&(t=this.rootname(i),i=i.slice(t.length));const s=i.endsWith("/");return i=l0(i),i.length>0&&s&&(i+="/"),e?`/${i}`:t+i},isAbsolute(i){return De(i),i=this.toPosix(i),this.hasProtocol(i)?!0:i.startsWith("/")},join(...i){if(i.length===0)return".";let t;for(let e=0;e<i.length;++e){const s=i[e];if(De(s),s.length>0)if(t===void 0)t=s;else{const n=i[e-1]??"";this.joinExtensions.includes(this.extname(n).toLowerCase())?t+=`/../${s}`:t+=`/${s}`}}return t===void 0?".":this.normalize(t)},dirname(i){if(De(i),i.length===0)return".";i=this.toPosix(i);let t=i.charCodeAt(0);const e=t===47;let s=-1,n=!0;const r=this.getProtocol(i),o=i;i=i.slice(r.length);for(let a=i.length-1;a>=1;--a)if(t=i.charCodeAt(a),t===47){if(!n){s=a;break}}else n=!1;return s===-1?e?"/":this.isUrl(o)?r+i:r:e&&s===1?"//":r+i.slice(0,s)},rootname(i){De(i),i=this.toPosix(i);let t="";if(i.startsWith("/")?t="/":t=this.getProtocol(i),this.isUrl(i)){const e=i.indexOf("/",t.length);e!==-1?t=i.slice(0,e):t=i,t.endsWith("/")||(t+="/")}return t},basename(i,t){De(i),t&&De(t),i=Ns(this.toPosix(i));let e=0,s=-1,n=!0,r;if(t!==void 0&&t.length>0&&t.length<=i.length){if(t.length===i.length&&t===i)return"";let o=t.length-1,a=-1;for(r=i.length-1;r>=0;--r){const l=i.charCodeAt(r);if(l===47){if(!n){e=r+1;break}}else a===-1&&(n=!1,a=r+1),o>=0&&(l===t.charCodeAt(o)?--o===-1&&(s=r):(o=-1,s=a))}return e===s?s=a:s===-1&&(s=i.length),i.slice(e,s)}for(r=i.length-1;r>=0;--r)if(i.charCodeAt(r)===47){if(!n){e=r+1;break}}else s===-1&&(n=!1,s=r+1);return s===-1?"":i.slice(e,s)},extname(i){De(i),i=Ns(this.toPosix(i));let t=-1,e=0,s=-1,n=!0,r=0;for(let o=i.length-1;o>=0;--o){const a=i.charCodeAt(o);if(a===47){if(!n){e=o+1;break}continue}s===-1&&(n=!1,s=o+1),a===46?t===-1?t=o:r!==1&&(r=1):t!==-1&&(r=-1)}return t===-1||s===-1||r===0||r===1&&t===s-1&&t===e+1?"":i.slice(t,s)},parse(i){De(i);const t={root:"",dir:"",base:"",ext:"",name:""};if(i.length===0)return t;i=Ns(this.toPosix(i));let e=i.charCodeAt(0);const s=this.isAbsolute(i);let n;t.root=this.rootname(i),s||this.hasProtocol(i)?n=1:n=0;let r=-1,o=0,a=-1,l=!0,c=i.length-1,h=0;for(;c>=n;--c){if(e=i.charCodeAt(c),e===47){if(!l){o=c+1;break}continue}a===-1&&(l=!1,a=c+1),e===46?r===-1?r=c:h!==1&&(h=1):r!==-1&&(h=-1)}return r===-1||a===-1||h===0||h===1&&r===a-1&&r===o+1?a!==-1&&(o===0&&s?t.base=t.name=i.slice(1,a):t.base=t.name=i.slice(o,a)):(o===0&&s?(t.name=i.slice(1,r),t.base=i.slice(1,a)):(t.name=i.slice(o,r),t.base=i.slice(o,a)),t.ext=i.slice(r,a)),t.dir=this.dirname(i),t},sep:"/",delimiter:":",joinExtensions:[".html"]};function Ru(i,t,e,s,n){const r=t[e];for(let o=0;o<r.length;o++){const a=r[o];e<t.length-1?Ru(i.replace(s[e],a),t,e+1,s,n):n.push(i.replace(s[e],a))}}function c0(i){const t=/\{(.*?)\}/g,e=i.match(t),s=[];if(e){const n=[];e.forEach(r=>{const o=r.substring(1,r.length-1).split(",");n.push(o)}),Ru(i,n,0,e,s)}else s.push(i);return s}const fr=i=>!Array.isArray(i);class Is{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(e=>{this._preferredOrder.push(e),e.priority||(e.priority=Object.keys(e.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map(s=>`${encodeURIComponent(s)}=${encodeURIComponent(e[s])}`).join("&")}}getAlias(t){const{alias:e,src:s}=t;return Ge(e||s,r=>typeof r=="string"?r:Array.isArray(r)?r.map(o=>(o==null?void 0:o.src)??o):r!=null&&r.src?r.src:r,!0)}addManifest(t){this._manifest&&Bt("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(e=>{this.addBundle(e.name,e.assets)})}addBundle(t,e){const s=[];let n=e;Array.isArray(e)||(n=Object.entries(e).map(([r,o])=>typeof o=="string"||Array.isArray(o)?{alias:r,src:o}:{alias:r,...o})),n.forEach(r=>{const o=r.src,a=r.alias;let l;if(typeof a=="string"){const c=this._createBundleAssetId(t,a);s.push(c),l=[a,c]}else{const c=a.map(h=>this._createBundleAssetId(t,h));s.push(...c),l=[...a,...c]}this.add({...r,alias:l,src:o})}),this._bundles[t]=s}add(t){const e=[];Array.isArray(t)?e.push(...t):e.push(t);let s;s=r=>{this.hasKey(r)&&Bt(`[Resolver] already has key: ${r} overwriting`)},Ge(e).forEach(r=>{const{src:o}=r;let{data:a,format:l,loadParser:c,parser:h}=r;const u=Ge(o).map(m=>typeof m=="string"?c0(m):Array.isArray(m)?m:[m]),d=this.getAlias(r);Array.isArray(d)?d.forEach(s):s(d);const f=[];u.forEach(m=>{m.forEach(y=>{let g={};if(typeof y!="object"){g.src=y;for(let E=0;E<this._parsers.length;E++){const T=this._parsers[E];if(T.test(y)){g=T.parse(y);break}}}else a=y.data??a,l=y.format??l,(y.loadParser||y.parser)&&(c=y.loadParser??c,h=y.parser??h),g={...g,...y};if(!d)throw new Error(`[Resolver] alias is undefined for this asset: ${g.src}`);g=this._buildResolvedAsset(g,{aliases:d,data:a,format:l,loadParser:c,parser:h}),f.push(g)})}),d.forEach(m=>{this._assetMap[m]=f})})}resolveBundle(t){const e=fr(t);t=Ge(t);const s={};return t.forEach(n=>{const r=this._bundles[n];if(r){const o=this.resolve(r),a={};for(const l in o){const c=o[l];a[this._extractAssetIdFromBundle(n,l)]=c}s[n]=a}}),e?s[t[0]]:s}resolveUrl(t){const e=this.resolve(t);if(typeof t!="string"){const s={};for(const n in e)s[n]=e[n].src;return s}return e.src}resolve(t){const e=fr(t);t=Ge(t);const s={};return t.forEach(n=>{if(!this._resolverHash[n])if(this._assetMap[n]){let r=this._assetMap[n];const o=this._getPreferredOrder(r);o==null||o.priority.forEach(a=>{o.params[a].forEach(l=>{const c=r.filter(h=>h[a]?h[a]===l:!1);c.length&&(r=c)})}),this._resolverHash[n]=r[0]}else this._resolverHash[n]=this._buildResolvedAsset({alias:[n],src:n},{});s[n]=this._resolverHash[n]}),e?s[t[0]]:s}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const s=t[e],n=this._preferredOrder.find(r=>r.params.format.includes(s.format));if(n)return n}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const e=/\?/.test(t)?"&":"?";return`${t}${e}${this._defaultSearchParams}`}_buildResolvedAsset(t,e){const{aliases:s,data:n,loadParser:r,parser:o,format:a}=e;return(this._basePath||this._rootPath)&&(t.src=be.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=s??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...n||{},...t.data},t.loadParser=r??t.loadParser,t.parser=o??t.parser,t.format=a??t.format??h0(t.src),t}}Is.RETINA_PREFIX=/@([0-9\.]+)x/;function h0(i){return i.split(".").pop().split("?").shift().split("#").shift()}const ea=(i,t)=>{const e=t.split("?")[1];return e&&(i+=`?${e}`),i},wu=class Vs{constructor(t,e){this.linkedSheets=[];let s=t;(t==null?void 0:t.source)instanceof Ne&&(s={texture:t,data:e});const{texture:n,data:r,cachePrefix:o=""}=s;this.cachePrefix=o,this._texture=n instanceof _t?n:null,this.textureSource=n.source,this.textures={},this.animations={},this.data=r;const a=parseFloat(r.meta.scale);a?(this.resolution=a,n.source.resolution=this.resolution):this.resolution=n.source._resolution,this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=Vs.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let e=t;const s=Vs.BATCH_SIZE;for(;e-t<s&&e<this._frameKeys.length;){const n=this._frameKeys[e],r=this._frames[n],o=r.frame;if(o){let a=null,l=null;const c=r.trimmed!==!1&&r.sourceSize?r.sourceSize:r.frame,h=new Ot(0,0,Math.floor(c.w)/this.resolution,Math.floor(c.h)/this.resolution);r.rotated?a=new Ot(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.h)/this.resolution,Math.floor(o.w)/this.resolution):a=new Ot(Math.floor(o.x)/this.resolution,Math.floor(o.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution),r.trimmed!==!1&&r.spriteSourceSize&&(l=new Ot(Math.floor(r.spriteSourceSize.x)/this.resolution,Math.floor(r.spriteSourceSize.y)/this.resolution,Math.floor(o.w)/this.resolution,Math.floor(o.h)/this.resolution)),this.textures[n]=new _t({source:this.textureSource,frame:a,orig:h,trim:l,rotate:r.rotated?2:0,defaultAnchor:r.anchor,defaultBorders:r.borders,label:n.toString()})}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let s=0;s<t[e].length;s++){const n=t[e][s];this.animations[e].push(this.textures[n])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Vs.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Vs.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){var e;for(const s in this.textures)this.textures[s].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&((e=this._texture)==null||e.destroy(),this.textureSource.destroy()),this._texture=null,this.textureSource=null,this.linkedSheets=[]}};wu.BATCH_SIZE=1e3;let $l=wu;const u0=["jpg","png","jpeg","avif","webp","basis","etc2","bc7","bc6h","bc5","bc4","bc3","bc2","bc1","eac","astc"];function Iu(i,t,e){const s={};if(i.forEach(n=>{s[n]=t}),Object.keys(t.textures).forEach(n=>{s[`${t.cachePrefix}${n}`]=t.textures[n]}),!e){const n=be.dirname(i[0]);t.linkedSheets.forEach((r,o)=>{const a=Iu([`${n}/${t.data.meta.related_multi_packs[o]}`],r,!0);Object.assign(s,a)})}return s}const d0={extension:lt.Asset,cache:{test:i=>i instanceof $l,getCacheableAssets:(i,t)=>Iu(i,t,!1)},resolver:{extension:{type:lt.ResolveParser,name:"resolveSpritesheet"},test:i=>{const e=i.split("?")[0].split("."),s=e.pop(),n=e.pop();return s==="json"&&u0.includes(n)},parse:i=>{var e;const t=i.split(".");return{resolution:parseFloat(((e=Is.RETINA_PREFIX.exec(i))==null?void 0:e[1])??"1"),format:t[t.length-2],src:i}}},loader:{name:"spritesheetLoader",id:"spritesheet",extension:{type:lt.LoadParser,priority:vi.Normal,name:"spritesheetLoader"},async testParse(i,t){return be.extname(t.src).toLowerCase()===".json"&&!!i.frames},async parse(i,t,e){var u,d;const{texture:s,imageFilename:n,textureOptions:r,cachePrefix:o}=(t==null?void 0:t.data)??{};let a=be.dirname(t.src);a&&a.lastIndexOf("/")!==a.length-1&&(a+="/");let l;if(s instanceof _t)l=s;else{const f=ea(a+(n??i.meta.image),t.src);l=(await e.load([{src:f,data:r}]))[f]}const c=new $l({texture:l.source,data:i,cachePrefix:o});await c.parse();const h=(u=i==null?void 0:i.meta)==null?void 0:u.related_multi_packs;if(Array.isArray(h)){const f=[];for(const y of h){if(typeof y!="string")continue;let g=a+y;(d=t.data)!=null&&d.ignoreMultiPack||(g=ea(g,t.src),f.push(e.load({src:g,data:{textureOptions:r,ignoreMultiPack:!0}})))}const m=await Promise.all(f);c.linkedSheets=m,m.forEach(y=>{y.linkedSheets=[c].concat(c.linkedSheets.filter(g=>g!==y))})}return c},async unload(i,t,e){await e.unload(i.textureSource._sourceOrigin),i.destroy(!1)}}};ne.add(d0);const mo=Object.create(null),Yl=Object.create(null);function Ha(i,t){let e=Yl[i];return e===void 0&&(mo[t]===void 0&&(mo[t]=1),Yl[i]=e=mo[t]++),e}let is;function Mu(){return(!is||is!=null&&is.isContextLost())&&(is=Wt.get().createCanvas().getContext("webgl",{})),is}let Hn;function f0(){if(!Hn){Hn="mediump";const i=Mu();i&&i.getShaderPrecisionFormat&&(Hn=i.getShaderPrecisionFormat(i.FRAGMENT_SHADER,i.HIGH_FLOAT).precision?"highp":"mediump")}return Hn}function p0(i,t,e){return t?i:e?(i=i.replace("out vec4 finalColor;",""),`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in varying
        #define finalColor gl_FragColor
        #define texture texture2D
        #endif
        ${i}
        `):`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in attribute
        #define out varying
        #endif
        ${i}
        `}function m0(i,t,e){const s=e?t.maxSupportedFragmentPrecision:t.maxSupportedVertexPrecision;if(i.substring(0,9)!=="precision"){let n=e?t.requestedFragmentPrecision:t.requestedVertexPrecision;return n==="highp"&&s!=="highp"&&(n="mediump"),`precision ${n} float;
${i}`}else if(s!=="highp"&&i.substring(0,15)==="precision highp")return i.replace("precision highp","precision mediump");return i}function g0(i,t){return t?`#version 300 es
${i}`:i}const y0={},S0={};function T0(i,{name:t="pixi-program"},e=!0){t=t.replace(/\s+/g,"-"),t+=e?"-fragment":"-vertex";const s=e?y0:S0;return s[t]?(s[t]++,t+=`-${s[t]}`):s[t]=1,i.indexOf("#define SHADER_NAME")!==-1?i:`${`#define SHADER_NAME ${t}`}
${i}`}function E0(i,t){return t?i.replace("#version 300 es",""):i}const go={stripVersion:E0,ensurePrecision:m0,addProgramDefines:p0,setProgramName:T0,insertVersion:g0},Ds=Object.create(null),Ou=class ia{constructor(t){t={...ia.defaultOptions,...t};const e=t.fragment.indexOf("#version 300 es")!==-1,s={stripVersion:e,ensurePrecision:{requestedFragmentPrecision:t.preferredFragmentPrecision,requestedVertexPrecision:t.preferredVertexPrecision,maxSupportedVertexPrecision:"highp",maxSupportedFragmentPrecision:f0()},setProgramName:{name:t.name},addProgramDefines:e,insertVersion:e};let n=t.fragment,r=t.vertex;Object.keys(go).forEach(o=>{const a=s[o];n=go[o](n,a,!0),r=go[o](r,a,!1)}),this.fragment=n,this.vertex=r,this.transformFeedbackVaryings=t.transformFeedbackVaryings,this._key=Ha(`${this.vertex}:${this.fragment}`,"gl-program")}destroy(){this.fragment=null,this.vertex=null,this._attributeData=null,this._uniformData=null,this._uniformBlockData=null,this.transformFeedbackVaryings=null,Ds[this._cacheKey]=null}static from(t){const e=`${t.vertex}:${t.fragment}`;return Ds[e]||(Ds[e]=new ia(t),Ds[e]._cacheKey=e),Ds[e]}};Ou.defaultOptions={preferredVertexPrecision:"highp",preferredFragmentPrecision:"mediump"};let ni=Ou;const Xl={uint8x2:{size:2,stride:2,normalised:!1},uint8x4:{size:4,stride:4,normalised:!1},sint8x2:{size:2,stride:2,normalised:!1},sint8x4:{size:4,stride:4,normalised:!1},unorm8x2:{size:2,stride:2,normalised:!0},unorm8x4:{size:4,stride:4,normalised:!0},snorm8x2:{size:2,stride:2,normalised:!0},snorm8x4:{size:4,stride:4,normalised:!0},uint16x2:{size:2,stride:4,normalised:!1},uint16x4:{size:4,stride:8,normalised:!1},sint16x2:{size:2,stride:4,normalised:!1},sint16x4:{size:4,stride:8,normalised:!1},unorm16x2:{size:2,stride:4,normalised:!0},unorm16x4:{size:4,stride:8,normalised:!0},snorm16x2:{size:2,stride:4,normalised:!0},snorm16x4:{size:4,stride:8,normalised:!0},float16x2:{size:2,stride:4,normalised:!1},float16x4:{size:4,stride:8,normalised:!1},float32:{size:1,stride:4,normalised:!1},float32x2:{size:2,stride:8,normalised:!1},float32x3:{size:3,stride:12,normalised:!1},float32x4:{size:4,stride:16,normalised:!1},uint32:{size:1,stride:4,normalised:!1},uint32x2:{size:2,stride:8,normalised:!1},uint32x3:{size:3,stride:12,normalised:!1},uint32x4:{size:4,stride:16,normalised:!1},sint32:{size:1,stride:4,normalised:!1},sint32x2:{size:2,stride:8,normalised:!1},sint32x3:{size:3,stride:12,normalised:!1},sint32x4:{size:4,stride:16,normalised:!1}};function sa(i){return Xl[i]??Xl.float32}const _0={f32:"float32","vec2<f32>":"float32x2","vec3<f32>":"float32x3","vec4<f32>":"float32x4",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",i32:"sint32","vec2<i32>":"sint32x2","vec3<i32>":"sint32x3","vec4<i32>":"sint32x4",u32:"uint32","vec2<u32>":"uint32x2","vec3<u32>":"uint32x3","vec4<u32>":"uint32x4",bool:"uint32","vec2<bool>":"uint32x2","vec3<bool>":"uint32x3","vec4<bool>":"uint32x4"};function b0({source:i,entryPoint:t}){const e={},s=i.indexOf(`fn ${t}`);if(s!==-1){const n=i.indexOf("->",s);if(n!==-1){const r=i.substring(s,n),o=/@location\((\d+)\)\s+([a-zA-Z0-9_]+)\s*:\s*([a-zA-Z0-9_<>]+)(?:,|\s|$)/g;let a;for(;(a=o.exec(r))!==null;){const l=_0[a[3]]??"float32";e[a[2]]={location:parseInt(a[1],10),format:l,stride:sa(l).stride,offset:0,instance:!1,start:0}}}}return e}function yo(i){var u,d;const t=/(^|[^/])@(group|binding)\(\d+\)[^;]+;/g,e=/@group\((\d+)\)/,s=/@binding\((\d+)\)/,n=/var(<[^>]+>)? (\w+)/,r=/:\s*(\w+)/,o=/struct\s+(\w+)\s*{([^}]+)}/g,a=/(\w+)\s*:\s*([\w\<\>]+)/g,l=/struct\s+(\w+)/,c=(u=i.match(t))==null?void 0:u.map(f=>({group:parseInt(f.match(e)[1],10),binding:parseInt(f.match(s)[1],10),name:f.match(n)[2],isUniform:f.match(n)[1]==="<uniform>",type:f.match(r)[1]}));if(!c)return{groups:[],structs:[]};const h=((d=i.match(o))==null?void 0:d.map(f=>{const m=f.match(l)[1],y=f.match(a).reduce((g,E)=>{const[T,_]=E.split(":");return g[T.trim()]=_.trim(),g},{});return y?{name:m,members:y}:null}).filter(({name:f})=>c.some(m=>m.type===f)))??[];return{groups:c,structs:h}}var zs=(i=>(i[i.VERTEX=1]="VERTEX",i[i.FRAGMENT=2]="FRAGMENT",i[i.COMPUTE=4]="COMPUTE",i))(zs||{});function x0({groups:i}){const t=[];for(let e=0;e<i.length;e++){const s=i[e];t[s.group]||(t[s.group]=[]),s.isUniform?t[s.group].push({binding:s.binding,visibility:zs.VERTEX|zs.FRAGMENT,buffer:{type:"uniform"}}):s.type==="sampler"?t[s.group].push({binding:s.binding,visibility:zs.FRAGMENT,sampler:{type:"filtering"}}):s.type==="texture_2d"&&t[s.group].push({binding:s.binding,visibility:zs.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}})}return t}function A0({groups:i}){const t=[];for(let e=0;e<i.length;e++){const s=i[e];t[s.group]||(t[s.group]={}),t[s.group][s.name]=s.binding}return t}function C0(i,t){const e=new Set,s=new Set,n=[...i.structs,...t.structs].filter(o=>e.has(o.name)?!1:(e.add(o.name),!0)),r=[...i.groups,...t.groups].filter(o=>{const a=`${o.name}-${o.binding}`;return s.has(a)?!1:(s.add(a),!0)});return{structs:n,groups:r}}const ks=Object.create(null);class Le{constructor(t){var a,l;this._layoutKey=0,this._attributeLocationsKey=0;const{fragment:e,vertex:s,layout:n,gpuLayout:r,name:o}=t;if(this.name=o,this.fragment=e,this.vertex=s,e.source===s.source){const c=yo(e.source);this.structsAndGroups=c}else{const c=yo(s.source),h=yo(e.source);this.structsAndGroups=C0(c,h)}this.layout=n??A0(this.structsAndGroups),this.gpuLayout=r??x0(this.structsAndGroups),this.autoAssignGlobalUniforms=((a=this.layout[0])==null?void 0:a.globalUniforms)!==void 0,this.autoAssignLocalUniforms=((l=this.layout[1])==null?void 0:l.localUniforms)!==void 0,this._generateProgramKey()}_generateProgramKey(){const{vertex:t,fragment:e}=this,s=t.source+e.source+t.entryPoint+e.entryPoint;this._layoutKey=Ha(s,"program")}get attributeData(){return this._attributeData??(this._attributeData=b0(this.vertex)),this._attributeData}destroy(){this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null,ks[this._cacheKey]=null}static from(t){const e=`${t.vertex.source}:${t.fragment.source}:${t.fragment.entryPoint}:${t.vertex.entryPoint}`;return ks[e]||(ks[e]=new Le(t),ks[e]._cacheKey=e),ks[e]}}const vu=["f32","i32","vec2<f32>","vec3<f32>","vec4<f32>","mat2x2<f32>","mat3x3<f32>","mat4x4<f32>","mat3x2<f32>","mat4x2<f32>","mat2x3<f32>","mat4x3<f32>","mat2x4<f32>","mat3x4<f32>","vec2<i32>","vec3<i32>","vec4<i32>"],R0=vu.reduce((i,t)=>(i[t]=!0,i),{});function w0(i,t){switch(i){case"f32":return 0;case"vec2<f32>":return new Float32Array(2*t);case"vec3<f32>":return new Float32Array(3*t);case"vec4<f32>":return new Float32Array(4*t);case"mat2x2<f32>":return new Float32Array([1,0,0,1]);case"mat3x3<f32>":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4x4<f32>":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Pu=class Lu{constructor(t,e){this._touched=0,this.uid=Xt("uniform"),this._resourceType="uniformGroup",this._resourceId=Xt("resource"),this.isUniformGroup=!0,this._dirtyId=0,this.destroyed=!1,e={...Lu.defaultOptions,...e},this.uniformStructures=t;const s={};for(const n in t){const r=t[n];if(r.name=n,r.size=r.size??1,!R0[r.type]){const o=r.type.match(/^array<(\w+(?:<\w+>)?),\s*(\d+)>$/);if(o){const[,a,l]=o;throw new Error(`Uniform type ${r.type} is not supported. Use type: '${a}', size: ${l} instead.`)}throw new Error(`Uniform type ${r.type} is not supported. Supported uniform types are: ${vu.join(", ")}`)}r.value??(r.value=w0(r.type,r.size)),s[n]=r.value}this.uniforms=s,this._dirtyId=1,this.ubo=e.ubo,this.isStatic=e.isStatic,this._signature=Ha(Object.keys(s).map(n=>`${n}-${t[n].type}`).join("-"),"uniform-group")}update(){this._dirtyId++}};Pu.defaultOptions={ubo:!1,isStatic:!1};let Nu=Pu;class nr{constructor(t){this.resources=Object.create(null),this._dirty=!0;let e=0;for(const s in t){const n=t[s];this.setResource(n,e++)}this._updateKey()}_updateKey(){if(!this._dirty)return;this._dirty=!1;const t=[];let e=0;for(const s in this.resources)t[e++]=this.resources[s]._resourceId;this._key=t.join("|")}setResource(t,e){var n,r;const s=this.resources[e];t!==s&&(s&&((n=t.off)==null||n.call(t,"change",this.onResourceChange,this)),(r=t.on)==null||r.call(t,"change",this.onResourceChange,this),this.resources[e]=t,this._dirty=!0)}getResource(t){return this.resources[t]}_touch(t){const e=this.resources;for(const s in e)e[s]._touched=t}destroy(){var e;const t=this.resources;for(const s in t){const n=t[s];(e=n==null?void 0:n.off)==null||e.call(n,"change",this.onResourceChange,this)}this.resources=null}onResourceChange(t){if(this._dirty=!0,t.destroyed){const e=this.resources;for(const s in e)e[s]===t&&(e[s]=null)}else this._updateKey()}}var on=(i=>(i[i.WEBGL=1]="WEBGL",i[i.WEBGPU=2]="WEBGPU",i[i.BOTH=3]="BOTH",i))(on||{});class $e extends Ke{constructor(t){super(),this.uid=Xt("shader"),this._uniformBindMap=Object.create(null),this._ownedBindGroups=[];let{gpuProgram:e,glProgram:s,groups:n,resources:r,compatibleRenderers:o,groupMap:a}=t;this.gpuProgram=e,this.glProgram=s,o===void 0&&(o=0,e&&(o|=on.WEBGPU),s&&(o|=on.WEBGL)),this.compatibleRenderers=o;const l={};if(!r&&!n&&(r={}),r&&n)throw new Error("[Shader] Cannot have both resources and groups");if(!e&&n&&!a)throw new Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");if(!e&&n&&a)for(const c in a)for(const h in a[c]){const u=a[c][h];l[u]={group:c,binding:h,name:u}}else if(e&&n&&!a){const c=e.structsAndGroups.groups;a={},c.forEach(h=>{a[h.group]=a[h.group]||{},a[h.group][h.binding]=h.name,l[h.name]=h})}else if(r){n={},a={},e&&e.structsAndGroups.groups.forEach(u=>{a[u.group]=a[u.group]||{},a[u.group][u.binding]=u.name,l[u.name]=u});let c=0;for(const h in r)l[h]||(n[99]||(n[99]=new nr,this._ownedBindGroups.push(n[99])),l[h]={group:99,binding:c,name:h},a[99]=a[99]||{},a[99][c]=h,c++);for(const h in r){const u=h;let d=r[h];!d.source&&!d._resourceType&&(d=new Nu(d));const f=l[u];f&&(n[f.group]||(n[f.group]=new nr,this._ownedBindGroups.push(n[f.group])),n[f.group].setResource(d,f.binding))}}this.groups=n,this._uniformBindMap=a,this.resources=this._buildResourceAccessor(n,l)}addResource(t,e,s){var n,r;(n=this._uniformBindMap)[e]||(n[e]={}),(r=this._uniformBindMap[e])[s]||(r[s]=t),this.groups[e]||(this.groups[e]=new nr,this._ownedBindGroups.push(this.groups[e]))}_buildResourceAccessor(t,e){const s={};for(const n in e){const r=e[n];Object.defineProperty(s,r.name,{get(){return t[r.group].getResource(r.binding)},set(o){t[r.group].setResource(o,r.binding)}})}return s}destroy(t=!1){var e,s;this.emit("destroy",this),t&&((e=this.gpuProgram)==null||e.destroy(),(s=this.glProgram)==null||s.destroy()),this.gpuProgram=null,this.glProgram=null,this.removeAllListeners(),this._uniformBindMap=null,this._ownedBindGroups.forEach(n=>{n.destroy()}),this._ownedBindGroups=null,this.resources=null,this.groups=null}static from(t){const{gpu:e,gl:s,...n}=t;let r,o;return e&&(r=Le.from(e)),s&&(o=ni.from(s)),new $e({gpuProgram:r,glProgram:o,...n})}}const I0={normal:0,add:1,multiply:2,screen:3,overlay:4,erase:5,"normal-npm":6,"add-npm":7,"screen-npm":8,min:9,max:10},So=0,To=1,Eo=2,_o=3,bo=4,xo=5,na=class Du{constructor(){this.data=0,this.blendMode="normal",this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<So)}set blend(t){!!(this.data&1<<So)!==t&&(this.data^=1<<So)}get offsets(){return!!(this.data&1<<To)}set offsets(t){!!(this.data&1<<To)!==t&&(this.data^=1<<To)}set cullMode(t){if(t==="none"){this.culling=!1;return}this.culling=!0,this.clockwiseFrontFace=t==="front"}get cullMode(){return this.culling?this.clockwiseFrontFace?"front":"back":"none"}get culling(){return!!(this.data&1<<Eo)}set culling(t){!!(this.data&1<<Eo)!==t&&(this.data^=1<<Eo)}get depthTest(){return!!(this.data&1<<_o)}set depthTest(t){!!(this.data&1<<_o)!==t&&(this.data^=1<<_o)}get depthMask(){return!!(this.data&1<<xo)}set depthMask(t){!!(this.data&1<<xo)!==t&&(this.data^=1<<xo)}get clockwiseFrontFace(){return!!(this.data&1<<bo)}set clockwiseFrontFace(t){!!(this.data&1<<bo)!==t&&(this.data^=1<<bo)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!=="none",this._blendMode=t,this._blendModeId=I0[t]||0}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[pixi.js/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new Du;return t.depthTest=!1,t.blend=!0,t}};na.default2d=na.for2d();let pr=na;const ku=class ra extends $e{constructor(t){t={...ra.defaultOptions,...t},super(t),this.enabled=!0,this._state=pr.for2d(),this.blendMode=t.blendMode,this.padding=t.padding,typeof t.antialias=="boolean"?this.antialias=t.antialias?"on":"off":this.antialias=t.antialias,this.resolution=t.resolution,this.blendRequired=t.blendRequired,this.clipToViewport=t.clipToViewport,this.addResource("uTexture",0,1)}apply(t,e,s,n){t.applyFilter(this,e,s,n)}get blendMode(){return this._state.blendMode}set blendMode(t){this._state.blendMode=t}static from(t){const{gpu:e,gl:s,...n}=t;let r,o;return e&&(r=Le.from(e)),s&&(o=ni.from(s)),new ra({gpuProgram:r,glProgram:o,...n})}};ku.defaultOptions={blendMode:"normal",resolution:1,padding:0,antialias:"off",blendRequired:!1,clipToViewport:!0};let Hu=ku;const oa=[];ne.handleByNamedList(lt.Environment,oa);async function M0(i){if(!i)for(let t=0;t<oa.length;t++){const e=oa[t];if(e.value.test()){await e.value.load();return}}}let Hs;function O0(){if(typeof Hs=="boolean")return Hs;try{Hs=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{Hs=!1}return Hs}function ql(i,t,e=2){const s=t&&t.length,n=s?t[0]*e:i.length;let r=Fu(i,0,n,e,!0);const o=[];if(!r||r.next===r.prev)return o;let a,l,c;if(s&&(r=D0(i,t,r,e)),i.length>80*e){a=i[0],l=i[1];let h=a,u=l;for(let d=e;d<n;d+=e){const f=i[d],m=i[d+1];f<a&&(a=f),m<l&&(l=m),f>h&&(h=f),m>u&&(u=m)}c=Math.max(h-a,u-l),c=c!==0?32767/c:0}return an(r,o,e,a,l,c,0),o}function Fu(i,t,e,s,n){let r;if(n===$0(i,t,e,s)>0)for(let o=t;o<e;o+=s)r=Kl(o/s|0,i[o],i[o+1],r);else for(let o=e-s;o>=t;o-=s)r=Kl(o/s|0,i[o],i[o+1],r);return r&&Ts(r,r.next)&&(cn(r),r=r.next),r}function qi(i,t){if(!i)return i;t||(t=i);let e=i,s;do if(s=!1,!e.steiner&&(Ts(e,e.next)||zt(e.prev,e,e.next)===0)){if(cn(e),e=t=e.prev,e===e.next)break;s=!0}else e=e.next;while(s||e!==t);return t}function an(i,t,e,s,n,r,o){if(!i)return;!o&&r&&U0(i,s,n,r);let a=i;for(;i.prev!==i.next;){const l=i.prev,c=i.next;if(r?P0(i,s,n,r):v0(i)){t.push(l.i,i.i,c.i),cn(i),i=c.next,a=c.next;continue}if(i=c,i===a){o?o===1?(i=L0(qi(i),t),an(i,t,e,s,n,r,2)):o===2&&N0(i,t,e,s,n,r):an(qi(i),t,e,s,n,r,1);break}}}function v0(i){const t=i.prev,e=i,s=i.next;if(zt(t,e,s)>=0)return!1;const n=t.x,r=e.x,o=s.x,a=t.y,l=e.y,c=s.y,h=Math.min(n,r,o),u=Math.min(a,l,c),d=Math.max(n,r,o),f=Math.max(a,l,c);let m=s.next;for(;m!==t;){if(m.x>=h&&m.x<=d&&m.y>=u&&m.y<=f&&$s(n,a,r,l,o,c,m.x,m.y)&&zt(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function P0(i,t,e,s){const n=i.prev,r=i,o=i.next;if(zt(n,r,o)>=0)return!1;const a=n.x,l=r.x,c=o.x,h=n.y,u=r.y,d=o.y,f=Math.min(a,l,c),m=Math.min(h,u,d),y=Math.max(a,l,c),g=Math.max(h,u,d),E=aa(f,m,t,e,s),T=aa(y,g,t,e,s);let _=i.prevZ,b=i.nextZ;for(;_&&_.z>=E&&b&&b.z<=T;){if(_.x>=f&&_.x<=y&&_.y>=m&&_.y<=g&&_!==n&&_!==o&&$s(a,h,l,u,c,d,_.x,_.y)&&zt(_.prev,_,_.next)>=0||(_=_.prevZ,b.x>=f&&b.x<=y&&b.y>=m&&b.y<=g&&b!==n&&b!==o&&$s(a,h,l,u,c,d,b.x,b.y)&&zt(b.prev,b,b.next)>=0))return!1;b=b.nextZ}for(;_&&_.z>=E;){if(_.x>=f&&_.x<=y&&_.y>=m&&_.y<=g&&_!==n&&_!==o&&$s(a,h,l,u,c,d,_.x,_.y)&&zt(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;b&&b.z<=T;){if(b.x>=f&&b.x<=y&&b.y>=m&&b.y<=g&&b!==n&&b!==o&&$s(a,h,l,u,c,d,b.x,b.y)&&zt(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function L0(i,t){let e=i;do{const s=e.prev,n=e.next.next;!Ts(s,n)&&Uu(s,e,e.next,n)&&ln(s,n)&&ln(n,s)&&(t.push(s.i,e.i,n.i),cn(e),cn(e.next),e=i=n),e=e.next}while(e!==i);return qi(e)}function N0(i,t,e,s,n,r){let o=i;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&W0(o,a)){let l=Gu(o,a);o=qi(o,o.next),l=qi(l,l.next),an(o,t,e,s,n,r,0),an(l,t,e,s,n,r,0);return}a=a.next}o=o.next}while(o!==i)}function D0(i,t,e,s){const n=[];for(let r=0,o=t.length;r<o;r++){const a=t[r]*s,l=r<o-1?t[r+1]*s:i.length,c=Fu(i,a,l,s,!1);c===c.next&&(c.steiner=!0),n.push(j0(c))}n.sort(k0);for(let r=0;r<n.length;r++)e=H0(n[r],e);return e}function k0(i,t){let e=i.x-t.x;if(e===0&&(e=i.y-t.y,e===0)){const s=(i.next.y-i.y)/(i.next.x-i.x),n=(t.next.y-t.y)/(t.next.x-t.x);e=s-n}return e}function H0(i,t){const e=F0(i,t);if(!e)return t;const s=Gu(e,i);return qi(s,s.next),qi(e,e.next)}function F0(i,t){let e=t;const s=i.x,n=i.y;let r=-1/0,o;if(Ts(i,e))return e;do{if(Ts(i,e.next))return e.next;if(n<=e.y&&n>=e.next.y&&e.next.y!==e.y){const u=e.x+(n-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(u<=s&&u>r&&(r=u,o=e.x<e.next.x?e:e.next,u===s))return o}e=e.next}while(e!==t);if(!o)return null;const a=o,l=o.x,c=o.y;let h=1/0;e=o;do{if(s>=e.x&&e.x>=l&&s!==e.x&&Bu(n<c?s:r,n,l,c,n<c?r:s,n,e.x,e.y)){const u=Math.abs(n-e.y)/(s-e.x);ln(e,i)&&(u<h||u===h&&(e.x>o.x||e.x===o.x&&B0(o,e)))&&(o=e,h=u)}e=e.next}while(e!==a);return o}function B0(i,t){return zt(i.prev,i,t.prev)<0&&zt(t.next,i,i.next)<0}function U0(i,t,e,s){let n=i;do n.z===0&&(n.z=aa(n.x,n.y,t,e,s)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next;while(n!==i);n.prevZ.nextZ=null,n.prevZ=null,G0(n)}function G0(i){let t,e=1;do{let s=i,n;i=null;let r=null;for(t=0;s;){t++;let o=s,a=0;for(let c=0;c<e&&(a++,o=o.nextZ,!!o);c++);let l=e;for(;a>0||l>0&&o;)a!==0&&(l===0||!o||s.z<=o.z)?(n=s,s=s.nextZ,a--):(n=o,o=o.nextZ,l--),r?r.nextZ=n:i=n,n.prevZ=r,r=n;s=o}r.nextZ=null,e*=2}while(t>1);return i}function aa(i,t,e,s,n){return i=(i-e)*n|0,t=(t-s)*n|0,i=(i|i<<8)&16711935,i=(i|i<<4)&252645135,i=(i|i<<2)&858993459,i=(i|i<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,i|t<<1}function j0(i){let t=i,e=i;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==i);return e}function Bu(i,t,e,s,n,r,o,a){return(n-o)*(t-a)>=(i-o)*(r-a)&&(i-o)*(s-a)>=(e-o)*(t-a)&&(e-o)*(r-a)>=(n-o)*(s-a)}function $s(i,t,e,s,n,r,o,a){return!(i===o&&t===a)&&Bu(i,t,e,s,n,r,o,a)}function W0(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!V0(i,t)&&(ln(i,t)&&ln(t,i)&&z0(i,t)&&(zt(i.prev,i,t.prev)||zt(i,t.prev,t))||Ts(i,t)&&zt(i.prev,i,i.next)>0&&zt(t.prev,t,t.next)>0)}function zt(i,t,e){return(t.y-i.y)*(e.x-t.x)-(t.x-i.x)*(e.y-t.y)}function Ts(i,t){return i.x===t.x&&i.y===t.y}function Uu(i,t,e,s){const n=Bn(zt(i,t,e)),r=Bn(zt(i,t,s)),o=Bn(zt(e,s,i)),a=Bn(zt(e,s,t));return!!(n!==r&&o!==a||n===0&&Fn(i,e,t)||r===0&&Fn(i,s,t)||o===0&&Fn(e,i,s)||a===0&&Fn(e,t,s))}function Fn(i,t,e){return t.x<=Math.max(i.x,e.x)&&t.x>=Math.min(i.x,e.x)&&t.y<=Math.max(i.y,e.y)&&t.y>=Math.min(i.y,e.y)}function Bn(i){return i>0?1:i<0?-1:0}function V0(i,t){let e=i;do{if(e.i!==i.i&&e.next.i!==i.i&&e.i!==t.i&&e.next.i!==t.i&&Uu(e,e.next,i,t))return!0;e=e.next}while(e!==i);return!1}function ln(i,t){return zt(i.prev,i,i.next)<0?zt(i,t,i.next)>=0&&zt(i,i.prev,t)>=0:zt(i,t,i.prev)<0||zt(i,i.next,t)<0}function z0(i,t){let e=i,s=!1;const n=(i.x+t.x)/2,r=(i.y+t.y)/2;do e.y>r!=e.next.y>r&&e.next.y!==e.y&&n<(e.next.x-e.x)*(r-e.y)/(e.next.y-e.y)+e.x&&(s=!s),e=e.next;while(e!==i);return s}function Gu(i,t){const e=la(i.i,i.x,i.y),s=la(t.i,t.x,t.y),n=i.next,r=t.prev;return i.next=t,t.prev=i,e.next=n,n.prev=e,s.next=e,e.prev=s,r.next=s,s.prev=r,s}function Kl(i,t,e,s){const n=la(i,t,e);return s?(n.next=s.next,n.prev=s,s.next.prev=n,s.next=n):(n.prev=n,n.next=n),n}function cn(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function la(i,t,e){return{i,x:t,y:e,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function $0(i,t,e,s){let n=0;for(let r=t,o=e-s;r<e;r+=s)n+=(i[o]-i[r])*(i[r+1]+i[o+1]),o=r;return n}const Y0=ql.default||ql;var ju=(i=>(i[i.NONE=0]="NONE",i[i.COLOR=16384]="COLOR",i[i.STENCIL=1024]="STENCIL",i[i.DEPTH=256]="DEPTH",i[i.COLOR_DEPTH=16640]="COLOR_DEPTH",i[i.COLOR_STENCIL=17408]="COLOR_STENCIL",i[i.DEPTH_STENCIL=1280]="DEPTH_STENCIL",i[i.ALL=17664]="ALL",i))(ju||{});class X0{constructor(t){this.items=[],this._name=t}emit(t,e,s,n,r,o,a,l){const{name:c,items:h}=this;for(let u=0,d=h.length;u<d;u++)h[u][c](t,e,s,n,r,o,a,l);return this}add(t){return t[this._name]&&(this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return e!==-1&&this.items.splice(e,1),this}contains(t){return this.items.indexOf(t)!==-1}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}const q0=["init","destroy","contextChange","resolutionChange","resetState","renderEnd","renderStart","render","update","postrender","prerender"],Wu=class Vu extends Ke{constructor(t){super(),this.uid=Xt("renderer"),this.runners=Object.create(null),this.renderPipes=Object.create(null),this._initOptions={},this._systemsHash=Object.create(null),this.type=t.type,this.name=t.name,this.config=t;const e=[...q0,...this.config.runners??[]];this._addRunners(...e),this._unsafeEvalCheck()}async init(t={}){const e=t.skipExtensionImports===!0?!0:t.manageImports===!1;await M0(e),this._addSystems(this.config.systems),this._addPipes(this.config.renderPipes,this.config.renderPipeAdaptors);for(const s in this._systemsHash)t={...this._systemsHash[s].constructor.defaultOptions,...t};t={...Vu.defaultOptions,...t},this._roundPixels=t.roundPixels?1:0;for(let s=0;s<this.runners.init.items.length;s++)await this.runners.init.items[s].init(t);this._initOptions=t}render(t,e){let s=t;if(s instanceof ut&&(s={container:s},e&&(dt(Rt,"passing a second argument is deprecated, please use render options instead"),s.target=e.renderTexture)),s.target||(s.target=this.view.renderTarget),s.target===this.view.renderTarget&&(this._lastObjectRendered=s.container,s.clearColor??(s.clearColor=this.background.colorRgba),s.clear??(s.clear=this.background.clearBeforeRender)),s.clearColor){const n=Array.isArray(s.clearColor)&&s.clearColor.length===4;s.clearColor=n?s.clearColor:Kt.shared.setValue(s.clearColor).toArray()}s.transform||(s.container.updateLocalTransform(),s.transform=s.container.localTransform),s.container.visible&&(s.container.enableRenderGroup(),this.runners.prerender.emit(s),this.runners.renderStart.emit(s),this.runners.render.emit(s),this.runners.renderEnd.emit(s),this.runners.postrender.emit(s))}resize(t,e,s){const n=this.view.resolution;this.view.resize(t,e,s),this.emit("resize",this.view.screen.width,this.view.screen.height,this.view.resolution),s!==void 0&&s!==n&&this.runners.resolutionChange.emit(s)}clear(t={}){const e=this;t.target||(t.target=e.renderTarget.renderTarget),t.clearColor||(t.clearColor=this.background.colorRgba),t.clear??(t.clear=ju.ALL);const{clear:s,clearColor:n,target:r}=t;Kt.shared.setValue(n??this.background.colorRgba),e.renderTarget.clear(r,s,Kt.shared.toArray())}get resolution(){return this.view.resolution}set resolution(t){this.view.resolution=t,this.runners.resolutionChange.emit(t)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...t){t.forEach(e=>{this.runners[e]=new X0(e)})}_addSystems(t){let e;for(e in t){const s=t[e];this._addSystem(s.value,s.name)}}_addSystem(t,e){const s=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=s,this._systemsHash[e]=s;for(const n in this.runners)this.runners[n].add(s);return this}_addPipes(t,e){const s=e.reduce((n,r)=>(n[r.name]=r.value,n),{});t.forEach(n=>{const r=n.value,o=n.name,a=s[o];this.renderPipes[o]=new r(this,a?new a:null),this.runners.destroy.add(this.renderPipes[o])})}destroy(t=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(t),Object.values(this.runners).forEach(e=>{e.destroy()}),(t===!0||typeof t=="object"&&t.releaseGlobalResources)&&xn.release(),this._systemsHash=null,this.renderPipes=null}generateTexture(t){return this.textureGenerator.generateTexture(t)}get roundPixels(){return!!this._roundPixels}_unsafeEvalCheck(){if(!O0())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}resetState(){this.runners.resetState.emit()}};Wu.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let zu=Wu,Un;function K0(i){return Un!==void 0||(Un=(()=>{var e;const t={stencil:!0,failIfMajorPerformanceCaveat:i??zu.defaultOptions.failIfMajorPerformanceCaveat};try{if(!Wt.get().getWebGLRenderingContext())return!1;let n=Wt.get().createCanvas().getContext("webgl",t);const r=!!((e=n==null?void 0:n.getContextAttributes())!=null&&e.stencil);if(n){const o=n.getExtension("WEBGL_lose_context");o&&o.loseContext()}return n=null,r}catch{return!1}})()),Un}let Gn;async function Z0(i={}){return Gn!==void 0||(Gn=await(async()=>{const t=Wt.get().getNavigator().gpu;if(!t)return!1;try{return await(await t.requestAdapter(i)).requestDevice(),!0}catch{return!1}})()),Gn}const Zl=["webgl","webgpu","canvas"];async function J0(i){let t=[];i.preference?(t.push(i.preference),Zl.forEach(r=>{r!==i.preference&&t.push(r)})):t=Zl.slice();let e,s={};for(let r=0;r<t.length;r++){const o=t[r];if(o==="webgpu"&&await Z0()){const{WebGPURenderer:a}=await dr(async()=>{const{WebGPURenderer:l}=await import("./WebGPURenderer-r8ndJw-i.js");return{WebGPURenderer:l}},__vite__mapDeps([3,2,4]));e=a,s={...i,...i.webgpu};break}else if(o==="webgl"&&K0(i.failIfMajorPerformanceCaveat??zu.defaultOptions.failIfMajorPerformanceCaveat)){const{WebGLRenderer:a}=await dr(async()=>{const{WebGLRenderer:l}=await import("./WebGLRenderer-CTmAMSnT.js");return{WebGLRenderer:l}},__vite__mapDeps([5,2,4]));e=a,s={...i,...i.webgl};break}else if(o==="canvas")throw s={...i},new Error("CanvasRenderer is not yet implemented")}if(delete s.webgpu,delete s.webgl,!e)throw new Error("No available renderer for the current environment");const n=new e;return await n.init(s),n}const $u="8.13.2";class Yu{static init(){var t;(t=globalThis.__PIXI_APP_INIT__)==null||t.call(globalThis,this,$u)}static destroy(){}}Yu.extension=lt.Application;class Q0{constructor(t){this._renderer=t}init(){var t;(t=globalThis.__PIXI_RENDERER_INIT__)==null||t.call(globalThis,this._renderer,$u)}destroy(){this._renderer=null}}Q0.extension={type:[lt.WebGLSystem,lt.WebGPUSystem],name:"initHook",priority:-10};const Xu=class ca{constructor(...t){this.stage=new ut,t[0]!==void 0&&dt(Rt,"Application constructor options are deprecated, please use Application.init() instead.")}async init(t){t={...t},this.renderer=await J0(t),ca._plugins.forEach(e=>{e.init.call(this,t)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return dt(Rt,"Application.view is deprecated, please use Application.canvas instead."),this.renderer.canvas}get screen(){return this.renderer.screen}destroy(t=!1,e=!1){const s=ca._plugins.slice(0);s.reverse(),s.forEach(n=>{n.destroy.call(this)}),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};Xu._plugins=[];let qu=Xu;ne.handleByList(lt.Application,qu._plugins);ne.add(Yu);class Ku extends Ke{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.applyFillAsTint=!0,this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return dt(Rt,"BitmapFont.font is deprecated, please use BitmapFont.fontFamily instead."),this.fontFamily}get pageTextures(){return dt(Rt,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}get size(){return dt(Rt,"BitmapFont.size is deprecated, please use BitmapFont.fontMetrics.fontSize instead."),this.fontMetrics.fontSize}get distanceFieldRange(){return dt(Rt,"BitmapFont.distanceFieldRange is deprecated, please use BitmapFont.distanceField.range instead."),this.distanceField.range}get distanceFieldType(){return dt(Rt,"BitmapFont.distanceFieldType is deprecated, please use BitmapFont.distanceField.type instead."),this.distanceField.type}destroy(t=!1){var e;this.emit("destroy",this),this.removeAllListeners();for(const s in this.chars)(e=this.chars[s].texture)==null||e.destroy();this.chars=null,t&&(this.pages.forEach(s=>s.texture.destroy(!0)),this.pages=null)}}/**
 * tiny-lru
 *
 * @copyright 2025 Jason Mulligan <jason.mulligan@avoidwork.com>
 * @license BSD-3-Clause
 * @version 11.4.5
 */class tg{constructor(t=0,e=0,s=!1){this.first=null,this.items=Object.create(null),this.last=null,this.max=t,this.resetTtl=s,this.size=0,this.ttl=e}clear(){return this.first=null,this.items=Object.create(null),this.last=null,this.size=0,this}delete(t){if(this.has(t)){const e=this.items[t];delete this.items[t],this.size--,e.prev!==null&&(e.prev.next=e.next),e.next!==null&&(e.next.prev=e.prev),this.first===e&&(this.first=e.next),this.last===e&&(this.last=e.prev)}return this}entries(t=this.keys()){return t.map(e=>[e,this.get(e)])}evict(t=!1){if(t||this.size>0){const e=this.first;delete this.items[e.key],--this.size===0?(this.first=null,this.last=null):(this.first=e.next,this.first.prev=null)}return this}expiresAt(t){let e;return this.has(t)&&(e=this.items[t].expiry),e}get(t){const e=this.items[t];if(e!==void 0){if(this.ttl>0&&e.expiry<=Date.now()){this.delete(t);return}return this.moveToEnd(e),e.value}}has(t){return t in this.items}moveToEnd(t){this.last!==t&&(t.prev!==null&&(t.prev.next=t.next),t.next!==null&&(t.next.prev=t.prev),this.first===t&&(this.first=t.next),t.prev=this.last,t.next=null,this.last!==null&&(this.last.next=t),this.last=t,this.first===null&&(this.first=t))}keys(){const t=[];let e=this.first;for(;e!==null;)t.push(e.key),e=e.next;return t}setWithEvicted(t,e,s=this.resetTtl){let n=null;if(this.has(t))this.set(t,e,!0,s);else{this.max>0&&this.size===this.max&&(n={...this.first},this.evict(!0));let r=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:e};++this.size===1?this.first=r:this.last.next=r,this.last=r}return n}set(t,e,s=!1,n=this.resetTtl){let r=this.items[t];return s||r!==void 0?(r.value=e,s===!1&&n&&(r.expiry=this.ttl>0?Date.now()+this.ttl:this.ttl),this.moveToEnd(r)):(this.max>0&&this.size===this.max&&this.evict(!0),r=this.items[t]={expiry:this.ttl>0?Date.now()+this.ttl:this.ttl,key:t,prev:this.last,next:null,value:e},++this.size===1?this.first=r:this.last.next=r,this.last=r),this}values(t=this.keys()){return t.map(e=>this.get(e))}}function Zu(i=1e3,t=0,e=!1){if(isNaN(i)||i<0)throw new TypeError("Invalid max value");if(isNaN(t)||t<0)throw new TypeError("Invalid ttl value");if(typeof e!="boolean")throw new TypeError("Invalid resetTtl value");return new tg(i,t,e)}const eg=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function mr(i){const t=typeof i.fontSize=="number"?`${i.fontSize}px`:i.fontSize;let e=i.fontFamily;Array.isArray(i.fontFamily)||(e=i.fontFamily.split(","));for(let s=e.length-1;s>=0;s--){let n=e[s].trim();!/([\"\'])[^\'\"]+\1/.test(n)&&!eg.includes(n)&&(n=`"${n}"`),e[s]=n}return`${i.fontStyle} ${i.fontVariant} ${i.fontWeight} ${t} ${e.join(",")}`}const Ao={willReadFrequently:!0},Ze=class rt{static get experimentalLetterSpacingSupported(){let t=rt._experimentalLetterSpacingSupported;if(t===void 0){const e=Wt.get().getCanvasRenderingContext2D().prototype;t=rt._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,s,n,r,o,a,l,c){this.text=t,this.style=e,this.width=s,this.height=n,this.lines=r,this.lineWidths=o,this.lineHeight=a,this.maxLineWidth=l,this.fontProperties=c}static measureText(t=" ",e,s=rt._canvas,n=e.wordWrap){var T;const r=`${t}-${e.styleKey}-wordWrap-${n}`;if(rt._measurementCache.has(r))return rt._measurementCache.get(r);const o=mr(e),a=rt.measureFont(o);a.fontSize===0&&(a.fontSize=e.fontSize,a.ascent=e.fontSize);const l=rt.__context;l.font=o;const h=(n?rt._wordWrap(t,e,s):t).split(/(?:\r\n|\r|\n)/),u=new Array(h.length);let d=0;for(let _=0;_<h.length;_++){const b=rt._measureText(h[_],e.letterSpacing,l);u[_]=b,d=Math.max(d,b)}const f=((T=e._stroke)==null?void 0:T.width)||0;let m=d+f;e.dropShadow&&(m+=e.dropShadow.distance);const y=e.lineHeight||a.fontSize;let g=Math.max(y,a.fontSize+f)+(h.length-1)*(y+e.leading);e.dropShadow&&(g+=e.dropShadow.distance);const E=new rt(t,e,m,g,h,u,y+e.leading,d,a);return rt._measurementCache.set(r,E),E}static _measureText(t,e,s){let n=!1;rt.experimentalLetterSpacingSupported&&(rt.experimentalLetterSpacing?(s.letterSpacing=`${e}px`,s.textLetterSpacing=`${e}px`,n=!0):(s.letterSpacing="0px",s.textLetterSpacing="0px"));const r=s.measureText(t);let o=r.width;const a=-r.actualBoundingBoxLeft;let c=r.actualBoundingBoxRight-a;if(o>0)if(n)o-=e,c-=e;else{const h=(rt.graphemeSegmenter(t).length-1)*e;o+=h,c+=h}return Math.max(o,c)}static _wordWrap(t,e,s=rt._canvas){const n=s.getContext("2d",Ao);let r=0,o="",a="";const l=Object.create(null),{letterSpacing:c,whiteSpace:h}=e,u=rt._collapseSpaces(h),d=rt._collapseNewlines(h);let f=!u;const m=e.wordWrapWidth+c,y=rt._tokenize(t);for(let g=0;g<y.length;g++){let E=y[g];if(rt._isNewline(E)){if(!d){a+=rt._addLine(o),f=!u,o="",r=0;continue}E=" "}if(u){const _=rt.isBreakingSpace(E),b=rt.isBreakingSpace(o[o.length-1]);if(_&&b)continue}const T=rt._getFromCache(E,c,l,n);if(T>m)if(o!==""&&(a+=rt._addLine(o),o="",r=0),rt.canBreakWords(E,e.breakWords)){const _=rt.wordWrapSplit(E);for(let b=0;b<_.length;b++){let A=_[b],C=A,R=1;for(;_[b+R];){const M=_[b+R];if(!rt.canBreakChars(C,M,E,b,e.breakWords))A+=M;else break;C=M,R++}b+=R-1;const O=rt._getFromCache(A,c,l,n);O+r>m&&(a+=rt._addLine(o),f=!1,o="",r=0),o+=A,r+=O}}else{o.length>0&&(a+=rt._addLine(o),o="",r=0);const _=g===y.length-1;a+=rt._addLine(E,!_),f=!1,o="",r=0}else T+r>m&&(f=!1,a+=rt._addLine(o),o="",r=0),(o.length>0||!rt.isBreakingSpace(E)||f)&&(o+=E,r+=T)}return a+=rt._addLine(o,!1),a}static _addLine(t,e=!0){return t=rt._trimRight(t),t=e?`${t}
`:t,t}static _getFromCache(t,e,s,n){let r=s[t];return typeof r!="number"&&(r=rt._measureText(t,e,n)+e,s[t]=r),r}static _collapseSpaces(t){return t==="normal"||t==="pre-line"}static _collapseNewlines(t){return t==="normal"}static _trimRight(t){if(typeof t!="string")return"";for(let e=t.length-1;e>=0;e--){const s=t[e];if(!rt.isBreakingSpace(s))break;t=t.slice(0,-1)}return t}static _isNewline(t){return typeof t!="string"?!1:rt._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return typeof t!="string"?!1:rt._breakingSpaces.includes(t.charCodeAt(0))}static _tokenize(t){const e=[];let s="";if(typeof t!="string")return e;for(let n=0;n<t.length;n++){const r=t[n],o=t[n+1];if(rt.isBreakingSpace(r,o)||rt._isNewline(r)){s!==""&&(e.push(s),s=""),r==="\r"&&o===`
`?(e.push(`\r
`),n++):e.push(r);continue}s+=r}return s!==""&&e.push(s),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,s,n,r){return!0}static wordWrapSplit(t){return rt.graphemeSegmenter(t)}static measureFont(t){if(rt._fonts[t])return rt._fonts[t];const e=rt._context;e.font=t;const s=e.measureText(rt.METRICS_STRING+rt.BASELINE_SYMBOL),n={ascent:s.actualBoundingBoxAscent,descent:s.actualBoundingBoxDescent,fontSize:s.actualBoundingBoxAscent+s.actualBoundingBoxDescent};return rt._fonts[t]=n,n}static clearMetrics(t=""){t?delete rt._fonts[t]:rt._fonts={}}static get _canvas(){if(!rt.__canvas){let t;try{const e=new OffscreenCanvas(0,0),s=e.getContext("2d",Ao);if(s!=null&&s.measureText)return rt.__canvas=e,e;t=Wt.get().createCanvas()}catch{t=Wt.get().createCanvas()}t.width=t.height=10,rt.__canvas=t}return rt.__canvas}static get _context(){return rt.__context||(rt.__context=rt._canvas.getContext("2d",Ao)),rt.__context}};Ze.METRICS_STRING="|q";Ze.BASELINE_SYMBOL="M";Ze.BASELINE_MULTIPLIER=1.4;Ze.HEIGHT_MULTIPLIER=2;Ze.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const i=new Intl.Segmenter;return t=>{const e=i.segment(t),s=[];let n=0;for(const r of e)s[n++]=r.segment;return s}}return i=>[...i]})();Ze.experimentalLetterSpacing=!1;Ze._fonts={};Ze._newlines=[10,13];Ze._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];Ze._measurementCache=Zu(1e3);let de=Ze;const Jl=[{offset:0,color:"white"},{offset:1,color:"black"}],Fa=class ha{constructor(...t){this.uid=Xt("fillGradient"),this._tick=0,this.type="linear",this.colorStops=[];let e=ig(t);e={...e.type==="radial"?ha.defaultRadialOptions:ha.defaultLinearOptions,...Qh(e)},this._textureSize=e.textureSize,this._wrapMode=e.wrapMode,e.type==="radial"?(this.center=e.center,this.outerCenter=e.outerCenter??this.center,this.innerRadius=e.innerRadius,this.outerRadius=e.outerRadius,this.scale=e.scale,this.rotation=e.rotation):(this.start=e.start,this.end=e.end),this.textureSpace=e.textureSpace,this.type=e.type,e.colorStops.forEach(n=>{this.addColorStop(n.offset,n.color)})}addColorStop(t,e){return this.colorStops.push({offset:t,color:Kt.shared.setValue(e).toHexa()}),this}buildLinearGradient(){if(this.texture)return;let{x:t,y:e}=this.start,{x:s,y:n}=this.end,r=s-t,o=n-e;const a=r<0||o<0;if(this._wrapMode==="clamp-to-edge"){if(r<0){const g=t;t=s,s=g,r*=-1}if(o<0){const g=e;e=n,n=g,o*=-1}}const l=this.colorStops.length?this.colorStops:Jl,c=this._textureSize,{canvas:h,context:u}=tc(c,1),d=a?u.createLinearGradient(this._textureSize,0,0,0):u.createLinearGradient(0,0,this._textureSize,0);Ql(d,l),u.fillStyle=d,u.fillRect(0,0,c,1),this.texture=new _t({source:new Xi({resource:h,addressMode:this._wrapMode})});const f=Math.sqrt(r*r+o*o),m=Math.atan2(o,r),y=new At;y.scale(f/c,1),y.rotate(m),y.translate(t,e),this.textureSpace==="local"&&y.scale(c,c),this.transform=y}buildGradient(){this.texture||this._tick++,this.type==="linear"?this.buildLinearGradient():this.buildRadialGradient()}buildRadialGradient(){if(this.texture)return;const t=this.colorStops.length?this.colorStops:Jl,e=this._textureSize,{canvas:s,context:n}=tc(e,e),{x:r,y:o}=this.center,{x:a,y:l}=this.outerCenter,c=this.innerRadius,h=this.outerRadius,u=a-h,d=l-h,f=e/(h*2),m=(r-u)*f,y=(o-d)*f,g=n.createRadialGradient(m,y,c*f,(a-u)*f,(l-d)*f,h*f);Ql(g,t),n.fillStyle=t[t.length-1].color,n.fillRect(0,0,e,e),n.fillStyle=g,n.translate(m,y),n.rotate(this.rotation),n.scale(1,this.scale),n.translate(-m,-y),n.fillRect(0,0,e,e),this.texture=new _t({source:new Xi({resource:s,addressMode:this._wrapMode})});const E=new At;E.scale(1/f,1/f),E.translate(u,d),this.textureSpace==="local"&&E.scale(e,e),this.transform=E}destroy(){var t;(t=this.texture)==null||t.destroy(!0),this.texture=null,this.transform=null,this.colorStops=[],this.start=null,this.end=null,this.center=null,this.outerCenter=null}get styleKey(){return`fill-gradient-${this.uid}-${this._tick}`}};Fa.defaultLinearOptions={start:{x:0,y:0},end:{x:0,y:1},colorStops:[],textureSpace:"local",type:"linear",textureSize:256,wrapMode:"clamp-to-edge"};Fa.defaultRadialOptions={center:{x:.5,y:.5},innerRadius:0,outerRadius:.5,colorStops:[],scale:1,textureSpace:"local",type:"radial",textureSize:256,wrapMode:"clamp-to-edge"};let mi=Fa;function Ql(i,t){for(let e=0;e<t.length;e++){const s=t[e];i.addColorStop(s.offset,s.color)}}function tc(i,t){const e=Wt.get().createCanvas(i,t),s=e.getContext("2d");return{canvas:e,context:s}}function ig(i){let t=i[0]??{};return(typeof t=="number"||i[1])&&(dt("8.5.2","use options object instead"),t={type:"linear",start:{x:i[0],y:i[1]},end:{x:i[2],y:i[3]},textureSpace:i[4],textureSize:i[5]??mi.defaultLinearOptions.textureSize}),t}const ec={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class zr{constructor(t,e){this.uid=Xt("fillPattern"),this._tick=0,this.transform=new At,this.texture=t,this.transform.scale(1/t.frame.width,1/t.frame.height),e&&(t.source.style.addressModeU=ec[e].addressModeU,t.source.style.addressModeV=ec[e].addressModeV)}setTransform(t){const e=this.texture;this.transform.copyFrom(t),this.transform.invert(),this.transform.scale(1/e.frame.width,1/e.frame.height),this._tick++}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture=t,this._tick++)}get styleKey(){return`fill-pattern-${this.uid}-${this._tick}`}destroy(){this.texture.destroy(!0),this.texture=null}}var sg=rg,Co={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},ng=/([astvzqmhlc])([^astvzqmhlc]*)/ig;function rg(i){var t=[];return i.replace(ng,function(e,s,n){var r=s.toLowerCase();for(n=ag(n),r=="m"&&n.length>2&&(t.push([s].concat(n.splice(0,2))),r="l",s=s=="m"?"l":"L");;){if(n.length==Co[r])return n.unshift(s),t.push(n);if(n.length<Co[r])throw new Error("malformed path data");t.push([s].concat(n.splice(0,Co[r])))}}),t}var og=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function ag(i){var t=i.match(og);return t?t.map(Number):[]}const lg=Wr(sg);function cg(i,t){const e=lg(i),s=[];let n=null,r=0,o=0;for(let a=0;a<e.length;a++){const l=e[a],c=l[0],h=l;switch(c){case"M":r=h[1],o=h[2],t.moveTo(r,o);break;case"m":r+=h[1],o+=h[2],t.moveTo(r,o);break;case"H":r=h[1],t.lineTo(r,o);break;case"h":r+=h[1],t.lineTo(r,o);break;case"V":o=h[1],t.lineTo(r,o);break;case"v":o+=h[1],t.lineTo(r,o);break;case"L":r=h[1],o=h[2],t.lineTo(r,o);break;case"l":r+=h[1],o+=h[2],t.lineTo(r,o);break;case"C":r=h[5],o=h[6],t.bezierCurveTo(h[1],h[2],h[3],h[4],r,o);break;case"c":t.bezierCurveTo(r+h[1],o+h[2],r+h[3],o+h[4],r+h[5],o+h[6]),r+=h[5],o+=h[6];break;case"S":r=h[3],o=h[4],t.bezierCurveToShort(h[1],h[2],r,o);break;case"s":t.bezierCurveToShort(r+h[1],o+h[2],r+h[3],o+h[4]),r+=h[3],o+=h[4];break;case"Q":r=h[3],o=h[4],t.quadraticCurveTo(h[1],h[2],r,o);break;case"q":t.quadraticCurveTo(r+h[1],o+h[2],r+h[3],o+h[4]),r+=h[3],o+=h[4];break;case"T":r=h[1],o=h[2],t.quadraticCurveToShort(r,o);break;case"t":r+=h[1],o+=h[2],t.quadraticCurveToShort(r,o);break;case"A":r=h[6],o=h[7],t.arcToSvg(h[1],h[2],h[3],h[4],h[5],r,o);break;case"a":r+=h[6],o+=h[7],t.arcToSvg(h[1],h[2],h[3],h[4],h[5],r,o);break;case"Z":case"z":t.closePath(),s.length>0&&(n=s.pop(),n?(r=n.startX,o=n.startY):(r=0,o=0)),n=null;break;default:Bt(`Unknown SVG path command: ${c}`)}c!=="Z"&&c!=="z"&&n===null&&(n={startX:r,startY:o},s.push(n))}return t}class Ba{constructor(t=0,e=0,s=0){this.type="circle",this.x=t,this.y=e,this.radius=s}clone(){return new Ba(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const s=this.radius*this.radius;let n=this.x-t,r=this.y-e;return n*=n,r*=r,n+r<=s}strokeContains(t,e,s,n=.5){if(this.radius===0)return!1;const r=this.x-t,o=this.y-e,a=this.radius,l=(1-n)*s,c=Math.sqrt(r*r+o*o);return c<=a+l&&c>a-(s-l)}getBounds(t){return t||(t=new Ot),t.x=this.x-this.radius,t.y=this.y-this.radius,t.width=this.radius*2,t.height=this.radius*2,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.radius=t.radius,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class Ua{constructor(t=0,e=0,s=0,n=0){this.type="ellipse",this.x=t,this.y=e,this.halfWidth=s,this.halfHeight=n}clone(){return new Ua(this.x,this.y,this.halfWidth,this.halfHeight)}contains(t,e){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let s=(t-this.x)/this.halfWidth,n=(e-this.y)/this.halfHeight;return s*=s,n*=n,s+n<=1}strokeContains(t,e,s,n=.5){const{halfWidth:r,halfHeight:o}=this;if(r<=0||o<=0)return!1;const a=s*(1-n),l=s-a,c=r-l,h=o-l,u=r+a,d=o+a,f=t-this.x,m=e-this.y,y=f*f/(c*c)+m*m/(h*h),g=f*f/(u*u)+m*m/(d*d);return y>1&&g<=1}getBounds(t){return t||(t=new Ot),t.x=this.x-this.halfWidth,t.y=this.y-this.halfHeight,t.width=this.halfWidth*2,t.height=this.halfHeight*2,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.halfWidth=t.halfWidth,this.halfHeight=t.halfHeight,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}function hg(i,t,e,s,n,r){const o=i-e,a=t-s,l=n-e,c=r-s,h=o*l+a*c,u=l*l+c*c;let d=-1;u!==0&&(d=h/u);let f,m;d<0?(f=e,m=s):d>1?(f=n,m=r):(f=e+d*l,m=s+d*c);const y=i-f,g=t-m;return y*y+g*g}let ug,dg;class sn{constructor(...t){this.type="polygon";let e=Array.isArray(t[0])?t[0]:t;if(typeof e[0]!="number"){const s=[];for(let n=0,r=e.length;n<r;n++)s.push(e[n].x,e[n].y);e=s}this.points=e,this.closePath=!0}isClockwise(){let t=0;const e=this.points,s=e.length;for(let n=0;n<s;n+=2){const r=e[n],o=e[n+1],a=e[(n+2)%s],l=e[(n+3)%s];t+=(a-r)*(l+o)}return t<0}containsPolygon(t){const e=this.getBounds(ug),s=t.getBounds(dg);if(!e.containsRect(s))return!1;const n=t.points;for(let r=0;r<n.length;r+=2){const o=n[r],a=n[r+1];if(!this.contains(o,a))return!1}return!0}clone(){const t=this.points.slice(),e=new sn(t);return e.closePath=this.closePath,e}contains(t,e){let s=!1;const n=this.points.length/2;for(let r=0,o=n-1;r<n;o=r++){const a=this.points[r*2],l=this.points[r*2+1],c=this.points[o*2],h=this.points[o*2+1];l>e!=h>e&&t<(c-a)*((e-l)/(h-l))+a&&(s=!s)}return s}strokeContains(t,e,s,n=.5){const r=s*s,o=r*(1-n),a=r-o,{points:l}=this,c=l.length-(this.closePath?0:2);for(let h=0;h<c;h+=2){const u=l[h],d=l[h+1],f=l[(h+2)%l.length],m=l[(h+3)%l.length],y=hg(t,e,u,d,f,m),g=Math.sign((f-u)*(e-d)-(m-d)*(t-u));if(y<=(g<0?a:o))return!0}return!1}getBounds(t){t||(t=new Ot);const e=this.points;let s=1/0,n=-1/0,r=1/0,o=-1/0;for(let a=0,l=e.length;a<l;a+=2){const c=e[a],h=e[a+1];s=c<s?c:s,n=c>n?c:n,r=h<r?h:r,o=h>o?h:o}return t.x=s,t.width=n-s,t.y=r,t.height=o-r,t}copyFrom(t){return this.points=t.points.slice(),this.closePath=t.closePath,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce((t,e)=>`${t}, ${e}`,"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return dt("8.11.0","Polygon.lastX is deprecated, please use Polygon.lastX instead."),this.points[this.points.length-2]}get y(){return dt("8.11.0","Polygon.y is deprecated, please use Polygon.lastY instead."),this.points[this.points.length-1]}get startX(){return this.points[0]}get startY(){return this.points[1]}}const jn=(i,t,e,s,n,r,o)=>{const a=i-e,l=t-s,c=Math.sqrt(a*a+l*l);return c>=n-r&&c<=n+o};class Ga{constructor(t=0,e=0,s=0,n=0,r=20){this.type="roundedRectangle",this.x=t,this.y=e,this.width=s,this.height=n,this.radius=r}getBounds(t){return t||(t=new Ot),t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}clone(){return new Ga(this.x,this.y,this.width,this.height,this.radius)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const s=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+s&&e<=this.y+this.height-s||t>=this.x+s&&t<=this.x+this.width-s)return!0;let n=t-(this.x+s),r=e-(this.y+s);const o=s*s;if(n*n+r*r<=o||(n=t-(this.x+this.width-s),n*n+r*r<=o)||(r=e-(this.y+this.height-s),n*n+r*r<=o)||(n=t-(this.x+s),n*n+r*r<=o))return!0}return!1}strokeContains(t,e,s,n=.5){const{x:r,y:o,width:a,height:l,radius:c}=this,h=s*(1-n),u=s-h,d=r+c,f=o+c,m=a-c*2,y=l-c*2,g=r+a,E=o+l;return(t>=r-h&&t<=r+u||t>=g-u&&t<=g+h)&&e>=f&&e<=f+y||(e>=o-h&&e<=o+u||e>=E-u&&e<=E+h)&&t>=d&&t<=d+m?!0:t<d&&e<f&&jn(t,e,d,f,c,u,h)||t>g-c&&e<f&&jn(t,e,g-c,f,c,u,h)||t>g-c&&e>E-c&&jn(t,e,g-c,E-c,c,u,h)||t<d&&e>E-c&&jn(t,e,d,E-c,c,u,h)}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}const Ju={};function fg(i,t,e){let s=2166136261;for(let n=0;n<t;n++)s^=i[n].uid,s=Math.imul(s,16777619),s>>>=0;return Ju[s]||pg(i,t,s,e)}function pg(i,t,e,s){const n={};let r=0;for(let a=0;a<s;a++){const l=a<t?i[a]:_t.EMPTY.source;n[r++]=l.source,n[r++]=l.style}const o=new nr(n);return Ju[e]=o,o}class ic{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}get float64View(){return this._float64Array||(this._float64Array=new Float64Array(this.rawBinaryData)),this._float64Array}get bigUint64View(){return this._bigUint64Array||(this._bigUint64Array=new BigUint64Array(this.rawBinaryData)),this._bigUint64Array}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this.uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}function sc(i,t){const e=i.byteLength/8|0,s=new Float64Array(i,0,e);new Float64Array(t,0,e).set(s);const r=i.byteLength-e*8;if(r>0){const o=new Uint8Array(i,e*8,r);new Uint8Array(t,e*8,r).set(o)}}const mg={normal:"normal-npm",add:"add-npm",screen:"screen-npm"};var gg=(i=>(i[i.DISABLED=0]="DISABLED",i[i.RENDERING_MASK_ADD=1]="RENDERING_MASK_ADD",i[i.MASK_ACTIVE=2]="MASK_ACTIVE",i[i.INVERSE_MASK_ACTIVE=3]="INVERSE_MASK_ACTIVE",i[i.RENDERING_MASK_REMOVE=4]="RENDERING_MASK_REMOVE",i[i.NONE=5]="NONE",i))(gg||{});function nc(i,t){return t.alphaMode==="no-premultiply-alpha"&&mg[i]||i}const yg=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function Sg(i){let t="";for(let e=0;e<i;++e)e>0&&(t+=`
else `),e<i-1&&(t+=`if(test == ${e}.0){}`);return t}function Tg(i,t){if(i===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const e=t.createShader(t.FRAGMENT_SHADER);try{for(;;){const s=yg.replace(/%forloop%/gi,Sg(i));if(t.shaderSource(e,s),t.compileShader(e),!t.getShaderParameter(e,t.COMPILE_STATUS))i=i/2|0;else break}}finally{t.deleteShader(e)}return i}let ss=null;function Eg(){var t;if(ss)return ss;const i=Mu();return ss=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),ss=Tg(ss,i),(t=i.getExtension("WEBGL_lose_context"))==null||t.loseContext(),ss}class _g{constructor(){this.ids=Object.create(null),this.textures=[],this.count=0}clear(){for(let t=0;t<this.count;t++){const e=this.textures[t];this.textures[t]=null,this.ids[e.uid]=null}this.count=0}}class bg{constructor(){this.renderPipeId="batch",this.action="startBatch",this.start=0,this.size=0,this.textures=new _g,this.blendMode="normal",this.topology="triangle-strip",this.canBundle=!0}destroy(){this.textures=null,this.gpuBindGroup=null,this.bindGroup=null,this.batcher=null}}const nn=[];let gr=0;xn.register({clear:()=>{if(nn.length>0)for(const i of nn)i&&i.destroy();nn.length=0,gr=0}});function rc(){return gr>0?nn[--gr]:new bg}function oc(i){nn[gr++]=i}let Fs=0;const Qu=class td{constructor(t){this.uid=Xt("batcher"),this.dirty=!0,this.batchIndex=0,this.batches=[],this._elements=[],t={...td.defaultOptions,...t},t.maxTextures||(dt("v8.8.0","maxTextures is a required option for Batcher now, please pass it in the options"),t.maxTextures=Eg());const{maxTextures:e,attributesInitialSize:s,indicesInitialSize:n}=t;this.attributeBuffer=new ic(s*4),this.indexBuffer=new Uint16Array(n),this.maxTextures=e}begin(){this.elementSize=0,this.elementStart=0,this.indexSize=0,this.attributeSize=0;for(let t=0;t<this.batchIndex;t++)oc(this.batches[t]);this.batchIndex=0,this._batchIndexStart=0,this._batchIndexSize=0,this.dirty=!0}add(t){this._elements[this.elementSize++]=t,t._indexStart=this.indexSize,t._attributeStart=this.attributeSize,t._batcher=this,this.indexSize+=t.indexSize,this.attributeSize+=t.attributeSize*this.vertexSize}checkAndUpdateTexture(t,e){const s=t._batch.textures.ids[e._source.uid];return!s&&s!==0?!1:(t._textureId=s,t.texture=e,!0)}updateElement(t){this.dirty=!0;const e=this.attributeBuffer;t.packAsQuad?this.packQuadAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId):this.packAttributes(t,e.float32View,e.uint32View,t._attributeStart,t._textureId)}break(t){const e=this._elements;if(!e[this.elementStart])return;let s=rc(),n=s.textures;n.clear();const r=e[this.elementStart];let o=nc(r.blendMode,r.texture._source),a=r.topology;this.attributeSize*4>this.attributeBuffer.size&&this._resizeAttributeBuffer(this.attributeSize*4),this.indexSize>this.indexBuffer.length&&this._resizeIndexBuffer(this.indexSize);const l=this.attributeBuffer.float32View,c=this.attributeBuffer.uint32View,h=this.indexBuffer;let u=this._batchIndexSize,d=this._batchIndexStart,f="startBatch";const m=this.maxTextures;for(let y=this.elementStart;y<this.elementSize;++y){const g=e[y];e[y]=null;const T=g.texture._source,_=nc(g.blendMode,T),b=o!==_||a!==g.topology;if(T._batchTick===Fs&&!b){g._textureId=T._textureBindLocation,u+=g.indexSize,g.packAsQuad?(this.packQuadAttributes(g,l,c,g._attributeStart,g._textureId),this.packQuadIndex(h,g._indexStart,g._attributeStart/this.vertexSize)):(this.packAttributes(g,l,c,g._attributeStart,g._textureId),this.packIndex(g,h,g._indexStart,g._attributeStart/this.vertexSize)),g._batch=s;continue}T._batchTick=Fs,(n.count>=m||b)&&(this._finishBatch(s,d,u-d,n,o,a,t,f),f="renderBatch",d=u,o=_,a=g.topology,s=rc(),n=s.textures,n.clear(),++Fs),g._textureId=T._textureBindLocation=n.count,n.ids[T.uid]=n.count,n.textures[n.count++]=T,g._batch=s,u+=g.indexSize,g.packAsQuad?(this.packQuadAttributes(g,l,c,g._attributeStart,g._textureId),this.packQuadIndex(h,g._indexStart,g._attributeStart/this.vertexSize)):(this.packAttributes(g,l,c,g._attributeStart,g._textureId),this.packIndex(g,h,g._indexStart,g._attributeStart/this.vertexSize))}n.count>0&&(this._finishBatch(s,d,u-d,n,o,a,t,f),d=u,++Fs),this.elementStart=this.elementSize,this._batchIndexStart=d,this._batchIndexSize=u}_finishBatch(t,e,s,n,r,o,a,l){t.gpuBindGroup=null,t.bindGroup=null,t.action=l,t.batcher=this,t.textures=n,t.blendMode=r,t.topology=o,t.start=e,t.size=s,++Fs,this.batches[this.batchIndex++]=t,a.add(t)}finish(t){this.break(t)}ensureAttributeBuffer(t){t*4<=this.attributeBuffer.size||this._resizeAttributeBuffer(t*4)}ensureIndexBuffer(t){t<=this.indexBuffer.length||this._resizeIndexBuffer(t)}_resizeAttributeBuffer(t){const e=Math.max(t,this.attributeBuffer.size*2),s=new ic(e);sc(this.attributeBuffer.rawBinaryData,s.rawBinaryData),this.attributeBuffer=s}_resizeIndexBuffer(t){const e=this.indexBuffer;let s=Math.max(t,e.length*1.5);s+=s%2;const n=s>65535?new Uint32Array(s):new Uint16Array(s);if(n.BYTES_PER_ELEMENT!==e.BYTES_PER_ELEMENT)for(let r=0;r<e.length;r++)n[r]=e[r];else sc(e.buffer,n.buffer);this.indexBuffer=n}packQuadIndex(t,e,s){t[e]=s+0,t[e+1]=s+1,t[e+2]=s+2,t[e+3]=s+0,t[e+4]=s+2,t[e+5]=s+3}packIndex(t,e,s,n){const r=t.indices,o=t.indexSize,a=t.indexOffset,l=t.attributeOffset;for(let c=0;c<o;c++)e[s++]=n+r[c+a]-l}destroy(){if(this.batches!==null){for(let t=0;t<this.batches.length;t++)oc(this.batches[t]);this.batches=null;for(let t=0;t<this._elements.length;t++)this._elements[t]&&(this._elements[t]._batch=null);this._elements=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null}}};Qu.defaultOptions={maxTextures:null,attributesInitialSize:4,indicesInitialSize:6};let ed=Qu;var Jt=(i=>(i[i.MAP_READ=1]="MAP_READ",i[i.MAP_WRITE=2]="MAP_WRITE",i[i.COPY_SRC=4]="COPY_SRC",i[i.COPY_DST=8]="COPY_DST",i[i.INDEX=16]="INDEX",i[i.VERTEX=32]="VERTEX",i[i.UNIFORM=64]="UNIFORM",i[i.STORAGE=128]="STORAGE",i[i.INDIRECT=256]="INDIRECT",i[i.QUERY_RESOLVE=512]="QUERY_RESOLVE",i[i.STATIC=1024]="STATIC",i))(Jt||{});let Mi=class extends Ke{constructor(t){let{data:e,size:s}=t;const{usage:n,label:r,shrinkToFit:o}=t;super(),this.uid=Xt("buffer"),this._resourceType="buffer",this._resourceId=Xt("resource"),this._touched=0,this._updateID=1,this._dataInt32=null,this.shrinkToFit=!0,this.destroyed=!1,e instanceof Array&&(e=new Float32Array(e)),this._data=e,s??(s=e==null?void 0:e.byteLength);const a=!!e;this.descriptor={size:s,usage:n,mappedAtCreation:a,label:r},this.shrinkToFit=o??!0}get data(){return this._data}set data(t){this.setDataWithSize(t,t.length,!0)}get dataInt32(){return this._dataInt32||(this._dataInt32=new Int32Array(this.data.buffer)),this._dataInt32}get static(){return!!(this.descriptor.usage&Jt.STATIC)}set static(t){t?this.descriptor.usage|=Jt.STATIC:this.descriptor.usage&=~Jt.STATIC}setDataWithSize(t,e,s){if(this._updateID++,this._updateSize=e*t.BYTES_PER_ELEMENT,this._data===t){s&&this.emit("update",this);return}const n=this._data;if(this._data=t,this._dataInt32=null,!n||n.length!==t.length){!this.shrinkToFit&&n&&t.byteLength<n.byteLength?s&&this.emit("update",this):(this.descriptor.size=t.byteLength,this._resourceId=Xt("resource"),this.emit("change",this));return}s&&this.emit("update",this)}update(t){this._updateSize=t??this._updateSize,this._updateID++,this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._data=null,this.descriptor=null,this.removeAllListeners()}};function id(i,t){if(!(i instanceof Mi)){let e=t?Jt.INDEX:Jt.VERTEX;i instanceof Array&&(t?(i=new Uint32Array(i),e=Jt.INDEX|Jt.COPY_DST):(i=new Float32Array(i),e=Jt.VERTEX|Jt.COPY_DST)),i=new Mi({data:i,label:t?"index-mesh-buffer":"vertex-mesh-buffer",usage:e})}return i}function xg(i,t,e){const s=i.getAttribute(t);if(!s)return e.minX=0,e.minY=0,e.maxX=0,e.maxY=0,e;const n=s.buffer.data;let r=1/0,o=1/0,a=-1/0,l=-1/0;const c=n.BYTES_PER_ELEMENT,h=(s.offset||0)/c,u=(s.stride||2*4)/c;for(let d=h;d<n.length;d+=u){const f=n[d],m=n[d+1];f>a&&(a=f),m>l&&(l=m),f<r&&(r=f),m<o&&(o=m)}return e.minX=r,e.minY=o,e.maxX=a,e.maxY=l,e}function Ag(i){return(i instanceof Mi||Array.isArray(i)||i.BYTES_PER_ELEMENT)&&(i={buffer:i}),i.buffer=id(i.buffer,!1),i}class xe extends Ke{constructor(t={}){super(),this.uid=Xt("geometry"),this._layoutKey=0,this.instanceCount=1,this._bounds=new ze,this._boundsDirty=!0;const{attributes:e,indexBuffer:s,topology:n}=t;if(this.buffers=[],this.attributes={},e)for(const r in e)this.addAttribute(r,e[r]);this.instanceCount=t.instanceCount??1,s&&this.addIndex(s),this.topology=n||"triangle-list"}onBufferUpdate(){this._boundsDirty=!0,this.emit("update",this)}getAttribute(t){return this.attributes[t]}getIndex(){return this.indexBuffer}getBuffer(t){return this.getAttribute(t).buffer}getSize(){for(const t in this.attributes){const e=this.attributes[t];return e.buffer.data.length/(e.stride/4||e.size)}return 0}addAttribute(t,e){const s=Ag(e);this.buffers.indexOf(s.buffer)===-1&&(this.buffers.push(s.buffer),s.buffer.on("update",this.onBufferUpdate,this),s.buffer.on("change",this.onBufferUpdate,this)),this.attributes[t]=s}addIndex(t){this.indexBuffer=id(t,!0),this.buffers.push(this.indexBuffer)}get bounds(){return this._boundsDirty?(this._boundsDirty=!1,xg(this,"aPosition",this._bounds)):this._bounds}destroy(t=!1){this.emit("destroy",this),this.removeAllListeners(),t&&this.buffers.forEach(e=>e.destroy()),this.attributes=null,this.buffers=null,this.indexBuffer=null,this._bounds=null}}const Cg=new Float32Array(1),Rg=new Uint32Array(1);class wg extends xe{constructor(){const e=new Mi({data:Cg,label:"attribute-batch-buffer",usage:Jt.VERTEX|Jt.COPY_DST,shrinkToFit:!1}),s=new Mi({data:Rg,label:"index-batch-buffer",usage:Jt.INDEX|Jt.COPY_DST,shrinkToFit:!1}),n=6*4;super({attributes:{aPosition:{buffer:e,format:"float32x2",stride:n,offset:0},aUV:{buffer:e,format:"float32x2",stride:n,offset:2*4},aColor:{buffer:e,format:"unorm8x4",stride:n,offset:4*4},aTextureIdAndRound:{buffer:e,format:"uint16x2",stride:n,offset:5*4}},indexBuffer:s})}}function ac(i,t,e){if(i)for(const s in i){const n=s.toLocaleLowerCase(),r=t[n];if(r){let o=i[s];s==="header"&&(o=o.replace(/@in\s+[^;]+;\s*/g,"").replace(/@out\s+[^;]+;\s*/g,"")),e&&r.push(`//----${e}----//`),r.push(o)}else Bt(`${s} placement hook does not exist in shader`)}}const Ig=/\{\{(.*?)\}\}/g;function lc(i){var s;const t={};return(((s=i.match(Ig))==null?void 0:s.map(n=>n.replace(/[{()}]/g,"")))??[]).forEach(n=>{t[n]=[]}),t}function cc(i,t){let e;const s=/@in\s+([^;]+);/g;for(;(e=s.exec(i))!==null;)t.push(e[1])}function hc(i,t,e=!1){const s=[];cc(t,s),i.forEach(a=>{a.header&&cc(a.header,s)});const n=s;e&&n.sort();const r=n.map((a,l)=>`       @location(${l}) ${a},`).join(`
`);let o=t.replace(/@in\s+[^;]+;\s*/g,"");return o=o.replace("{{in}}",`
${r}
`),o}function uc(i,t){let e;const s=/@out\s+([^;]+);/g;for(;(e=s.exec(i))!==null;)t.push(e[1])}function Mg(i){const e=/\b(\w+)\s*:/g.exec(i);return e?e[1]:""}function Og(i){const t=/@.*?\s+/g;return i.replace(t,"")}function vg(i,t){const e=[];uc(t,e),i.forEach(l=>{l.header&&uc(l.header,e)});let s=0;const n=e.sort().map(l=>l.indexOf("builtin")>-1?l:`@location(${s++}) ${l}`).join(`,
`),r=e.sort().map(l=>`       var ${Og(l)};`).join(`
`),o=`return VSOutput(
            ${e.sort().map(l=>` ${Mg(l)}`).join(`,
`)});`;let a=t.replace(/@out\s+[^;]+;\s*/g,"");return a=a.replace("{{struct}}",`
${n}
`),a=a.replace("{{start}}",`
${r}
`),a=a.replace("{{return}}",`
${o}
`),a}function dc(i,t){let e=i;for(const s in t){const n=t[s];n.join(`
`).length?e=e.replace(`{{${s}}}`,`//-----${s} START-----//
${n.join(`
`)}
//----${s} FINISH----//`):e=e.replace(`{{${s}}}`,"")}return e}const Ri=Object.create(null),Ro=new Map;let Pg=0;function Lg({template:i,bits:t}){const e=sd(i,t);if(Ri[e])return Ri[e];const{vertex:s,fragment:n}=Dg(i,t);return Ri[e]=nd(s,n,t),Ri[e]}function Ng({template:i,bits:t}){const e=sd(i,t);return Ri[e]||(Ri[e]=nd(i.vertex,i.fragment,t)),Ri[e]}function Dg(i,t){const e=t.map(o=>o.vertex).filter(o=>!!o),s=t.map(o=>o.fragment).filter(o=>!!o);let n=hc(e,i.vertex,!0);n=vg(e,n);const r=hc(s,i.fragment,!0);return{vertex:n,fragment:r}}function sd(i,t){return t.map(e=>(Ro.has(e)||Ro.set(e,Pg++),Ro.get(e))).sort((e,s)=>e-s).join("-")+i.vertex+i.fragment}function nd(i,t,e){const s=lc(i),n=lc(t);return e.forEach(r=>{ac(r.vertex,s,r.name),ac(r.fragment,n,r.name)}),{vertex:dc(i,s),fragment:dc(t,n)}}const kg=`
    @in aPosition: vec2<f32>;
    @in aUV: vec2<f32>;

    @out @builtin(position) vPosition: vec4<f32>;
    @out vUV : vec2<f32>;
    @out vColor : vec4<f32>;

    {{header}}

    struct VSOutput {
        {{struct}}
    };

    @vertex
    fn main( {{in}} ) -> VSOutput {

        var worldTransformMatrix = globalUniforms.uWorldTransformMatrix;
        var modelMatrix = mat3x3<f32>(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        var position = aPosition;
        var uv = aUV;

        {{start}}

        vColor = vec4<f32>(1., 1., 1., 1.);

        {{main}}

        vUV = uv;

        var modelViewProjectionMatrix = globalUniforms.uProjectionMatrix * worldTransformMatrix * modelMatrix;

        vPosition =  vec4<f32>((modelViewProjectionMatrix *  vec3<f32>(position, 1.0)).xy, 0.0, 1.0);

        vColor *= globalUniforms.uWorldColorAlpha;

        {{end}}

        {{return}}
    };
`,Hg=`
    @in vUV : vec2<f32>;
    @in vColor : vec4<f32>;

    {{header}}

    @fragment
    fn main(
        {{in}}
      ) -> @location(0) vec4<f32> {

        {{start}}

        var outColor:vec4<f32>;

        {{main}}

        var finalColor:vec4<f32> = outColor * vColor;

        {{end}}

        return finalColor;
      };
`,Fg=`
    in vec2 aPosition;
    in vec2 aUV;

    out vec4 vColor;
    out vec2 vUV;

    {{header}}

    void main(void){

        mat3 worldTransformMatrix = uWorldTransformMatrix;
        mat3 modelMatrix = mat3(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        vec2 position = aPosition;
        vec2 uv = aUV;

        {{start}}

        vColor = vec4(1.);

        {{main}}

        vUV = uv;

        mat3 modelViewProjectionMatrix = uProjectionMatrix * worldTransformMatrix * modelMatrix;

        gl_Position = vec4((modelViewProjectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);

        vColor *= uWorldColorAlpha;

        {{end}}
    }
`,Bg=`

    in vec4 vColor;
    in vec2 vUV;

    out vec4 finalColor;

    {{header}}

    void main(void) {

        {{start}}

        vec4 outColor;

        {{main}}

        finalColor = outColor * vColor;

        {{end}}
    }
`,Ug={name:"global-uniforms-bit",vertex:{header:`
        struct GlobalUniforms {
            uProjectionMatrix:mat3x3<f32>,
            uWorldTransformMatrix:mat3x3<f32>,
            uWorldColorAlpha: vec4<f32>,
            uResolution: vec2<f32>,
        }

        @group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;
        `}},Gg={name:"global-uniforms-bit",vertex:{header:`
          uniform mat3 uProjectionMatrix;
          uniform mat3 uWorldTransformMatrix;
          uniform vec4 uWorldColorAlpha;
          uniform vec2 uResolution;
        `}};function jg({bits:i,name:t}){const e=Lg({template:{fragment:Hg,vertex:kg},bits:[Ug,...i]});return Le.from({name:t,vertex:{source:e.vertex,entryPoint:"main"},fragment:{source:e.fragment,entryPoint:"main"}})}function Wg({bits:i,name:t}){return new ni({name:t,...Ng({template:{vertex:Fg,fragment:Bg},bits:[Gg,...i]})})}const Vg={name:"color-bit",vertex:{header:`
            @in aColor: vec4<f32>;
        `,main:`
            vColor *= vec4<f32>(aColor.rgb * aColor.a, aColor.a);
        `}},zg={name:"color-bit",vertex:{header:`
            in vec4 aColor;
        `,main:`
            vColor *= vec4(aColor.rgb * aColor.a, aColor.a);
        `}},wo={};function $g(i){const t=[];if(i===1)t.push("@group(1) @binding(0) var textureSource1: texture_2d<f32>;"),t.push("@group(1) @binding(1) var textureSampler1: sampler;");else{let e=0;for(let s=0;s<i;s++)t.push(`@group(1) @binding(${e++}) var textureSource${s+1}: texture_2d<f32>;`),t.push(`@group(1) @binding(${e++}) var textureSampler${s+1}: sampler;`)}return t.join(`
`)}function Yg(i){const t=[];if(i===1)t.push("outColor = textureSampleGrad(textureSource1, textureSampler1, vUV, uvDx, uvDy);");else{t.push("switch vTextureId {");for(let e=0;e<i;e++)e===i-1?t.push("  default:{"):t.push(`  case ${e}:{`),t.push(`      outColor = textureSampleGrad(textureSource${e+1}, textureSampler${e+1}, vUV, uvDx, uvDy);`),t.push("      break;}");t.push("}")}return t.join(`
`)}function Xg(i){return wo[i]||(wo[i]={name:"texture-batch-bit",vertex:{header:`
                @in aTextureIdAndRound: vec2<u32>;
                @out @interpolate(flat) vTextureId : u32;
            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1)
                {
                    vPosition = vec4<f32>(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
                }
            `},fragment:{header:`
                @in @interpolate(flat) vTextureId: u32;

                ${$g(i)}
            `,main:`
                var uvDx = dpdx(vUV);
                var uvDy = dpdy(vUV);

                ${Yg(i)}
            `}}),wo[i]}const Io={};function qg(i){const t=[];for(let e=0;e<i;e++)e>0&&t.push("else"),e<i-1&&t.push(`if(vTextureId < ${e}.5)`),t.push("{"),t.push(`	outColor = texture(uTextures[${e}], vUV);`),t.push("}");return t.join(`
`)}function Kg(i){return Io[i]||(Io[i]={name:"texture-batch-bit",vertex:{header:`
                in vec2 aTextureIdAndRound;
                out float vTextureId;

            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1.)
                {
                    gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
                }
            `},fragment:{header:`
                in float vTextureId;

                uniform sampler2D uTextures[${i}];

            `,main:`

                ${qg(i)}
            `}}),Io[i]}const Zg={name:"round-pixels-bit",vertex:{header:`
            fn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32>
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},Jg={name:"round-pixels-bit",vertex:{header:`
            vec2 roundPixels(vec2 position, vec2 targetSize)
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},fc={};function Qg(i){let t=fc[i];if(t)return t;const e=new Int32Array(i);for(let s=0;s<i;s++)e[s]=s;return t=fc[i]=new Nu({uTextures:{value:e,type:"i32",size:i}},{isStatic:!0}),t}class ty extends $e{constructor(t){const e=Wg({name:"batch",bits:[zg,Kg(t),Jg]}),s=jg({name:"batch",bits:[Vg,Xg(t),Zg]});super({glProgram:e,gpuProgram:s,resources:{batchSamplers:Qg(t)}})}}let Mo=null;const rd=class od extends ed{constructor(t){super(t),this.geometry=new wg,this.name=od.extension.name,this.vertexSize=6,Mo??(Mo=new ty(t.maxTextures)),this.shader=Mo}packAttributes(t,e,s,n,r){const o=r<<16|t.roundPixels&65535,a=t.transform,l=a.a,c=a.b,h=a.c,u=a.d,d=a.tx,f=a.ty,{positions:m,uvs:y}=t,g=t.color,E=t.attributeOffset,T=E+t.attributeSize;for(let _=E;_<T;_++){const b=_*2,A=m[b],C=m[b+1];e[n++]=l*A+h*C+d,e[n++]=u*C+c*A+f,e[n++]=y[b],e[n++]=y[b+1],s[n++]=g,s[n++]=o}}packQuadAttributes(t,e,s,n,r){const o=t.texture,a=t.transform,l=a.a,c=a.b,h=a.c,u=a.d,d=a.tx,f=a.ty,m=t.bounds,y=m.maxX,g=m.minX,E=m.maxY,T=m.minY,_=o.uvs,b=t.color,A=r<<16|t.roundPixels&65535;e[n+0]=l*g+h*T+d,e[n+1]=u*T+c*g+f,e[n+2]=_.x0,e[n+3]=_.y0,s[n+4]=b,s[n+5]=A,e[n+6]=l*y+h*T+d,e[n+7]=u*T+c*y+f,e[n+8]=_.x1,e[n+9]=_.y1,s[n+10]=b,s[n+11]=A,e[n+12]=l*y+h*E+d,e[n+13]=u*E+c*y+f,e[n+14]=_.x2,e[n+15]=_.y2,s[n+16]=b,s[n+17]=A,e[n+18]=l*g+h*E+d,e[n+19]=u*E+c*g+f,e[n+20]=_.x3,e[n+21]=_.y3,s[n+22]=b,s[n+23]=A}};rd.extension={type:[lt.Batcher],name:"default"};let ey=rd;function iy(i,t,e,s,n,r,o,a=null){let l=0;e*=t,n*=r;const c=a.a,h=a.b,u=a.c,d=a.d,f=a.tx,m=a.ty;for(;l<o;){const y=i[e],g=i[e+1];s[n]=c*y+u*g+f,s[n+1]=h*y+d*g+m,n+=r,e+=t,l++}}function sy(i,t,e,s){let n=0;for(t*=e;n<s;)i[t]=0,i[t+1]=0,t+=e,n++}function ad(i,t,e,s,n){const r=t.a,o=t.b,a=t.c,l=t.d,c=t.tx,h=t.ty;e||(e=0),s||(s=2),n||(n=i.length/s-e);let u=e*s;for(let d=0;d<n;d++){const f=i[u],m=i[u+1];i[u]=r*f+a*m+c,i[u+1]=o*f+l*m+h,u+=s}}const ny=new At;class ld{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.renderable&&this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){const t=this.baseColor,e=t>>16|t&65280|(t&255)<<16,s=this.renderable;return s?cu(e,s.groupColor)+(this.alpha*s.groupAlpha*255<<24):e+(this.alpha*255<<24)}get transform(){var t;return((t=this.renderable)==null?void 0:t.groupTransform)||ny}copyTo(t){t.indexOffset=this.indexOffset,t.indexSize=this.indexSize,t.attributeOffset=this.attributeOffset,t.attributeSize=this.attributeSize,t.baseColor=this.baseColor,t.alpha=this.alpha,t.texture=this.texture,t.geometryData=this.geometryData,t.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}destroy(){this.renderable=null,this.texture=null,this.geometryData=null,this._batcher=null,this._batch=null}}const hn={extension:{type:lt.ShapeBuilder,name:"circle"},build(i,t){let e,s,n,r,o,a;if(i.type==="circle"){const b=i;if(o=a=b.radius,o<=0)return!1;e=b.x,s=b.y,n=r=0}else if(i.type==="ellipse"){const b=i;if(o=b.halfWidth,a=b.halfHeight,o<=0||a<=0)return!1;e=b.x,s=b.y,n=r=0}else{const b=i,A=b.width/2,C=b.height/2;e=b.x+A,s=b.y+C,o=a=Math.max(0,Math.min(b.radius,Math.min(A,C))),n=A-o,r=C-a}if(n<0||r<0)return!1;const l=Math.ceil(2.3*Math.sqrt(o+a)),c=l*8+(n?4:0)+(r?4:0);if(c===0)return!1;if(l===0)return t[0]=t[6]=e+n,t[1]=t[3]=s+r,t[2]=t[4]=e-n,t[5]=t[7]=s-r,!0;let h=0,u=l*4+(n?2:0)+2,d=u,f=c,m=n+o,y=r,g=e+m,E=e-m,T=s+y;if(t[h++]=g,t[h++]=T,t[--u]=T,t[--u]=E,r){const b=s-y;t[d++]=E,t[d++]=b,t[--f]=b,t[--f]=g}for(let b=1;b<l;b++){const A=Math.PI/2*(b/l),C=n+Math.cos(A)*o,R=r+Math.sin(A)*a,O=e+C,M=e-C,w=s+R,I=s-R;t[h++]=O,t[h++]=w,t[--u]=w,t[--u]=M,t[d++]=M,t[d++]=I,t[--f]=I,t[--f]=O}m=n,y=r+a,g=e+m,E=e-m,T=s+y;const _=s-y;return t[h++]=g,t[h++]=T,t[--f]=_,t[--f]=g,n&&(t[h++]=E,t[h++]=T,t[--f]=_,t[--f]=E),!0},triangulate(i,t,e,s,n,r){if(i.length===0)return;let o=0,a=0;for(let h=0;h<i.length;h+=2)o+=i[h],a+=i[h+1];o/=i.length/2,a/=i.length/2;let l=s;t[l*e]=o,t[l*e+1]=a;const c=l++;for(let h=0;h<i.length;h+=2)t[l*e]=i[h],t[l*e+1]=i[h+1],h>0&&(n[r++]=l,n[r++]=c,n[r++]=l-1),l++;n[r++]=c+1,n[r++]=c,n[r++]=l-1}},ry={...hn,extension:{...hn.extension,name:"ellipse"}},oy={...hn,extension:{...hn.extension,name:"roundedRectangle"}},cd=1e-4,pc=1e-4;function ay(i){const t=i.length;if(t<6)return 1;let e=0;for(let s=0,n=i[t-2],r=i[t-1];s<t;s+=2){const o=i[s],a=i[s+1];e+=(o-n)*(a+r),n=o,r=a}return e<0?-1:1}function mc(i,t,e,s,n,r,o,a){const l=i-e*n,c=t-s*n,h=i+e*r,u=t+s*r;let d,f;o?(d=s,f=-e):(d=-s,f=e);const m=l+d,y=c+f,g=h+d,E=u+f;return a.push(m,y),a.push(g,E),2}function Pi(i,t,e,s,n,r,o,a){const l=e-i,c=s-t;let h=Math.atan2(l,c),u=Math.atan2(n-i,r-t);a&&h<u?h+=Math.PI*2:!a&&h>u&&(u+=Math.PI*2);let d=h;const f=u-h,m=Math.abs(f),y=Math.sqrt(l*l+c*c),g=(15*m*Math.sqrt(y)/Math.PI>>0)+1,E=f/g;if(d+=E,a){o.push(i,t),o.push(e,s);for(let T=1,_=d;T<g;T++,_+=E)o.push(i,t),o.push(i+Math.sin(_)*y,t+Math.cos(_)*y);o.push(i,t),o.push(n,r)}else{o.push(e,s),o.push(i,t);for(let T=1,_=d;T<g;T++,_+=E)o.push(i+Math.sin(_)*y,t+Math.cos(_)*y),o.push(i,t);o.push(n,r),o.push(i,t)}return g*2}function ly(i,t,e,s,n,r){const o=cd;if(i.length===0)return;const a=t;let l=a.alignment;if(t.alignment!==.5){let $=ay(i);l=(l-.5)*$+.5}const c=new me(i[0],i[1]),h=new me(i[i.length-2],i[i.length-1]),u=s,d=Math.abs(c.x-h.x)<o&&Math.abs(c.y-h.y)<o;if(u){i=i.slice(),d&&(i.pop(),i.pop(),h.set(i[i.length-2],i[i.length-1]));const $=(c.x+h.x)*.5,et=(h.y+c.y)*.5;i.unshift($,et),i.push($,et)}const f=n,m=i.length/2;let y=i.length;const g=f.length/2,E=a.width/2,T=E*E,_=a.miterLimit*a.miterLimit;let b=i[0],A=i[1],C=i[2],R=i[3],O=0,M=0,w=-(A-R),I=b-C,L=0,D=0,N=Math.sqrt(w*w+I*I);w/=N,I/=N,w*=E,I*=E;const U=l,v=(1-U)*2,P=U*2;u||(a.cap==="round"?y+=Pi(b-w*(v-P)*.5,A-I*(v-P)*.5,b-w*v,A-I*v,b+w*P,A+I*P,f,!0)+2:a.cap==="square"&&(y+=mc(b,A,w,I,v,P,!0,f))),f.push(b-w*v,A-I*v),f.push(b+w*P,A+I*P);for(let $=1;$<m-1;++$){b=i[($-1)*2],A=i[($-1)*2+1],C=i[$*2],R=i[$*2+1],O=i[($+1)*2],M=i[($+1)*2+1],w=-(A-R),I=b-C,N=Math.sqrt(w*w+I*I),w/=N,I/=N,w*=E,I*=E,L=-(R-M),D=C-O,N=Math.sqrt(L*L+D*D),L/=N,D/=N,L*=E,D*=E;const et=C-b,H=A-R,k=C-O,F=M-R,z=et*k+H*F,X=H*k-F*et,j=X<0;if(Math.abs(X)<.001*Math.abs(z)){f.push(C-w*v,R-I*v),f.push(C+w*P,R+I*P),z>=0&&(a.join==="round"?y+=Pi(C,R,C-w*v,R-I*v,C-L*v,R-D*v,f,!1)+4:y+=2,f.push(C-L*P,R-D*P),f.push(C+L*v,R+D*v));continue}const V=(-w+b)*(-I+R)-(-w+C)*(-I+A),W=(-L+O)*(-D+R)-(-L+C)*(-D+M),K=(et*W-k*V)/X,tt=(F*V-H*W)/X,ct=(K-C)*(K-C)+(tt-R)*(tt-R),ht=C+(K-C)*v,pt=R+(tt-R)*v,It=C-(K-C)*P,Ct=R-(tt-R)*P,Dt=Math.min(et*et+H*H,k*k+F*F),vt=j?v:P,Ht=Dt+vt*vt*T;ct<=Ht?a.join==="bevel"||ct/T>_?(j?(f.push(ht,pt),f.push(C+w*P,R+I*P),f.push(ht,pt),f.push(C+L*P,R+D*P)):(f.push(C-w*v,R-I*v),f.push(It,Ct),f.push(C-L*v,R-D*v),f.push(It,Ct)),y+=2):a.join==="round"?j?(f.push(ht,pt),f.push(C+w*P,R+I*P),y+=Pi(C,R,C+w*P,R+I*P,C+L*P,R+D*P,f,!0)+4,f.push(ht,pt),f.push(C+L*P,R+D*P)):(f.push(C-w*v,R-I*v),f.push(It,Ct),y+=Pi(C,R,C-w*v,R-I*v,C-L*v,R-D*v,f,!1)+4,f.push(C-L*v,R-D*v),f.push(It,Ct)):(f.push(ht,pt),f.push(It,Ct)):(f.push(C-w*v,R-I*v),f.push(C+w*P,R+I*P),a.join==="round"?j?y+=Pi(C,R,C+w*P,R+I*P,C+L*P,R+D*P,f,!0)+2:y+=Pi(C,R,C-w*v,R-I*v,C-L*v,R-D*v,f,!1)+2:a.join==="miter"&&ct/T<=_&&(j?(f.push(It,Ct),f.push(It,Ct)):(f.push(ht,pt),f.push(ht,pt)),y+=2),f.push(C-L*v,R-D*v),f.push(C+L*P,R+D*P),y+=2)}b=i[(m-2)*2],A=i[(m-2)*2+1],C=i[(m-1)*2],R=i[(m-1)*2+1],w=-(A-R),I=b-C,N=Math.sqrt(w*w+I*I),w/=N,I/=N,w*=E,I*=E,f.push(C-w*v,R-I*v),f.push(C+w*P,R+I*P),u||(a.cap==="round"?y+=Pi(C-w*(v-P)*.5,R-I*(v-P)*.5,C-w*v,R-I*v,C+w*P,R+I*P,f,!1)+2:a.cap==="square"&&(y+=mc(C,R,w,I,v,P,!1,f)));const q=pc*pc;for(let $=g;$<y+g-2;++$)b=f[$*2],A=f[$*2+1],C=f[($+1)*2],R=f[($+1)*2+1],O=f[($+2)*2],M=f[($+2)*2+1],!(Math.abs(b*(R-M)+C*(M-A)+O*(A-R))<q)&&r.push($,$+1,$+2)}function cy(i,t,e,s){const n=cd;if(i.length===0)return;const r=i[0],o=i[1],a=i[i.length-2],l=i[i.length-1],c=t||Math.abs(r-a)<n&&Math.abs(o-l)<n,h=e,u=i.length/2,d=h.length/2;for(let f=0;f<u;f++)h.push(i[f*2]),h.push(i[f*2+1]);for(let f=0;f<u-1;f++)s.push(d+f,d+f+1);c&&s.push(d+u-1,d)}function hd(i,t,e,s,n,r,o){const a=Y0(i,t,2);if(!a)return;for(let c=0;c<a.length;c+=3)r[o++]=a[c]+n,r[o++]=a[c+1]+n,r[o++]=a[c+2]+n;let l=n*s;for(let c=0;c<i.length;c+=2)e[l]=i[c],e[l+1]=i[c+1],l+=s}const hy=[],uy={extension:{type:lt.ShapeBuilder,name:"polygon"},build(i,t){for(let e=0;e<i.points.length;e++)t[e]=i.points[e];return!0},triangulate(i,t,e,s,n,r){hd(i,hy,t,e,s,n,r)}},dy={extension:{type:lt.ShapeBuilder,name:"rectangle"},build(i,t){const e=i,s=e.x,n=e.y,r=e.width,o=e.height;return r>0&&o>0?(t[0]=s,t[1]=n,t[2]=s+r,t[3]=n,t[4]=s+r,t[5]=n+o,t[6]=s,t[7]=n+o,!0):!1},triangulate(i,t,e,s,n,r){let o=0;s*=e,t[s+o]=i[0],t[s+o+1]=i[1],o+=e,t[s+o]=i[2],t[s+o+1]=i[3],o+=e,t[s+o]=i[6],t[s+o+1]=i[7],o+=e,t[s+o]=i[4],t[s+o+1]=i[5],o+=e;const a=s/e;n[r++]=a,n[r++]=a+1,n[r++]=a+2,n[r++]=a+1,n[r++]=a+3,n[r++]=a+2}},fy={extension:{type:lt.ShapeBuilder,name:"triangle"},build(i,t){return t[0]=i.x,t[1]=i.y,t[2]=i.x2,t[3]=i.y2,t[4]=i.x3,t[5]=i.y3,!0},triangulate(i,t,e,s,n,r){let o=0;s*=e,t[s+o]=i[0],t[s+o+1]=i[1],o+=e,t[s+o]=i[2],t[s+o+1]=i[3],o+=e,t[s+o]=i[4],t[s+o+1]=i[5];const a=s/e;n[r++]=a,n[r++]=a+1,n[r++]=a+2}},py=new At,my=new Ot;function gy(i,t,e,s){const n=t.matrix?i.copyFrom(t.matrix).invert():i.identity();if(t.textureSpace==="local"){const o=e.getBounds(my);t.width&&o.pad(t.width);const{x:a,y:l}=o,c=1/o.width,h=1/o.height,u=-a*c,d=-l*h,f=n.a,m=n.b,y=n.c,g=n.d;n.a*=c,n.b*=c,n.c*=h,n.d*=h,n.tx=u*f+d*y+n.tx,n.ty=u*m+d*g+n.ty}else n.translate(t.texture.frame.x,t.texture.frame.y),n.scale(1/t.texture.source.width,1/t.texture.source.height);const r=t.texture.source.style;return!(t.fill instanceof mi)&&r.addressMode==="clamp-to-edge"&&(r.addressMode="repeat",r.update()),s&&n.append(py.copyFrom(s).invert()),n}const $r={};ne.handleByMap(lt.ShapeBuilder,$r);ne.add(dy,uy,fy,hn,ry,oy);const yy=new Ot,Sy=new At;function Ty(i,t){const{geometryData:e,batches:s}=t;s.length=0,e.indices.length=0,e.vertices.length=0,e.uvs.length=0;for(let n=0;n<i.instructions.length;n++){const r=i.instructions[n];if(r.action==="texture")Ey(r.data,s,e);else if(r.action==="fill"||r.action==="stroke"){const o=r.action==="stroke",a=r.data.path.shapePath,l=r.data.style,c=r.data.hole;o&&c&&gc(c.shapePath,l,!0,s,e),c&&(a.shapePrimitives[a.shapePrimitives.length-1].holes=c.shapePath.shapePrimitives),gc(a,l,o,s,e)}}}function Ey(i,t,e){const s=[],n=$r.rectangle,r=yy;r.x=i.dx,r.y=i.dy,r.width=i.dw,r.height=i.dh;const o=i.transform;if(!n.build(r,s))return;const{vertices:a,uvs:l,indices:c}=e,h=c.length,u=a.length/2;o&&ad(s,o),n.triangulate(s,a,2,u,c,h);const d=i.image,f=d.uvs;l.push(f.x0,f.y0,f.x1,f.y1,f.x3,f.y3,f.x2,f.y2);const m=Oe.get(ld);m.indexOffset=h,m.indexSize=c.length-h,m.attributeOffset=u,m.attributeSize=a.length/2-u,m.baseColor=i.style,m.alpha=i.alpha,m.texture=d,m.geometryData=e,t.push(m)}function gc(i,t,e,s,n){const{vertices:r,uvs:o,indices:a}=n;i.shapePrimitives.forEach(({shape:l,transform:c,holes:h})=>{const u=[],d=$r[l.type];if(!d.build(l,u))return;const f=a.length,m=r.length/2;let y="triangle-list";if(c&&ad(u,c),e){const _=l.closePath??!0,b=t;b.pixelLine?(cy(u,_,r,a),y="line-list"):ly(u,b,!1,_,r,a)}else if(h){const _=[],b=u.slice();_y(h).forEach(C=>{_.push(b.length/2),b.push(...C)}),hd(b,_,r,2,m,a,f)}else d.triangulate(u,r,2,m,a,f);const g=o.length/2,E=t.texture;if(E!==_t.WHITE){const _=gy(Sy,t,l,c);iy(r,2,m,o,g,2,r.length/2-m,_)}else sy(o,g,2,r.length/2-m);const T=Oe.get(ld);T.indexOffset=f,T.indexSize=a.length-f,T.attributeOffset=m,T.attributeSize=r.length/2-m,T.baseColor=t.color,T.alpha=t.alpha,T.texture=E,T.geometryData=n,T.topology=y,s.push(T)})}function _y(i){const t=[];for(let e=0;e<i.length;e++){const s=i[e].shape,n=[];$r[s.type].build(s,n)&&t.push(n)}return t}class by{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}}class xy{constructor(){this.instructions=new fu}init(t){this.batcher=new ey({maxTextures:t}),this.instructions.reset()}get geometry(){return dt(Sm,"GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}destroy(){this.batcher.destroy(),this.instructions.destroy(),this.batcher=null,this.instructions=null}}const ja=class ua{constructor(t){this._gpuContextHash={},this._graphicsDataContextHash=Object.create(null),this._renderer=t,t.renderableGC.addManagedHash(this,"_gpuContextHash"),t.renderableGC.addManagedHash(this,"_graphicsDataContextHash")}init(t){ua.defaultOptions.bezierSmoothness=(t==null?void 0:t.bezierSmoothness)??ua.defaultOptions.bezierSmoothness}getContextRenderData(t){return this._graphicsDataContextHash[t.uid]||this._initContextRenderData(t)}updateGpuContext(t){let e=this._gpuContextHash[t.uid]||this._initContext(t);if(t.dirty){e?this._cleanGraphicsContextData(t):e=this._initContext(t),Ty(t,e);const s=t.batchMode;t.customShader||s==="no-batch"?e.isBatchable=!1:s==="auto"?e.isBatchable=e.geometryData.vertices.length<400:e.isBatchable=!0,t.dirty=!1}return e}getGpuContext(t){return this._gpuContextHash[t.uid]||this._initContext(t)}_initContextRenderData(t){const e=Oe.get(xy,{maxTextures:this._renderer.limits.maxBatchableTextures}),{batches:s,geometryData:n}=this._gpuContextHash[t.uid],r=n.vertices.length,o=n.indices.length;for(let h=0;h<s.length;h++)s[h].applyTransform=!1;const a=e.batcher;a.ensureAttributeBuffer(r),a.ensureIndexBuffer(o),a.begin();for(let h=0;h<s.length;h++){const u=s[h];a.add(u)}a.finish(e.instructions);const l=a.geometry;l.indexBuffer.setDataWithSize(a.indexBuffer,a.indexSize,!0),l.buffers[0].setDataWithSize(a.attributeBuffer.float32View,a.attributeSize,!0);const c=a.batches;for(let h=0;h<c.length;h++){const u=c[h];u.bindGroup=fg(u.textures.textures,u.textures.count,this._renderer.limits.maxBatchableTextures)}return this._graphicsDataContextHash[t.uid]=e,e}_initContext(t){const e=new by;return e.context=t,this._gpuContextHash[t.uid]=e,t.on("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]}onGraphicsContextDestroy(t){this._cleanGraphicsContextData(t),t.off("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]=null}_cleanGraphicsContextData(t){const e=this._gpuContextHash[t.uid];e.isBatchable||this._graphicsDataContextHash[t.uid]&&(Oe.return(this.getContextRenderData(t)),this._graphicsDataContextHash[t.uid]=null),e.batches&&e.batches.forEach(s=>{Oe.return(s)})}destroy(){for(const t in this._gpuContextHash)this._gpuContextHash[t]&&this.onGraphicsContextDestroy(this._gpuContextHash[t].context)}};ja.extension={type:[lt.WebGLSystem,lt.WebGPUSystem,lt.CanvasSystem],name:"graphicsContext"};ja.defaultOptions={bezierSmoothness:.5};let ud=ja;const Ay=8,Wn=11920929e-14,Cy=1;function dd(i,t,e,s,n,r,o,a,l,c){const u=Math.min(.99,Math.max(0,c??ud.defaultOptions.bezierSmoothness));let d=(Cy-u)/1;return d*=d,Ry(t,e,s,n,r,o,a,l,i,d),i}function Ry(i,t,e,s,n,r,o,a,l,c){da(i,t,e,s,n,r,o,a,l,c,0),l.push(o,a)}function da(i,t,e,s,n,r,o,a,l,c,h){if(h>Ay)return;const u=(i+e)/2,d=(t+s)/2,f=(e+n)/2,m=(s+r)/2,y=(n+o)/2,g=(r+a)/2,E=(u+f)/2,T=(d+m)/2,_=(f+y)/2,b=(m+g)/2,A=(E+_)/2,C=(T+b)/2;if(h>0){let R=o-i,O=a-t;const M=Math.abs((e-o)*O-(s-a)*R),w=Math.abs((n-o)*O-(r-a)*R);if(M>Wn&&w>Wn){if((M+w)*(M+w)<=c*(R*R+O*O)){l.push(A,C);return}}else if(M>Wn){if(M*M<=c*(R*R+O*O)){l.push(A,C);return}}else if(w>Wn){if(w*w<=c*(R*R+O*O)){l.push(A,C);return}}else if(R=A-(i+o)/2,O=C-(t+a)/2,R*R+O*O<=c){l.push(A,C);return}}da(i,t,u,d,E,T,A,C,l,c,h+1),da(A,C,_,b,y,g,o,a,l,c,h+1)}const wy=8,Iy=11920929e-14,My=1;function Oy(i,t,e,s,n,r,o,a){const c=Math.min(.99,Math.max(0,a??ud.defaultOptions.bezierSmoothness));let h=(My-c)/1;return h*=h,vy(t,e,s,n,r,o,i,h),i}function vy(i,t,e,s,n,r,o,a){fa(o,i,t,e,s,n,r,a,0),o.push(n,r)}function fa(i,t,e,s,n,r,o,a,l){if(l>wy)return;const c=(t+s)/2,h=(e+n)/2,u=(s+r)/2,d=(n+o)/2,f=(c+u)/2,m=(h+d)/2;let y=r-t,g=o-e;const E=Math.abs((s-r)*g-(n-o)*y);if(E>Iy){if(E*E<=a*(y*y+g*g)){i.push(f,m);return}}else if(y=f-(t+r)/2,g=m-(e+o)/2,y*y+g*g<=a){i.push(f,m);return}fa(i,t,e,c,h,f,m,a,l+1),fa(i,f,m,u,d,r,o,a,l+1)}function fd(i,t,e,s,n,r,o,a){let l=Math.abs(n-r);(!o&&n>r||o&&r>n)&&(l=2*Math.PI-l),a||(a=Math.max(6,Math.floor(6*Math.pow(s,1/3)*(l/Math.PI)))),a=Math.max(a,3);let c=l/a,h=n;c*=o?-1:1;for(let u=0;u<a+1;u++){const d=Math.cos(h),f=Math.sin(h),m=t+d*s,y=e+f*s;i.push(m,y),h+=c}}function Py(i,t,e,s,n,r){const o=i[i.length-2],l=i[i.length-1]-e,c=o-t,h=n-e,u=s-t,d=Math.abs(l*u-c*h);if(d<1e-8||r===0){(i[i.length-2]!==t||i[i.length-1]!==e)&&i.push(t,e);return}const f=l*l+c*c,m=h*h+u*u,y=l*h+c*u,g=r*Math.sqrt(f)/d,E=r*Math.sqrt(m)/d,T=g*y/f,_=E*y/m,b=g*u+E*c,A=g*h+E*l,C=c*(E+T),R=l*(E+T),O=u*(g+_),M=h*(g+_),w=Math.atan2(R-A,C-b),I=Math.atan2(M-A,O-b);fd(i,b+t,A+e,r,w,I,c*h>u*l)}const rn=Math.PI*2,Oo={centerX:0,centerY:0,ang1:0,ang2:0},vo=({x:i,y:t},e,s,n,r,o,a,l)=>{i*=e,t*=s;const c=n*i-r*t,h=r*i+n*t;return l.x=c+o,l.y=h+a,l};function Ly(i,t){const e=t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),s=t===1.5707963267948966?.551915024494:e,n=Math.cos(i),r=Math.sin(i),o=Math.cos(i+t),a=Math.sin(i+t);return[{x:n-r*s,y:r+n*s},{x:o+a*s,y:a-o*s},{x:o,y:a}]}const yc=(i,t,e,s)=>{const n=i*s-t*e<0?-1:1;let r=i*e+t*s;return r>1&&(r=1),r<-1&&(r=-1),n*Math.acos(r)},Ny=(i,t,e,s,n,r,o,a,l,c,h,u,d)=>{const f=Math.pow(n,2),m=Math.pow(r,2),y=Math.pow(h,2),g=Math.pow(u,2);let E=f*m-f*g-m*y;E<0&&(E=0),E/=f*g+m*y,E=Math.sqrt(E)*(o===a?-1:1);const T=E*n/r*u,_=E*-r/n*h,b=c*T-l*_+(i+e)/2,A=l*T+c*_+(t+s)/2,C=(h-T)/n,R=(u-_)/r,O=(-h-T)/n,M=(-u-_)/r,w=yc(1,0,C,R);let I=yc(C,R,O,M);a===0&&I>0&&(I-=rn),a===1&&I<0&&(I+=rn),d.centerX=b,d.centerY=A,d.ang1=w,d.ang2=I};function Dy(i,t,e,s,n,r,o,a=0,l=0,c=0){if(r===0||o===0)return;const h=Math.sin(a*rn/360),u=Math.cos(a*rn/360),d=u*(t-s)/2+h*(e-n)/2,f=-h*(t-s)/2+u*(e-n)/2;if(d===0&&f===0)return;r=Math.abs(r),o=Math.abs(o);const m=Math.pow(d,2)/Math.pow(r,2)+Math.pow(f,2)/Math.pow(o,2);m>1&&(r*=Math.sqrt(m),o*=Math.sqrt(m)),Ny(t,e,s,n,r,o,l,c,h,u,d,f,Oo);let{ang1:y,ang2:g}=Oo;const{centerX:E,centerY:T}=Oo;let _=Math.abs(g)/(rn/4);Math.abs(1-_)<1e-7&&(_=1);const b=Math.max(Math.ceil(_),1);g/=b;let A=i[i.length-2],C=i[i.length-1];const R={x:0,y:0};for(let O=0;O<b;O++){const M=Ly(y,g),{x:w,y:I}=vo(M[0],r,o,u,h,E,T,R),{x:L,y:D}=vo(M[1],r,o,u,h,E,T,R),{x:N,y:U}=vo(M[2],r,o,u,h,E,T,R);dd(i,A,C,w,I,L,D,N,U),A=N,C=U,y+=g}}function ky(i,t,e){const s=(o,a)=>{const l=a.x-o.x,c=a.y-o.y,h=Math.sqrt(l*l+c*c),u=l/h,d=c/h;return{len:h,nx:u,ny:d}},n=(o,a)=>{o===0?i.moveTo(a.x,a.y):i.lineTo(a.x,a.y)};let r=t[t.length-1];for(let o=0;o<t.length;o++){const a=t[o%t.length],l=a.radius??e;if(l<=0){n(o,a),r=a;continue}const c=t[(o+1)%t.length],h=s(a,r),u=s(a,c);if(h.len<1e-4||u.len<1e-4){n(o,a),r=a;continue}let d=Math.asin(h.nx*u.ny-h.ny*u.nx),f=1,m=!1;h.nx*u.nx-h.ny*-u.ny<0?d<0?d=Math.PI+d:(d=Math.PI-d,f=-1,m=!0):d>0&&(f=-1,m=!0);const y=d/2;let g,E=Math.abs(Math.cos(y)*l/Math.sin(y));E>Math.min(h.len/2,u.len/2)?(E=Math.min(h.len/2,u.len/2),g=Math.abs(E*Math.sin(y)/Math.cos(y))):g=l;const T=a.x+u.nx*E+-u.ny*g*f,_=a.y+u.ny*E+u.nx*g*f,b=Math.atan2(h.ny,h.nx)+Math.PI/2*f,A=Math.atan2(u.ny,u.nx)-Math.PI/2*f;o===0&&i.moveTo(T+Math.cos(b)*g,_+Math.sin(b)*g),i.arc(T,_,g,b,A,m),r=a}}function Hy(i,t,e,s){const n=(a,l)=>Math.sqrt((a.x-l.x)**2+(a.y-l.y)**2),r=(a,l,c)=>({x:a.x+(l.x-a.x)*c,y:a.y+(l.y-a.y)*c}),o=t.length;for(let a=0;a<o;a++){const l=t[(a+1)%o],c=l.radius??e;if(c<=0){a===0?i.moveTo(l.x,l.y):i.lineTo(l.x,l.y);continue}const h=t[a],u=t[(a+2)%o],d=n(h,l);let f;if(d<1e-4)f=l;else{const g=Math.min(d/2,c);f=r(l,h,g/d)}const m=n(u,l);let y;if(m<1e-4)y=l;else{const g=Math.min(m/2,c);y=r(l,u,g/m)}a===0?i.moveTo(f.x,f.y):i.lineTo(f.x,f.y),i.quadraticCurveTo(l.x,l.y,y.x,y.y,s)}}const Fy=new Ot;class By{constructor(t){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new ze,this._graphicsPath2D=t,this.signed=t.checkForHoles}moveTo(t,e){return this.startPoly(t,e),this}lineTo(t,e){this._ensurePoly();const s=this._currentPoly.points,n=s[s.length-2],r=s[s.length-1];return(n!==t||r!==e)&&s.push(t,e),this}arc(t,e,s,n,r,o){this._ensurePoly(!1);const a=this._currentPoly.points;return fd(a,t,e,s,n,r,o),this}arcTo(t,e,s,n,r){this._ensurePoly();const o=this._currentPoly.points;return Py(o,t,e,s,n,r),this}arcToSvg(t,e,s,n,r,o,a){const l=this._currentPoly.points;return Dy(l,this._currentPoly.lastX,this._currentPoly.lastY,o,a,t,e,s,n,r),this}bezierCurveTo(t,e,s,n,r,o,a){this._ensurePoly();const l=this._currentPoly;return dd(this._currentPoly.points,l.lastX,l.lastY,t,e,s,n,r,o,a),this}quadraticCurveTo(t,e,s,n,r){this._ensurePoly();const o=this._currentPoly;return Oy(this._currentPoly.points,o.lastX,o.lastY,t,e,s,n,r),this}closePath(){return this.endPoly(!0),this}addPath(t,e){this.endPoly(),e&&!e.isIdentity()&&(t=t.clone(!0),t.transform(e));const s=this.shapePrimitives,n=s.length;for(let r=0;r<t.instructions.length;r++){const o=t.instructions[r];this[o.action](...o.data)}if(t.checkForHoles&&s.length-n>1){let r=null;for(let o=n;o<s.length;o++){const a=s[o];if(a.shape.type==="polygon"){const l=a.shape,c=r==null?void 0:r.shape;c&&c.containsPolygon(l)?(r.holes||(r.holes=[]),r.holes.push(a),s.copyWithin(o,o+1),s.length--,o--):r=a}}}return this}finish(t=!1){this.endPoly(t)}rect(t,e,s,n,r){return this.drawShape(new Ot(t,e,s,n),r),this}circle(t,e,s,n){return this.drawShape(new Ba(t,e,s),n),this}poly(t,e,s){const n=new sn(t);return n.closePath=e,this.drawShape(n,s),this}regularPoly(t,e,s,n,r=0,o){n=Math.max(n|0,3);const a=-1*Math.PI/2+r,l=Math.PI*2/n,c=[];for(let h=0;h<n;h++){const u=a-h*l;c.push(t+s*Math.cos(u),e+s*Math.sin(u))}return this.poly(c,!0,o),this}roundPoly(t,e,s,n,r,o=0,a){if(n=Math.max(n|0,3),r<=0)return this.regularPoly(t,e,s,n,o);const l=s*Math.sin(Math.PI/n)-.001;r=Math.min(r,l);const c=-1*Math.PI/2+o,h=Math.PI*2/n,u=(n-2)*Math.PI/n/2;for(let d=0;d<n;d++){const f=d*h+c,m=t+s*Math.cos(f),y=e+s*Math.sin(f),g=f+Math.PI+u,E=f-Math.PI-u,T=m+r*Math.cos(g),_=y+r*Math.sin(g),b=m+r*Math.cos(E),A=y+r*Math.sin(E);d===0?this.moveTo(T,_):this.lineTo(T,_),this.quadraticCurveTo(m,y,b,A,a)}return this.closePath()}roundShape(t,e,s=!1,n){return t.length<3?this:(s?Hy(this,t,e,n):ky(this,t,e),this.closePath())}filletRect(t,e,s,n,r){if(r===0)return this.rect(t,e,s,n);const o=Math.min(s,n)/2,a=Math.min(o,Math.max(-o,r)),l=t+s,c=e+n,h=a<0?-a:0,u=Math.abs(a);return this.moveTo(t,e+u).arcTo(t+h,e+h,t+u,e,u).lineTo(l-u,e).arcTo(l-h,e+h,l,e+u,u).lineTo(l,c-u).arcTo(l-h,c-h,t+s-u,c,u).lineTo(t+u,c).arcTo(t+h,c-h,t,c-u,u).closePath()}chamferRect(t,e,s,n,r,o){if(r<=0)return this.rect(t,e,s,n);const a=Math.min(r,Math.min(s,n)/2),l=t+s,c=e+n,h=[t+a,e,l-a,e,l,e+a,l,c-a,l-a,c,t+a,c,t,c-a,t,e+a];for(let u=h.length-1;u>=2;u-=2)h[u]===h[u-2]&&h[u-1]===h[u-3]&&h.splice(u-1,2);return this.poly(h,!0,o)}ellipse(t,e,s,n,r){return this.drawShape(new Ua(t,e,s,n),r),this}roundRect(t,e,s,n,r,o){return this.drawShape(new Ga(t,e,s,n,r),o),this}drawShape(t,e){return this.endPoly(),this.shapePrimitives.push({shape:t,transform:e}),this}startPoly(t,e){let s=this._currentPoly;return s&&this.endPoly(),s=new sn,s.points.push(t,e),this._currentPoly=s,this}endPoly(t=!1){const e=this._currentPoly;return e&&e.points.length>2&&(e.closePath=t,this.shapePrimitives.push({shape:e})),this._currentPoly=null,this}_ensurePoly(t=!0){if(!this._currentPoly&&(this._currentPoly=new sn,t)){const e=this.shapePrimitives[this.shapePrimitives.length-1];if(e){let s=e.shape.x,n=e.shape.y;if(e.transform&&!e.transform.isIdentity()){const r=e.transform,o=s;s=r.a*s+r.c*n+r.tx,n=r.b*o+r.d*n+r.ty}this._currentPoly.points.push(s,n)}else this._currentPoly.points.push(0,0)}}buildPath(){const t=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let e=0;e<t.instructions.length;e++){const s=t.instructions[e];this[s.action](...s.data)}this.finish()}get bounds(){const t=this._bounds;t.clear();const e=this.shapePrimitives;for(let s=0;s<e.length;s++){const n=e[s],r=n.shape.getBounds(Fy);n.transform?t.addRect(r,n.transform):t.addRect(r)}return t}}class pi{constructor(t,e=!1){this.instructions=[],this.uid=Xt("graphicsPath"),this._dirty=!0,this.checkForHoles=e,typeof t=="string"?cg(t,this):this.instructions=(t==null?void 0:t.slice())??[]}get shapePath(){return this._shapePath||(this._shapePath=new By(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(t,e){return t=t.clone(),this.instructions.push({action:"addPath",data:[t,e]}),this._dirty=!0,this}arc(...t){return this.instructions.push({action:"arc",data:t}),this._dirty=!0,this}arcTo(...t){return this.instructions.push({action:"arcTo",data:t}),this._dirty=!0,this}arcToSvg(...t){return this.instructions.push({action:"arcToSvg",data:t}),this._dirty=!0,this}bezierCurveTo(...t){return this.instructions.push({action:"bezierCurveTo",data:t}),this._dirty=!0,this}bezierCurveToShort(t,e,s,n,r){const o=this.instructions[this.instructions.length-1],a=this.getLastPoint(me.shared);let l=0,c=0;if(!o||o.action!=="bezierCurveTo")l=a.x,c=a.y;else{l=o.data[2],c=o.data[3];const h=a.x,u=a.y;l=h+(h-l),c=u+(u-c)}return this.instructions.push({action:"bezierCurveTo",data:[l,c,t,e,s,n,r]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...t){return this.instructions.push({action:"ellipse",data:t}),this._dirty=!0,this}lineTo(...t){return this.instructions.push({action:"lineTo",data:t}),this._dirty=!0,this}moveTo(...t){return this.instructions.push({action:"moveTo",data:t}),this}quadraticCurveTo(...t){return this.instructions.push({action:"quadraticCurveTo",data:t}),this._dirty=!0,this}quadraticCurveToShort(t,e,s){const n=this.instructions[this.instructions.length-1],r=this.getLastPoint(me.shared);let o=0,a=0;if(!n||n.action!=="quadraticCurveTo")o=r.x,a=r.y;else{o=n.data[0],a=n.data[1];const l=r.x,c=r.y;o=l+(l-o),a=c+(c-a)}return this.instructions.push({action:"quadraticCurveTo",data:[o,a,t,e,s]}),this._dirty=!0,this}rect(t,e,s,n,r){return this.instructions.push({action:"rect",data:[t,e,s,n,r]}),this._dirty=!0,this}circle(t,e,s,n){return this.instructions.push({action:"circle",data:[t,e,s,n]}),this._dirty=!0,this}roundRect(...t){return this.instructions.push({action:"roundRect",data:t}),this._dirty=!0,this}poly(...t){return this.instructions.push({action:"poly",data:t}),this._dirty=!0,this}regularPoly(...t){return this.instructions.push({action:"regularPoly",data:t}),this._dirty=!0,this}roundPoly(...t){return this.instructions.push({action:"roundPoly",data:t}),this._dirty=!0,this}roundShape(...t){return this.instructions.push({action:"roundShape",data:t}),this._dirty=!0,this}filletRect(...t){return this.instructions.push({action:"filletRect",data:t}),this._dirty=!0,this}chamferRect(...t){return this.instructions.push({action:"chamferRect",data:t}),this._dirty=!0,this}star(t,e,s,n,r,o,a){r||(r=n/2);const l=-1*Math.PI/2+o,c=s*2,h=Math.PI*2/c,u=[];for(let d=0;d<c;d++){const f=d%2?r:n,m=d*h+l;u.push(t+f*Math.cos(m),e+f*Math.sin(m))}return this.poly(u,!0,a),this}clone(t=!1){const e=new pi;if(e.checkForHoles=this.checkForHoles,!t)e.instructions=this.instructions.slice();else for(let s=0;s<this.instructions.length;s++){const n=this.instructions[s];e.instructions.push({action:n.action,data:n.data.slice()})}return e}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(t){if(t.isIdentity())return this;const e=t.a,s=t.b,n=t.c,r=t.d,o=t.tx,a=t.ty;let l=0,c=0,h=0,u=0,d=0,f=0,m=0,y=0;for(let g=0;g<this.instructions.length;g++){const E=this.instructions[g],T=E.data;switch(E.action){case"moveTo":case"lineTo":l=T[0],c=T[1],T[0]=e*l+n*c+o,T[1]=s*l+r*c+a;break;case"bezierCurveTo":h=T[0],u=T[1],d=T[2],f=T[3],l=T[4],c=T[5],T[0]=e*h+n*u+o,T[1]=s*h+r*u+a,T[2]=e*d+n*f+o,T[3]=s*d+r*f+a,T[4]=e*l+n*c+o,T[5]=s*l+r*c+a;break;case"quadraticCurveTo":h=T[0],u=T[1],l=T[2],c=T[3],T[0]=e*h+n*u+o,T[1]=s*h+r*u+a,T[2]=e*l+n*c+o,T[3]=s*l+r*c+a;break;case"arcToSvg":l=T[5],c=T[6],m=T[0],y=T[1],T[0]=e*m+n*y,T[1]=s*m+r*y,T[5]=e*l+n*c+o,T[6]=s*l+r*c+a;break;case"circle":T[4]=Bs(T[3],t);break;case"rect":T[4]=Bs(T[4],t);break;case"ellipse":T[8]=Bs(T[8],t);break;case"roundRect":T[5]=Bs(T[5],t);break;case"addPath":T[0].transform(t);break;case"poly":T[2]=Bs(T[2],t);break;default:Bt("unknown transform action",E.action);break}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(t){let e=this.instructions.length-1,s=this.instructions[e];if(!s)return t.x=0,t.y=0,t;for(;s.action==="closePath";){if(e--,e<0)return t.x=0,t.y=0,t;s=this.instructions[e]}switch(s.action){case"moveTo":case"lineTo":t.x=s.data[0],t.y=s.data[1];break;case"quadraticCurveTo":t.x=s.data[2],t.y=s.data[3];break;case"bezierCurveTo":t.x=s.data[4],t.y=s.data[5];break;case"arc":case"arcToSvg":t.x=s.data[5],t.y=s.data[6];break;case"addPath":s.data[0].getLastPoint(t);break}return t}}function Bs(i,t){return i?i.prepend(t):t.clone()}function $t(i,t,e){const s=i.getAttribute(t);return s?Number(s):e}function Uy(i,t){const e=i.querySelectorAll("defs");for(let s=0;s<e.length;s++){const n=e[s];for(let r=0;r<n.children.length;r++){const o=n.children[r];switch(o.nodeName.toLowerCase()){case"lineargradient":t.defs[o.id]=Gy(o);break;case"radialgradient":t.defs[o.id]=jy();break}}}}function Gy(i){const t=$t(i,"x1",0),e=$t(i,"y1",0),s=$t(i,"x2",1),n=$t(i,"y2",0),r=i.getAttribute("gradientUnits")||"objectBoundingBox",o=new mi(t,e,s,n,r==="objectBoundingBox"?"local":"global");for(let a=0;a<i.children.length;a++){const l=i.children[a],c=$t(l,"offset",0),h=Kt.shared.setValue(l.getAttribute("stop-color")).toNumber();o.addColorStop(c,h)}return o}function jy(i){return Bt("[SVG Parser] Radial gradients are not yet supported"),new mi(0,0,1,0)}function Sc(i){const t=i.match(/url\s*\(\s*['"]?\s*#([^'"\s)]+)\s*['"]?\s*\)/i);return t?t[1]:""}const Tc={fill:{type:"paint",default:0},"fill-opacity":{type:"number",default:1},stroke:{type:"paint",default:0},"stroke-width":{type:"number",default:1},"stroke-opacity":{type:"number",default:1},"stroke-linecap":{type:"string",default:"butt"},"stroke-linejoin":{type:"string",default:"miter"},"stroke-miterlimit":{type:"number",default:10},"stroke-dasharray":{type:"string",default:"none"},"stroke-dashoffset":{type:"number",default:0},opacity:{type:"number",default:1}};function pd(i,t){const e=i.getAttribute("style"),s={},n={},r={strokeStyle:s,fillStyle:n,useFill:!1,useStroke:!1};for(const o in Tc){const a=i.getAttribute(o);a&&Ec(t,r,o,a.trim())}if(e){const o=e.split(";");for(let a=0;a<o.length;a++){const l=o[a].trim(),[c,h]=l.split(":");Tc[c]&&Ec(t,r,c,h.trim())}}return{strokeStyle:r.useStroke?s:null,fillStyle:r.useFill?n:null,useFill:r.useFill,useStroke:r.useStroke}}function Ec(i,t,e,s){switch(e){case"stroke":if(s!=="none"){if(s.startsWith("url(")){const n=Sc(s);t.strokeStyle.fill=i.defs[n]}else t.strokeStyle.color=Kt.shared.setValue(s).toNumber();t.useStroke=!0}break;case"stroke-width":t.strokeStyle.width=Number(s);break;case"fill":if(s!=="none"){if(s.startsWith("url(")){const n=Sc(s);t.fillStyle.fill=i.defs[n]}else t.fillStyle.color=Kt.shared.setValue(s).toNumber();t.useFill=!0}break;case"fill-opacity":t.fillStyle.alpha=Number(s);break;case"stroke-opacity":t.strokeStyle.alpha=Number(s);break;case"opacity":t.fillStyle.alpha=Number(s),t.strokeStyle.alpha=Number(s);break}}function Wy(i){if(i.length<=2)return!0;const t=i.map(a=>a.area).sort((a,l)=>l-a),[e,s]=t,n=t[t.length-1],r=e/s,o=s/n;return!(r>3&&o<2)}function Vy(i){return i.split(/(?=[Mm])/).filter(s=>s.trim().length>0)}function zy(i){const t=i.match(/[-+]?[0-9]*\.?[0-9]+/g);if(!t||t.length<4)return 0;const e=t.map(Number),s=[],n=[];for(let h=0;h<e.length;h+=2)h+1<e.length&&(s.push(e[h]),n.push(e[h+1]));if(s.length===0||n.length===0)return 0;const r=Math.min(...s),o=Math.max(...s),a=Math.min(...n),l=Math.max(...n);return(o-r)*(l-a)}function _c(i,t){const e=new pi(i,!1);for(const s of e.instructions)t.instructions.push(s)}function $y(i,t){if(typeof i=="string"){const o=document.createElement("div");o.innerHTML=i.trim(),i=o.querySelector("svg")}const e={context:t,defs:{},path:new pi};Uy(i,e);const s=i.children,{fillStyle:n,strokeStyle:r}=pd(i,e);for(let o=0;o<s.length;o++){const a=s[o];a.nodeName.toLowerCase()!=="defs"&&md(a,e,n,r)}return t}function md(i,t,e,s){const n=i.children,{fillStyle:r,strokeStyle:o}=pd(i,t);r&&e?e={...e,...r}:r&&(e=r),o&&s?s={...s,...o}:o&&(s=o);const a=!e&&!s;a&&(e={color:0});let l,c,h,u,d,f,m,y,g,E,T,_,b,A,C,R,O;switch(i.nodeName.toLowerCase()){case"path":{A=i.getAttribute("d");const M=i.getAttribute("fill-rule"),w=Vy(A),I=M==="evenodd",L=w.length>1;if(I&&L){const N=w.map(v=>({path:v,area:zy(v)}));if(N.sort((v,P)=>P.area-v.area),w.length>3||!Wy(N))for(let v=0;v<N.length;v++){const P=N[v],q=v===0;t.context.beginPath();const $=new pi(void 0,!0);_c(P.path,$),t.context.path($),q?(e&&t.context.fill(e),s&&t.context.stroke(s)):t.context.cut()}else for(let v=0;v<N.length;v++){const P=N[v],q=v%2===1;t.context.beginPath();const $=new pi(void 0,!0);_c(P.path,$),t.context.path($),q?t.context.cut():(e&&t.context.fill(e),s&&t.context.stroke(s))}}else{const N=M?M==="evenodd":!0;C=new pi(A,N),t.context.path(C),e&&t.context.fill(e),s&&t.context.stroke(s)}break}case"circle":m=$t(i,"cx",0),y=$t(i,"cy",0),g=$t(i,"r",0),t.context.ellipse(m,y,g,g),e&&t.context.fill(e),s&&t.context.stroke(s);break;case"rect":l=$t(i,"x",0),c=$t(i,"y",0),R=$t(i,"width",0),O=$t(i,"height",0),E=$t(i,"rx",0),T=$t(i,"ry",0),E||T?t.context.roundRect(l,c,R,O,E||T):t.context.rect(l,c,R,O),e&&t.context.fill(e),s&&t.context.stroke(s);break;case"ellipse":m=$t(i,"cx",0),y=$t(i,"cy",0),E=$t(i,"rx",0),T=$t(i,"ry",0),t.context.beginPath(),t.context.ellipse(m,y,E,T),e&&t.context.fill(e),s&&t.context.stroke(s);break;case"line":h=$t(i,"x1",0),u=$t(i,"y1",0),d=$t(i,"x2",0),f=$t(i,"y2",0),t.context.beginPath(),t.context.moveTo(h,u),t.context.lineTo(d,f),s&&t.context.stroke(s);break;case"polygon":b=i.getAttribute("points"),_=b.match(/\d+/g).map(M=>parseInt(M,10)),t.context.poly(_,!0),e&&t.context.fill(e),s&&t.context.stroke(s);break;case"polyline":b=i.getAttribute("points"),_=b.match(/\d+/g).map(M=>parseInt(M,10)),t.context.poly(_,!1),s&&t.context.stroke(s);break;case"g":case"svg":break;default:{Bt(`[SVG parser] <${i.nodeName}> elements unsupported`);break}}a&&(e=null);for(let M=0;M<n.length;M++)md(n[M],t,e,s)}function Yy(i){return Kt.isColorLike(i)}function bc(i){return i instanceof zr}function xc(i){return i instanceof mi}function Xy(i){return i instanceof _t}function qy(i,t,e){const s=Kt.shared.setValue(t??0);return i.color=s.toNumber(),i.alpha=s.alpha===1?e.alpha:s.alpha,i.texture=_t.WHITE,{...e,...i}}function Ky(i,t,e){return i.texture=t,{...e,...i}}function Ac(i,t,e){return i.fill=t,i.color=16777215,i.texture=t.texture,i.matrix=t.transform,{...e,...i}}function Cc(i,t,e){return t.buildGradient(),i.fill=t,i.color=16777215,i.texture=t.texture,i.matrix=t.transform,i.textureSpace=t.textureSpace,{...e,...i}}function Zy(i,t){const e={...t,...i},s=Kt.shared.setValue(e.color);return e.alpha*=s.alpha,e.color=s.toNumber(),e}function Bi(i,t){if(i==null)return null;const e={},s=i;return Yy(i)?qy(e,i,t):Xy(i)?Ky(e,i,t):bc(i)?Ac(e,i,t):xc(i)?Cc(e,i,t):s.fill&&bc(s.fill)?Ac(s,s.fill,t):s.fill&&xc(s.fill)?Cc(s,s.fill,t):Zy(s,t)}function yr(i,t){const{width:e,alignment:s,miterLimit:n,cap:r,join:o,pixelLine:a,...l}=t,c=Bi(i,l);return c?{width:e,alignment:s,miterLimit:n,cap:r,join:o,pixelLine:a,...c}:null}const Jy=new me,Rc=new At,Wa=class ei extends Ke{constructor(){super(...arguments),this.uid=Xt("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this._activePath=new pi,this._transform=new At,this._fillStyle={...ei.defaultFillStyle},this._strokeStyle={...ei.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new ze,this._boundsDirty=!0}clone(){const t=new ei;return t.batchMode=this.batchMode,t.instructions=this.instructions.slice(),t._activePath=this._activePath.clone(),t._transform=this._transform.clone(),t._fillStyle={...this._fillStyle},t._strokeStyle={...this._strokeStyle},t._stateStack=this._stateStack.slice(),t._bounds=this._bounds.clone(),t._boundsDirty=!0,t}get fillStyle(){return this._fillStyle}set fillStyle(t){this._fillStyle=Bi(t,ei.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(t){this._strokeStyle=yr(t,ei.defaultStrokeStyle)}setFillStyle(t){return this._fillStyle=Bi(t,ei.defaultFillStyle),this}setStrokeStyle(t){return this._strokeStyle=Bi(t,ei.defaultStrokeStyle),this}texture(t,e,s,n,r,o){return this.instructions.push({action:"texture",data:{image:t,dx:s||0,dy:n||0,dw:r||t.frame.width,dh:o||t.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:e?Kt.shared.setValue(e).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new pi,this}fill(t,e){let s;const n=this.instructions[this.instructions.length-1];return this._tick===0&&n&&n.action==="stroke"?s=n.data.path:s=this._activePath.clone(),s?(t!=null&&(e!==void 0&&typeof t=="number"&&(dt(Rt,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),t={color:t,alpha:e}),this._fillStyle=Bi(t,ei.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:s}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){const{x:t,y:e}=this._activePath.getLastPoint(me.shared);this._activePath.clear(),this._activePath.moveTo(t,e)}stroke(t){let e;const s=this.instructions[this.instructions.length-1];return this._tick===0&&s&&s.action==="fill"?e=s.data.path:e=this._activePath.clone(),e?(t!=null&&(this._strokeStyle=yr(t,ei.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:e}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let t=0;t<2;t++){const e=this.instructions[this.instructions.length-1-t],s=this._activePath.clone();if(e&&(e.action==="stroke"||e.action==="fill"))if(e.data.hole)e.data.hole.addPath(s);else{e.data.hole=s;break}}return this._initNextPathLocation(),this}arc(t,e,s,n,r,o){this._tick++;const a=this._transform;return this._activePath.arc(a.a*t+a.c*e+a.tx,a.b*t+a.d*e+a.ty,s,n,r,o),this}arcTo(t,e,s,n,r){this._tick++;const o=this._transform;return this._activePath.arcTo(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,o.a*s+o.c*n+o.tx,o.b*s+o.d*n+o.ty,r),this}arcToSvg(t,e,s,n,r,o,a){this._tick++;const l=this._transform;return this._activePath.arcToSvg(t,e,s,n,r,l.a*o+l.c*a+l.tx,l.b*o+l.d*a+l.ty),this}bezierCurveTo(t,e,s,n,r,o,a){this._tick++;const l=this._transform;return this._activePath.bezierCurveTo(l.a*t+l.c*e+l.tx,l.b*t+l.d*e+l.ty,l.a*s+l.c*n+l.tx,l.b*s+l.d*n+l.ty,l.a*r+l.c*o+l.tx,l.b*r+l.d*o+l.ty,a),this}closePath(){var t;return this._tick++,(t=this._activePath)==null||t.closePath(),this}ellipse(t,e,s,n){return this._tick++,this._activePath.ellipse(t,e,s,n,this._transform.clone()),this}circle(t,e,s){return this._tick++,this._activePath.circle(t,e,s,this._transform.clone()),this}path(t){return this._tick++,this._activePath.addPath(t,this._transform.clone()),this}lineTo(t,e){this._tick++;const s=this._transform;return this._activePath.lineTo(s.a*t+s.c*e+s.tx,s.b*t+s.d*e+s.ty),this}moveTo(t,e){this._tick++;const s=this._transform,n=this._activePath.instructions,r=s.a*t+s.c*e+s.tx,o=s.b*t+s.d*e+s.ty;return n.length===1&&n[0].action==="moveTo"?(n[0].data[0]=r,n[0].data[1]=o,this):(this._activePath.moveTo(r,o),this)}quadraticCurveTo(t,e,s,n,r){this._tick++;const o=this._transform;return this._activePath.quadraticCurveTo(o.a*t+o.c*e+o.tx,o.b*t+o.d*e+o.ty,o.a*s+o.c*n+o.tx,o.b*s+o.d*n+o.ty,r),this}rect(t,e,s,n){return this._tick++,this._activePath.rect(t,e,s,n,this._transform.clone()),this}roundRect(t,e,s,n,r){return this._tick++,this._activePath.roundRect(t,e,s,n,r,this._transform.clone()),this}poly(t,e){return this._tick++,this._activePath.poly(t,e,this._transform.clone()),this}regularPoly(t,e,s,n,r=0,o){return this._tick++,this._activePath.regularPoly(t,e,s,n,r,o),this}roundPoly(t,e,s,n,r,o){return this._tick++,this._activePath.roundPoly(t,e,s,n,r,o),this}roundShape(t,e,s,n){return this._tick++,this._activePath.roundShape(t,e,s,n),this}filletRect(t,e,s,n,r){return this._tick++,this._activePath.filletRect(t,e,s,n,r),this}chamferRect(t,e,s,n,r,o){return this._tick++,this._activePath.chamferRect(t,e,s,n,r,o),this}star(t,e,s,n,r=0,o=0){return this._tick++,this._activePath.star(t,e,s,n,r,o,this._transform.clone()),this}svg(t){return this._tick++,$y(t,this),this}restore(){const t=this._stateStack.pop();return t&&(this._transform=t.transform,this._fillStyle=t.fillStyle,this._strokeStyle=t.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(t){return this._transform.rotate(t),this}scale(t,e=t){return this._transform.scale(t,e),this}setTransform(t,e,s,n,r,o){return t instanceof At?(this._transform.set(t.a,t.b,t.c,t.d,t.tx,t.ty),this):(this._transform.set(t,e,s,n,r,o),this)}transform(t,e,s,n,r,o){return t instanceof At?(this._transform.append(t),this):(Rc.set(t,e,s,n,r,o),this._transform.append(Rc),this)}translate(t,e=t){return this._transform.translate(t,e),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this._boundsDirty=!0,!this.dirty&&(this.emit("update",this,16),this.dirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;this._boundsDirty=!1;const t=this._bounds;t.clear();for(let e=0;e<this.instructions.length;e++){const s=this.instructions[e],n=s.action;if(n==="fill"){const r=s.data;t.addBounds(r.path.bounds)}else if(n==="texture"){const r=s.data;t.addFrame(r.dx,r.dy,r.dx+r.dw,r.dy+r.dh,r.transform)}if(n==="stroke"){const r=s.data,o=r.style.alignment,a=r.style.width*(1-o),l=r.path.bounds;t.addFrame(l.minX-a,l.minY-a,l.maxX+a,l.maxY+a)}}return t}containsPoint(t){var n;if(!this.bounds.containsPoint(t.x,t.y))return!1;const e=this.instructions;let s=!1;for(let r=0;r<e.length;r++){const o=e[r],a=o.data,l=a.path;if(!o.action||!l)continue;const c=a.style,h=l.shapePath.shapePrimitives;for(let u=0;u<h.length;u++){const d=h[u].shape;if(!c||!d)continue;const f=h[u].transform,m=f?f.applyInverse(t,Jy):t;if(o.action==="fill")s=d.contains(m.x,m.y);else{const g=c;s=d.strokeContains(m.x,m.y,g.width,g.alignment)}const y=a.hole;if(y){const g=(n=y.shapePath)==null?void 0:n.shapePrimitives;if(g)for(let E=0;E<g.length;E++)g[E].shape.contains(m.x,m.y)&&(s=!1)}if(s)return!0}}return s}destroy(t=!1){if(this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners(),typeof t=="boolean"?t:t==null?void 0:t.texture){const s=typeof t=="boolean"?t:t==null?void 0:t.textureSource;this._fillStyle.texture&&(this._fillStyle.fill&&"uid"in this._fillStyle.fill?this._fillStyle.fill.destroy():this._fillStyle.texture.destroy(s)),this._strokeStyle.texture&&(this._strokeStyle.fill&&"uid"in this._strokeStyle.fill?this._strokeStyle.fill.destroy():this._strokeStyle.texture.destroy(s))}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};Wa.defaultFillStyle={color:16777215,alpha:1,texture:_t.WHITE,matrix:null,fill:null,textureSpace:"local"};Wa.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:_t.WHITE,matrix:null,fill:null,textureSpace:"local",pixelLine:!1};let Re=Wa;const Va=class ns extends Ke{constructor(t={}){super(),this.uid=Xt("textStyle"),this._tick=0,Qy(t);const e={...ns.defaultTextStyle,...t};for(const s in e){const n=s;this[n]=e[s]}this.update(),this._tick=0}get align(){return this._align}set align(t){this._align=t,this.update()}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords=t,this.update()}get dropShadow(){return this._dropShadow}set dropShadow(t){t!==null&&typeof t=="object"?this._dropShadow=this._createProxy({...ns.defaultDropShadow,...t}):this._dropShadow=t?this._createProxy({...ns.defaultDropShadow}):null,this.update()}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t,this.update()}get fontSize(){return this._fontSize}set fontSize(t){typeof t=="string"?this._fontSize=parseInt(t,10):this._fontSize=t,this.update()}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t.toLowerCase(),this.update()}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t,this.update()}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t,this.update()}get leading(){return this._leading}set leading(t){this._leading=t,this.update()}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing=t,this.update()}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t,this.update()}get padding(){return this._padding}set padding(t){this._padding=t,this.update()}get filters(){return this._filters}set filters(t){this._filters=Object.freeze(t),this.update()}get trim(){return this._trim}set trim(t){this._trim=t,this.update()}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t,this.update()}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace=t,this.update()}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap=t,this.update()}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth=t,this.update()}get fill(){return this._originalFill}set fill(t){t!==this._originalFill&&(this._originalFill=t,this._isFillStyle(t)&&(this._originalFill=this._createProxy({...Re.defaultFillStyle,...t},()=>{this._fill=Bi({...this._originalFill},Re.defaultFillStyle)})),this._fill=Bi(t===0?"black":t,Re.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(t){t!==this._originalStroke&&(this._originalStroke=t,this._isFillStyle(t)&&(this._originalStroke=this._createProxy({...Re.defaultStrokeStyle,...t},()=>{this._stroke=yr({...this._originalStroke},Re.defaultStrokeStyle)})),this._stroke=yr(t,Re.defaultStrokeStyle),this.update())}update(){this._tick++,this.emit("update",this)}reset(){const t=ns.defaultTextStyle;for(const e in t)this[e]=t[e]}get styleKey(){return`${this.uid}-${this._tick}`}clone(){return new ns({align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?{...this._dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,filters:this._filters?[...this._filters]:void 0})}_getFinalPadding(){let t=0;if(this._filters)for(let e=0;e<this._filters.length;e++)t+=this._filters[e].padding;return Math.max(this._padding,t)}destroy(t=!1){var s,n,r,o;if(this.removeAllListeners(),typeof t=="boolean"?t:t==null?void 0:t.texture){const a=typeof t=="boolean"?t:t==null?void 0:t.textureSource;(s=this._fill)!=null&&s.texture&&this._fill.texture.destroy(a),(n=this._originalFill)!=null&&n.texture&&this._originalFill.texture.destroy(a),(r=this._stroke)!=null&&r.texture&&this._stroke.texture.destroy(a),(o=this._originalStroke)!=null&&o.texture&&this._originalStroke.texture.destroy(a)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(t,e){return new Proxy(t,{set:(s,n,r)=>(s[n]=r,e==null||e(n,r),this.update(),!0)})}_isFillStyle(t){return(t??null)!==null&&!(Kt.isColorLike(t)||t instanceof mi||t instanceof zr)}};Va.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5};Va.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let Es=Va;function Qy(i){const t=i;if(typeof t.dropShadow=="boolean"&&t.dropShadow){const e=Es.defaultDropShadow;i.dropShadow={alpha:t.dropShadowAlpha??e.alpha,angle:t.dropShadowAngle??e.angle,blur:t.dropShadowBlur??e.blur,color:t.dropShadowColor??e.color,distance:t.dropShadowDistance??e.distance}}if(t.strokeThickness!==void 0){dt(Rt,"strokeThickness is now a part of stroke");const e=t.stroke;let s={};if(Kt.isColorLike(e))s.color=e;else if(e instanceof mi||e instanceof zr)s.fill=e;else if(Object.hasOwnProperty.call(e,"color")||Object.hasOwnProperty.call(e,"fill"))s=e;else throw new Error("Invalid stroke value.");i.stroke={...s,width:t.strokeThickness}}if(Array.isArray(t.fillGradientStops)){if(dt(Rt,"gradient fill is now a fill pattern: `new FillGradient(...)`"),!Array.isArray(t.fill)||t.fill.length===0)throw new Error("Invalid fill value. Expected an array of colors for gradient fill.");t.fill.length!==t.fillGradientStops.length&&Bt("The number of fill colors must match the number of fill gradient stops.");const e=new mi({start:{x:0,y:0},end:{x:0,y:1},textureSpace:"local"}),s=t.fillGradientStops.slice(),n=t.fill.map(r=>Kt.shared.setValue(r).toNumber());s.forEach((r,o)=>{e.addColorStop(r,n[o])}),i.fill={fill:e}}}class tS{constructor(t){this._canvasPool=Object.create(null),this.canvasOptions=t||{},this.enableFullScreen=!1}_createCanvasAndContext(t,e){const s=Wt.get().createCanvas();s.width=t,s.height=e;const n=s.getContext("2d");return{canvas:s,context:n}}getOptimalCanvasAndContext(t,e,s=1){t=Math.ceil(t*s-1e-6),e=Math.ceil(e*s-1e-6),t=ms(t),e=ms(e);const n=(t<<17)+(e<<1);this._canvasPool[n]||(this._canvasPool[n]=[]);let r=this._canvasPool[n].pop();return r||(r=this._createCanvasAndContext(t,e)),r}returnCanvasAndContext(t){const e=t.canvas,{width:s,height:n}=e,r=(s<<17)+(n<<1);t.context.resetTransform(),t.context.clearRect(0,0,s,n),this._canvasPool[r].push(t)}clear(){this._canvasPool={}}}const un=new tS;xn.register(un);const wc=1e5;function Sr(i,t,e,s=0){if(i.texture===_t.WHITE&&!i.fill)return Kt.shared.setValue(i.color).setAlpha(i.alpha??1).toHexa();if(i.fill){if(i.fill instanceof zr){const n=i.fill,r=t.createPattern(n.texture.source.resource,"repeat"),o=n.transform.copyTo(At.shared);return o.scale(n.texture.frame.width,n.texture.frame.height),r.setTransform(o),r}else if(i.fill instanceof mi){const n=i.fill,r=n.type==="linear",o=n.textureSpace==="local";let a=1,l=1;o&&e&&(a=e.width+s,l=e.height+s);let c,h=!1;if(r){const{start:u,end:d}=n;c=t.createLinearGradient(u.x*a,u.y*l,d.x*a,d.y*l),h=Math.abs(d.x-u.x)<Math.abs((d.y-u.y)*.1)}else{const{center:u,innerRadius:d,outerCenter:f,outerRadius:m}=n;c=t.createRadialGradient(u.x*a,u.y*l,d*a,f.x*a,f.y*l,m*a)}if(h&&o&&e){const u=e.lineHeight/l;for(let d=0;d<e.lines.length;d++){const f=(d*e.lineHeight+s/2)/l;n.colorStops.forEach(m=>{const y=f+m.offset*u;c.addColorStop(Math.floor(y*wc)/wc,Kt.shared.setValue(m.color).toHex())})}}else n.colorStops.forEach(u=>{c.addColorStop(u.offset,Kt.shared.setValue(u.color).toHex())});return c}}else{const n=t.createPattern(i.texture.source.resource,"repeat"),r=i.matrix.copyTo(At.shared);return r.scale(i.texture.frame.width,i.texture.frame.height),n.setTransform(r),n}return Bt("FillStyle not recognised",i),"red"}const gd=class yd extends Ku{constructor(t){super(),this.resolution=1,this.pages=[],this._padding=0,this._measureCache=Object.create(null),this._currentChars=[],this._currentX=0,this._currentY=0,this._currentMaxCharHeight=0,this._currentPageIndex=-1,this._skipKerning=!1;const e={...yd.defaultOptions,...t};this._textureSize=e.textureSize,this._mipmap=e.mipmap;const s=e.style.clone();e.overrideFill&&(s._fill.color=16777215,s._fill.alpha=1,s._fill.texture=_t.WHITE,s._fill.fill=null),this.applyFillAsTint=e.overrideFill;const n=s.fontSize;s.fontSize=this.baseMeasurementFontSize;const r=mr(s);e.overrideSize?s._stroke&&(s._stroke.width*=this.baseRenderedFontSize/n):s.fontSize=this.baseRenderedFontSize=n,this._style=s,this._skipKerning=e.skipKerning??!1,this.resolution=e.resolution??1,this._padding=e.padding??4,e.textureStyle&&(this._textureStyle=e.textureStyle instanceof gs?e.textureStyle:new gs(e.textureStyle)),this.fontMetrics=de.measureFont(r),this.lineHeight=s.lineHeight||this.fontMetrics.fontSize||s.fontSize}ensureCharacters(t){var g,E;const e=de.graphemeSegmenter(t).filter(T=>!this._currentChars.includes(T)).filter((T,_,b)=>b.indexOf(T)===_);if(!e.length)return;this._currentChars=[...this._currentChars,...e];let s;this._currentPageIndex===-1?s=this._nextPage():s=this.pages[this._currentPageIndex];let{canvas:n,context:r}=s.canvasAndContext,o=s.texture.source;const a=this._style;let l=this._currentX,c=this._currentY,h=this._currentMaxCharHeight;const u=this.baseRenderedFontSize/this.baseMeasurementFontSize,d=this._padding*u;let f=!1;const m=n.width/this.resolution,y=n.height/this.resolution;for(let T=0;T<e.length;T++){const _=e[T],b=de.measureText(_,a,n,!1);b.lineHeight=b.height;const A=b.width*u,C=Math.ceil((a.fontStyle==="italic"?2:1)*A),R=b.height*u,O=C+d*2,M=R+d*2;if(f=!1,_!==`
`&&_!=="\r"&&_!=="	"&&_!==" "&&(f=!0,h=Math.ceil(Math.max(M,h))),l+O>m&&(c+=h,h=M,l=0,c+h>y)){o.update();const I=this._nextPage();n=I.canvasAndContext.canvas,r=I.canvasAndContext.context,o=I.texture.source,l=0,c=0,h=0}const w=A/u-(((g=a.dropShadow)==null?void 0:g.distance)??0)-(((E=a._stroke)==null?void 0:E.width)??0);if(this.chars[_]={id:_.codePointAt(0),xOffset:-this._padding,yOffset:-this._padding,xAdvance:w,kerning:{}},f){this._drawGlyph(r,b,l+d,c+d,u,a);const I=o.width*u,L=o.height*u,D=new Ot(l/I*o.width,c/L*o.height,O/I*o.width,M/L*o.height);this.chars[_].texture=new _t({source:o,frame:D}),l+=Math.ceil(O)}}o.update(),this._currentX=l,this._currentY=c,this._currentMaxCharHeight=h,this._skipKerning&&this._applyKerning(e,r)}get pageTextures(){return dt(Rt,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}_applyKerning(t,e){const s=this._measureCache;for(let n=0;n<t.length;n++){const r=t[n];for(let o=0;o<this._currentChars.length;o++){const a=this._currentChars[o];let l=s[r];l||(l=s[r]=e.measureText(r).width);let c=s[a];c||(c=s[a]=e.measureText(a).width);let h=e.measureText(r+a).width,u=h-(l+c);u&&(this.chars[r].kerning[a]=u),h=e.measureText(r+a).width,u=h-(l+c),u&&(this.chars[a].kerning[r]=u)}}}_nextPage(){this._currentPageIndex++;const t=this.resolution,e=un.getOptimalCanvasAndContext(this._textureSize,this._textureSize,t);this._setupContext(e.context,this._style,t);const s=t*(this.baseRenderedFontSize/this.baseMeasurementFontSize),n=new _t({source:new Xi({resource:e.canvas,resolution:s,alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:this._mipmap})});this._textureStyle&&(n.source.style=this._textureStyle);const r={canvasAndContext:e,texture:n};return this.pages[this._currentPageIndex]=r,r}_setupContext(t,e,s){e.fontSize=this.baseRenderedFontSize,t.scale(s,s),t.font=mr(e),e.fontSize=this.baseMeasurementFontSize,t.textBaseline=e.textBaseline;const n=e._stroke,r=(n==null?void 0:n.width)??0;if(n&&(t.lineWidth=r,t.lineJoin=n.join,t.miterLimit=n.miterLimit,t.strokeStyle=Sr(n,t)),e._fill&&(t.fillStyle=Sr(e._fill,t)),e.dropShadow){const o=e.dropShadow,a=Kt.shared.setValue(o.color).toArray(),l=o.blur*s,c=o.distance*s;t.shadowColor=`rgba(${a[0]*255},${a[1]*255},${a[2]*255},${o.alpha})`,t.shadowBlur=l,t.shadowOffsetX=Math.cos(o.angle)*c,t.shadowOffsetY=Math.sin(o.angle)*c}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}_drawGlyph(t,e,s,n,r,o){const a=e.text,l=e.fontProperties,c=o._stroke,h=((c==null?void 0:c.width)??0)*r,u=s+h/2,d=n-h/2,f=l.descent*r,m=e.lineHeight*r;let y=!1;o.stroke&&h&&(y=!0,t.strokeText(a,u,d+m-f));const{shadowBlur:g,shadowOffsetX:E,shadowOffsetY:T}=t;o._fill&&(y&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.fillText(a,u,d+m-f)),y&&(t.shadowBlur=g,t.shadowOffsetX=E,t.shadowOffsetY=T)}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{canvasAndContext:e,texture:s}=this.pages[t];un.returnCanvasAndContext(e),s.destroy(!0)}this.pages=null}};gd.defaultOptions={textureSize:512,style:new Es,mipmap:!0};let Ic=gd;function eS(i,t,e,s){const n={width:0,height:0,offsetY:0,scale:t.fontSize/e.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};n.offsetY=e.baseLineOffset;let r=n.lines[0],o=null,a=!0;const l={width:0,start:0,index:0,positions:[],chars:[]},c=e.baseMeasurementFontSize/t.fontSize,h=t.letterSpacing*c,u=t.wordWrapWidth*c,d=t.lineHeight?t.lineHeight*c:e.lineHeight,f=t.wordWrap&&t.breakWords,m=E=>{const T=r.width;for(let _=0;_<l.index;_++){const b=E.positions[_];r.chars.push(E.chars[_]),r.charPositions.push(b+T)}r.width+=E.width,a=!1,l.width=0,l.index=0,l.chars.length=0},y=()=>{let E=r.chars.length-1;if(s){let T=r.chars[E];for(;T===" ";)r.width-=e.chars[T].xAdvance,T=r.chars[--E]}n.width=Math.max(n.width,r.width),r={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},a=!0,n.lines.push(r),n.height+=d},g=E=>E-h>u;for(let E=0;E<i.length+1;E++){let T;const _=E===i.length;_||(T=i[E]);const b=e.chars[T]||e.chars[" "];if(/(?:\s)/.test(T)||T==="\r"||T===`
`||_){if(!a&&t.wordWrap&&g(r.width+l.width)?(y(),m(l),_||r.charPositions.push(0)):(l.start=r.width,m(l),_||r.charPositions.push(0)),T==="\r"||T===`
`)y();else if(!_){const O=b.xAdvance+(b.kerning[o]||0)+h;r.width+=O,r.spaceWidth=O,r.spacesIndex.push(r.charPositions.length),r.chars.push(T)}}else{const R=b.kerning[o]||0,O=b.xAdvance+R+h;f&&g(r.width+l.width+O)&&(m(l),y()),l.positions[l.index++]=l.width+R,l.chars.push(T),l.width+=O}o=T}return y(),t.align==="center"?iS(n):t.align==="right"?sS(n):t.align==="justify"&&nS(n),n}function iS(i){for(let t=0;t<i.lines.length;t++){const e=i.lines[t],s=i.width/2-e.width/2;for(let n=0;n<e.charPositions.length;n++)e.charPositions[n]+=s}}function sS(i){for(let t=0;t<i.lines.length;t++){const e=i.lines[t],s=i.width-e.width;for(let n=0;n<e.charPositions.length;n++)e.charPositions[n]+=s}}function nS(i){const t=i.width;for(let e=0;e<i.lines.length;e++){const s=i.lines[e];let n=0,r=s.spacesIndex[n++],o=0;const a=s.spacesIndex.length,c=(t-s.width)/a;for(let h=0;h<s.charPositions.length;h++)h===r&&(r=s.spacesIndex[n++],o+=c),s.charPositions[h]+=o}}function rS(i){if(i==="")return[];typeof i=="string"&&(i=[i]);const t=[];for(let e=0,s=i.length;e<s;e++){const n=i[e];if(Array.isArray(n)){if(n.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${n.length}.`);if(n[0].length===0||n[1].length===0)throw new Error("[BitmapFont]: Invalid character delimiter.");const r=n[0].charCodeAt(0),o=n[1].charCodeAt(0);if(o<r)throw new Error("[BitmapFont]: Invalid character range.");for(let a=r,l=o;a<=l;a++)t.push(String.fromCharCode(a))}else t.push(...Array.from(n))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}let Vn=0;class oS{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1,textureStyle:null},this.measureCache=Zu(1e3)}getFont(t,e){var o;let s=`${e.fontFamily}-bitmap`,n=!0;if(e._fill.fill&&!e._stroke?(s+=e._fill.fill.styleKey,n=!1):(e._stroke||e.dropShadow)&&(s=`${e.styleKey}-bitmap`,n=!1),!Vt.has(s)){const a=Object.create(e);a.lineHeight=0;const l=new Ic({style:a,overrideFill:n,overrideSize:!0,...this.defaultOptions});Vn++,Vn>50&&Bt("BitmapText",`You have dynamically created ${Vn} bitmap fonts, this can be inefficient. Try pre installing your font styles using \`BitmapFont.install({name:"style1", style})\``),l.once("destroy",()=>{Vn--,Vt.remove(s)}),Vt.set(s,l)}const r=Vt.get(s);return(o=r.ensureCharacters)==null||o.call(r,t),r}getLayout(t,e,s=!0){const n=this.getFont(t,e),r=`${t}-${e.styleKey}-${s}`;if(this.measureCache.has(r))return this.measureCache.get(r);const o=de.graphemeSegmenter(t),a=eS(o,e,n,s);return this.measureCache.set(r,a),a}measureText(t,e,s=!0){return this.getLayout(t,e,s)}install(...t){var c,h,u,d;let e=t[0];typeof e=="string"&&(e={name:e,style:t[1],chars:(c=t[2])==null?void 0:c.chars,resolution:(h=t[2])==null?void 0:h.resolution,padding:(u=t[2])==null?void 0:u.padding,skipKerning:(d=t[2])==null?void 0:d.skipKerning},dt(Rt,"BitmapFontManager.install(name, style, options) is deprecated, use BitmapFontManager.install({name, style, ...options})"));const s=e==null?void 0:e.name;if(!s)throw new Error("[BitmapFontManager] Property `name` is required.");e={...this.defaultOptions,...e};const n=e.style,r=n instanceof Es?n:new Es(n),o=e.dynamicFill??this._canUseTintForStyle(r),a=new Ic({style:r,overrideFill:o,skipKerning:e.skipKerning,padding:e.padding,resolution:e.resolution,overrideSize:!1,textureStyle:e.textureStyle}),l=rS(e.chars);return a.ensureCharacters(l.join("")),Vt.set(`${s}-bitmap`,a),a.once("destroy",()=>Vt.remove(`${s}-bitmap`)),a}uninstall(t){const e=`${t}-bitmap`,s=Vt.get(e);s&&s.destroy()}_canUseTintForStyle(t){return!t._stroke&&(!t.dropShadow||t.dropShadow.color===0)&&!t._fill.fill&&t._fill.color===16777215}}const pa=new oS;class Cn extends Ku{constructor(t,e){super();const{textures:s,data:n}=t;Object.keys(n.pages).forEach(r=>{const o=n.pages[parseInt(r,10)],a=s[o.id];this.pages.push({texture:a})}),Object.keys(n.chars).forEach(r=>{const o=n.chars[r],{frame:a,source:l,rotate:c}=s[o.page],h=kt.transformRectCoords(o,a,c,new Ot),u=new _t({frame:h,orig:new Ot(0,0,o.width,o.height),source:l,rotate:c});this.chars[r]={id:r.codePointAt(0),xOffset:o.xOffset,yOffset:o.yOffset,xAdvance:o.xAdvance,kerning:o.kerning??{},texture:u}}),this.baseRenderedFontSize=n.fontSize,this.baseMeasurementFontSize=n.fontSize,this.fontMetrics={ascent:0,descent:0,fontSize:n.fontSize},this.baseLineOffset=n.baseLineOffset,this.lineHeight=n.lineHeight,this.fontFamily=n.fontFamily,this.distanceField=n.distanceField??{type:"none",range:0},this.url=e}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{texture:e}=this.pages[t];e.destroy(!0)}this.pages=null}static install(t){pa.install(t)}static uninstall(t){pa.uninstall(t)}}const Po={test(i){return typeof i=="string"&&i.startsWith("info face=")},parse(i){const t=i.match(/^[a-z]+\s+.+$/gm),e={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const u in t){const d=t[u].match(/^[a-z]+/gm)[0],f=t[u].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),m={};for(const y in f){const g=f[y].split("="),E=g[0],T=g[1].replace(/"/gm,""),_=parseFloat(T),b=isNaN(_)?T:_;m[E]=b}e[d].push(m)}const s={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},[n]=e.info,[r]=e.common,[o]=e.distanceField??[];o&&(s.distanceField={range:parseInt(o.distanceRange,10),type:o.fieldType}),s.fontSize=parseInt(n.size,10),s.fontFamily=n.face,s.lineHeight=parseInt(r.lineHeight,10);const a=e.page;for(let u=0;u<a.length;u++)s.pages.push({id:parseInt(a[u].id,10)||0,file:a[u].file});const l={};s.baseLineOffset=s.lineHeight-parseInt(r.base,10);const c=e.char;for(let u=0;u<c.length;u++){const d=c[u],f=parseInt(d.id,10);let m=d.letter??d.char??String.fromCharCode(f);m==="space"&&(m=" "),l[f]=m,s.chars[m]={id:f,page:parseInt(d.page,10)||0,x:parseInt(d.x,10),y:parseInt(d.y,10),width:parseInt(d.width,10),height:parseInt(d.height,10),xOffset:parseInt(d.xoffset,10),yOffset:parseInt(d.yoffset,10),xAdvance:parseInt(d.xadvance,10),kerning:{}}}const h=e.kerning||[];for(let u=0;u<h.length;u++){const d=parseInt(h[u].first,10),f=parseInt(h[u].second,10),m=parseInt(h[u].amount,10);s.chars[l[f]].kerning[l[d]]=m}return s}},Mc={test(i){const t=i;return typeof t!="string"&&"getElementsByTagName"in t&&t.getElementsByTagName("page").length&&t.getElementsByTagName("info")[0].getAttribute("face")!==null},parse(i){const t={chars:{},pages:[],lineHeight:0,fontSize:0,fontFamily:"",distanceField:null,baseLineOffset:0},e=i.getElementsByTagName("info")[0],s=i.getElementsByTagName("common")[0],n=i.getElementsByTagName("distanceField")[0];n&&(t.distanceField={type:n.getAttribute("fieldType"),range:parseInt(n.getAttribute("distanceRange"),10)});const r=i.getElementsByTagName("page"),o=i.getElementsByTagName("char"),a=i.getElementsByTagName("kerning");t.fontSize=parseInt(e.getAttribute("size"),10),t.fontFamily=e.getAttribute("face"),t.lineHeight=parseInt(s.getAttribute("lineHeight"),10);for(let c=0;c<r.length;c++)t.pages.push({id:parseInt(r[c].getAttribute("id"),10)||0,file:r[c].getAttribute("file")});const l={};t.baseLineOffset=t.lineHeight-parseInt(s.getAttribute("base"),10);for(let c=0;c<o.length;c++){const h=o[c],u=parseInt(h.getAttribute("id"),10);let d=h.getAttribute("letter")??h.getAttribute("char")??String.fromCharCode(u);d==="space"&&(d=" "),l[u]=d,t.chars[d]={id:u,page:parseInt(h.getAttribute("page"),10)||0,x:parseInt(h.getAttribute("x"),10),y:parseInt(h.getAttribute("y"),10),width:parseInt(h.getAttribute("width"),10),height:parseInt(h.getAttribute("height"),10),xOffset:parseInt(h.getAttribute("xoffset"),10),yOffset:parseInt(h.getAttribute("yoffset"),10),xAdvance:parseInt(h.getAttribute("xadvance"),10),kerning:{}}}for(let c=0;c<a.length;c++){const h=parseInt(a[c].getAttribute("first"),10),u=parseInt(a[c].getAttribute("second"),10),d=parseInt(a[c].getAttribute("amount"),10);t.chars[l[u]].kerning[l[h]]=d}return t}},Oc={test(i){return typeof i=="string"&&i.includes("<font>")?Mc.test(Wt.get().parseXML(i)):!1},parse(i){return Mc.parse(Wt.get().parseXML(i))}},aS=[".xml",".fnt"],lS={extension:{type:lt.CacheParser,name:"cacheBitmapFont"},test:i=>i instanceof Cn,getCacheableAssets(i,t){const e={};return i.forEach(s=>{e[s]=t,e[`${s}-bitmap`]=t}),e[`${t.fontFamily}-bitmap`]=t,e}},cS={extension:{type:lt.LoadParser,priority:vi.Normal},name:"loadBitmapFont",id:"bitmap-font",test(i){return aS.includes(be.extname(i).toLowerCase())},async testParse(i){return Po.test(i)||Oc.test(i)},async parse(i,t,e){const s=Po.test(i)?Po.parse(i):Oc.parse(i),{src:n}=t,{pages:r}=s,o=[],a=s.distanceField?{scaleMode:"linear",alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:!1,resolution:1}:{};for(let u=0;u<r.length;++u){const d=r[u].file;let f=be.join(be.dirname(n),d);f=ea(f,n),o.push({src:f,data:a})}const l=await e.load(o),c=o.map(u=>l[u.src]);return new Cn({data:s,textures:c},n)},async load(i,t){return await(await Wt.get().fetch(i)).text()},async unload(i,t,e){await Promise.all(i.pages.map(s=>e.unload(s.texture.source._sourceOrigin))),i.destroy()}};let hS=class{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach(e=>{this._assetList.push(e)}),this.verbose&&console.log("[BackgroundLoader] assets: ",this._assetList),this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let s=0;s<e;s++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}};const uS={extension:{type:lt.CacheParser,name:"cacheTextureArray"},test:i=>Array.isArray(i)&&i.every(t=>t instanceof _t),getCacheableAssets:(i,t)=>{const e={};return i.forEach(s=>{t.forEach((n,r)=>{e[s+(r===0?"":r+1)]=n})}),e}};async function Sd(i){if("Image"in globalThis)return new Promise(t=>{const e=new Image;e.onload=()=>{t(!0)},e.onerror=()=>{t(!1)},e.src=i});if("createImageBitmap"in globalThis&&"fetch"in globalThis){try{const t=await(await fetch(i)).blob();await createImageBitmap(t)}catch{return!1}return!0}return!1}const dS={extension:{type:lt.DetectionParser,priority:1},test:async()=>Sd("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),add:async i=>[...i,"avif"],remove:async i=>i.filter(t=>t!=="avif")},vc=["png","jpg","jpeg"],fS={extension:{type:lt.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async i=>[...i,...vc],remove:async i=>i.filter(t=>!vc.includes(t))},pS="WorkerGlobalScope"in globalThis&&globalThis instanceof globalThis.WorkerGlobalScope;function Yr(i){return pS?!1:document.createElement("video").canPlayType(i)!==""}const mS={extension:{type:lt.DetectionParser,priority:0},test:async()=>Yr("video/mp4"),add:async i=>[...i,"mp4","m4v"],remove:async i=>i.filter(t=>t!=="mp4"&&t!=="m4v")},gS={extension:{type:lt.DetectionParser,priority:0},test:async()=>Yr("video/ogg"),add:async i=>[...i,"ogv"],remove:async i=>i.filter(t=>t!=="ogv")},yS={extension:{type:lt.DetectionParser,priority:0},test:async()=>Yr("video/webm"),add:async i=>[...i,"webm"],remove:async i=>i.filter(t=>t!=="webm")},SS={extension:{type:lt.DetectionParser,priority:0},test:async()=>Sd("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA="),add:async i=>[...i,"webp"],remove:async i=>i.filter(t=>t!=="webp")};class TS{constructor(){this._parsers=[],this._parsersValidated=!1,this.parsers=new Proxy(this._parsers,{set:(t,e,s)=>(this._parsersValidated=!1,t[e]=s,!0)}),this.promiseCache={}}reset(){this._parsersValidated=!1,this.promiseCache={}}_getLoadPromiseAndParser(t,e){const s={promise:null,parser:null};return s.promise=(async()=>{var o,a;let n=null,r=null;if((e.parser||e.loadParser)&&(r=this._parserHash[e.parser||e.loadParser],e.loadParser&&Bt(`[Assets] "loadParser" is deprecated, use "parser" instead for ${t}`),r||Bt(`[Assets] specified load parser "${e.parser||e.loadParser}" not found while loading ${t}`)),!r){for(let l=0;l<this.parsers.length;l++){const c=this.parsers[l];if(c.load&&((o=c.test)!=null&&o.call(c,t,e,this))){r=c;break}}if(!r)return Bt(`[Assets] ${t} could not be loaded as we don't know how to parse it, ensure the correct parser has been added`),null}n=await r.load(t,e,this),s.parser=r;for(let l=0;l<this.parsers.length;l++){const c=this.parsers[l];c.parse&&c.parse&&await((a=c.testParse)==null?void 0:a.call(c,n,e,this))&&(n=await c.parse(n,e,this)||n,s.parser=c)}return n})(),s}async load(t,e){this._parsersValidated||this._validateParsers();let s=0;const n={},r=fr(t),o=Ge(t,c=>({alias:[c],src:c,data:{}})),a=o.length,l=o.map(async c=>{const h=be.toAbsolute(c.src);if(!n[c.src])try{this.promiseCache[h]||(this.promiseCache[h]=this._getLoadPromiseAndParser(h,c)),n[c.src]=await this.promiseCache[h].promise,e&&e(++s/a)}catch(u){throw delete this.promiseCache[h],delete n[c.src],new Error(`[Loader.load] Failed to load ${h}.
${u}`)}});return await Promise.all(l),r?n[o[0].src]:n}async unload(t){const s=Ge(t,n=>({alias:[n],src:n})).map(async n=>{var a,l;const r=be.toAbsolute(n.src),o=this.promiseCache[r];if(o){const c=await o.promise;delete this.promiseCache[r],await((l=(a=o.parser)==null?void 0:a.unload)==null?void 0:l.call(a,c,n,this))}});await Promise.all(s)}_validateParsers(){this._parsersValidated=!0,this._parserHash=this._parsers.filter(t=>t.name||t.id).reduce((t,e)=>(!e.name&&!e.id?Bt("[Assets] parser should have an id"):(t[e.name]||t[e.id])&&Bt(`[Assets] parser id conflict "${e.id}"`),t[e.name]=e,e.id&&(t[e.id]=e),t),{})}}function Ms(i,t){if(Array.isArray(t)){for(const e of t)if(i.startsWith(`data:${e}`))return!0;return!1}return i.startsWith(`data:${t}`)}function Os(i,t){const e=i.split("?")[0],s=be.extname(e).toLowerCase();return Array.isArray(t)?t.includes(s):s===t}const ES=".json",_S="application/json",bS={extension:{type:lt.LoadParser,priority:vi.Low},name:"loadJson",id:"json",test(i){return Ms(i,_S)||Os(i,ES)},async load(i){return await(await Wt.get().fetch(i)).json()}},xS=".txt",AS="text/plain",CS={name:"loadTxt",id:"text",extension:{type:lt.LoadParser,priority:vi.Low,name:"loadTxt"},test(i){return Ms(i,AS)||Os(i,xS)},async load(i){return await(await Wt.get().fetch(i)).text()}},RS=["normal","bold","100","200","300","400","500","600","700","800","900"],wS=[".ttf",".otf",".woff",".woff2"],IS=["font/ttf","font/otf","font/woff","font/woff2"],MS=/^(--|-?[A-Z_])[0-9A-Z_-]*$/i;function OS(i){const t=be.extname(i),n=be.basename(i,t).replace(/(-|_)/g," ").toLowerCase().split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1));let r=n.length>0;for(const a of n)if(!a.match(MS)){r=!1;break}let o=n.join(" ");return r||(o=`"${o.replace(/[\\"]/g,"\\$&")}"`),o}const vS=/^[0-9A-Za-z%:/?#\[\]@!\$&'()\*\+,;=\-._~]*$/;function PS(i){return vS.test(i)?i:encodeURI(i)}const LS={extension:{type:lt.LoadParser,priority:vi.Low},name:"loadWebFont",id:"web-font",test(i){return Ms(i,IS)||Os(i,wS)},async load(i,t){var s,n,r;const e=Wt.get().getFontFaceSet();if(e){const o=[],a=((s=t.data)==null?void 0:s.family)??OS(i),l=((r=(n=t.data)==null?void 0:n.weights)==null?void 0:r.filter(h=>RS.includes(h)))??["normal"],c=t.data??{};for(let h=0;h<l.length;h++){const u=l[h],d=new FontFace(a,`url(${PS(i)})`,{...c,weight:u});await d.load(),e.add(d),o.push(d)}return Vt.has(`${a}-and-url`)?Vt.get(`${a}-and-url`).entries.push({url:i,faces:o}):Vt.set(`${a}-and-url`,{entries:[{url:i,faces:o}]}),o.length===1?o[0]:o}return Bt("[loadWebFont] FontFace API is not supported. Skipping loading font"),null},unload(i){const t=Array.isArray(i)?i:[i],e=t[0].family,s=Vt.get(`${e}-and-url`),n=s.entries.find(r=>r.faces.some(o=>t.indexOf(o)!==-1));n.faces=n.faces.filter(r=>t.indexOf(r)===-1),n.faces.length===0&&(s.entries=s.entries.filter(r=>r!==n)),t.forEach(r=>{Wt.get().getFontFaceSet().delete(r)}),s.entries.length===0&&Vt.remove(`${e}-and-url`)}};function za(i,t=1){var s;const e=(s=Is.RETINA_PREFIX)==null?void 0:s.exec(i);return e?parseFloat(e[1]):t}function $a(i,t,e){i.label=e,i._sourceOrigin=e;const s=new _t({source:i,label:e}),n=()=>{delete t.promiseCache[e],Vt.has(e)&&Vt.remove(e)};return s.source.once("destroy",()=>{t.promiseCache[e]&&(Bt("[Assets] A TextureSource managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the TextureSource."),n())}),s.once("destroy",()=>{i.destroyed||(Bt("[Assets] A Texture managed by Assets was destroyed instead of unloaded! Use Assets.unload() instead of destroying the Texture."),n())}),s}const NS=".svg",DS="image/svg+xml",kS={extension:{type:lt.LoadParser,priority:vi.Low,name:"loadSVG"},name:"loadSVG",id:"svg",config:{crossOrigin:"anonymous",parseAsGraphicsContext:!1},test(i){return Ms(i,DS)||Os(i,NS)},async load(i,t,e){var s;return((s=t.data)==null?void 0:s.parseAsGraphicsContext)??this.config.parseAsGraphicsContext?FS(i):HS(i,t,e,this.config.crossOrigin)},unload(i){i.destroy(!0)}};async function HS(i,t,e,s){var g,E,T;const n=await Wt.get().fetch(i),r=Wt.get().createImage();r.src=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(await n.text())}`,r.crossOrigin=s,await r.decode();const o=((g=t.data)==null?void 0:g.width)??r.width,a=((E=t.data)==null?void 0:E.height)??r.height,l=((T=t.data)==null?void 0:T.resolution)||za(i),c=Math.ceil(o*l),h=Math.ceil(a*l),u=Wt.get().createCanvas(c,h),d=u.getContext("2d");d.imageSmoothingEnabled=!0,d.imageSmoothingQuality="high",d.drawImage(r,0,0,o*l,a*l);const{parseAsGraphicsContext:f,...m}=t.data??{},y=new Xi({resource:u,alphaMode:"premultiply-alpha-on-upload",resolution:l,...m});return $a(y,e,i)}async function FS(i){const e=await(await Wt.get().fetch(i)).text(),s=new Re;return s.svg(e),s}const BS=`(function () {
    'use strict';

    const WHITE_PNG = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=";
    async function checkImageBitmap() {
      try {
        if (typeof createImageBitmap !== "function")
          return false;
        const response = await fetch(WHITE_PNG);
        const imageBlob = await response.blob();
        const imageBitmap = await createImageBitmap(imageBlob);
        return imageBitmap.width === 1 && imageBitmap.height === 1;
      } catch (_e) {
        return false;
      }
    }
    void checkImageBitmap().then((result) => {
      self.postMessage(result);
    });

})();
`;let hs=null,ma=class{constructor(){hs||(hs=URL.createObjectURL(new Blob([BS],{type:"application/javascript"}))),this.worker=new Worker(hs)}};ma.revokeObjectURL=function(){hs&&(URL.revokeObjectURL(hs),hs=null)};const US=`(function () {
    'use strict';

    async function loadImageBitmap(url, alphaMode) {
      const response = await fetch(url);
      if (!response.ok) {
        throw new Error(\`[WorkerManager.loadImageBitmap] Failed to fetch \${url}: \${response.status} \${response.statusText}\`);
      }
      const imageBlob = await response.blob();
      return alphaMode === "premultiplied-alpha" ? createImageBitmap(imageBlob, { premultiplyAlpha: "none" }) : createImageBitmap(imageBlob);
    }
    self.onmessage = async (event) => {
      try {
        const imageBitmap = await loadImageBitmap(event.data.data[0], event.data.data[1]);
        self.postMessage({
          data: imageBitmap,
          uuid: event.data.uuid,
          id: event.data.id
        }, [imageBitmap]);
      } catch (e) {
        self.postMessage({
          error: e,
          uuid: event.data.uuid,
          id: event.data.id
        });
      }
    };

})();
`;let us=null;class Td{constructor(){us||(us=URL.createObjectURL(new Blob([US],{type:"application/javascript"}))),this.worker=new Worker(us)}}Td.revokeObjectURL=function(){us&&(URL.revokeObjectURL(us),us=null)};let Pc=0,Lo;class GS{constructor(){this._initialized=!1,this._createdWorkers=0,this._workerPool=[],this._queue=[],this._resolveHash={}}isImageBitmapSupported(){return this._isImageBitmapSupported!==void 0?this._isImageBitmapSupported:(this._isImageBitmapSupported=new Promise(t=>{const{worker:e}=new ma;e.addEventListener("message",s=>{e.terminate(),ma.revokeObjectURL(),t(s.data)})}),this._isImageBitmapSupported)}loadImageBitmap(t,e){var s;return this._run("loadImageBitmap",[t,(s=e==null?void 0:e.data)==null?void 0:s.alphaMode])}async _initWorkers(){this._initialized||(this._initialized=!0)}_getWorker(){Lo===void 0&&(Lo=navigator.hardwareConcurrency||4);let t=this._workerPool.pop();return!t&&this._createdWorkers<Lo&&(this._createdWorkers++,t=new Td().worker,t.addEventListener("message",e=>{this._complete(e.data),this._returnWorker(e.target),this._next()})),t}_returnWorker(t){this._workerPool.push(t)}_complete(t){t.error!==void 0?this._resolveHash[t.uuid].reject(t.error):this._resolveHash[t.uuid].resolve(t.data),this._resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const s=new Promise((n,r)=>{this._queue.push({id:t,arguments:e,resolve:n,reject:r})});return this._next(),s}_next(){if(!this._queue.length)return;const t=this._getWorker();if(!t)return;const e=this._queue.pop(),s=e.id;this._resolveHash[Pc]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:Pc++,id:s})}reset(){this._workerPool.forEach(t=>t.terminate()),this._workerPool.length=0,Object.values(this._resolveHash).forEach(({reject:t})=>{t==null||t(new Error("WorkerManager destroyed"))}),this._resolveHash={},this._queue.length=0,this._initialized=!1,this._createdWorkers=0}}const Lc=new GS,jS=[".jpeg",".jpg",".png",".webp",".avif"],WS=["image/jpeg","image/png","image/webp","image/avif"];async function VS(i,t){var n;const e=await Wt.get().fetch(i);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${i}: ${e.status} ${e.statusText}`);const s=await e.blob();return((n=t==null?void 0:t.data)==null?void 0:n.alphaMode)==="premultiplied-alpha"?createImageBitmap(s,{premultiplyAlpha:"none"}):createImageBitmap(s)}const Ed={name:"loadTextures",id:"texture",extension:{type:lt.LoadParser,priority:vi.High,name:"loadTextures"},config:{preferWorkers:!0,preferCreateImageBitmap:!0,crossOrigin:"anonymous"},test(i){return Ms(i,WS)||Os(i,jS)},async load(i,t,e){var r;let s=null;globalThis.createImageBitmap&&this.config.preferCreateImageBitmap?this.config.preferWorkers&&await Lc.isImageBitmapSupported()?s=await Lc.loadImageBitmap(i,t):s=await VS(i,t):s=await new Promise((o,a)=>{s=Wt.get().createImage(),s.crossOrigin=this.config.crossOrigin,s.src=i,s.complete?o(s):(s.onload=()=>{o(s)},s.onerror=a)});const n=new Xi({resource:s,alphaMode:"premultiply-alpha-on-upload",resolution:((r=t.data)==null?void 0:r.resolution)||za(i),...t.data});return $a(n,e,i)},unload(i){i.destroy(!0)}},zS=[".mp4",".m4v",".webm",".ogg",".ogv",".h264",".avi",".mov"];let No,Do;function $S(i,t,e){e===void 0&&!t.startsWith("data:")?i.crossOrigin=XS(t):e!==!1&&(i.crossOrigin=typeof e=="string"?e:"anonymous")}function YS(i){return new Promise((t,e)=>{i.addEventListener("canplaythrough",s),i.addEventListener("error",n),i.load();function s(){r(),t()}function n(o){r(),e(o)}function r(){i.removeEventListener("canplaythrough",s),i.removeEventListener("error",n)}})}function XS(i,t=globalThis.location){if(i.startsWith("data:"))return"";t||(t=globalThis.location);const e=new URL(i,document.baseURI);return e.hostname!==t.hostname||e.port!==t.port||e.protocol!==t.protocol?"anonymous":""}function qS(){const i=[],t=[];for(const e of zS){const s=en.MIME_TYPES[e.substring(1)]||`video/${e.substring(1)}`;Yr(s)&&(i.push(e),t.includes(s)||t.push(s))}return{validVideoExtensions:i,validVideoMime:t}}const KS={name:"loadVideo",id:"video",extension:{type:lt.LoadParser,name:"loadVideo"},test(i){if(!No||!Do){const{validVideoExtensions:s,validVideoMime:n}=qS();No=s,Do=n}const t=Ms(i,Do),e=Os(i,No);return t||e},async load(i,t,e){var l,c;const s={...en.defaultOptions,resolution:((l=t.data)==null?void 0:l.resolution)||za(i),alphaMode:((c=t.data)==null?void 0:c.alphaMode)||await xu(),...t.data},n=document.createElement("video"),r={preload:s.autoLoad!==!1?"auto":void 0,"webkit-playsinline":s.playsinline!==!1?"":void 0,playsinline:s.playsinline!==!1?"":void 0,muted:s.muted===!0?"":void 0,loop:s.loop===!0?"":void 0,autoplay:s.autoPlay!==!1?"":void 0};Object.keys(r).forEach(h=>{const u=r[h];u!==void 0&&n.setAttribute(h,u)}),s.muted===!0&&(n.muted=!0),$S(n,i,s.crossorigin);const o=document.createElement("source");let a;if(s.mime)a=s.mime;else if(i.startsWith("data:"))a=i.slice(5,i.indexOf(";"));else if(!i.startsWith("blob:")){const h=i.split("?")[0].slice(i.lastIndexOf(".")+1).toLowerCase();a=en.MIME_TYPES[h]||`video/${h}`}return o.src=i,a&&(o.type=a),new Promise(h=>{const u=async()=>{const d=new en({...s,resource:n});n.removeEventListener("canplay",u),t.data.preload&&await YS(n),h($a(d,e,i))};s.preload&&!s.autoPlay&&n.load(),n.addEventListener("canplay",u),n.appendChild(o)})},unload(i){i.destroy(!0)}},_d={extension:{type:lt.ResolveParser,name:"resolveTexture"},test:Ed.test,parse:i=>{var t;return{resolution:parseFloat(((t=Is.RETINA_PREFIX.exec(i))==null?void 0:t[1])??"1"),format:i.split(".").pop(),src:i}}},ZS={extension:{type:lt.ResolveParser,priority:-2,name:"resolveJson"},test:i=>Is.RETINA_PREFIX.test(i)&&i.endsWith(".json"),parse:_d.parse};class JS{constructor(){this._detections=[],this._initialized=!1,this.resolver=new Is,this.loader=new TS,this.cache=Vt,this._backgroundLoader=new hS(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var r,o;if(this._initialized){Bt("[Assets]AssetManager already initialized, did you load before calling this Assets.init()?");return}if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let a=t.manifest;typeof a=="string"&&(a=await this.load(a)),this.resolver.addManifest(a)}const e=((r=t.texturePreference)==null?void 0:r.resolution)??1,s=typeof e=="number"?[e]:e,n=await this._detectFormats({preferredFormats:(o=t.texturePreference)==null?void 0:o.format,skipDetections:t.skipDetections,detections:this._detections});this.resolver.prefer({params:{format:n,resolution:s}}),t.preferences&&this.setPreferences(t.preferences)}add(t){this.resolver.add(t)}async load(t,e){this._initialized||await this.init();const s=fr(t),n=Ge(t).map(a=>{if(typeof a!="string"){const l=this.resolver.getAlias(a);return l.some(c=>!this.resolver.hasKey(c))&&this.add(a),Array.isArray(l)?l[0]:l}return this.resolver.hasKey(a)||this.add({alias:a,src:a}),a}),r=this.resolver.resolve(n),o=await this._mapLoadToResolve(r,e);return s?o[n[0]]:o}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let s=!1;typeof t=="string"&&(s=!0,t=[t]);const n=this.resolver.resolveBundle(t),r={},o=Object.keys(n);let a=0,l=0;const c=()=>{e==null||e(++a/l)},h=o.map(u=>{const d=n[u],f=Object.values(d),m=[...new Set(f.flat())];return l+=m.length,this._mapLoadToResolve(d,c).then(y=>{r[u]=y})});return await Promise.all(h),s?r[t[0]]:r}async backgroundLoad(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),typeof t=="string"&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach(s=>{this._backgroundLoader.add(Object.values(s))})}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if(typeof t=="string")return Vt.get(t);const e={};for(let s=0;s<t.length;s++)e[s]=Vt.get(t[s]);return e}async _mapLoadToResolve(t,e){const s=[...new Set(Object.values(t))];this._backgroundLoader.active=!1;const n=await this.loader.load(s,e);this._backgroundLoader.active=!0;const r={};return s.forEach(o=>{const a=n[o.src],l=[o.src];o.alias&&l.push(...o.alias),l.forEach(c=>{r[c]=a}),Vt.set(l,a)}),r}async unload(t){this._initialized||await this.init();const e=Ge(t).map(n=>typeof n!="string"?n.src:n),s=this.resolver.resolve(e);await this._unloadFromResolved(s)}async unloadBundle(t){this._initialized||await this.init(),t=Ge(t);const e=this.resolver.resolveBundle(t),s=Object.keys(e).map(n=>this._unloadFromResolved(e[n]));await Promise.all(s)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach(s=>{Vt.remove(s.src)}),await this.loader.unload(e)}async _detectFormats(t){let e=[];t.preferredFormats&&(e=Array.isArray(t.preferredFormats)?t.preferredFormats:[t.preferredFormats]);for(const s of t.detections)t.skipDetections||await s.test()?e=await s.add(e):t.skipDetections||(e=await s.remove(e));return e=e.filter((s,n)=>e.indexOf(s)===n),e}get detections(){return this._detections}setPreferences(t){this.loader.parsers.forEach(e=>{e.config&&Object.keys(e.config).filter(s=>s in t).forEach(s=>{e.config[s]=t[s]})})}}const bt=new JS;ne.handleByList(lt.LoadParser,bt.loader.parsers).handleByList(lt.ResolveParser,bt.resolver.parsers).handleByList(lt.CacheParser,bt.cache.parsers).handleByList(lt.DetectionParser,bt.detections);ne.add(uS,fS,dS,SS,mS,gS,yS,bS,CS,LS,kS,Ed,KS,cS,lS,_d,ZS);const Nc={loader:lt.LoadParser,resolver:lt.ResolveParser,cache:lt.CacheParser,detection:lt.DetectionParser};ne.handle(lt.Asset,i=>{const t=i.ref;Object.entries(Nc).filter(([e])=>!!t[e]).forEach(([e,s])=>ne.add(Object.assign(t[e],{extension:t[e].extension??s})))},i=>{const t=i.ref;Object.keys(Nc).filter(e=>!!t[e]).forEach(e=>ne.remove(t[e]))});const bd={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},QS=["in vec2 vBlurTexCoords[%size%];","uniform sampler2D uTexture;","out vec4 finalColor;","void main(void)","{","    finalColor = vec4(0.0);","    %blur%","}"].join(`
`);function tT(i){const t=bd[i],e=t.length;let s=QS,n="";const r="finalColor += texture(uTexture, vBlurTexCoords[%index%]) * %value%;";let o;for(let a=0;a<i;a++){let l=r.replace("%index%",a.toString());o=a,a>=e&&(o=i-a-1),l=l.replace("%value%",t[o].toString()),n+=l,n+=`
`}return s=s.replace("%blur%",n),s=s.replace("%size%",i.toString()),s}const eT=`
    in vec2 aPosition;

    uniform float uStrength;

    out vec2 vBlurTexCoords[%size%];

    uniform vec4 uInputSize;
    uniform vec4 uOutputFrame;
    uniform vec4 uOutputTexture;

    vec4 filterVertexPosition( void )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;

    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

    vec2 filterTextureCoord( void )
    {
        return aPosition * (uOutputFrame.zw * uInputSize.zw);
    }

    void main(void)
    {
        gl_Position = filterVertexPosition();

        float pixelStrength = uInputSize.%dimension% * uStrength;

        vec2 textureCoord = filterTextureCoord();
        %blur%
    }`;function iT(i,t){const e=Math.ceil(i/2);let s=eT,n="",r;t?r="vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * pixelStrength, 0.0);":r="vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * pixelStrength);";for(let o=0;o<i;o++){let a=r.replace("%index%",o.toString());a=a.replace("%sampleIndex%",`${o-(e-1)}.0`),n+=a,n+=`
`}return s=s.replace("%blur%",n),s=s.replace("%size%",i.toString()),s=s.replace("%dimension%",t?"z":"w"),s}function sT(i,t){const e=iT(t,i),s=tT(t);return ni.from({vertex:e,fragment:s,name:`blur-${i?"horizontal":"vertical"}-pass-filter`})}var nT=`

struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

struct BlurUniforms {
  uStrength:f32,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uTexture: texture_2d<f32>;
@group(0) @binding(2) var uSampler : sampler;

@group(1) @binding(0) var<uniform> blurUniforms : BlurUniforms;


struct VSOutput {
    @builtin(position) position: vec4<f32>,
    %blur-struct%
  };

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;

    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);  
}

fn getSize() -> vec2<f32>
{
  return gfu.uGlobalFrame.zw;
}


@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>, 
) -> VSOutput {

  let filteredCord = filterTextureCoord(aPosition);

  let pixelStrength = gfu.uInputSize.%dimension% * blurUniforms.uStrength;

  return VSOutput(
   filterVertexPosition(aPosition),
    %blur-vertex-out%
  );
}

@fragment
fn mainFragment(
  @builtin(position) position: vec4<f32>,
  %blur-fragment-in%
) -> @location(0) vec4<f32> {

    var   finalColor = vec4(0.0);

    %blur-sampling%

    return finalColor;
}`;function rT(i,t){const e=bd[t],s=e.length,n=[],r=[],o=[];for(let u=0;u<t;u++){n[u]=`@location(${u}) offset${u}: vec2<f32>,`,i?r[u]=`filteredCord + vec2(${u-s+1} * pixelStrength, 0.0),`:r[u]=`filteredCord + vec2(0.0, ${u-s+1} * pixelStrength),`;const d=u<s?u:t-u-1,f=e[d].toString();o[u]=`finalColor += textureSample(uTexture, uSampler, offset${u}) * ${f};`}const a=n.join(`
`),l=r.join(`
`),c=o.join(`
`),h=nT.replace("%blur-struct%",a).replace("%blur-vertex-out%",l).replace("%blur-fragment-in%",a).replace("%blur-sampling%",c).replace("%dimension%",i?"z":"w");return Le.from({vertex:{source:h,entryPoint:"mainVertex"},fragment:{source:h,entryPoint:"mainFragment"}})}const xd=class Ad extends Hu{constructor(t){t={...Ad.defaultOptions,...t};const e=sT(t.horizontal,t.kernelSize),s=rT(t.horizontal,t.kernelSize);super({glProgram:e,gpuProgram:s,resources:{blurUniforms:{uStrength:{value:0,type:"f32"}}},...t}),this.horizontal=t.horizontal,this._quality=0,this.quality=t.quality,this.blur=t.strength,this._uniforms=this.resources.blurUniforms.uniforms}apply(t,e,s,n){if(this._uniforms.uStrength=this.strength/this.passes,this.passes===1)t.applyFilter(this,e,s,n);else{const r=Ss.getSameSizeTexture(e);let o=e,a=r;this._state.blend=!1;const l=t.renderer.type===on.WEBGPU;for(let c=0;c<this.passes-1;c++){t.applyFilter(this,o,a,c===0?!0:l);const h=a;a=o,o=h}this._state.blend=!0,t.applyFilter(this,o,s,n),Ss.returnTexture(r)}}get blur(){return this.strength}set blur(t){this.padding=1+Math.abs(t)*2,this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}};xd.defaultOptions={strength:8,quality:4,kernelSize:5};let ko=xd;class Cd extends Hu{constructor(...t){let e=t[0]??{};typeof e=="number"&&(dt(Rt,"BlurFilter constructor params are now options object. See params: { strength, quality, resolution, kernelSize }"),e={strength:e},t[1]!==void 0&&(e.quality=t[1]),t[2]!==void 0&&(e.resolution=t[2]||"inherit"),t[3]!==void 0&&(e.kernelSize=t[3])),e={...ko.defaultOptions,...e};const{strength:s,strengthX:n,strengthY:r,quality:o,...a}=e;super({...a,compatibleRenderers:on.BOTH,resources:{}}),this._repeatEdgePixels=!1,this.blurXFilter=new ko({horizontal:!0,...e}),this.blurYFilter=new ko({horizontal:!1,...e}),this.quality=o,this.strengthX=n??s,this.strengthY=r??s,this.repeatEdgePixels=!1}apply(t,e,s,n){const r=Math.abs(this.blurXFilter.strength),o=Math.abs(this.blurYFilter.strength);if(r&&o){const a=Ss.getSameSizeTexture(e);this.blurXFilter.blendMode="normal",this.blurXFilter.apply(t,e,a,!0),this.blurYFilter.blendMode=this.blendMode,this.blurYFilter.apply(t,a,s,n),Ss.returnTexture(a)}else o?(this.blurYFilter.blendMode=this.blendMode,this.blurYFilter.apply(t,e,s,n)):(this.blurXFilter.blendMode=this.blendMode,this.blurXFilter.apply(t,e,s,n))}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=Math.max(Math.abs(this.blurXFilter.blur),Math.abs(this.blurYFilter.blur))*2}get strength(){if(this.strengthX!==this.strengthY)throw new Error("BlurFilter's strengthX and strengthY are different");return this.strengthX}set strength(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get strengthX(){return this.blurXFilter.blur}set strengthX(t){this.blurXFilter.blur=t,this.updatePadding()}get strengthY(){return this.blurYFilter.blur}set strengthY(t){this.blurYFilter.blur=t,this.updatePadding()}get blur(){return dt("8.3.0","BlurFilter.blur is deprecated, please use BlurFilter.strength instead."),this.strength}set blur(t){dt("8.3.0","BlurFilter.blur is deprecated, please use BlurFilter.strength instead."),this.strength=t}get blurX(){return dt("8.3.0","BlurFilter.blurX is deprecated, please use BlurFilter.strengthX instead."),this.strengthX}set blurX(t){dt("8.3.0","BlurFilter.blurX is deprecated, please use BlurFilter.strengthX instead."),this.strengthX=t}get blurY(){return dt("8.3.0","BlurFilter.blurY is deprecated, please use BlurFilter.strengthY instead."),this.strengthY}set blurY(t){dt("8.3.0","BlurFilter.blurY is deprecated, please use BlurFilter.strengthY instead."),this.strengthY=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}}Cd.defaultOptions={strength:8,quality:4,kernelSize:5};function Dc(i,t,e,s,n,r,o,a){const l=o-e,c=a-s,h=n-e,u=r-s,d=i-e,f=t-s,m=l*l+c*c,y=l*h+c*u,g=l*d+c*f,E=h*h+u*u,T=h*d+u*f,_=1/(m*E-y*y),b=(E*g-y*T)*_,A=(m*T-y*g)*_;return b>=0&&A>=0&&b+A<1}class ft extends An{constructor(t){t instanceof Re&&(t={context:t});const{context:e,roundPixels:s,...n}=t||{};super({label:"Graphics",...n}),this.renderPipeId="graphics",e?this._context=e:this._context=this._ownedContext=new Re,this._context.on("update",this.onViewUpdate,this),this.didViewUpdate=!0,this.allowChildren=!1,this.roundPixels=s??!1}set context(t){t!==this._context&&(this._context.off("update",this.onViewUpdate,this),this._context=t,this._context.on("update",this.onViewUpdate,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(t){return this._context.containsPoint(t)}destroy(t){this._ownedContext&&!t?this._ownedContext.destroy(t):(t===!0||(t==null?void 0:t.context)===!0)&&this._context.destroy(t),this._ownedContext=null,this._context=null,super.destroy(t)}_callContextMethod(t,e){return this.context[t](...e),this}setFillStyle(...t){return this._callContextMethod("setFillStyle",t)}setStrokeStyle(...t){return this._callContextMethod("setStrokeStyle",t)}fill(...t){return this._callContextMethod("fill",t)}stroke(...t){return this._callContextMethod("stroke",t)}texture(...t){return this._callContextMethod("texture",t)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...t){return this._callContextMethod("arc",t)}arcTo(...t){return this._callContextMethod("arcTo",t)}arcToSvg(...t){return this._callContextMethod("arcToSvg",t)}bezierCurveTo(...t){return this._callContextMethod("bezierCurveTo",t)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...t){return this._callContextMethod("ellipse",t)}circle(...t){return this._callContextMethod("circle",t)}path(...t){return this._callContextMethod("path",t)}lineTo(...t){return this._callContextMethod("lineTo",t)}moveTo(...t){return this._callContextMethod("moveTo",t)}quadraticCurveTo(...t){return this._callContextMethod("quadraticCurveTo",t)}rect(...t){return this._callContextMethod("rect",t)}roundRect(...t){return this._callContextMethod("roundRect",t)}poly(...t){return this._callContextMethod("poly",t)}regularPoly(...t){return this._callContextMethod("regularPoly",t)}roundPoly(...t){return this._callContextMethod("roundPoly",t)}roundShape(...t){return this._callContextMethod("roundShape",t)}filletRect(...t){return this._callContextMethod("filletRect",t)}chamferRect(...t){return this._callContextMethod("chamferRect",t)}star(...t){return this._callContextMethod("star",t)}svg(...t){return this._callContextMethod("svg",t)}restore(...t){return this._callContextMethod("restore",t)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...t){return this._callContextMethod("rotate",t)}scaleTransform(...t){return this._callContextMethod("scale",t)}setTransform(...t){return this._callContextMethod("setTransform",t)}transform(...t){return this._callContextMethod("transform",t)}translateTransform(...t){return this._callContextMethod("translate",t)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(t){this._context.fillStyle=t}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(t){this._context.strokeStyle=t}clone(t=!1){return t?new ft(this._context.clone()):(this._ownedContext=null,new ft(this._context))}lineStyle(t,e,s){dt(Rt,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");const n={};return t&&(n.width=t),e&&(n.color=e),s&&(n.alpha=s),this.context.strokeStyle=n,this}beginFill(t,e){dt(Rt,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");const s={};return t!==void 0&&(s.color=t),e!==void 0&&(s.alpha=e),this.context.fillStyle=s,this}endFill(){dt(Rt,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();const t=this.context.strokeStyle;return(t.width!==Re.defaultStrokeStyle.width||t.color!==Re.defaultStrokeStyle.color||t.alpha!==Re.defaultStrokeStyle.alpha)&&this.context.stroke(),this}drawCircle(...t){return dt(Rt,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",t)}drawEllipse(...t){return dt(Rt,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",t)}drawPolygon(...t){return dt(Rt,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",t)}drawRect(...t){return dt(Rt,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",t)}drawRoundedRect(...t){return dt(Rt,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",t)}drawStar(...t){return dt(Rt,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",t)}}const Rd=class wd extends xe{constructor(...t){let e=t[0]??{};e instanceof Float32Array&&(dt(Rt,"use new MeshGeometry({ positions, uvs, indices }) instead"),e={positions:e,uvs:t[1],indices:t[2]}),e={...wd.defaultOptions,...e};const s=e.positions||new Float32Array([0,0,1,0,1,1,0,1]);let n=e.uvs;n||(e.positions?n=new Float32Array(s.length):n=new Float32Array([0,0,1,0,1,1,0,1]));const r=e.indices||new Uint32Array([0,1,2,0,2,3]),o=e.shrinkBuffersToFit,a=new Mi({data:s,label:"attribute-mesh-positions",shrinkToFit:o,usage:Jt.VERTEX|Jt.COPY_DST}),l=new Mi({data:n,label:"attribute-mesh-uvs",shrinkToFit:o,usage:Jt.VERTEX|Jt.COPY_DST}),c=new Mi({data:r,label:"index-mesh-buffer",shrinkToFit:o,usage:Jt.INDEX|Jt.COPY_DST});super({attributes:{aPosition:{buffer:a,format:"float32x2",stride:2*4,offset:0},aUV:{buffer:l,format:"float32x2",stride:2*4,offset:0}},indexBuffer:c,topology:e.topology}),this.batchMode="auto"}get positions(){return this.attributes.aPosition.buffer.data}set positions(t){this.attributes.aPosition.buffer.data=t}get uvs(){return this.attributes.aUV.buffer.data}set uvs(t){this.attributes.aUV.buffer.data=t}get indices(){return this.indexBuffer.data}set indices(t){this.indexBuffer.data=t}};Rd.defaultOptions={topology:"triangle-list",shrinkBuffersToFit:!1};let oT=Rd;class Oi extends An{constructor(...t){let e=t[0];e instanceof xe&&(dt(Rt,"Mesh: use new Mesh({ geometry, shader }) instead"),e={geometry:e,shader:t[1]},t[3]&&(dt(Rt,"Mesh: drawMode argument has been removed, use geometry.topology instead"),e.geometry.topology=t[3]));const{geometry:s,shader:n,texture:r,roundPixels:o,state:a,...l}=e;super({label:"Mesh",...l}),this.renderPipeId="mesh",this._shader=null,this.allowChildren=!1,this.shader=n??null,this.texture=r??(n==null?void 0:n.texture)??_t.WHITE,this.state=a??pr.for2d(),this._geometry=s,this._geometry.on("update",this.onViewUpdate,this),this.roundPixels=o??!1}get material(){return dt(Rt,"mesh.material property has been removed, use mesh.shader instead"),this._shader}set shader(t){this._shader!==t&&(this._shader=t,this.onViewUpdate())}get shader(){return this._shader}set geometry(t){var e;this._geometry!==t&&((e=this._geometry)==null||e.off("update",this.onViewUpdate,this),t.on("update",this.onViewUpdate,this),this._geometry=t,this.onViewUpdate())}get geometry(){return this._geometry}set texture(t){t||(t=_t.EMPTY);const e=this._texture;e!==t&&(e&&e.dynamic&&e.off("update",this.onViewUpdate,this),t.dynamic&&t.on("update",this.onViewUpdate,this),this.shader&&(this.shader.texture=t),this._texture=t,this.onViewUpdate())}get texture(){return this._texture}get batched(){return this._shader||this.state.data&12?!1:this._geometry instanceof oT?this._geometry.batchMode==="auto"?this._geometry.positions.length/2<=100:this._geometry.batchMode==="batch":!1}get bounds(){return this._geometry.bounds}updateBounds(){this._bounds=this._geometry.bounds}containsPoint(t){const{x:e,y:s}=t;if(!this.bounds.containsPoint(e,s))return!1;const n=this.geometry.getBuffer("aPosition").data,r=this.geometry.topology==="triangle-strip"?3:1;if(this.geometry.getIndex()){const o=this.geometry.getIndex().data,a=o.length;for(let l=0;l+2<a;l+=r){const c=o[l]*2,h=o[l+1]*2,u=o[l+2]*2;if(Dc(e,s,n[c],n[c+1],n[h],n[h+1],n[u],n[u+1]))return!0}}else{const o=n.length/2;for(let a=0;a+2<o;a+=r){const l=a*2,c=(a+1)*2,h=(a+2)*2;if(Dc(e,s,n[l],n[l+1],n[c],n[c+1],n[h],n[h+1]))return!0}}return!1}destroy(t){var s;if(super.destroy(t),typeof t=="boolean"?t:t==null?void 0:t.texture){const n=typeof t=="boolean"?t:t==null?void 0:t.textureSource;this._texture.destroy(n)}(s=this._geometry)==null||s.off("update",this.onViewUpdate,this),this._texture=null,this._geometry=null,this._shader=null,this._gpuData=null}}class Id extends An{constructor(t,e){const{text:s,resolution:n,style:r,anchor:o,width:a,height:l,roundPixels:c,...h}=t;super({...h}),this.batched=!0,this._resolution=null,this._autoResolution=!0,this._didTextUpdate=!0,this._styleClass=e,this.text=s??"",this.style=r,this.resolution=n??null,this.allowChildren=!1,this._anchor=new re({_onUpdate:()=>{this.onViewUpdate()}}),o&&(this.anchor=o),this.roundPixels=c??!1,a!==void 0&&(this.width=a),l!==void 0&&(this.height=l)}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}set text(t){t=t.toString(),this._text!==t&&(this._text=t,this.onViewUpdate())}get text(){return this._text}set resolution(t){this._autoResolution=t===null,this._resolution=t,this.onViewUpdate()}get resolution(){return this._resolution}get style(){return this._style}set style(t){var e;t||(t={}),(e=this._style)==null||e.off("update",this.onViewUpdate,this),t instanceof this._styleClass?this._style=t:this._style=new this._styleClass(t),this._style.on("update",this.onViewUpdate,this),this.onViewUpdate()}get width(){return Math.abs(this.scale.x)*this.bounds.width}set width(t){this._setWidth(t,this.bounds.width)}get height(){return Math.abs(this.scale.y)*this.bounds.height}set height(t){this._setHeight(t,this.bounds.height)}getSize(t){return t||(t={}),t.width=Math.abs(this.scale.x)*this.bounds.width,t.height=Math.abs(this.scale.y)*this.bounds.height,t}setSize(t,e){typeof t=="object"?(e=t.height??t.width,t=t.width):e??(e=t),t!==void 0&&this._setWidth(t,this.bounds.width),e!==void 0&&this._setHeight(e,this.bounds.height)}containsPoint(t){const e=this.bounds.width,s=this.bounds.height,n=-e*this.anchor.x;let r=0;return t.x>=n&&t.x<=n+e&&(r=-s*this.anchor.y,t.y>=r&&t.y<=r+s)}onViewUpdate(){this.didViewUpdate||(this._didTextUpdate=!0),super.onViewUpdate()}destroy(t=!1){super.destroy(t),this.owner=null,this._bounds=null,this._anchor=null,(typeof t=="boolean"?t:t!=null&&t.style)&&this._style.destroy(t),this._style=null,this._text=null}get styleKey(){return`${this._text}:${this._style.styleKey}:${this._resolution}`}}function Md(i,t){let e=i[0]??{};return(typeof e=="string"||i[1])&&(dt(Rt,`use new ${t}({ text: "hi!", style }) instead`),e={text:e,style:i[1]}),e}let Li=null,hi=null;function aT(i,t){Li||(Li=Wt.get().createCanvas(256,128),hi=Li.getContext("2d",{willReadFrequently:!0}),hi.globalCompositeOperation="copy",hi.globalAlpha=1),(Li.width<i||Li.height<t)&&(Li.width=ms(i),Li.height=ms(t))}function kc(i,t,e){for(let s=0,n=4*e*t;s<t;++s,n+=4)if(i[n+3]!==0)return!1;return!0}function Hc(i,t,e,s,n){const r=4*t;for(let o=s,a=s*r+4*e;o<=n;++o,a+=r)if(i[a+3]!==0)return!1;return!0}function lT(...i){let t=i[0];t.canvas||(t={canvas:i[0],resolution:i[1]});const{canvas:e}=t,s=Math.min(t.resolution??1,1),n=t.width??e.width,r=t.height??e.height;let o=t.output;if(aT(n,r),!hi)throw new TypeError("Failed to get canvas 2D context");hi.drawImage(e,0,0,n,r,0,0,n*s,r*s);const l=hi.getImageData(0,0,n,r).data;let c=0,h=0,u=n-1,d=r-1;for(;h<r&&kc(l,n,h);)++h;if(h===r)return Ot.EMPTY;for(;kc(l,n,d);)--d;for(;Hc(l,n,c,h,d);)++c;for(;Hc(l,n,u,h,d);)--u;return++u,++d,hi.globalCompositeOperation="source-over",hi.strokeRect(c,h,u-c,d-h),hi.globalCompositeOperation="copy",o??(o=new Ot),o.set(c/s,h/s,(u-c)/s,(d-h)/s),o}const Fc=new Ot;class cT{getCanvasAndContext(t){const{text:e,style:s,resolution:n=1}=t,r=s._getFinalPadding(),o=de.measureText(e||" ",s),a=Math.ceil(Math.ceil(Math.max(1,o.width)+r*2)*n),l=Math.ceil(Math.ceil(Math.max(1,o.height)+r*2)*n),c=un.getOptimalCanvasAndContext(a,l);this._renderTextToCanvas(e,s,r,n,c);const h=s.trim?lT({canvas:c.canvas,width:a,height:l,resolution:1,output:Fc}):Fc.set(0,0,a,l);return{canvasAndContext:c,frame:h}}returnCanvasAndContext(t){un.returnCanvasAndContext(t)}_renderTextToCanvas(t,e,s,n,r){var _,b,A,C;const{canvas:o,context:a}=r,l=mr(e),c=de.measureText(t||" ",e),h=c.lines,u=c.lineHeight,d=c.lineWidths,f=c.maxLineWidth,m=c.fontProperties,y=o.height;if(a.resetTransform(),a.scale(n,n),a.textBaseline=e.textBaseline,(_=e._stroke)!=null&&_.width){const R=e._stroke;a.lineWidth=R.width,a.miterLimit=R.miterLimit,a.lineJoin=R.join,a.lineCap=R.cap}a.font=l;let g,E;const T=e.dropShadow?2:1;for(let R=0;R<T;++R){const O=e.dropShadow&&R===0,M=O?Math.ceil(Math.max(1,y)+s*2):0,w=M*n;if(O){a.fillStyle="black",a.strokeStyle="black";const D=e.dropShadow,N=D.color,U=D.alpha;a.shadowColor=Kt.shared.setValue(N).setAlpha(U).toRgbaString();const v=D.blur*n,P=D.distance*n;a.shadowBlur=v,a.shadowOffsetX=Math.cos(D.angle)*P,a.shadowOffsetY=Math.sin(D.angle)*P+w}else{if(a.fillStyle=e._fill?Sr(e._fill,a,c,s*2):null,(b=e._stroke)!=null&&b.width){const D=e._stroke.width*.5+s*2;a.strokeStyle=Sr(e._stroke,a,c,D)}a.shadowColor="black"}let I=(u-m.fontSize)/2;u-m.fontSize<0&&(I=0);const L=((A=e._stroke)==null?void 0:A.width)??0;for(let D=0;D<h.length;D++)g=L/2,E=L/2+D*u+m.ascent+I,e.align==="right"?g+=f-d[D]:e.align==="center"&&(g+=(f-d[D])/2),(C=e._stroke)!=null&&C.width&&this._drawLetterSpacing(h[D],e,r,g+s,E+s-M,!0),e._fill!==void 0&&this._drawLetterSpacing(h[D],e,r,g+s,E+s-M)}}_drawLetterSpacing(t,e,s,n,r,o=!1){const{context:a}=s,l=e.letterSpacing;let c=!1;if(de.experimentalLetterSpacingSupported&&(de.experimentalLetterSpacing?(a.letterSpacing=`${l}px`,a.textLetterSpacing=`${l}px`,c=!0):(a.letterSpacing="0px",a.textLetterSpacing="0px")),l===0||c){o?a.strokeText(t,n,r):a.fillText(t,n,r);return}let h=n;const u=de.graphemeSegmenter(t);let d=a.measureText(t).width,f=0;for(let m=0;m<u.length;++m){const y=u[m];o?a.strokeText(y,h,r):a.fillText(y,h,r);let g="";for(let E=m+1;E<u.length;++E)g+=u[E];f=a.measureText(g).width,h+=d-f+l,d=f}}}const Bc=new cT;let Ve=class extends Id{constructor(...t){const e=Md(t,"Text");super(e,Es),this.renderPipeId="text",e.textureStyle&&(this.textureStyle=e.textureStyle instanceof gs?e.textureStyle:new gs(e.textureStyle))}updateBounds(){const t=this._bounds,e=this._anchor;let s=0,n=0;if(this._style.trim){const{frame:r,canvasAndContext:o}=Bc.getCanvasAndContext({text:this.text,style:this._style,resolution:1});Bc.returnCanvasAndContext(o),s=r.width,n=r.height}else{const r=de.measureText(this._text,this._style);s=r.width,n=r.height}t.minX=-e._x*s,t.maxX=t.minX+s,t.minY=-e._y*n,t.maxY=t.minY+n}};class Od extends Id{constructor(...t){var e;const s=Md(t,"BitmapText");s.style??(s.style=s.style||{}),(e=s.style).fill??(e.fill=16777215),super(s,Es),this.renderPipeId="bitmapText"}updateBounds(){const t=this._bounds,e=this._anchor,s=pa.measureText(this.text,this._style),n=s.scale,r=s.offsetY*n;let o=s.width*n,a=s.height*n;const l=this._style._stroke;l&&(o+=l.width,a+=l.width),t.minX=-e._x*o,t.maxX=t.minX+o,t.minY=-e._y*(a+r),t.maxY=t.minY+a}set resolution(t){t!==null&&Bt("[BitmapText] dynamically updating the resolution is not supported. Resolution should be managed by the BitmapFont.")}get resolution(){return this._resolution}}function hT(i,t){for(const e in i.attributes){const s=i.attributes[e],n=t[e];n?(s.format??(s.format=n.format),s.offset??(s.offset=n.offset),s.instance??(s.instance=n.instance)):Bt(`Attribute ${e} is not present in the shader, but is present in the geometry. Unable to infer attribute details.`)}uT(i)}function uT(i){const{buffers:t,attributes:e}=i,s={},n={};for(const r in t){const o=t[r];s[o.uid]=0,n[o.uid]=0}for(const r in e){const o=e[r];s[o.buffer.uid]+=sa(o.format).stride}for(const r in e){const o=e[r];o.stride??(o.stride=s[o.buffer.uid]),o.start??(o.start=n[o.buffer.uid]),n[o.buffer.uid]+=sa(o.format).stride}}class Ya extends _t{static create(t){return new Ya({source:new Ne(t)})}resize(t,e,s){return this.source.resize(t,e,s),this}}class dT extends An{constructor(t){typeof t=="function"&&(t={render:t});const{render:e,...s}=t;super({label:"RenderContainer",...s}),this.renderPipeId="customRender",this.batched=!1,e&&(this.render=e),this.containsPoint=t.containsPoint??(()=>!1),this.addBounds=t.addBounds??(()=>!1)}updateBounds(){this._bounds.clear(),this.addBounds(this._bounds)}render(t){}}ne.add(lm,cm);const mt=class mt{static createSelectedHitCircle(){return new ft().setStrokeStyle({width:12,color:15575808,alpha:1,cap:"round",alignment:1}).arc(0,0,59,0,Math.PI*2).stroke()}static createHitCircle(){const t=new ut,e=new ft().circle(0,0,59).fill(16777215),s=new ft().circle(0,0,47).fill(10132122),n=new ft().circle(0,0,35).fill(3092271);return t.addChild(e),t.addChild(s),t.addChild(n),t}static createHitCircleOverlay(){return new ft().setStrokeStyle({width:4,color:16777215,alpha:1,cap:"round",alignment:1}).arc(0,0,67,0,Math.PI*2).stroke()}static createApproachCircle(){return new ft().setStrokeStyle({width:4,color:16777215,alpha:1,cap:"round",alignment:0}).circle(0,0,59).stroke()}static createSliderBall(){const t=new ft().setStrokeStyle({width:15,color:16777215,alpha:1,cap:"round",alignment:1}).arc(0,0,59,0,Math.PI*2).stroke(),e=new ut;return e.addChild(t),e}static async createSliderBallBG(){const e=document.createElement("canvas");e.width=59*2,e.height=59*2;const s=e.getContext("2d"),n=s.createLinearGradient(0,0,0,59*2);return n.addColorStop(0,"white"),n.addColorStop(1,"rgb(74, 74, 74)"),s.fillStyle=n,s.fillRect(0,0,59*2,59*2),await bt.load(e.toDataURL())}static createSliderFollowCircle(){return new ft().setStrokeStyle({width:8,color:16777215,alpha:1,cap:"round",alignment:1}).circle(0,0,128).fill({color:16777215,alpha:.3}).stroke()}static createGlow(){return new ft().circle(0,0,59).fill(16777215)}static async createTexture(t){let e=null;switch(t){case"SELECTED_HIT_CIRCLE":e=mt.createSelectedHitCircle();break;case"HIT_CIRCLE":e=mt.createHitCircle();break;case"HIT_CIRCLE_OVERLAY":e=mt.createHitCircleOverlay();break;case"SLIDER_BALL":e=mt.createSliderBall();break;case"SLIDER_BALL_BG":return await mt.createSliderBallBG();case"SLIDER_FOLLOW_CIRCLE":e=mt.createSliderFollowCircle();break;case"GLOW":e=mt.createGlow()}if(!e)return null;const{width:s,height:n}=e,r=Ya.create({width:s,height:n,antialias:!0});return p.APP.renderer.render({container:e,target:r,clearColor:new Kt([0,0,0,0]),transform:new At(1,0,0,1,s/2,n/2)}),e.destroy(!0),r}static async generateDefaultTextures(){await es(t=>{t(async()=>mt.SELECTED={texture:await bt.load(await qt.getDefaults("base64s","hitcircleselect@2x","legacy")),isHD:!0}),t(async()=>mt.SELECTED_ARGON={texture:await mt.createTexture("SELECTED_HIT_CIRCLE"),isHD:!1}),t(async()=>mt.FOLLOWPOINT={texture:await bt.load("/static/followpoint@2x.png"),isHD:!0}),t(async()=>mt.ARGON.HIT_CIRCLE={texture:await mt.createTexture("HIT_CIRCLE"),isHD:!1}),t(async()=>mt.ARGON.HIT_CIRCLE_OVERLAY={texture:await mt.createTexture("HIT_CIRCLE_OVERLAY"),isHD:!1}),t(async()=>{const[s,n,r]=await Promise.all([mt.createTexture("SLIDER_BALL"),bt.load("/static/arrow.png"),mt.createTexture("SLIDER_BALL_BG")]);mt.ARGON.SLIDER_B={ring:{texture:s,isHD:!1},arrow:{texture:n,isHD:!1},gradient:{texture:r,isHD:!1}}}),t(async()=>{const[s,n]=await Promise.all([qt.getDefaults("base64s","reversearrow@2x","argon").then(r=>bt.load(r)),qt.getDefaults("base64s","repeat-edge-piece","argon").then(r=>bt.load(r))]);mt.ARGON.REVERSE_ARROW={arrow:{texture:s,isHD:!0},ring:{texture:n,isHD:!1}}}),t(async()=>mt.ARGON.SLIDER_FOLLOW_CIRCLE={texture:await mt.createTexture("SLIDER_FOLLOW_CIRCLE"),isHD:!1}),t(async()=>mt.ARGON.APPROACH_CIRCLE={texture:await bt.load(await qt.getDefaults("base64s","approachcircle@2x","argon")),isHD:!0}),t(async()=>{mt.ARGON.DEFAULTS=await Promise.all(Array.from({length:10}).map(async(s,n)=>({texture:await bt.load(await qt.getDefaults("base64s",`default-${n}@2x`,"argon")),isHD:!0})))}),t(async()=>mt.ARGON.GLOW={texture:await mt.createTexture("GLOW"),isHD:!1});const e=["HIT_CIRCLE","HIT_CIRCLE_OVERLAY","SLIDER_B","SLIDER_FOLLOW_CIRCLE","REVERSE_ARROW","APPROACH_CIRCLE"];for(const s of e)t(()=>mt.updateTextureFor(s));t(async()=>{const s=await Promise.all(Array.from({length:10}).map(async(n,r)=>({base64:await qt.getDefaults("base64s",`default-${r}@2x`,"legacy"),isHD:!0})));await mt.updateNumberTextures(s)}),t(async()=>mt.BALL_SPEC={texture:await bt.load("static/sliderb-spec@2x.png"),isHD:!0}),t(async()=>mt.BALL_ND={texture:await bt.load("static/sliderb-nd@2x.png"),isHD:!0})})}static async updateNumberTextures(t,e){if(e){mt.CUSTOM[e].DEFAULTS=[];for(const[s,n]of t.entries()){const{base64:r,isHD:o}=n;mt.CUSTOM[e].DEFAULTS.push({texture:r?await bt.load(r):await bt.load(`static/legacy/default-${s}@2x.png`),isHD:r?o:!1})}return}mt.LEGACY.DEFAULTS=[];for(const[s,n]of t.entries()){const{base64:r,isHD:o}=n,a=r?await bt.load(r):await bt.load(`static/legacy/default-${s}@2x.png`);mt.LEGACY.DEFAULTS.push({texture:a,isHD:r?o:!1})}}static async updateTextureFor(t,e,s,n){n&&!mt.CUSTOM[n]&&(mt.CUSTOM[n]={DEFAULTS:null,HIT_CIRCLE:null,HIT_CIRCLE_OVERLAY:null,SLIDER_B:null,REVERSE_ARROW:null,SLIDER_FOLLOW_CIRCLE:null,APPROACH_CIRCLE:null});const r=n?mt.CUSTOM[n]:mt.LEGACY;switch(t){case"HIT_CIRCLE":r.HIT_CIRCLE={texture:await bt.load(e??await qt.getDefaults("base64s","hitcircle@2x","legacy")),isHD:e?s:!0};break;case"HIT_CIRCLE_OVERLAY":r.HIT_CIRCLE_OVERLAY={texture:await bt.load(e??await qt.getDefaults("base64s","hitcircleoverlay@2x","legacy")),isHD:e?s:!0};break;case"SLIDER_B":r.SLIDER_B={ring:{texture:await bt.load(e??await qt.getDefaults("base64s","sliderb0@2x","legacy")),isHD:e?s:!0},arrow:{texture:await bt.load("static/empty.png"),isHD:!1},gradient:{texture:await bt.load("static/empty.png"),isHD:!1}};break;case"REVERSE_ARROW":r.REVERSE_ARROW={arrow:{texture:await bt.load(e??await qt.getDefaults("base64s","reversearrow@2x","legacy")),isHD:e?s:!0},ring:{texture:await bt.load("static/empty.png"),isHD:!1}};break;case"SLIDER_FOLLOW_CIRCLE":r.SLIDER_FOLLOW_CIRCLE={texture:await bt.load(e??await qt.getDefaults("base64s","sliderfollowcircle@2x","legacy")),isHD:e?s:!0};break;case"APPROACH_CIRCLE":r.APPROACH_CIRCLE={texture:await bt.load(e??await qt.getDefaults("base64s","approachcircle@2x","legacy")),isHD:e?s:!0};break}}};S(mt,"SELECTED"),S(mt,"SELECTED_ARGON"),S(mt,"FOLLOWPOINT"),S(mt,"ARGON",{DEFAULTS:null,HIT_CIRCLE:null,HIT_CIRCLE_OVERLAY:null,SLIDER_B:null,REVERSE_ARROW:null,SLIDER_FOLLOW_CIRCLE:null,APPROACH_CIRCLE:null,GLOW:null}),S(mt,"LEGACY",{DEFAULTS:null,HIT_CIRCLE:null,HIT_CIRCLE_OVERLAY:null,SLIDER_B:null,REVERSE_ARROW:null,SLIDER_FOLLOW_CIRCLE:null,APPROACH_CIRCLE:null}),S(mt,"CUSTOM",{}),S(mt,"SLIDER_TEXTURE");let st=mt;class fT{constructor(){S(this,"isDragging",!1);S(this,"obj");S(this,"graphics");S(this,"dragWindow");S(this,"startTimestamp");S(this,"endTimestamp");S(this,"isObjectSelecting",!1);S(this,"currentX",null);this.obj=new ut,this.obj.eventMode="static",this.graphics=new ft().rect(0,0,Y.WIDTH,Y.HEIGHT).fill({color:16777215,alpha:.01}),this.graphics.zIndex=-1,this.dragWindow=new ft().rect(0,0,0,0),this.dragWindow.zIndex=-1,this.obj.addChild(this.graphics,this.dragWindow),this.obj.on("mousedown",t=>{if(!p.BEATMAP_FILE||this.isObjectSelecting)return;const{x:e,y:s}=this.obj.toLocal(t.global),n=Y.WIDTH/2,r=p.BEATMAP_FILE.audioNode.getCurrentTime();this.startTimestamp=r-(n-e)/Y.ZOOM_DISTANCE*500,this.isDragging=!0}),this.obj.on("mousemove",t=>this.handleDraggingEvent(t)),this.obj.on("wheel",t=>this.handleDraggingEvent(t)),this.obj.on("mouseup",t=>this.handleEndEvent(t)),this.obj.on("touchstart",t=>this.handleEndEvent(t)),this.obj.on("mouseleave",t=>this.handleLeaveEvent(t))}checkObjectsInWindow(){const t=[];if(this.startTimestamp&&this.endTimestamp){const e=p.BEATMAP_FILE.beatmapRenderData.objectsController.objectsList,s=(r,o)=>{let a=this.startTimestamp,l=this.endTimestamp;return a>l&&(l=a,a=this.endTimestamp),r.obj.endTime<a?-1:r.obj.time>l?1:0},n=Qi(e,null,s);if(n!==-1){let r=n-1,o=n+1;for(;r>=0&&s(e[r])===0;)t.push(e[r]),r--;for(t.reverse(),t.push(e[n]);o<=e.length-1&&s(e[o])===0;)t.push(e[o]),o++}}this.isObjectSelecting||(p.SELECTED=t.map(e=>e.obj.time))}clearAll(){this.obj.removeChild(this.graphics),this.obj.removeChild(this.dragWindow),this.obj.removeChildren().forEach(e=>{e.destroy()}),this.obj.addChild(this.graphics,this.dragWindow)}handleDraggingEvent(t){if(!this.isDragging)return;const{x:e,y:s}=this.obj.toLocal(t.global),n=Y.WIDTH/2,r=p.BEATMAP_FILE.audioNode.getCurrentTime();this.endTimestamp=r-(n-e)/Y.ZOOM_DISTANCE*500,this.currentX=e,this.checkObjectsInWindow()}handleEndEvent(t){this.checkObjectsInWindow(),this.startTimestamp=null,this.endTimestamp=null,this.isObjectSelecting=!1,this.isDragging=!1,this.currentX=-1}handleLeaveEvent(t){this.isDragging&&(this.checkObjectsInWindow(),this.startTimestamp=null,this.endTimestamp=null,this.isObjectSelecting=!1,this.isDragging=!1,this.currentX=-1)}resize(){this.graphics.clear().rect(0,0,Y.WIDTH,Y.HEIGHT).fill({color:16777215,alpha:.01})}draw(t){if(!this.startTimestamp||!this.endTimestamp){this.dragWindow.clear();return}const e=Y.WIDTH/2;this.isDragging&&this.currentX&&(this.endTimestamp=t-(e-this.currentX)/Y.ZOOM_DISTANCE*500,this.checkObjectsInWindow());let s=this.startTimestamp,n=this.endTimestamp;s>n&&(n=s,s=this.endTimestamp);const r=t-s,o=t-n,a=Math.max(e-r/500*Y.ZOOM_DISTANCE,0),l=e-o/500*Y.ZOOM_DISTANCE;this.dragWindow.clear().rect(a,0,l-a,Y.HEIGHT).fill({color:16777215,alpha:.2})}}const pT={message:"/static/info.svg",warning:"/static/alert-triangle.svg",error:"/static/badge-alert.svg"};class di{constructor({message:t,autoTimeout:e=!0,type:s="message"}){S(this,"timeout");S(this,"dialog");S(this,"button");S(this,"autoTimeout",!0);const n=document.createElement("div");n.classList.add("noti",s);const r=document.createElement("img");r.src=pT[s],r.width=24,r.height=24;const o=document.createElement("div");o.classList.add("notiContent"),o.textContent=t;const a=document.createElement("button");a.classList.add("notiDismiss");const l=document.createElement("img");l.src="/static/close.png",l.width=24,l.height=24,a.append(l),n.append(r,o,a),this.dialog=n,this.button=a,e!==void 0&&(this.autoTimeout=e)}notify(){document.querySelector(".notiContainer").append(this.dialog),this.button.blur(),this.dialog.classList.remove("animationOut"),this.dialog.classList.add("animationIn");const t=()=>{this.dialog.classList.remove("animationIn"),this.dialog.classList.add("animationOut"),this.dialog.onanimationend=()=>{document.querySelector(".notiContainer").removeChild(this.dialog)}};this.timeout=setTimeout(this.autoTimeout?t:()=>{},2e3),this.button.addEventListener("click",()=>{clearTimeout(this.timeout),t()})}}var Ae=Object.freeze({Linear:Object.freeze({None:function(i){return i},In:function(i){return this.None(i)},Out:function(i){return this.None(i)},InOut:function(i){return this.None(i)}}),Quadratic:Object.freeze({In:function(i){return i*i},Out:function(i){return i*(2-i)},InOut:function(i){return(i*=2)<1?.5*i*i:-.5*(--i*(i-2)-1)}}),Cubic:Object.freeze({In:function(i){return i*i*i},Out:function(i){return--i*i*i+1},InOut:function(i){return(i*=2)<1?.5*i*i*i:.5*((i-=2)*i*i+2)}}),Quartic:Object.freeze({In:function(i){return i*i*i*i},Out:function(i){return 1- --i*i*i*i},InOut:function(i){return(i*=2)<1?.5*i*i*i*i:-.5*((i-=2)*i*i*i-2)}}),Quintic:Object.freeze({In:function(i){return i*i*i*i*i},Out:function(i){return--i*i*i*i*i+1},InOut:function(i){return(i*=2)<1?.5*i*i*i*i*i:.5*((i-=2)*i*i*i*i+2)}}),Sinusoidal:Object.freeze({In:function(i){return 1-Math.sin((1-i)*Math.PI/2)},Out:function(i){return Math.sin(i*Math.PI/2)},InOut:function(i){return .5*(1-Math.sin(Math.PI*(.5-i)))}}),Exponential:Object.freeze({In:function(i){return i===0?0:Math.pow(1024,i-1)},Out:function(i){return i===1?1:1-Math.pow(2,-10*i)},InOut:function(i){return i===0?0:i===1?1:(i*=2)<1?.5*Math.pow(1024,i-1):.5*(-Math.pow(2,-10*(i-1))+2)}}),Circular:Object.freeze({In:function(i){return 1-Math.sqrt(1-i*i)},Out:function(i){return Math.sqrt(1- --i*i)},InOut:function(i){return(i*=2)<1?-.5*(Math.sqrt(1-i*i)-1):.5*(Math.sqrt(1-(i-=2)*i)+1)}}),Elastic:Object.freeze({In:function(i){return i===0?0:i===1?1:-Math.pow(2,10*(i-1))*Math.sin((i-1.1)*5*Math.PI)},Out:function(i){return i===0?0:i===1?1:Math.pow(2,-10*i)*Math.sin((i-.1)*5*Math.PI)+1},InOut:function(i){return i===0?0:i===1?1:(i*=2,i<1?-.5*Math.pow(2,10*(i-1))*Math.sin((i-1.1)*5*Math.PI):.5*Math.pow(2,-10*(i-1))*Math.sin((i-1.1)*5*Math.PI)+1)}}),Back:Object.freeze({In:function(i){var t=1.70158;return i===1?1:i*i*((t+1)*i-t)},Out:function(i){var t=1.70158;return i===0?0:--i*i*((t+1)*i+t)+1},InOut:function(i){var t=2.5949095;return(i*=2)<1?.5*(i*i*((t+1)*i-t)):.5*((i-=2)*i*((t+1)*i+t)+2)}}),Bounce:Object.freeze({In:function(i){return 1-Ae.Bounce.Out(1-i)},Out:function(i){return i<1/2.75?7.5625*i*i:i<2/2.75?7.5625*(i-=1.5/2.75)*i+.75:i<2.5/2.75?7.5625*(i-=2.25/2.75)*i+.9375:7.5625*(i-=2.625/2.75)*i+.984375},InOut:function(i){return i<.5?Ae.Bounce.In(i*2)*.5:Ae.Bounce.Out(i*2-1)*.5+.5}}),generatePow:function(i){return i===void 0&&(i=4),i=i<Number.EPSILON?Number.EPSILON:i,i=i>1e4?1e4:i,{In:function(t){return Math.pow(t,i)},Out:function(t){return 1-Math.pow(1-t,i)},InOut:function(t){return t<.5?Math.pow(t*2,i)/2:(1-Math.pow(2-t*2,i))/2+.5}}}}),Ys=function(){return performance.now()},mT=function(){function i(){this._tweens={},this._tweensAddedDuringUpdate={}}return i.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map(function(e){return t._tweens[e]})},i.prototype.removeAll=function(){this._tweens={}},i.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},i.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},i.prototype.update=function(t,e){t===void 0&&(t=Ys()),e===void 0&&(e=!1);var s=Object.keys(this._tweens);if(s.length===0)return!1;for(;s.length>0;){this._tweensAddedDuringUpdate={};for(var n=0;n<s.length;n++){var r=this._tweens[s[n]],o=!e;r&&r.update(t,o)===!1&&!e&&delete this._tweens[s[n]]}s=Object.keys(this._tweensAddedDuringUpdate)}return!0},i}(),ga={Linear:function(i,t){var e=i.length-1,s=e*t,n=Math.floor(s),r=ga.Utils.Linear;return t<0?r(i[0],i[1],s):t>1?r(i[e],i[e-1],e-s):r(i[n],i[n+1>e?e:n+1],s-n)},Utils:{Linear:function(i,t,e){return(t-i)*e+i}}},vd=function(){function i(){}return i.nextId=function(){return i._nextId++},i._nextId=0,i}(),ya=new mT,ve=function(){function i(t,e){e===void 0&&(e=ya),this._object=t,this._group=e,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._isDynamic=!1,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=Ae.Linear.None,this._interpolationFunction=ga.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._id=vd.nextId(),this._isChainStopped=!1,this._propertiesAreSetUp=!1,this._goToEnd=!1}return i.prototype.getId=function(){return this._id},i.prototype.isPlaying=function(){return this._isPlaying},i.prototype.isPaused=function(){return this._isPaused},i.prototype.to=function(t,e){if(e===void 0&&(e=1e3),this._isPlaying)throw new Error("Can not call Tween.to() while Tween is already started or paused. Stop the Tween first.");return this._valuesEnd=t,this._propertiesAreSetUp=!1,this._duration=e,this},i.prototype.duration=function(t){return t===void 0&&(t=1e3),this._duration=t,this},i.prototype.dynamic=function(t){return t===void 0&&(t=!1),this._isDynamic=t,this},i.prototype.start=function(t,e){if(t===void 0&&(t=Ys()),e===void 0&&(e=!1),this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed){this._reversed=!1;for(var s in this._valuesStartRepeat)this._swapEndStartRepeatValues(s),this._valuesStart[s]=this._valuesStartRepeat[s]}if(this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._onEveryStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=t,this._startTime+=this._delayTime,!this._propertiesAreSetUp||e){if(this._propertiesAreSetUp=!0,!this._isDynamic){var n={};for(var r in this._valuesEnd)n[r]=this._valuesEnd[r];this._valuesEnd=n}this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat,e)}return this},i.prototype.startFromCurrentValues=function(t){return this.start(t,!0)},i.prototype._setupProperties=function(t,e,s,n,r){for(var o in s){var a=t[o],l=Array.isArray(a),c=l?"array":typeof a,h=!l&&Array.isArray(s[o]);if(!(c==="undefined"||c==="function")){if(h){var u=s[o];if(u.length===0)continue;for(var d=[a],f=0,m=u.length;f<m;f+=1){var y=this._handleRelativeValue(a,u[f]);if(isNaN(y)){h=!1,console.warn("Found invalid interpolation list. Skipping.");break}d.push(y)}h&&(s[o]=d)}if((c==="object"||l)&&a&&!h){e[o]=l?[]:{};var g=a;for(var E in g)e[o][E]=g[E];n[o]=l?[]:{};var u=s[o];if(!this._isDynamic){var T={};for(var E in u)T[E]=u[E];s[o]=u=T}this._setupProperties(g,e[o],u,n[o],r)}else(typeof e[o]>"u"||r)&&(e[o]=a),l||(e[o]*=1),h?n[o]=s[o].slice().reverse():n[o]=e[o]||0}}},i.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},i.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},i.prototype.pause=function(t){return t===void 0&&(t=Ys()),this._isPaused||!this._isPlaying?this:(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this),this)},i.prototype.resume=function(t){return t===void 0&&(t=Ys()),!this._isPaused||!this._isPlaying?this:(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this)},i.prototype.stopChainedTweens=function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this},i.prototype.group=function(t){return t===void 0&&(t=ya),this._group=t,this},i.prototype.delay=function(t){return t===void 0&&(t=0),this._delayTime=t,this},i.prototype.repeat=function(t){return t===void 0&&(t=0),this._initialRepeat=t,this._repeat=t,this},i.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},i.prototype.yoyo=function(t){return t===void 0&&(t=!1),this._yoyo=t,this},i.prototype.easing=function(t){return t===void 0&&(t=Ae.Linear.None),this._easingFunction=t,this},i.prototype.interpolation=function(t){return t===void 0&&(t=ga.Linear),this._interpolationFunction=t,this},i.prototype.chain=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._chainedTweens=t,this},i.prototype.onStart=function(t){return this._onStartCallback=t,this},i.prototype.onEveryStart=function(t){return this._onEveryStartCallback=t,this},i.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},i.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},i.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},i.prototype.onStop=function(t){return this._onStopCallback=t,this},i.prototype.update=function(t,e){if(t===void 0&&(t=Ys()),e===void 0&&(e=!0),this._isPaused)return!0;var s,n,r=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(t>r)return!1;e&&this.start(t,!0)}if(this._goToEnd=!1,t<this._startTime)return!0;this._onStartCallbackFired===!1&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),this._onEveryStartCallbackFired===!1&&(this._onEveryStartCallback&&this._onEveryStartCallback(this._object),this._onEveryStartCallbackFired=!0),n=(t-this._startTime)/this._duration,n=this._duration===0||n>1?1:n;var o=this._easingFunction(n);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,o),this._onUpdateCallback&&this._onUpdateCallback(this._object,n),n===1)if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(s in this._valuesStartRepeat)!this._yoyo&&typeof this._valuesEnd[s]=="string"&&(this._valuesStartRepeat[s]=this._valuesStartRepeat[s]+parseFloat(this._valuesEnd[s])),this._yoyo&&this._swapEndStartRepeatValues(s),this._valuesStart[s]=this._valuesStartRepeat[s];return this._yoyo&&(this._reversed=!this._reversed),this._repeatDelayTime!==void 0?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),this._onEveryStartCallbackFired=!1,!0}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var a=0,l=this._chainedTweens.length;a<l;a++)this._chainedTweens[a].start(this._startTime+this._duration,!1);return this._isPlaying=!1,!1}return!0},i.prototype._updateProperties=function(t,e,s,n){for(var r in s)if(e[r]!==void 0){var o=e[r]||0,a=s[r],l=Array.isArray(t[r]),c=Array.isArray(a),h=!l&&c;h?t[r]=this._interpolationFunction(a,n):typeof a=="object"&&a?this._updateProperties(t[r],o,a,n):(a=this._handleRelativeValue(o,a),typeof a=="number"&&(t[r]=o+(a-o)*n))}},i.prototype._handleRelativeValue=function(t,e){return typeof e!="string"?e:e.charAt(0)==="+"||e.charAt(0)==="-"?t+parseFloat(e):parseFloat(e)},i.prototype._swapEndStartRepeatValues=function(t){var e=this._valuesStartRepeat[t],s=this._valuesEnd[t];typeof s=="string"?this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(s):this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=e},i}();vd.nextId;var ri=ya;ri.getAll.bind(ri);ri.removeAll.bind(ri);var rr=ri.add.bind(ri),os=ri.remove.bind(ri),gT=ri.update.bind(ri),wi={Easing:Ae,Tween:ve};class gi{constructor(t,e,s,n,r=0,o=0,a=0){S(this,"masterContainer");S(this,"container");S(this,"mask");S(this,"paddingMask");this._x=t,this._y=e,this._w=s,this._h=n,this._borderRadius=a,this._color=r,this._alpha=o,this._padding=0,this._borderBox=!0,this._overflow="hidden",this.masterContainer=new ut,this.masterContainer.x=this._x,this.masterContainer.y=this._y,this.paddingMask=new ft,this.masterContainer.addChild(this.paddingMask),this.masterContainer.mask=this.paddingMask,this.background=new ft,this.masterContainer.addChild(this.background),this.container=new ut,this.container.x=this._padding,this.container.y=this._padding,this.mask=new ft,this.container.addChild(this.mask),this.container.mask=this.mask,this.container.eventMode="static",this.masterContainer.addChild(this.container),this.masterContainer.eventMode="static",this.redraw()}get x(){return this._x}set x(t){t!==this._x&&(this._x=t,this.updatePosition())}get y(){return this._y}set y(t){t!==this._y&&(this._y=t,this.updatePosition())}get w(){return this._w}set w(t){t!==this._w&&(this._w=t,this.redraw())}get h(){return this._h}set h(t){t!==this._h&&(this._h=t,this.redraw())}get borderRadius(){return this._borderRadius}set borderRadius(t){t!==this._borderRadius&&(this._borderRadius=t,this.redraw())}get padding(){return this._padding}set padding(t){t!==this._padding&&(this._padding=t,this.updatePosition(),this.redraw())}get borderBox(){return this._borderBox}set borderBox(t){t!==this._borderBox&&(this._borderBox=t,this.redraw())}get color(){return this._color}set color(t){t!==this._color&&(this._color=t,this.redraw())}get alpha(){return this._alpha}set alpha(t){t!==this._alpha&&(this._alpha=t,this.redraw())}get overflow(){return this._overflow}set overflow(t){this._overflow=t,this.redraw()}resize(t,e){this._w=t??this._w,this._h=e??this._h,this.redraw()}updatePosition(){this.masterContainer.x=this._x,this.masterContainer.y=this._y,this.container.x=this._padding,this.container.y=this._padding}redraw(){if(this.container.x=this.padding,this.container.y=this.padding,this.borderBox){this.paddingMask.clear().roundRect(0,0,this._w,this._h,this.borderRadius).fill({color:0,alpha:.01}),this.background.clear().roundRect(0,0,this._w,this._h,this.borderRadius).fill({color:this._color,alpha:this._alpha}),this.mask.clear().roundRect(0,0,this._w-this.padding*2,this._h-this.padding*2,0).fill({color:0,alpha:.01}),this.overflow==="hidden"&&(this.masterContainer.mask=this.paddingMask,this.container.mask=this.mask),this.overflow==="visible"&&(this.masterContainer.mask=void 0,this.container.mask=void 0);return}this.paddingMask.clear().roundRect(0,0,this._w+this.padding*2,this._h+this.padding*2,this.borderRadius).fill({color:0,alpha:.01}),this.background.clear().roundRect(0,0,this._w+this.padding*2,this._h+this.padding*2,this.borderRadius).fill({color:this._color,alpha:this._alpha}),this.mask.clear().roundRect(0,0,this._w,this._h,0).fill({color:0,alpha:.01}),this.overflow==="hidden"&&(this.masterContainer.mask=this.paddingMask,this.container.mask=this.mask),this.overflow==="visible"&&(this.masterContainer.mask=void 0,this.container.mask=void 0)}}const ke=class ke{static GetHitSound(t){return parseInt(t).toString(2).padStart(4,"0").split("").reverse().slice(1).reduce((e,s,n)=>(s==="1"&&e.push(ke.HIT_SOUNDS[n]),e),["hitnormal"])}static GetHitSample(t,e){/^\d:\d.*/g.test(t)||(t="0:0");const s=e.sampleSet!==0?e.sampleSet:ke.PARSE_ENUM[B.SAMPLE_SET],[n,r]=t.split(":"),o=ke.HIT_SAMPLES[parseInt(n)===0?s:n],a=parseInt(r)===0?o:ke.HIT_SAMPLES[r];return{normalSet:o,additionSet:a}}static GetName(t,e,s){const n=ke.GetHitSound(e),{normalSet:r,additionSet:o}=ke.GetHitSample(t,s),a=s.sampleIdx;return n.map(l=>l==="hitnormal"?`${r}-${l}${a}`:`${o}-${l}${a}`)}};S(ke,"HIT_SAMPLES",["","normal","soft","drum"]),S(ke,"HIT_SOUNDS",["hitwhistle","hitfinish","hitclap"]),S(ke,"PARSE_ENUM",{Normal:1,Soft:2,Drum:3});let ue=ke;const xi=class xi{constructor(t,e){S(this,"obj");S(this,"marker");S(this,"indicator");S(this,"timingPoint");S(this,"time");S(this,"value");S(this,"sample");S(this,"volume");S(this,"idx");this.timingPoint=t,this.idx=e,this.graphics=new ft,this.obj=new ut,this.obj.y=40*this.idx,this.obj.cullable=!0,this.obj.eventMode="none",this.marker=new ft().roundRect(90,5,Tt.WIDTH-105,30,5).fill(1776411),this.indicator=new ft().roundRect(95,10,5,20,5).fill(this.timingPoint.beatstep?16073306:4388192);let s=t.time;const n=s<0;s<0&&(s*=-1);const r=Math.floor(s/6e4),o=Math.floor((s-r*6e4)/1e3),a=s-r*6e4-o*1e3,l=`${n?"-":""}${r.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}:${a.toFixed(0).padStart(3,"0")}`;this.timestamp=new Ve({text:l,style:{fontFamily:"Torus",fontWeight:400,fontSize:xi.FONT_SIZE,fill:16777215}}),this.timestamp.x=10,this.timestamp.y=20,this.timestamp.anchor.set(0,.5),this.value=new Ve({text:`${(t.beatstep?6e4/t.beatstep:t.svMultiplier).toFixed(2)}${t.beatstep?" BPM":"x"}`,style:{fontFamily:"Torus",fontWeight:500,fontSize:xi.FONT_SIZE,fill:16777215}}),this.value.x=120,this.value.y=20,this.value.anchor.set(0,.5),this.obj.addChild(this.graphics),this.obj.addChild(this.marker),this.obj.addChild(this.indicator),this.obj.addChild(this.timestamp),this.obj.addChild(this.value),this.sample=new Ve({text:`${(ue.HIT_SAMPLES[t.sampleSet][0]??"").toUpperCase()}${t.sampleIdx!==0?":C"+t.sampleIdx:""}`,style:{fontFamily:"Torus",fontWeight:500,fontSize:xi.FONT_SIZE,fill:16777215}}),this.sample.x=210,this.sample.y=20,this.sample.anchor.set(0,.5),this.volume=new Ve({text:`${t.sampleVol}%`,style:{fontFamily:"Torus",fontWeight:500,fontSize:xi.FONT_SIZE,fill:16777215}}),this.volume.x=270,this.volume.y=20,this.volume.anchor.set(0,.5),this.obj.addChild(this.sample),this.obj.addChild(this.volume)}changeColor(){const t=p.COLOR_PALETTES.primary4,e=p.COLOR_PALETTES.primary1,s=p.COLOR_PALETTES.accent1;this.marker.clear().roundRect(90,5,Tt.WIDTH-105,30,5).fill(this.timingPoint.isKiai?s:t),this.value.style.fill=this.timingPoint.isKiai?e:16777215,this.sample.style.fill=this.timingPoint.isKiai?e:16777215,this.volume.style.fill=this.timingPoint.isKiai?e:16777215}resize(){this.changeColor()}update(){if(this.obj.y=40*this.idx-Tt.SCROLLED,this.graphics.clear(),this.idx===Tt.CURRENT_SV_IDX){const t=p.COLOR_PALETTES.primary5;this.graphics.roundRect(0,0,Tt.WIDTH-10,40,5).fill(t)}}};S(xi,"FONT_SIZE",13),S(xi,"EMIT_CHANGE",!1);let Sa=xi;class Tt{static init(){this.MASTER_CONTAINER=new gi(0,0,370,p.APP.renderer.height-100),this.MASTER_CONTAINER.color=p.COLOR_PALETTES.primary3,this.MASTER_CONTAINER.padding=15,this.MASTER_CONTAINER.alpha=1,this.MASTER_CONTAINER.borderRadius=10,this.WIDTH=this.MASTER_CONTAINER.w,this.HEIGHT=this.MASTER_CONTAINER.h,this._size_x=0,this.stage=this.MASTER_CONTAINER.container,this.stage.hitArea=new Ot(0,0,this.WIDTH,this.HEIGHT),this.stage.on("wheel",t=>{let e=this.SCROLLED;e=ot(e+t.deltaY,0,this.MAX_HEIGHT-this.HEIGHT);const s=new ve({scrolled:this.SCROLLED},!1).to({scrolled:e},100).easing(Ae.Cubic.Out).onUpdate(n=>{this.SCROLLED=n.scrolled,this.EMIT_CHANGE=!0}).start();s.onComplete=()=>os(s),rr(s)}),this.stage.eventMode="static",this.stage.on("touchstart",t=>this.handleTouchDown(t)),this.stage.on("globaltouchmove",t=>this.handleTouchMove(t)),this.stage.on("touchend",t=>this.handleTouchUp(t)),this.stage.on("touchendoutside",t=>this.handleTouchUp(t)),this.scrollbar=new ft,this.scrollbar.eventMode="static",this.scrollbar.on("mousedown",t=>this.handleMouseDown(t)),this.scrollbar.on("globalmousemove",t=>this.handleMouseMove(t)),this.scrollbar.on("mouseup",t=>this.handleMouseUp(t)),this.scrollbar.on("mouseupoutside",t=>this.handleMouseUp(t)),this.stage.addChild(this.scrollbar),this.forceResize(),this.forceUpdate()}static scrollTo(t){var r,o;if(!((o=(r=p.BEATMAP_FILE)==null?void 0:r.beatmapRenderData)!=null&&o.objectsController))return;let e=vs(this.POINTS,t,(a,l)=>a.timingPoint.time<l?-1:a.timingPoint.time>l?1:0);for(;e>0&&this.POINTS[e].timingPoint.time>t;)e--;this.CURRENT_SV_IDX=e;let s=this.SCROLLED;if(40*e-this.SCROLLED<0&&(s=40*e),40*e-this.SCROLLED>this.HEIGHT-40&&(s=40*e-(this.HEIGHT-40)),this.forceUpdate(),s===this.SCROLLED)return;const n=new ve({rate:this.SCROLLED},!1).to({rate:s},50).easing(Ae.Quintic.Out).onUpdate(a=>{this.SCROLLED=a.rate,this.EMIT_CHANGE=!0}).start();n.onComplete=()=>os(n),rr(n)}static handleTouchDown(t){this.IS_TOUCHING=!0,this.START_Y_TOUCH=t.global.y,this.TOUCH_LAST_TIMESTAMP=performance.now(),this.TOUCH_TWEEN&&this.TOUCH_TWEEN.stop()}static handleTouchMove(t){if(!this.IS_TOUCHING)return;const e=t.global.y-this.START_Y_TOUCH;this.START_Y_TOUCH=t.global.y,(this.SCROLLED-e>this.MAX_HEIGHT-this.HEIGHT||this.SCROLLED-e<0)&&window.scrollBy(0,-e),this.SCROLLED=ot(this.SCROLLED-e,0,this.MAX_HEIGHT-this.HEIGHT),this.EMIT_CHANGE=!0;const s=performance.now()-this.TOUCH_LAST_TIMESTAMP;s!==0&&(this.TOUCH_VELOCITY=e/s),this.TOUCH_LAST_TIMESTAMP=performance.now()}static handleTouchUp(t){this.IS_TOUCHING=!1;const e=performance.now();this.TOUCH_VELOCITY=this.TOUCH_VELOCITY*ot(1-(e-this.TOUCH_LAST_TIMESTAMP)/200,0,1);const s=this.TOUCH_VELOCITY*300,n=this.SCROLLED;let r=0;this.TOUCH_TWEEN=new ve({predicted:0},!1).to({predicted:s},300).easing(Ae.Quadratic.Out).onUpdate(o=>{this.SCROLLED=ot(n-o.predicted,0,this.MAX_HEIGHT-this.HEIGHT),this.EMIT_CHANGE=!0,(n-o.predicted>this.MAX_HEIGHT-this.HEIGHT||n-o.predicted<0)&&n>0&&n<this.MAX_HEIGHT-this.HEIGHT&&window.scrollBy(0,-(o.predicted-r)),r=o.predicted}).start(),this.TOUCH_TWEEN.onComplete=()=>{os(this.TOUCH_TWEEN),this.TOUCH_TWEEN=null},this.TOUCH_TWEEN.onStop=()=>{os(this.TOUCH_TWEEN),this.TOUCH_TWEEN=null},rr(this.TOUCH_TWEEN),this.START_Y_TOUCH=-1,this.TOUCH_VELOCITY=0,this.TOUCH_LAST_TIMESTAMP=0}static handleMouseDown(t){this.IS_DRAGGING=!0,this.START_Y=t.global.y,this.DELTA_Y_LOCAL=this.scrollbar.toLocal(t.global).y}static handleMouseMove(t){if(!this.IS_DRAGGING)return;const e=(t.global.y-this.START_Y)/(this.HEIGHT-this.HEIGHT*(this.HEIGHT/this.MAX_HEIGHT))*(this.MAX_HEIGHT-this.HEIGHT),s=this.HEIGHT*(this.HEIGHT/this.MAX_HEIGHT);this.START_Y=ot(t.global.y,this.DELTA_Y_LOCAL,this.HEIGHT+this.DELTA_Y_LOCAL-s),this.SCROLLED=ot(this.SCROLLED+e,0,this.MAX_HEIGHT-this.HEIGHT),this.EMIT_CHANGE=!0}static handleMouseUp(t){this.IS_DRAGGING=!1,this.START_Y=-1,this.DELTA_Y_LOCAL=0}static initTimingPoints(){this.MAX_HEIGHT=40*B.timingPointsList.length,this.scrollbar.clear().roundRect(0,0,5,this.HEIGHT*(this.HEIGHT/this.MAX_HEIGHT)).fill({color:11184810,alpha:this.MAX_HEIGHT<=this.HEIGHT?0:1}),this.POINTS=[],this.SCROLLED=0,B.timingPointsList.forEach((t,e)=>{const s=new Sa(t,e);this.POINTS.push(s)})}static get SIZE_X(){return this._size_x}static set SIZE_X(t){this._size_x=t,this.EMIT_CHANGE=!0}static forceResize(){var t,e;innerWidth/innerHeight<1?(p.SHOW_TIMING_PANEL&&!this.ON_ANIM&&(this.SIZE_X=p.WRAPPER.h*.75),this.MASTER_CONTAINER.x=0,this.MASTER_CONTAINER.y=p.APP.renderer.height-p.WRAPPER.h*.75*(this.SIZE_X/(p.WRAPPER.h*.75)),this.MASTER_CONTAINER.w=p.APP.renderer.width,this.MASTER_CONTAINER.h=this.SIZE_X,this.scrollTo(((e=(t=p.BEATMAP_FILE)==null?void 0:t.audioNode)==null?void 0:e.getCurrentTime())??0)):(p.SHOW_TIMING_PANEL&&!this.ON_ANIM&&(this.SIZE_X=400),this.MASTER_CONTAINER.x=p.APP.renderer.width-this.SIZE_X,this.MASTER_CONTAINER.y=(p.IS_FULLSCREEN,0),this.MASTER_CONTAINER.w=400,this.MASTER_CONTAINER.h=p.APP.renderer.height-(p.IS_FULLSCREEN,0)-this.SIZE_Y,p.IS_FULLSCREEN?this.MASTER_CONTAINER.borderRadius=0:this.MASTER_CONTAINER.borderRadius=10),this.MASTER_CONTAINER.redraw(),this.MASTER_CONTAINER.color!==p.COLOR_PALETTES.primary3&&(this.MASTER_CONTAINER.color=p.COLOR_PALETTES.primary3),!(this.WIDTH===this.MASTER_CONTAINER.w-this.MASTER_CONTAINER.padding*2&&this.HEIGHT===this.MASTER_CONTAINER.h-this.MASTER_CONTAINER.padding*2)&&(this.EMIT_CHANGE=!0,this.WIDTH=this.MASTER_CONTAINER.w-this.MASTER_CONTAINER.padding*2,this.HEIGHT=this.MASTER_CONTAINER.h-this.MASTER_CONTAINER.padding*2,this.stage.hitArea=new Ot(0,0,this.WIDTH,this.HEIGHT),this.MAX_HEIGHT=40*B.timingPointsList.length,this.scrollbar.clear().roundRect(0,0,5,this.HEIGHT*(this.HEIGHT/this.MAX_HEIGHT)).fill({color:11184810,alpha:this.MAX_HEIGHT<=this.HEIGHT?0:1}))}static resize(){p.EMIT_STACK.length!==0&&this.forceResize()}static forceUpdate(){if(!p.SHOW_TIMING_PANEL)return;this.stage.removeChildren(),this.stage.addChild(this.MASTER_CONTAINER.mask);let t=Math.floor(this.SCROLLED/40);for(;t<this.POINTS.length&&40*t-this.SCROLLED<this.HEIGHT;){if(t<0){t++;continue}const e=this.POINTS[t++];this.stage.addChild(e.obj),e.resize(),e.update()}this.stage.addChild(this.scrollbar),this.scrollbar.x=this.WIDTH-5,this.scrollbar.y=(this.HEIGHT-this.HEIGHT*(this.HEIGHT/this.MAX_HEIGHT))*(this.SCROLLED/(this.MAX_HEIGHT-this.HEIGHT))}static update(t){this.resize(),this.EMIT_CHANGE&&(this.forceUpdate(),this.EMIT_CHANGE=!1)}}S(Tt,"renderer"),S(Tt,"stage"),S(Tt,"scrollbar"),S(Tt,"WIDTH"),S(Tt,"HEIGHT"),S(Tt,"POINTS",[]),S(Tt,"SCROLL_RATE",0),S(Tt,"SCROLLED",0),S(Tt,"MAX_HEIGHT",0),S(Tt,"TWEEN_LIST",[]),S(Tt,"IS_DRAGGING",!1),S(Tt,"START_Y",-1),S(Tt,"DELTA_Y_LOCAL",0),S(Tt,"IS_TOUCHING",!1),S(Tt,"START_Y_TOUCH",-1),S(Tt,"TOUCH_VELOCITY",0),S(Tt,"TOUCH_LAST_TIMESTAMP",0),S(Tt,"TOUCH_TWEEN",null),S(Tt,"CURRENT_SV_IDX",0),S(Tt,"MASTER_CONTAINER"),S(Tt,"SIZE_Y",0),S(Tt,"ON_ANIM",!1);var yT=4,ST=.001,TT=1e-7,ET=10,Xs=11,zn=1/(Xs-1),_T=typeof Float32Array=="function";function Pd(i,t){return 1-3*t+3*i}function Ld(i,t){return 3*t-6*i}function Nd(i){return 3*i}function Tr(i,t,e){return((Pd(t,e)*i+Ld(t,e))*i+Nd(t))*i}function Dd(i,t,e){return 3*Pd(t,e)*i*i+2*Ld(t,e)*i+Nd(t)}function bT(i,t,e,s,n){var r,o,a=0;do o=t+(e-t)/2,r=Tr(o,s,n)-i,r>0?e=o:t=o;while(Math.abs(r)>TT&&++a<ET);return o}function xT(i,t,e,s){for(var n=0;n<yT;++n){var r=Dd(t,e,s);if(r===0)return t;var o=Tr(t,e,s)-i;t-=o/r}return t}function AT(i){return i}var CT=function(t,e,s,n){if(!(0<=t&&t<=1&&0<=s&&s<=1))throw new Error("bezier x values must be in [0, 1] range");if(t===e&&s===n)return AT;for(var r=_T?new Float32Array(Xs):new Array(Xs),o=0;o<Xs;++o)r[o]=Tr(o*zn,t,s);function a(l){for(var c=0,h=1,u=Xs-1;h!==u&&r[h]<=l;++h)c+=zn;--h;var d=(l-r[h])/(r[h+1]-r[h]),f=c+d*zn,m=Dd(f,t,s);return m>=ST?xT(l,f,t,s):m===0?f:bT(l,c,c+zn,t,s)}return function(c){return c===0?0:c===1?1:Tr(a(c),e,n)}};const kd=Wr(CT);class je{constructor({text:t,renderMode:e,style:s}){this._text=t,this._sprite=new Ve({text:this.text,style:s}),this._metrics=de.measureText(t,this._sprite.style),this._color=s.fill,this._x=0,this._y=0}get text(){return this._text}set text(t){this._text!==t&&(this._text=t,this._sprite.text=t,this._metrics=de.measureText(t,this._sprite.style),this._resize())}get color(){return this._color}set color(t){t!==this._color&&(this._color=t,this.style.fill=t)}get sprite(){return this._sprite}get style(){return this._sprite.style}get width(){return this._metrics.width}get height(){return this._metrics.height}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.update())}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.update())}_resize(){this._metrics=de.measureText(this.text,this.style)}update(){this._resize(),this.sprite.x=this.x,this.sprite.y=this.y}}class Er{constructor(){this.container=new ut,this.content=new ut,this.background=new ft,this._paddingX=0,this._paddingY=0,this._color=0,this._alpha=0,this._borderRadius=0,this._child=void 0,this._x=0,this._y=0,this._width=void 0,this._height=void 0,this.container.addChild(this.background,this.content),this.container.x=0,this.container.y=0,this.placeItemsCenter=!1}addChild(t){if(this._child=t,t instanceof je){this.content.addChild(t.sprite);return}this.content.addChild(t)}get paddingX(){return this._paddingX}set paddingX(t){this._paddingX=t,this.update()}get paddingY(){return this._paddingY}set paddingY(t){this._paddingY=t,this.update()}get color(){return this._color}set color(t){this._color=t,this.alpha=1,this.update()}get alpha(){return this._alpha}set alpha(t){this._alpha=t,this.update()}get width(){var t;return this._width?this._width:(((t=this._child)==null?void 0:t.width)??0)+this.paddingX*2}set width(t){t!==this._width&&(this._width=t,this.update())}get height(){var t;return this._height?this._height:(((t=this._child)==null?void 0:t.height)??0)+this.paddingY*2}set height(t){t!==this._height&&(this._height=t,this.update())}get x(){return this._x}set x(t){t!==this._x&&(this._x=t,this.update())}get y(){return this._y}set y(t){t!==this._y&&(this._y=t,this.update())}get borderRadius(){return this._borderRadius}set borderRadius(t){t!==this._borderRadius&&(this._borderRadius=t,this.update())}update(){var t,e;this.container.x=this.x,this.container.y=this.y,this.placeItemsCenter?(this.content.x=(this.width-(((t=this._child)==null?void 0:t.width)??0))/2,this.content.y=(this.height-(((e=this._child)==null?void 0:e.height)??0))/2):(this.content.x=this.paddingX,this.content.y=this.paddingY),this.background.clear().roundRect(0,0,this.width,this.height,this.borderRadius).fill({color:this.color,alpha:this.alpha})}}class dn{constructor(){S(this,"container");S(this,"children",[]);this.container=new ut,this._gap=0,this._flexDirection="column",this._justifyContent="center"}addChild(...t){this.children.push(...t),t.forEach(e=>{if(e instanceof je){this.container.addChild(e.sprite);return}this.container.addChild(e)}),this.update()}get gap(){return this._gap}set gap(t){this._gap=t,this.update()}get flexDirection(){return this._flexDirection}set flexDirection(t){["row","column"].includes(t)&&(this._flexDirection=t,this.update())}get justifyContent(){return this._justifyContent}set justifyContent(t){this._justifyContent=t,this.update()}get width(){return this.container.width}get height(){return this.container.height}get x(){return this.container.x}set x(t){this.container.x=t}get y(){return this.container.y}set y(t){this.container.y=t}getLargestChildFactor(t){return Math.max(...this.children.map(e=>e[t]))}update(){const t=this.flexDirection==="column"?"y":"x",e=this.flexDirection==="column"?"x":"y",s=this.flexDirection==="column"?"width":"height",n=this.flexDirection==="column"?"height":"width";this.children.forEach((r,o,a)=>{if(this.justifyContent==="center"&&(r[t]=Math.ceil((this.getLargestChildFactor(n)-r[n])*.5)),this.justifyContent==="start"&&(r[t]=0),o===0){r[e]=0;return}r[e]=a[o-1][e]+a[o-1][s]+this.gap})}}function Xr(){St.ON_ANIM=!0;let i={game:0,timing:0,metadata:0};p.SHOW_METADATA||(i={game:innerWidth<innerHeight?0:400,timing:0,metadata:innerWidth<innerHeight?p.WRAPPER.h*.75:400}),p.SHOW_METADATA&&(i={game:0,timing:0,metadata:0}),p.SHOW_TIMING_PANEL=!1,p.SHOW_METADATA=!p.SHOW_METADATA;const t=kd(0,.4,0,1);new ve({reduction:{game:p.REDUCTION,timing:Tt.SIZE_X,metadata:St.SIZE_X}}).easing(e=>t(e)).to({reduction:i},200).onUpdate(e=>{p.REDUCTION=e.reduction.game,St.SIZE_X=e.reduction.metadata,Tt.SIZE_X=e.reduction.timing,St.ON_ANIM=!0,p.EMIT_STACK.push(!0)}).onComplete(()=>{St.ON_ANIM=!1}).start()}class St{static init(){this.MASTER_CONTAINER=new gi(0,0,370,p.APP.renderer.height-100),this.MASTER_CONTAINER.color=p.COLOR_PALETTES.primary3,this.MASTER_CONTAINER.padding=15,this.MASTER_CONTAINER.alpha=1,this.MASTER_CONTAINER.borderRadius=10,this.MASTER_CONTAINER.masterContainer.on("touchstart",s=>{this.IS_TOUCHING=!0,this.START_Y_TOUCH=s.global.y,this.TOUCH_LAST_TIMESTAMP=performance.now(),this.TOUCH_TWEEN&&this.TOUCH_TWEEN.stop()}),this.MASTER_CONTAINER.masterContainer.on("touchmove",s=>{if(!this.IS_TOUCHING)return;const n=Math.max(0,this.flex.height-this.container.height+this.container.paddingY),r=s.global.y-this.START_Y_TOUCH;this.START_Y_TOUCH=s.global.y,(this.SCROLLED-r>n||this.SCROLLED-r<0)&&window.scrollBy(0,-r),this.SCROLLED=ot(this.SCROLLED-r,0,n),this.flex.y=-this.SCROLLED;const o=performance.now()-this.TOUCH_LAST_TIMESTAMP;o!==0&&(this.TOUCH_VELOCITY=r/o),this.TOUCH_LAST_TIMESTAMP=performance.now()}),this.MASTER_CONTAINER.masterContainer.on("touchend",s=>{this.IS_TOUCHING=!1;const n=Math.max(0,this.flex.height-this.container.height+this.container.paddingY),r=performance.now();this.TOUCH_VELOCITY=this.TOUCH_VELOCITY*ot(1-(r-this.TOUCH_LAST_TIMESTAMP)/200,0,1);const o=this.TOUCH_VELOCITY*300,a=this.SCROLLED;let l=0;this.TOUCH_TWEEN=new ve({predicted:0},!1).to({predicted:o},300).easing(Ae.Quadratic.Out).onUpdate(c=>{this.SCROLLED=ot(a-c.predicted,0,n),this.flex.y=-this.SCROLLED,(a-c.predicted>n||a-c.predicted<0)&&a>0&&a<n&&window.scrollBy(0,-(c.predicted-l)),l=c.predicted}).start(),this.TOUCH_TWEEN.onComplete=()=>{os(this.TOUCH_TWEEN),this.TOUCH_TWEEN=null},this.TOUCH_TWEEN.onStop=()=>{os(this.TOUCH_TWEEN),this.TOUCH_TWEEN=null},rr(this.TOUCH_TWEEN),this.START_Y_TOUCH=-1,this.TOUCH_VELOCITY=0,this.TOUCH_LAST_TIMESTAMP=0}),this.WIDTH=this.MASTER_CONTAINER.w,this.HEIGHT=this.MASTER_CONTAINER.h,this.flex=new dn,this.flex.flexDirection="row",this.flex.gap=20,this.flex.justifyContent="start",this.container=new Er,this.container.paddingX=20,this.container.paddingY=20,this.container.color=p.COLOR_PALETTES.primary2,this.container.borderRadius=10;const t={fontSize:16,fontFamily:"Torus",fill:"white",fontWeight:500,wordWrap:!0},e={fontSize:12,fontFamily:"Torus",fill:"white",fontWeight:400,wordWrap:!0};Object.keys(this.LABEL).forEach(s=>{this.LABEL[s]=new je({text:s.replaceAll("_"," "),style:e}),this[s.toUpperCase()]=new je({text:"",style:t}),this.CONTAINERS[s]=new dn,this.CONTAINERS[s].flexDirection="row",this.CONTAINERS[s].justifyContent="start",this.CONTAINERS[s].gap=6,this.CONTAINERS[s].addChild(this.LABEL[s].sprite,this[s.toUpperCase()].sprite),this.flex.addChild(this.CONTAINERS[s].container),this.container.addChild(this.flex.container)}),this.MASTER_CONTAINER.container.addChild(this.container.container),this.forceUpdate()}static get artist(){return this._artist}static set artist(t){this._artist=t,this.ARTIST.text=t,this.forceUpdate()}static get romanized_artist(){return this._romanized_artist}static set romanized_artist(t){this._romanized_artist=t,this.ROMANIZED_ARTIST.text=t,this.forceUpdate()}static get title(){return this._title}static set title(t){this._title=t,this.TITLE.text=t,this.forceUpdate()}static get romanized_title(){return this._romanized_title}static set romanized_title(t){this._romanized_title=t,this.ROMANIZED_TITLE.text=t,this.forceUpdate()}static get difficulty_name(){return this._difficulty_name}static set difficulty_name(t){this._difficulty_name=t,this.DIFFICULTY_NAME.text=t,this.forceUpdate()}static get source(){return this._source}static set source(t){this._source=t,this.SOURCE.text=t,this.forceUpdate()}static get tag(){return this._tag}static set tag(t){this._tag=t,this.TAG.text=t}static resize(){innerWidth/innerHeight<1?(p.SHOW_METADATA&&!this.ON_ANIM&&(this.SIZE_X=p.WRAPPER.h*.75),this.MASTER_CONTAINER.x=0,this.MASTER_CONTAINER.y=p.APP.renderer.height-p.WRAPPER.h*.75*(this.SIZE_X/(p.WRAPPER.h*.75)),this.MASTER_CONTAINER.w=p.APP.renderer.width,this.MASTER_CONTAINER.h=this.SIZE_X):(p.SHOW_METADATA&&!this.ON_ANIM&&(this.SIZE_X=400),this.MASTER_CONTAINER.x=p.APP.renderer.width-this.SIZE_X,this.MASTER_CONTAINER.y=(p.IS_FULLSCREEN,0),this.MASTER_CONTAINER.w=400,this.MASTER_CONTAINER.h=p.APP.renderer.height-(p.IS_FULLSCREEN,0)-this.SIZE_Y),!(this.WIDTH===this.MASTER_CONTAINER.w-this.MASTER_CONTAINER.padding*2&&this.HEIGHT===this.MASTER_CONTAINER.h-this.MASTER_CONTAINER.padding*2)&&(this.WIDTH=this.MASTER_CONTAINER.w,this.HEIGHT=this.MASTER_CONTAINER.h,p.IS_FULLSCREEN?this.MASTER_CONTAINER.borderRadius=0:this.MASTER_CONTAINER.borderRadius=10)}static forceUpdate(){this.resize(),this.container.width=this.MASTER_CONTAINER.w-this.MASTER_CONTAINER.padding*2,this.container.height=this.MASTER_CONTAINER.h-this.MASTER_CONTAINER.padding*2,Object.keys(this.LABEL).forEach(t=>{this.LABEL[t].style.wordWrapWidth=this.container.width-this.container.paddingX*2,this[t.toUpperCase()].style.wordWrapWidth=this.container.width-this.container.paddingX*2,this.LABEL[t].style.fontSize=12,this[t.toUpperCase()].style.fontSize=16,this.LABEL[t].update(),this[t.toUpperCase()].update(),this.CONTAINERS[t].update(),this.flex.update()}),this.container.update(),this.MASTER_CONTAINER.redraw()}static update(){p.EMIT_STACK.length!==0&&this.forceUpdate()}}S(St,"MASTER_CONTAINER"),S(St,"SIZE_X",0),S(St,"SIZE_Y",0),S(St,"ARTIST"),S(St,"ROMANIZED_ARTIST"),S(St,"TITLE"),S(St,"ROMANIZED_TITLE"),S(St,"DIFFICULTY_NAME"),S(St,"SOURCE"),S(St,"TAG"),S(St,"LABEL",{artist:null,romanized_artist:null,title:null,romanized_title:null,difficulty_name:null,source:null,tag:null}),S(St,"CONTAINERS",{artist:null,romanized_artist:null,title:null,romanized_title:null,difficulty_name:null,source:null,tag:null}),S(St,"container"),S(St,"ON_ANIM",!1),S(St,"SCROLL_RATE",0),S(St,"IS_TOUCHING",!1),S(St,"START_Y_TOUCH",-1),S(St,"TOUCH_VELOCITY",0),S(St,"TOUCH_LAST_TIMESTAMP",0),S(St,"TOUCH_TWEEN",null),S(St,"SCROLLED",0);function or(i,t){return i==null||t==null?NaN:i<t?-1:i>t?1:i>=t?0:NaN}function RT(i,t){return i==null||t==null?NaN:t<i?-1:t>i?1:t>=i?0:NaN}function Hd(i){let t,e,s;i.length!==2?(t=or,e=(a,l)=>or(i(a),l),s=(a,l)=>i(a)-l):(t=i===or||i===RT?i:wT,e=i,s=i);function n(a,l,c=0,h=a.length){if(c<h){if(t(l,l)!==0)return h;do{const u=c+h>>>1;e(a[u],l)<0?c=u+1:h=u}while(c<h)}return c}function r(a,l,c=0,h=a.length){if(c<h){if(t(l,l)!==0)return h;do{const u=c+h>>>1;e(a[u],l)<=0?c=u+1:h=u}while(c<h)}return c}function o(a,l,c=0,h=a.length){const u=n(a,l,c,h-1);return u>c&&s(a[u-1],l)>-s(a[u],l)?u-1:u}return{left:n,center:o,right:r}}function wT(){return 0}function IT(i){return i===null?NaN:+i}const MT=Hd(or),OT=MT.right;Hd(IT).center;const vT=Math.sqrt(50),PT=Math.sqrt(10),LT=Math.sqrt(2);function _r(i,t,e){const s=(t-i)/Math.max(0,e),n=Math.floor(Math.log10(s)),r=s/Math.pow(10,n),o=r>=vT?10:r>=PT?5:r>=LT?2:1;let a,l,c;return n<0?(c=Math.pow(10,-n)/o,a=Math.round(i*c),l=Math.round(t*c),a/c<i&&++a,l/c>t&&--l,c=-c):(c=Math.pow(10,n)*o,a=Math.round(i/c),l=Math.round(t/c),a*c<i&&++a,l*c>t&&--l),l<a&&.5<=e&&e<2?_r(i,t,e*2):[a,l,c]}function NT(i,t,e){if(t=+t,i=+i,e=+e,!(e>0))return[];if(i===t)return[i];const s=t<i,[n,r,o]=s?_r(t,i,e):_r(i,t,e);if(!(r>=n))return[];const a=r-n+1,l=new Array(a);if(s)if(o<0)for(let c=0;c<a;++c)l[c]=(r-c)/-o;else for(let c=0;c<a;++c)l[c]=(r-c)*o;else if(o<0)for(let c=0;c<a;++c)l[c]=(n+c)/-o;else for(let c=0;c<a;++c)l[c]=(n+c)*o;return l}function Ta(i,t,e){return t=+t,i=+i,e=+e,_r(i,t,e)[2]}function DT(i,t,e){t=+t,i=+i,e=+e;const s=t<i,n=s?Ta(t,i,e):Ta(i,t,e);return(s?-1:1)*(n<0?1/-n:n)}var kT={value:()=>{}};function Fd(){for(var i=0,t=arguments.length,e={},s;i<t;++i){if(!(s=arguments[i]+"")||s in e||/[\s.]/.test(s))throw new Error("illegal type: "+s);e[s]=[]}return new ar(e)}function ar(i){this._=i}function HT(i,t){return i.trim().split(/^|\s+/).map(function(e){var s="",n=e.indexOf(".");if(n>=0&&(s=e.slice(n+1),e=e.slice(0,n)),e&&!t.hasOwnProperty(e))throw new Error("unknown type: "+e);return{type:e,name:s}})}ar.prototype=Fd.prototype={constructor:ar,on:function(i,t){var e=this._,s=HT(i+"",e),n,r=-1,o=s.length;if(arguments.length<2){for(;++r<o;)if((n=(i=s[r]).type)&&(n=FT(e[n],i.name)))return n;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++r<o;)if(n=(i=s[r]).type)e[n]=Uc(e[n],i.name,t);else if(t==null)for(n in e)e[n]=Uc(e[n],i.name,null);return this},copy:function(){var i={},t=this._;for(var e in t)i[e]=t[e].slice();return new ar(i)},call:function(i,t){if((n=arguments.length-2)>0)for(var e=new Array(n),s=0,n,r;s<n;++s)e[s]=arguments[s+2];if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(r=this._[i],s=0,n=r.length;s<n;++s)r[s].value.apply(t,e)},apply:function(i,t,e){if(!this._.hasOwnProperty(i))throw new Error("unknown type: "+i);for(var s=this._[i],n=0,r=s.length;n<r;++n)s[n].value.apply(t,e)}};function FT(i,t){for(var e=0,s=i.length,n;e<s;++e)if((n=i[e]).name===t)return n.value}function Uc(i,t,e){for(var s=0,n=i.length;s<n;++s)if(i[s].name===t){i[s]=kT,i=i.slice(0,s).concat(i.slice(s+1));break}return e!=null&&i.push({name:t,value:e}),i}var Ea="http://www.w3.org/1999/xhtml";const Gc={svg:"http://www.w3.org/2000/svg",xhtml:Ea,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function qr(i){var t=i+="",e=t.indexOf(":");return e>=0&&(t=i.slice(0,e))!=="xmlns"&&(i=i.slice(e+1)),Gc.hasOwnProperty(t)?{space:Gc[t],local:i}:i}function BT(i){return function(){var t=this.ownerDocument,e=this.namespaceURI;return e===Ea&&t.documentElement.namespaceURI===Ea?t.createElement(i):t.createElementNS(e,i)}}function UT(i){return function(){return this.ownerDocument.createElementNS(i.space,i.local)}}function Bd(i){var t=qr(i);return(t.local?UT:BT)(t)}function GT(){}function Xa(i){return i==null?GT:function(){return this.querySelector(i)}}function jT(i){typeof i!="function"&&(i=Xa(i));for(var t=this._groups,e=t.length,s=new Array(e),n=0;n<e;++n)for(var r=t[n],o=r.length,a=s[n]=new Array(o),l,c,h=0;h<o;++h)(l=r[h])&&(c=i.call(l,l.__data__,h,r))&&("__data__"in l&&(c.__data__=l.__data__),a[h]=c);return new Ye(s,this._parents)}function WT(i){return i==null?[]:Array.isArray(i)?i:Array.from(i)}function VT(){return[]}function Ud(i){return i==null?VT:function(){return this.querySelectorAll(i)}}function zT(i){return function(){return WT(i.apply(this,arguments))}}function $T(i){typeof i=="function"?i=zT(i):i=Ud(i);for(var t=this._groups,e=t.length,s=[],n=[],r=0;r<e;++r)for(var o=t[r],a=o.length,l,c=0;c<a;++c)(l=o[c])&&(s.push(i.call(l,l.__data__,c,o)),n.push(l));return new Ye(s,n)}function Gd(i){return function(){return this.matches(i)}}function jd(i){return function(t){return t.matches(i)}}var YT=Array.prototype.find;function XT(i){return function(){return YT.call(this.children,i)}}function qT(){return this.firstElementChild}function KT(i){return this.select(i==null?qT:XT(typeof i=="function"?i:jd(i)))}var ZT=Array.prototype.filter;function JT(){return Array.from(this.children)}function QT(i){return function(){return ZT.call(this.children,i)}}function tE(i){return this.selectAll(i==null?JT:QT(typeof i=="function"?i:jd(i)))}function eE(i){typeof i!="function"&&(i=Gd(i));for(var t=this._groups,e=t.length,s=new Array(e),n=0;n<e;++n)for(var r=t[n],o=r.length,a=s[n]=[],l,c=0;c<o;++c)(l=r[c])&&i.call(l,l.__data__,c,r)&&a.push(l);return new Ye(s,this._parents)}function Wd(i){return new Array(i.length)}function iE(){return new Ye(this._enter||this._groups.map(Wd),this._parents)}function br(i,t){this.ownerDocument=i.ownerDocument,this.namespaceURI=i.namespaceURI,this._next=null,this._parent=i,this.__data__=t}br.prototype={constructor:br,appendChild:function(i){return this._parent.insertBefore(i,this._next)},insertBefore:function(i,t){return this._parent.insertBefore(i,t)},querySelector:function(i){return this._parent.querySelector(i)},querySelectorAll:function(i){return this._parent.querySelectorAll(i)}};function sE(i){return function(){return i}}function nE(i,t,e,s,n,r){for(var o=0,a,l=t.length,c=r.length;o<c;++o)(a=t[o])?(a.__data__=r[o],s[o]=a):e[o]=new br(i,r[o]);for(;o<l;++o)(a=t[o])&&(n[o]=a)}function rE(i,t,e,s,n,r,o){var a,l,c=new Map,h=t.length,u=r.length,d=new Array(h),f;for(a=0;a<h;++a)(l=t[a])&&(d[a]=f=o.call(l,l.__data__,a,t)+"",c.has(f)?n[a]=l:c.set(f,l));for(a=0;a<u;++a)f=o.call(i,r[a],a,r)+"",(l=c.get(f))?(s[a]=l,l.__data__=r[a],c.delete(f)):e[a]=new br(i,r[a]);for(a=0;a<h;++a)(l=t[a])&&c.get(d[a])===l&&(n[a]=l)}function oE(i){return i.__data__}function aE(i,t){if(!arguments.length)return Array.from(this,oE);var e=t?rE:nE,s=this._parents,n=this._groups;typeof i!="function"&&(i=sE(i));for(var r=n.length,o=new Array(r),a=new Array(r),l=new Array(r),c=0;c<r;++c){var h=s[c],u=n[c],d=u.length,f=lE(i.call(h,h&&h.__data__,c,s)),m=f.length,y=a[c]=new Array(m),g=o[c]=new Array(m),E=l[c]=new Array(d);e(h,u,y,g,E,f,t);for(var T=0,_=0,b,A;T<m;++T)if(b=y[T]){for(T>=_&&(_=T+1);!(A=g[_])&&++_<m;);b._next=A||null}}return o=new Ye(o,s),o._enter=a,o._exit=l,o}function lE(i){return typeof i=="object"&&"length"in i?i:Array.from(i)}function cE(){return new Ye(this._exit||this._groups.map(Wd),this._parents)}function hE(i,t,e){var s=this.enter(),n=this,r=this.exit();return typeof i=="function"?(s=i(s),s&&(s=s.selection())):s=s.append(i+""),t!=null&&(n=t(n),n&&(n=n.selection())),e==null?r.remove():e(r),s&&n?s.merge(n).order():n}function uE(i){for(var t=i.selection?i.selection():i,e=this._groups,s=t._groups,n=e.length,r=s.length,o=Math.min(n,r),a=new Array(n),l=0;l<o;++l)for(var c=e[l],h=s[l],u=c.length,d=a[l]=new Array(u),f,m=0;m<u;++m)(f=c[m]||h[m])&&(d[m]=f);for(;l<n;++l)a[l]=e[l];return new Ye(a,this._parents)}function dE(){for(var i=this._groups,t=-1,e=i.length;++t<e;)for(var s=i[t],n=s.length-1,r=s[n],o;--n>=0;)(o=s[n])&&(r&&o.compareDocumentPosition(r)^4&&r.parentNode.insertBefore(o,r),r=o);return this}function fE(i){i||(i=pE);function t(u,d){return u&&d?i(u.__data__,d.__data__):!u-!d}for(var e=this._groups,s=e.length,n=new Array(s),r=0;r<s;++r){for(var o=e[r],a=o.length,l=n[r]=new Array(a),c,h=0;h<a;++h)(c=o[h])&&(l[h]=c);l.sort(t)}return new Ye(n,this._parents).order()}function pE(i,t){return i<t?-1:i>t?1:i>=t?0:NaN}function mE(){var i=arguments[0];return arguments[0]=this,i.apply(null,arguments),this}function gE(){return Array.from(this)}function yE(){for(var i=this._groups,t=0,e=i.length;t<e;++t)for(var s=i[t],n=0,r=s.length;n<r;++n){var o=s[n];if(o)return o}return null}function SE(){let i=0;for(const t of this)++i;return i}function TE(){return!this.node()}function EE(i){for(var t=this._groups,e=0,s=t.length;e<s;++e)for(var n=t[e],r=0,o=n.length,a;r<o;++r)(a=n[r])&&i.call(a,a.__data__,r,n);return this}function _E(i){return function(){this.removeAttribute(i)}}function bE(i){return function(){this.removeAttributeNS(i.space,i.local)}}function xE(i,t){return function(){this.setAttribute(i,t)}}function AE(i,t){return function(){this.setAttributeNS(i.space,i.local,t)}}function CE(i,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttribute(i):this.setAttribute(i,e)}}function RE(i,t){return function(){var e=t.apply(this,arguments);e==null?this.removeAttributeNS(i.space,i.local):this.setAttributeNS(i.space,i.local,e)}}function wE(i,t){var e=qr(i);if(arguments.length<2){var s=this.node();return e.local?s.getAttributeNS(e.space,e.local):s.getAttribute(e)}return this.each((t==null?e.local?bE:_E:typeof t=="function"?e.local?RE:CE:e.local?AE:xE)(e,t))}function Vd(i){return i.ownerDocument&&i.ownerDocument.defaultView||i.document&&i||i.defaultView}function IE(i){return function(){this.style.removeProperty(i)}}function ME(i,t,e){return function(){this.style.setProperty(i,t,e)}}function OE(i,t,e){return function(){var s=t.apply(this,arguments);s==null?this.style.removeProperty(i):this.style.setProperty(i,s,e)}}function vE(i,t,e){return arguments.length>1?this.each((t==null?IE:typeof t=="function"?OE:ME)(i,t,e??"")):_s(this.node(),i)}function _s(i,t){return i.style.getPropertyValue(t)||Vd(i).getComputedStyle(i,null).getPropertyValue(t)}function PE(i){return function(){delete this[i]}}function LE(i,t){return function(){this[i]=t}}function NE(i,t){return function(){var e=t.apply(this,arguments);e==null?delete this[i]:this[i]=e}}function DE(i,t){return arguments.length>1?this.each((t==null?PE:typeof t=="function"?NE:LE)(i,t)):this.node()[i]}function zd(i){return i.trim().split(/^|\s+/)}function qa(i){return i.classList||new $d(i)}function $d(i){this._node=i,this._names=zd(i.getAttribute("class")||"")}$d.prototype={add:function(i){var t=this._names.indexOf(i);t<0&&(this._names.push(i),this._node.setAttribute("class",this._names.join(" ")))},remove:function(i){var t=this._names.indexOf(i);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(i){return this._names.indexOf(i)>=0}};function Yd(i,t){for(var e=qa(i),s=-1,n=t.length;++s<n;)e.add(t[s])}function Xd(i,t){for(var e=qa(i),s=-1,n=t.length;++s<n;)e.remove(t[s])}function kE(i){return function(){Yd(this,i)}}function HE(i){return function(){Xd(this,i)}}function FE(i,t){return function(){(t.apply(this,arguments)?Yd:Xd)(this,i)}}function BE(i,t){var e=zd(i+"");if(arguments.length<2){for(var s=qa(this.node()),n=-1,r=e.length;++n<r;)if(!s.contains(e[n]))return!1;return!0}return this.each((typeof t=="function"?FE:t?kE:HE)(e,t))}function UE(){this.textContent=""}function GE(i){return function(){this.textContent=i}}function jE(i){return function(){var t=i.apply(this,arguments);this.textContent=t??""}}function WE(i){return arguments.length?this.each(i==null?UE:(typeof i=="function"?jE:GE)(i)):this.node().textContent}function VE(){this.innerHTML=""}function zE(i){return function(){this.innerHTML=i}}function $E(i){return function(){var t=i.apply(this,arguments);this.innerHTML=t??""}}function YE(i){return arguments.length?this.each(i==null?VE:(typeof i=="function"?$E:zE)(i)):this.node().innerHTML}function XE(){this.nextSibling&&this.parentNode.appendChild(this)}function qE(){return this.each(XE)}function KE(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function ZE(){return this.each(KE)}function JE(i){var t=typeof i=="function"?i:Bd(i);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function QE(){return null}function t_(i,t){var e=typeof i=="function"?i:Bd(i),s=t==null?QE:typeof t=="function"?t:Xa(t);return this.select(function(){return this.insertBefore(e.apply(this,arguments),s.apply(this,arguments)||null)})}function e_(){var i=this.parentNode;i&&i.removeChild(this)}function i_(){return this.each(e_)}function s_(){var i=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(i,this.nextSibling):i}function n_(){var i=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(i,this.nextSibling):i}function r_(i){return this.select(i?n_:s_)}function o_(i){return arguments.length?this.property("__data__",i):this.node().__data__}function a_(i){return function(t){i.call(this,t,this.__data__)}}function l_(i){return i.trim().split(/^|\s+/).map(function(t){var e="",s=t.indexOf(".");return s>=0&&(e=t.slice(s+1),t=t.slice(0,s)),{type:t,name:e}})}function c_(i){return function(){var t=this.__on;if(t){for(var e=0,s=-1,n=t.length,r;e<n;++e)r=t[e],(!i.type||r.type===i.type)&&r.name===i.name?this.removeEventListener(r.type,r.listener,r.options):t[++s]=r;++s?t.length=s:delete this.__on}}}function h_(i,t,e){return function(){var s=this.__on,n,r=a_(t);if(s){for(var o=0,a=s.length;o<a;++o)if((n=s[o]).type===i.type&&n.name===i.name){this.removeEventListener(n.type,n.listener,n.options),this.addEventListener(n.type,n.listener=r,n.options=e),n.value=t;return}}this.addEventListener(i.type,r,e),n={type:i.type,name:i.name,value:t,listener:r,options:e},s?s.push(n):this.__on=[n]}}function u_(i,t,e){var s=l_(i+""),n,r=s.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var l=0,c=a.length,h;l<c;++l)for(n=0,h=a[l];n<r;++n)if((o=s[n]).type===h.type&&o.name===h.name)return h.value}return}for(a=t?h_:c_,n=0;n<r;++n)this.each(a(s[n],t,e));return this}function qd(i,t,e){var s=Vd(i),n=s.CustomEvent;typeof n=="function"?n=new n(t,e):(n=s.document.createEvent("Event"),e?(n.initEvent(t,e.bubbles,e.cancelable),n.detail=e.detail):n.initEvent(t,!1,!1)),i.dispatchEvent(n)}function d_(i,t){return function(){return qd(this,i,t)}}function f_(i,t){return function(){return qd(this,i,t.apply(this,arguments))}}function p_(i,t){return this.each((typeof t=="function"?f_:d_)(i,t))}function*m_(){for(var i=this._groups,t=0,e=i.length;t<e;++t)for(var s=i[t],n=0,r=s.length,o;n<r;++n)(o=s[n])&&(yield o)}var g_=[null];function Ye(i,t){this._groups=i,this._parents=t}function Rn(){return new Ye([[document.documentElement]],g_)}function y_(){return this}Ye.prototype=Rn.prototype={constructor:Ye,select:jT,selectAll:$T,selectChild:KT,selectChildren:tE,filter:eE,data:aE,enter:iE,exit:cE,join:hE,merge:uE,selection:y_,order:dE,sort:fE,call:mE,nodes:gE,node:yE,size:SE,empty:TE,each:EE,attr:wE,style:vE,property:DE,classed:BE,text:WE,html:YE,raise:qE,lower:ZE,append:JE,insert:t_,remove:i_,clone:r_,datum:o_,on:u_,dispatch:p_,[Symbol.iterator]:m_};function Ka(i,t,e){i.prototype=t.prototype=e,e.constructor=i}function Kd(i,t){var e=Object.create(i.prototype);for(var s in t)e[s]=t[s];return e}function wn(){}var fn=.7,xr=1/fn,ds="\\s*([+-]?\\d+)\\s*",pn="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",si="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",S_=/^#([0-9a-f]{3,8})$/,T_=new RegExp(`^rgb\\(${ds},${ds},${ds}\\)$`),E_=new RegExp(`^rgb\\(${si},${si},${si}\\)$`),__=new RegExp(`^rgba\\(${ds},${ds},${ds},${pn}\\)$`),b_=new RegExp(`^rgba\\(${si},${si},${si},${pn}\\)$`),x_=new RegExp(`^hsl\\(${pn},${si},${si}\\)$`),A_=new RegExp(`^hsla\\(${pn},${si},${si},${pn}\\)$`),jc={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Ka(wn,pe,{copy(i){return Object.assign(new this.constructor,this,i)},displayable(){return this.rgb().displayable()},hex:Wc,formatHex:Wc,formatHex8:C_,formatHsl:R_,formatRgb:Vc,toString:Vc});function Wc(){return this.rgb().formatHex()}function C_(){return this.rgb().formatHex8()}function R_(){return Zd(this).formatHsl()}function Vc(){return this.rgb().formatRgb()}function pe(i){var t,e;return i=(i+"").trim().toLowerCase(),(t=S_.exec(i))?(e=t[1].length,t=parseInt(t[1],16),e===6?zc(t):e===3?new ge(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):e===8?$n(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):e===4?$n(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=T_.exec(i))?new ge(t[1],t[2],t[3],1):(t=E_.exec(i))?new ge(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=__.exec(i))?$n(t[1],t[2],t[3],t[4]):(t=b_.exec(i))?$n(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=x_.exec(i))?Xc(t[1],t[2]/100,t[3]/100,1):(t=A_.exec(i))?Xc(t[1],t[2]/100,t[3]/100,t[4]):jc.hasOwnProperty(i)?zc(jc[i]):i==="transparent"?new ge(NaN,NaN,NaN,0):null}function zc(i){return new ge(i>>16&255,i>>8&255,i&255,1)}function $n(i,t,e,s){return s<=0&&(i=t=e=NaN),new ge(i,t,e,s)}function w_(i){return i instanceof wn||(i=pe(i)),i?(i=i.rgb(),new ge(i.r,i.g,i.b,i.opacity)):new ge}function Xe(i,t,e,s){return arguments.length===1?w_(i):new ge(i,t,e,s??1)}function ge(i,t,e,s){this.r=+i,this.g=+t,this.b=+e,this.opacity=+s}Ka(ge,Xe,Kd(wn,{brighter(i){return i=i==null?xr:Math.pow(xr,i),new ge(this.r*i,this.g*i,this.b*i,this.opacity)},darker(i){return i=i==null?fn:Math.pow(fn,i),new ge(this.r*i,this.g*i,this.b*i,this.opacity)},rgb(){return this},clamp(){return new ge($i(this.r),$i(this.g),$i(this.b),Ar(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:$c,formatHex:$c,formatHex8:I_,formatRgb:Yc,toString:Yc}));function $c(){return`#${Ui(this.r)}${Ui(this.g)}${Ui(this.b)}`}function I_(){return`#${Ui(this.r)}${Ui(this.g)}${Ui(this.b)}${Ui((isNaN(this.opacity)?1:this.opacity)*255)}`}function Yc(){const i=Ar(this.opacity);return`${i===1?"rgb(":"rgba("}${$i(this.r)}, ${$i(this.g)}, ${$i(this.b)}${i===1?")":`, ${i})`}`}function Ar(i){return isNaN(i)?1:Math.max(0,Math.min(1,i))}function $i(i){return Math.max(0,Math.min(255,Math.round(i)||0))}function Ui(i){return i=$i(i),(i<16?"0":"")+i.toString(16)}function Xc(i,t,e,s){return s<=0?i=t=e=NaN:e<=0||e>=1?i=t=NaN:t<=0&&(i=NaN),new We(i,t,e,s)}function Zd(i){if(i instanceof We)return new We(i.h,i.s,i.l,i.opacity);if(i instanceof wn||(i=pe(i)),!i)return new We;if(i instanceof We)return i;i=i.rgb();var t=i.r/255,e=i.g/255,s=i.b/255,n=Math.min(t,e,s),r=Math.max(t,e,s),o=NaN,a=r-n,l=(r+n)/2;return a?(t===r?o=(e-s)/a+(e<s)*6:e===r?o=(s-t)/a+2:o=(t-e)/a+4,a/=l<.5?r+n:2-r-n,o*=60):a=l>0&&l<1?0:o,new We(o,a,l,i.opacity)}function M_(i,t,e,s){return arguments.length===1?Zd(i):new We(i,t,e,s??1)}function We(i,t,e,s){this.h=+i,this.s=+t,this.l=+e,this.opacity=+s}Ka(We,M_,Kd(wn,{brighter(i){return i=i==null?xr:Math.pow(xr,i),new We(this.h,this.s,this.l*i,this.opacity)},darker(i){return i=i==null?fn:Math.pow(fn,i),new We(this.h,this.s,this.l*i,this.opacity)},rgb(){var i=this.h%360+(this.h<0)*360,t=isNaN(i)||isNaN(this.s)?0:this.s,e=this.l,s=e+(e<.5?e:1-e)*t,n=2*e-s;return new ge(Ho(i>=240?i-240:i+120,n,s),Ho(i,n,s),Ho(i<120?i+240:i-120,n,s),this.opacity)},clamp(){return new We(qc(this.h),Yn(this.s),Yn(this.l),Ar(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const i=Ar(this.opacity);return`${i===1?"hsl(":"hsla("}${qc(this.h)}, ${Yn(this.s)*100}%, ${Yn(this.l)*100}%${i===1?")":`, ${i})`}`}}));function qc(i){return i=(i||0)%360,i<0?i+360:i}function Yn(i){return Math.max(0,Math.min(1,i||0))}function Ho(i,t,e){return(i<60?t+(e-t)*i/60:i<180?e:i<240?t+(e-t)*(240-i)/60:t)*255}const Za=i=>()=>i;function O_(i,t){return function(e){return i+e*t}}function v_(i,t,e){return i=Math.pow(i,e),t=Math.pow(t,e)-i,e=1/e,function(s){return Math.pow(i+s*t,e)}}function P_(i){return(i=+i)==1?Jd:function(t,e){return e-t?v_(t,e,i):Za(isNaN(t)?e:t)}}function Jd(i,t){var e=t-i;return e?O_(i,e):Za(isNaN(i)?t:i)}const mn=function i(t){var e=P_(t);function s(n,r){var o=e((n=Xe(n)).r,(r=Xe(r)).r),a=e(n.g,r.g),l=e(n.b,r.b),c=Jd(n.opacity,r.opacity);return function(h){return n.r=o(h),n.g=a(h),n.b=l(h),n.opacity=c(h),n+""}}return s.gamma=i,s}(1);function L_(i,t){t||(t=[]);var e=i?Math.min(t.length,i.length):0,s=t.slice(),n;return function(r){for(n=0;n<e;++n)s[n]=i[n]*(1-r)+t[n]*r;return s}}function N_(i){return ArrayBuffer.isView(i)&&!(i instanceof DataView)}function D_(i,t){var e=t?t.length:0,s=i?Math.min(e,i.length):0,n=new Array(s),r=new Array(e),o;for(o=0;o<s;++o)n[o]=Ja(i[o],t[o]);for(;o<e;++o)r[o]=t[o];return function(a){for(o=0;o<s;++o)r[o]=n[o](a);return r}}function k_(i,t){var e=new Date;return i=+i,t=+t,function(s){return e.setTime(i*(1-s)+t*s),e}}function Fe(i,t){return i=+i,t=+t,function(e){return i*(1-e)+t*e}}function H_(i,t){var e={},s={},n;(i===null||typeof i!="object")&&(i={}),(t===null||typeof t!="object")&&(t={});for(n in t)n in i?e[n]=Ja(i[n],t[n]):s[n]=t[n];return function(r){for(n in e)s[n]=e[n](r);return s}}var _a=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Fo=new RegExp(_a.source,"g");function F_(i){return function(){return i}}function B_(i){return function(t){return i(t)+""}}function Qd(i,t){var e=_a.lastIndex=Fo.lastIndex=0,s,n,r,o=-1,a=[],l=[];for(i=i+"",t=t+"";(s=_a.exec(i))&&(n=Fo.exec(t));)(r=n.index)>e&&(r=t.slice(e,r),a[o]?a[o]+=r:a[++o]=r),(s=s[0])===(n=n[0])?a[o]?a[o]+=n:a[++o]=n:(a[++o]=null,l.push({i:o,x:Fe(s,n)})),e=Fo.lastIndex;return e<t.length&&(r=t.slice(e),a[o]?a[o]+=r:a[++o]=r),a.length<2?l[0]?B_(l[0].x):F_(t):(t=l.length,function(c){for(var h=0,u;h<t;++h)a[(u=l[h]).i]=u.x(c);return a.join("")})}function Ja(i,t){var e=typeof t,s;return t==null||e==="boolean"?Za(t):(e==="number"?Fe:e==="string"?(s=pe(t))?(t=s,mn):Qd:t instanceof pe?mn:t instanceof Date?k_:N_(t)?L_:Array.isArray(t)?D_:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?H_:Fe)(i,t)}function U_(i,t){return i=+i,t=+t,function(e){return Math.round(i*(1-e)+t*e)}}var Kc=180/Math.PI,ba={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function tf(i,t,e,s,n,r){var o,a,l;return(o=Math.sqrt(i*i+t*t))&&(i/=o,t/=o),(l=i*e+t*s)&&(e-=i*l,s-=t*l),(a=Math.sqrt(e*e+s*s))&&(e/=a,s/=a,l/=a),i*s<t*e&&(i=-i,t=-t,l=-l,o=-o),{translateX:n,translateY:r,rotate:Math.atan2(t,i)*Kc,skewX:Math.atan(l)*Kc,scaleX:o,scaleY:a}}var Xn;function G_(i){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(i+"");return t.isIdentity?ba:tf(t.a,t.b,t.c,t.d,t.e,t.f)}function j_(i){return i==null||(Xn||(Xn=document.createElementNS("http://www.w3.org/2000/svg","g")),Xn.setAttribute("transform",i),!(i=Xn.transform.baseVal.consolidate()))?ba:(i=i.matrix,tf(i.a,i.b,i.c,i.d,i.e,i.f))}function ef(i,t,e,s){function n(c){return c.length?c.pop()+" ":""}function r(c,h,u,d,f,m){if(c!==u||h!==d){var y=f.push("translate(",null,t,null,e);m.push({i:y-4,x:Fe(c,u)},{i:y-2,x:Fe(h,d)})}else(u||d)&&f.push("translate("+u+t+d+e)}function o(c,h,u,d){c!==h?(c-h>180?h+=360:h-c>180&&(c+=360),d.push({i:u.push(n(u)+"rotate(",null,s)-2,x:Fe(c,h)})):h&&u.push(n(u)+"rotate("+h+s)}function a(c,h,u,d){c!==h?d.push({i:u.push(n(u)+"skewX(",null,s)-2,x:Fe(c,h)}):h&&u.push(n(u)+"skewX("+h+s)}function l(c,h,u,d,f,m){if(c!==u||h!==d){var y=f.push(n(f)+"scale(",null,",",null,")");m.push({i:y-4,x:Fe(c,u)},{i:y-2,x:Fe(h,d)})}else(u!==1||d!==1)&&f.push(n(f)+"scale("+u+","+d+")")}return function(c,h){var u=[],d=[];return c=i(c),h=i(h),r(c.translateX,c.translateY,h.translateX,h.translateY,u,d),o(c.rotate,h.rotate,u,d),a(c.skewX,h.skewX,u,d),l(c.scaleX,c.scaleY,h.scaleX,h.scaleY,u,d),c=h=null,function(f){for(var m=-1,y=d.length,g;++m<y;)u[(g=d[m]).i]=g.x(f);return u.join("")}}}var W_=ef(G_,"px, ","px)","deg)"),V_=ef(j_,", ",")",")"),bs=0,qs=0,Us=0,sf=1e3,Cr,Ks,Rr=0,Ki=0,Kr=0,gn=typeof performance=="object"&&performance.now?performance:Date,nf=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(i){setTimeout(i,17)};function Qa(){return Ki||(nf(z_),Ki=gn.now()+Kr)}function z_(){Ki=0}function wr(){this._call=this._time=this._next=null}wr.prototype=rf.prototype={constructor:wr,restart:function(i,t,e){if(typeof i!="function")throw new TypeError("callback is not a function");e=(e==null?Qa():+e)+(t==null?0:+t),!this._next&&Ks!==this&&(Ks?Ks._next=this:Cr=this,Ks=this),this._call=i,this._time=e,xa()},stop:function(){this._call&&(this._call=null,this._time=1/0,xa())}};function rf(i,t,e){var s=new wr;return s.restart(i,t,e),s}function $_(){Qa(),++bs;for(var i=Cr,t;i;)(t=Ki-i._time)>=0&&i._call.call(void 0,t),i=i._next;--bs}function Zc(){Ki=(Rr=gn.now())+Kr,bs=qs=0;try{$_()}finally{bs=0,X_(),Ki=0}}function Y_(){var i=gn.now(),t=i-Rr;t>sf&&(Kr-=t,Rr=i)}function X_(){for(var i,t=Cr,e,s=1/0;t;)t._call?(s>t._time&&(s=t._time),i=t,t=t._next):(e=t._next,t._next=null,t=i?i._next=e:Cr=e);Ks=i,xa(s)}function xa(i){if(!bs){qs&&(qs=clearTimeout(qs));var t=i-Ki;t>24?(i<1/0&&(qs=setTimeout(Zc,i-gn.now()-Kr)),Us&&(Us=clearInterval(Us))):(Us||(Rr=gn.now(),Us=setInterval(Y_,sf)),bs=1,nf(Zc))}}function Jc(i,t,e){var s=new wr;return t=t==null?0:+t,s.restart(n=>{s.stop(),i(n+t)},t,e),s}var q_=Fd("start","end","cancel","interrupt"),K_=[],of=0,Qc=1,Aa=2,lr=3,th=4,Ca=5,cr=6;function Zr(i,t,e,s,n,r){var o=i.__transition;if(!o)i.__transition={};else if(e in o)return;Z_(i,e,{name:t,index:s,group:n,on:q_,tween:K_,time:r.time,delay:r.delay,duration:r.duration,ease:r.ease,timer:null,state:of})}function tl(i,t){var e=Je(i,t);if(e.state>of)throw new Error("too late; already scheduled");return e}function oi(i,t){var e=Je(i,t);if(e.state>lr)throw new Error("too late; already running");return e}function Je(i,t){var e=i.__transition;if(!e||!(e=e[t]))throw new Error("transition not found");return e}function Z_(i,t,e){var s=i.__transition,n;s[t]=e,e.timer=rf(r,0,e.time);function r(c){e.state=Qc,e.timer.restart(o,e.delay,e.time),e.delay<=c&&o(c-e.delay)}function o(c){var h,u,d,f;if(e.state!==Qc)return l();for(h in s)if(f=s[h],f.name===e.name){if(f.state===lr)return Jc(o);f.state===th?(f.state=cr,f.timer.stop(),f.on.call("interrupt",i,i.__data__,f.index,f.group),delete s[h]):+h<t&&(f.state=cr,f.timer.stop(),f.on.call("cancel",i,i.__data__,f.index,f.group),delete s[h])}if(Jc(function(){e.state===lr&&(e.state=th,e.timer.restart(a,e.delay,e.time),a(c))}),e.state=Aa,e.on.call("start",i,i.__data__,e.index,e.group),e.state===Aa){for(e.state=lr,n=new Array(d=e.tween.length),h=0,u=-1;h<d;++h)(f=e.tween[h].value.call(i,i.__data__,e.index,e.group))&&(n[++u]=f);n.length=u+1}}function a(c){for(var h=c<e.duration?e.ease.call(null,c/e.duration):(e.timer.restart(l),e.state=Ca,1),u=-1,d=n.length;++u<d;)n[u].call(i,h);e.state===Ca&&(e.on.call("end",i,i.__data__,e.index,e.group),l())}function l(){e.state=cr,e.timer.stop(),delete s[t];for(var c in s)return;delete i.__transition}}function J_(i,t){var e=i.__transition,s,n,r=!0,o;if(e){t=t==null?null:t+"";for(o in e){if((s=e[o]).name!==t){r=!1;continue}n=s.state>Aa&&s.state<Ca,s.state=cr,s.timer.stop(),s.on.call(n?"interrupt":"cancel",i,i.__data__,s.index,s.group),delete e[o]}r&&delete i.__transition}}function Q_(i){return this.each(function(){J_(this,i)})}function tb(i,t){var e,s;return function(){var n=oi(this,i),r=n.tween;if(r!==e){s=e=r;for(var o=0,a=s.length;o<a;++o)if(s[o].name===t){s=s.slice(),s.splice(o,1);break}}n.tween=s}}function eb(i,t,e){var s,n;if(typeof e!="function")throw new Error;return function(){var r=oi(this,i),o=r.tween;if(o!==s){n=(s=o).slice();for(var a={name:t,value:e},l=0,c=n.length;l<c;++l)if(n[l].name===t){n[l]=a;break}l===c&&n.push(a)}r.tween=n}}function ib(i,t){var e=this._id;if(i+="",arguments.length<2){for(var s=Je(this.node(),e).tween,n=0,r=s.length,o;n<r;++n)if((o=s[n]).name===i)return o.value;return null}return this.each((t==null?tb:eb)(e,i,t))}function el(i,t,e){var s=i._id;return i.each(function(){var n=oi(this,s);(n.value||(n.value={}))[t]=e.apply(this,arguments)}),function(n){return Je(n,s).value[t]}}function af(i,t){var e;return(typeof t=="number"?Fe:t instanceof pe?mn:(e=pe(t))?(t=e,mn):Qd)(i,t)}function sb(i){return function(){this.removeAttribute(i)}}function nb(i){return function(){this.removeAttributeNS(i.space,i.local)}}function rb(i,t,e){var s,n=e+"",r;return function(){var o=this.getAttribute(i);return o===n?null:o===s?r:r=t(s=o,e)}}function ob(i,t,e){var s,n=e+"",r;return function(){var o=this.getAttributeNS(i.space,i.local);return o===n?null:o===s?r:r=t(s=o,e)}}function ab(i,t,e){var s,n,r;return function(){var o,a=e(this),l;return a==null?void this.removeAttribute(i):(o=this.getAttribute(i),l=a+"",o===l?null:o===s&&l===n?r:(n=l,r=t(s=o,a)))}}function lb(i,t,e){var s,n,r;return function(){var o,a=e(this),l;return a==null?void this.removeAttributeNS(i.space,i.local):(o=this.getAttributeNS(i.space,i.local),l=a+"",o===l?null:o===s&&l===n?r:(n=l,r=t(s=o,a)))}}function cb(i,t){var e=qr(i),s=e==="transform"?V_:af;return this.attrTween(i,typeof t=="function"?(e.local?lb:ab)(e,s,el(this,"attr."+i,t)):t==null?(e.local?nb:sb)(e):(e.local?ob:rb)(e,s,t))}function hb(i,t){return function(e){this.setAttribute(i,t.call(this,e))}}function ub(i,t){return function(e){this.setAttributeNS(i.space,i.local,t.call(this,e))}}function db(i,t){var e,s;function n(){var r=t.apply(this,arguments);return r!==s&&(e=(s=r)&&ub(i,r)),e}return n._value=t,n}function fb(i,t){var e,s;function n(){var r=t.apply(this,arguments);return r!==s&&(e=(s=r)&&hb(i,r)),e}return n._value=t,n}function pb(i,t){var e="attr."+i;if(arguments.length<2)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;var s=qr(i);return this.tween(e,(s.local?db:fb)(s,t))}function mb(i,t){return function(){tl(this,i).delay=+t.apply(this,arguments)}}function gb(i,t){return t=+t,function(){tl(this,i).delay=t}}function yb(i){var t=this._id;return arguments.length?this.each((typeof i=="function"?mb:gb)(t,i)):Je(this.node(),t).delay}function Sb(i,t){return function(){oi(this,i).duration=+t.apply(this,arguments)}}function Tb(i,t){return t=+t,function(){oi(this,i).duration=t}}function Eb(i){var t=this._id;return arguments.length?this.each((typeof i=="function"?Sb:Tb)(t,i)):Je(this.node(),t).duration}function _b(i,t){if(typeof t!="function")throw new Error;return function(){oi(this,i).ease=t}}function bb(i){var t=this._id;return arguments.length?this.each(_b(t,i)):Je(this.node(),t).ease}function xb(i,t){return function(){var e=t.apply(this,arguments);if(typeof e!="function")throw new Error;oi(this,i).ease=e}}function Ab(i){if(typeof i!="function")throw new Error;return this.each(xb(this._id,i))}function Cb(i){typeof i!="function"&&(i=Gd(i));for(var t=this._groups,e=t.length,s=new Array(e),n=0;n<e;++n)for(var r=t[n],o=r.length,a=s[n]=[],l,c=0;c<o;++c)(l=r[c])&&i.call(l,l.__data__,c,r)&&a.push(l);return new yi(s,this._parents,this._name,this._id)}function Rb(i){if(i._id!==this._id)throw new Error;for(var t=this._groups,e=i._groups,s=t.length,n=e.length,r=Math.min(s,n),o=new Array(s),a=0;a<r;++a)for(var l=t[a],c=e[a],h=l.length,u=o[a]=new Array(h),d,f=0;f<h;++f)(d=l[f]||c[f])&&(u[f]=d);for(;a<s;++a)o[a]=t[a];return new yi(o,this._parents,this._name,this._id)}function wb(i){return(i+"").trim().split(/^|\s+/).every(function(t){var e=t.indexOf(".");return e>=0&&(t=t.slice(0,e)),!t||t==="start"})}function Ib(i,t,e){var s,n,r=wb(t)?tl:oi;return function(){var o=r(this,i),a=o.on;a!==s&&(n=(s=a).copy()).on(t,e),o.on=n}}function Mb(i,t){var e=this._id;return arguments.length<2?Je(this.node(),e).on.on(i):this.each(Ib(e,i,t))}function Ob(i){return function(){var t=this.parentNode;for(var e in this.__transition)if(+e!==i)return;t&&t.removeChild(this)}}function vb(){return this.on("end.remove",Ob(this._id))}function Pb(i){var t=this._name,e=this._id;typeof i!="function"&&(i=Xa(i));for(var s=this._groups,n=s.length,r=new Array(n),o=0;o<n;++o)for(var a=s[o],l=a.length,c=r[o]=new Array(l),h,u,d=0;d<l;++d)(h=a[d])&&(u=i.call(h,h.__data__,d,a))&&("__data__"in h&&(u.__data__=h.__data__),c[d]=u,Zr(c[d],t,e,d,c,Je(h,e)));return new yi(r,this._parents,t,e)}function Lb(i){var t=this._name,e=this._id;typeof i!="function"&&(i=Ud(i));for(var s=this._groups,n=s.length,r=[],o=[],a=0;a<n;++a)for(var l=s[a],c=l.length,h,u=0;u<c;++u)if(h=l[u]){for(var d=i.call(h,h.__data__,u,l),f,m=Je(h,e),y=0,g=d.length;y<g;++y)(f=d[y])&&Zr(f,t,e,y,d,m);r.push(d),o.push(h)}return new yi(r,o,t,e)}var Nb=Rn.prototype.constructor;function Db(){return new Nb(this._groups,this._parents)}function kb(i,t){var e,s,n;return function(){var r=_s(this,i),o=(this.style.removeProperty(i),_s(this,i));return r===o?null:r===e&&o===s?n:n=t(e=r,s=o)}}function lf(i){return function(){this.style.removeProperty(i)}}function Hb(i,t,e){var s,n=e+"",r;return function(){var o=_s(this,i);return o===n?null:o===s?r:r=t(s=o,e)}}function Fb(i,t,e){var s,n,r;return function(){var o=_s(this,i),a=e(this),l=a+"";return a==null&&(l=a=(this.style.removeProperty(i),_s(this,i))),o===l?null:o===s&&l===n?r:(n=l,r=t(s=o,a))}}function Bb(i,t){var e,s,n,r="style."+t,o="end."+r,a;return function(){var l=oi(this,i),c=l.on,h=l.value[r]==null?a||(a=lf(t)):void 0;(c!==e||n!==h)&&(s=(e=c).copy()).on(o,n=h),l.on=s}}function Ub(i,t,e){var s=(i+="")=="transform"?W_:af;return t==null?this.styleTween(i,kb(i,s)).on("end.style."+i,lf(i)):typeof t=="function"?this.styleTween(i,Fb(i,s,el(this,"style."+i,t))).each(Bb(this._id,i)):this.styleTween(i,Hb(i,s,t),e).on("end.style."+i,null)}function Gb(i,t,e){return function(s){this.style.setProperty(i,t.call(this,s),e)}}function jb(i,t,e){var s,n;function r(){var o=t.apply(this,arguments);return o!==n&&(s=(n=o)&&Gb(i,o,e)),s}return r._value=t,r}function Wb(i,t,e){var s="style."+(i+="");if(arguments.length<2)return(s=this.tween(s))&&s._value;if(t==null)return this.tween(s,null);if(typeof t!="function")throw new Error;return this.tween(s,jb(i,t,e??""))}function Vb(i){return function(){this.textContent=i}}function zb(i){return function(){var t=i(this);this.textContent=t??""}}function $b(i){return this.tween("text",typeof i=="function"?zb(el(this,"text",i)):Vb(i==null?"":i+""))}function Yb(i){return function(t){this.textContent=i.call(this,t)}}function Xb(i){var t,e;function s(){var n=i.apply(this,arguments);return n!==e&&(t=(e=n)&&Yb(n)),t}return s._value=i,s}function qb(i){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(i==null)return this.tween(t,null);if(typeof i!="function")throw new Error;return this.tween(t,Xb(i))}function Kb(){for(var i=this._name,t=this._id,e=cf(),s=this._groups,n=s.length,r=0;r<n;++r)for(var o=s[r],a=o.length,l,c=0;c<a;++c)if(l=o[c]){var h=Je(l,t);Zr(l,i,e,c,o,{time:h.time+h.delay+h.duration,delay:0,duration:h.duration,ease:h.ease})}return new yi(s,this._parents,i,e)}function Zb(){var i,t,e=this,s=e._id,n=e.size();return new Promise(function(r,o){var a={value:o},l={value:function(){--n===0&&r()}};e.each(function(){var c=oi(this,s),h=c.on;h!==i&&(t=(i=h).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(l)),c.on=t}),n===0&&r()})}var Jb=0;function yi(i,t,e,s){this._groups=i,this._parents=t,this._name=e,this._id=s}function cf(){return++Jb}var li=Rn.prototype;yi.prototype={constructor:yi,select:Pb,selectAll:Lb,selectChild:li.selectChild,selectChildren:li.selectChildren,filter:Cb,merge:Rb,selection:Db,transition:Kb,call:li.call,nodes:li.nodes,node:li.node,size:li.size,empty:li.empty,each:li.each,on:Mb,attr:cb,attrTween:pb,style:Ub,styleTween:Wb,text:$b,textTween:qb,remove:vb,tween:ib,delay:yb,duration:Eb,ease:bb,easeVarying:Ab,end:Zb,[Symbol.iterator]:li[Symbol.iterator]};function Qb(i){return((i*=2)<=1?i*i*i:(i-=2)*i*i+2)/2}var tx={time:null,delay:0,duration:250,ease:Qb};function ex(i,t){for(var e;!(e=i.__transition)||!(e=e[t]);)if(!(i=i.parentNode))throw new Error(`transition ${t} not found`);return e}function ix(i){var t,e;i instanceof yi?(t=i._id,i=i._name):(t=cf(),(e=tx).time=Qa(),i=i==null?null:i+"");for(var s=this._groups,n=s.length,r=0;r<n;++r)for(var o=s[r],a=o.length,l,c=0;c<a;++c)(l=o[c])&&Zr(l,i,t,c,o,e||ex(l,t));return new yi(s,this._parents,i,t)}Rn.prototype.interrupt=Q_;Rn.prototype.transition=ix;function sx(i){return Math.abs(i=Math.round(i))>=1e21?i.toLocaleString("en").replace(/,/g,""):i.toString(10)}function Ir(i,t){if((e=(i=t?i.toExponential(t-1):i.toExponential()).indexOf("e"))<0)return null;var e,s=i.slice(0,e);return[s.length>1?s[0]+s.slice(2):s,+i.slice(e+1)]}function xs(i){return i=Ir(Math.abs(i)),i?i[1]:NaN}function nx(i,t){return function(e,s){for(var n=e.length,r=[],o=0,a=i[0],l=0;n>0&&a>0&&(l+a+1>s&&(a=Math.max(1,s-l)),r.push(e.substring(n-=a,n+a)),!((l+=a+1)>s));)a=i[o=(o+1)%i.length];return r.reverse().join(t)}}function rx(i){return function(t){return t.replace(/[0-9]/g,function(e){return i[+e]})}}var ox=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Mr(i){if(!(t=ox.exec(i)))throw new Error("invalid format: "+i);var t;return new il({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Mr.prototype=il.prototype;function il(i){this.fill=i.fill===void 0?" ":i.fill+"",this.align=i.align===void 0?">":i.align+"",this.sign=i.sign===void 0?"-":i.sign+"",this.symbol=i.symbol===void 0?"":i.symbol+"",this.zero=!!i.zero,this.width=i.width===void 0?void 0:+i.width,this.comma=!!i.comma,this.precision=i.precision===void 0?void 0:+i.precision,this.trim=!!i.trim,this.type=i.type===void 0?"":i.type+""}il.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function ax(i){t:for(var t=i.length,e=1,s=-1,n;e<t;++e)switch(i[e]){case".":s=n=e;break;case"0":s===0&&(s=e),n=e;break;default:if(!+i[e])break t;s>0&&(s=0);break}return s>0?i.slice(0,s)+i.slice(n+1):i}var hf;function lx(i,t){var e=Ir(i,t);if(!e)return i+"";var s=e[0],n=e[1],r=n-(hf=Math.max(-8,Math.min(8,Math.floor(n/3)))*3)+1,o=s.length;return r===o?s:r>o?s+new Array(r-o+1).join("0"):r>0?s.slice(0,r)+"."+s.slice(r):"0."+new Array(1-r).join("0")+Ir(i,Math.max(0,t+r-1))[0]}function eh(i,t){var e=Ir(i,t);if(!e)return i+"";var s=e[0],n=e[1];return n<0?"0."+new Array(-n).join("0")+s:s.length>n+1?s.slice(0,n+1)+"."+s.slice(n+1):s+new Array(n-s.length+2).join("0")}const ih={"%":(i,t)=>(i*100).toFixed(t),b:i=>Math.round(i).toString(2),c:i=>i+"",d:sx,e:(i,t)=>i.toExponential(t),f:(i,t)=>i.toFixed(t),g:(i,t)=>i.toPrecision(t),o:i=>Math.round(i).toString(8),p:(i,t)=>eh(i*100,t),r:eh,s:lx,X:i=>Math.round(i).toString(16).toUpperCase(),x:i=>Math.round(i).toString(16)};function sh(i){return i}var nh=Array.prototype.map,rh=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function cx(i){var t=i.grouping===void 0||i.thousands===void 0?sh:nx(nh.call(i.grouping,Number),i.thousands+""),e=i.currency===void 0?"":i.currency[0]+"",s=i.currency===void 0?"":i.currency[1]+"",n=i.decimal===void 0?".":i.decimal+"",r=i.numerals===void 0?sh:rx(nh.call(i.numerals,String)),o=i.percent===void 0?"%":i.percent+"",a=i.minus===void 0?"":i.minus+"",l=i.nan===void 0?"NaN":i.nan+"";function c(u){u=Mr(u);var d=u.fill,f=u.align,m=u.sign,y=u.symbol,g=u.zero,E=u.width,T=u.comma,_=u.precision,b=u.trim,A=u.type;A==="n"?(T=!0,A="g"):ih[A]||(_===void 0&&(_=12),b=!0,A="g"),(g||d==="0"&&f==="=")&&(g=!0,d="0",f="=");var C=y==="$"?e:y==="#"&&/[boxX]/.test(A)?"0"+A.toLowerCase():"",R=y==="$"?s:/[%p]/.test(A)?o:"",O=ih[A],M=/[defgprs%]/.test(A);_=_===void 0?6:/[gprs]/.test(A)?Math.max(1,Math.min(21,_)):Math.max(0,Math.min(20,_));function w(I){var L=C,D=R,N,U,v;if(A==="c")D=O(I)+D,I="";else{I=+I;var P=I<0||1/I<0;if(I=isNaN(I)?l:O(Math.abs(I),_),b&&(I=ax(I)),P&&+I==0&&m!=="+"&&(P=!1),L=(P?m==="("?m:a:m==="-"||m==="("?"":m)+L,D=(A==="s"?rh[8+hf/3]:"")+D+(P&&m==="("?")":""),M){for(N=-1,U=I.length;++N<U;)if(v=I.charCodeAt(N),48>v||v>57){D=(v===46?n+I.slice(N+1):I.slice(N))+D,I=I.slice(0,N);break}}}T&&!g&&(I=t(I,1/0));var q=L.length+I.length+D.length,$=q<E?new Array(E-q+1).join(d):"";switch(T&&g&&(I=t($+I,$.length?E-D.length:1/0),$=""),f){case"<":I=L+I+D+$;break;case"=":I=L+$+I+D;break;case"^":I=$.slice(0,q=$.length>>1)+L+I+D+$.slice(q);break;default:I=$+L+I+D;break}return r(I)}return w.toString=function(){return u+""},w}function h(u,d){var f=c((u=Mr(u),u.type="f",u)),m=Math.max(-8,Math.min(8,Math.floor(xs(d)/3)))*3,y=Math.pow(10,-m),g=rh[8+m/3];return function(E){return f(y*E)+g}}return{format:c,formatPrefix:h}}var qn,uf,df;hx({thousands:",",grouping:[3],currency:["$",""]});function hx(i){return qn=cx(i),uf=qn.format,df=qn.formatPrefix,qn}function ux(i){return Math.max(0,-xs(Math.abs(i)))}function dx(i,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(xs(t)/3)))*3-xs(Math.abs(i)))}function fx(i,t){return i=Math.abs(i),t=Math.abs(t)-i,Math.max(0,xs(t)-xs(i))+1}function px(i,t){switch(arguments.length){case 0:break;case 1:this.range(i);break;default:this.range(t).domain(i);break}return this}function mx(i){return function(){return i}}function gx(i){return+i}var oh=[0,1];function as(i){return i}function Ra(i,t){return(t-=i=+i)?function(e){return(e-i)/t}:mx(isNaN(t)?NaN:.5)}function yx(i,t){var e;return i>t&&(e=i,i=t,t=e),function(s){return Math.max(i,Math.min(t,s))}}function Sx(i,t,e){var s=i[0],n=i[1],r=t[0],o=t[1];return n<s?(s=Ra(n,s),r=e(o,r)):(s=Ra(s,n),r=e(r,o)),function(a){return r(s(a))}}function Tx(i,t,e){var s=Math.min(i.length,t.length)-1,n=new Array(s),r=new Array(s),o=-1;for(i[s]<i[0]&&(i=i.slice().reverse(),t=t.slice().reverse());++o<s;)n[o]=Ra(i[o],i[o+1]),r[o]=e(t[o],t[o+1]);return function(a){var l=OT(i,a,1,s)-1;return r[l](n[l](a))}}function Ex(i,t){return t.domain(i.domain()).range(i.range()).interpolate(i.interpolate()).clamp(i.clamp()).unknown(i.unknown())}function _x(){var i=oh,t=oh,e=Ja,s,n,r,o=as,a,l,c;function h(){var d=Math.min(i.length,t.length);return o!==as&&(o=yx(i[0],i[d-1])),a=d>2?Tx:Sx,l=c=null,u}function u(d){return d==null||isNaN(d=+d)?r:(l||(l=a(i.map(s),t,e)))(s(o(d)))}return u.invert=function(d){return o(n((c||(c=a(t,i.map(s),Fe)))(d)))},u.domain=function(d){return arguments.length?(i=Array.from(d,gx),h()):i.slice()},u.range=function(d){return arguments.length?(t=Array.from(d),h()):t.slice()},u.rangeRound=function(d){return t=Array.from(d),e=U_,h()},u.clamp=function(d){return arguments.length?(o=d?!0:as,h()):o!==as},u.interpolate=function(d){return arguments.length?(e=d,h()):e},u.unknown=function(d){return arguments.length?(r=d,u):r},function(d,f){return s=d,n=f,h()}}function bx(){return _x()(as,as)}function xx(i,t,e,s){var n=DT(i,t,e),r;switch(s=Mr(s??",f"),s.type){case"s":{var o=Math.max(Math.abs(i),Math.abs(t));return s.precision==null&&!isNaN(r=dx(n,o))&&(s.precision=r),df(s,o)}case"":case"e":case"g":case"p":case"r":{s.precision==null&&!isNaN(r=fx(n,Math.max(Math.abs(i),Math.abs(t))))&&(s.precision=r-(s.type==="e"));break}case"f":case"%":{s.precision==null&&!isNaN(r=ux(n))&&(s.precision=r-(s.type==="%")*2);break}}return uf(s)}function Ax(i){var t=i.domain;return i.ticks=function(e){var s=t();return NT(s[0],s[s.length-1],e??10)},i.tickFormat=function(e,s){var n=t();return xx(n[0],n[n.length-1],e??10,s)},i.nice=function(e){e==null&&(e=10);var s=t(),n=0,r=s.length-1,o=s[n],a=s[r],l,c,h=10;for(a<o&&(c=o,o=a,a=c,c=n,n=r,r=c);h-- >0;){if(c=Ta(o,a,e),c===l)return s[n]=o,s[r]=a,t(s);if(c>0)o=Math.floor(o/c)*c,a=Math.ceil(a/c)*c;else if(c<0)o=Math.ceil(o*c)/c,a=Math.floor(a*c)/c;else break;l=c}return i},i}function ff(){var i=bx();return i.copy=function(){return Ex(i,ff())},px.apply(i,arguments),Ax(i)}function Zs(i,t,e){this.k=i,this.x=t,this.y=e}Zs.prototype={constructor:Zs,scale:function(i){return i===1?this:new Zs(this.k*i,this.x,this.y)},translate:function(i,t){return i===0&t===0?this:new Zs(this.k,this.x+this.k*i,this.y+this.k*t)},apply:function(i){return[i[0]*this.k+this.x,i[1]*this.k+this.y]},applyX:function(i){return i*this.k+this.x},applyY:function(i){return i*this.k+this.y},invert:function(i){return[(i[0]-this.x)/this.k,(i[1]-this.y)/this.k]},invertX:function(i){return(i-this.x)/this.k},invertY:function(i){return(i-this.y)/this.k},rescaleX:function(i){return i.copy().domain(i.range().map(this.invertX,this).map(i.invert,i))},rescaleY:function(i){return i.copy().domain(i.range().map(this.invertY,this).map(i.invert,i))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};Zs.prototype;function Jr(){const i=document.querySelector(".seekTo");i.classList.remove("popupAnim"),i.classList.add("popoutAnim"),i.close()}function Cx(){const i=document.querySelector(".seekTo");i.classList.remove("popoutAnim"),i.classList.add("popupAnim"),i.show()}function ah(){var e;const i=document.querySelector(".seekTo"),t=document.querySelector("#jumpToTime");if(t.blur(),!i.open){if((e=p.BEATMAP_FILE)!=null&&e.audioNode){const s=p.BEATMAP_FILE.audioNode.getCurrentTime(),n=Math.floor(s/6e4),r=Math.floor((s-n*6e4)/1e3),o=s-n*6e4-r*1e3;t.value=`${n.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}:${o.toFixed(0).padStart(3,"0")}`;const a=window.location.origin,l=p.BEATMAP_FILE!==void 0?p.BEATMAP_FILE.audioNode.getCurrentTime():0,c=B.CURRENT_MAPID||"";document.querySelector("#previewURL").value=`${a}${a.includes("github.io")?"/beatmap-viewer-how":""}?b=${c}&t=${l}`}Cx();return}Jr()}class ie{static createDigit(t=0,e="digit"){const s=new Od({text:e==="digit"?"0":":",style:{fontFamily:"Torus16",fontSize:16,align:"center",fontWeight:400}});return s.anchor.set(.5),s.x=t,s.y=e==="digit"?this.HEIGHT/2:this.HEIGHT/2-1,s}static init(){this.MASTER_CONTAINER=new gi(0,p.WRAPPER.h-60,110,60),this.MASTER_CONTAINER.color=p.COLOR_PALETTES.primary4,this.MASTER_CONTAINER.alpha=1,this.MASTER_CONTAINER.masterContainer.on("mouseenter",()=>{this.MASTER_CONTAINER.color=p.COLOR_PALETTES.primary5}),this.MASTER_CONTAINER.masterContainer.on("mouseleave",()=>{this.MASTER_CONTAINER.color=p.COLOR_PALETTES.primary4}),this.stage=this.MASTER_CONTAINER.container,this.WIDTH=120,this.HEIGHT=60;const t=new ut,e=new ut,s=new ut,n=new ut;this.colons=[];for(let r=0;r<2;r++){const o=this.createDigit(r*9);e.addChild(o),this.digits.minutes.push(o)}this.colons.push(this.createDigit(16,"colon")),e.addChild(this.colons.at(-1));for(let r=0;r<2;r++){const o=this.createDigit(r*9);s.addChild(o),this.digits.seconds.push(o)}this.colons.push(this.createDigit(16,"colon")),s.addChild(this.colons.at(-1));for(let r=0;r<3;r++){const o=this.createDigit(r*9);n.addChild(o),this.digits.miliseconds.push(o)}e.x=0,s.x=24,n.x=48,t.addChild(e,s,n),t.x=23,this.minutes=e,this.seconds=s,this.miliseconds=n,this.timeContainer=t,this.stage.addChild(t),this.rePosition(),this.MASTER_CONTAINER.masterContainer.on("click",()=>{ah()}),this.MASTER_CONTAINER.masterContainer.on("tap",()=>{ah()})}static rePosition(){this.MASTER_CONTAINER&&(this.MASTER_CONTAINER.x=0,innerWidth/innerHeight<1?(this.MASTER_CONTAINER.y=p.STATS.container.y+p.STATS.container.height+60-Y.HEIGHT_REDUCTION,this.MASTER_CONTAINER.w=p.WRAPPER.w/2,this.timeContainer.x=(this.MASTER_CONTAINER.w-this.timeContainer.width)/2):(this.MASTER_CONTAINER.y=p.WRAPPER.h-60,this.MASTER_CONTAINER.w=110,this.timeContainer.x=23),this.MASTER_CONTAINER.h=60,this.WIDTH=120,this.HEIGHT=60,this.minutes.x=0,this.seconds.x=24,this.miliseconds.x=48,this.colons.forEach(t=>{t.x=16,t.y=this.HEIGHT/2-1,t.style.fontSize=16}),this.digits.minutes.forEach((t,e)=>{t.x=9*e,t.y=this.HEIGHT/2,t.style.fontSize=16}),this.digits.seconds.forEach((t,e)=>{t.x=9*e,t.y=this.HEIGHT/2,t.style.fontSize=16}),this.digits.miliseconds.forEach((t,e)=>{t.x=9*e,t.y=this.HEIGHT/2,t.style.fontSize=16}))}static forceUpdate(t){const e=Sh(t),s=Sh(Si.lastTimestamp??0);e.miliseconds.forEach((n,r)=>{n!==s.miliseconds[r]&&(this.digits.miliseconds[r].text=n)}),e.seconds.forEach((n,r)=>{n!==s.seconds[r]&&(this.digits.seconds[r].text=n)}),e.minutes.forEach((n,r)=>{n!==s.minutes[r]&&(this.digits.minutes[r].text=n)}),this.EMIT_CHANGE&&this.rePosition()}static update(t){p.IS_FULLSCREEN?this.MASTER_CONTAINER.masterContainer.visible=p.IS_HOVERING_PROGRESS:this.MASTER_CONTAINER.masterContainer.visible=!0,p.EMIT_STACK.length!==0&&(this.EMIT_CHANGE=!0),this.forceUpdate(t),this.EMIT_CHANGE=!1}}S(ie,"renderer"),S(ie,"stage"),S(ie,"WIDTH"),S(ie,"HEIGHT"),S(ie,"MASTER_CONTAINER"),S(ie,"digits",{minutes:[],seconds:[],miliseconds:[]}),S(ie,"EMIT_CHANGE",!1);var pf;(()=>{var i={"./src/core/audio/HitSampleInfo.ts":(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.HitSampleInfo=void 0;class o{constructor(l,c=null,h=null,u=0){this.volume=0,this.name="",this.name=l,this.bank=c,this.suffix=h,this.volume=u}}r.HitSampleInfo=o,o.HIT_WHISTLE="hitwhistle",o.HIT_FINISH="hitfinish",o.HIT_NORMAL="hitnormal",o.HIT_CLAP="hitclap",o.ALL_ADDITIONS=[o.HIT_WHISTLE,o.HIT_CLAP,o.HIT_FINISH]},"./src/core/audio/LegacySampleBank.ts":(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.LegacySampleBank=void 0,function(o){o[o.None=0]="None",o[o.Normal=1]="Normal",o[o.Soft=2]="Soft",o[o.Drum=3]="Drum"}(r.LegacySampleBank||(r.LegacySampleBank={}))},"./src/core/beatmap/Beatmap.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.mostCommonBeatLength=r.Beatmap=void 0;const a=o("./src/core/beatmap/BeatmapDifficulty.ts"),l=o("./src/core/utils/index.ts"),c=o("./src/core/hitobjects/Types.ts"),h=o("./src/core/beatmap/ControlPoints/ControlPointInfo.ts");class u{constructor(y,g,E,T){this.hitObjects=y,this.difficulty=g,this.appliedMods=E,this.controlPointInfo=T,this.hitObjectDict=(0,l.normalizeHitObjects)(y),this.gameClockRate=(0,l.determineDefaultPlaybackSpeed)(E)}getHitObject(y){return this.hitObjectDict[y]}getSliderCheckPoint(y){return this.hitObjectDict[y]}getSlider(y){return this.hitObjectDict[y]}getHitCircle(y){return this.hitObjectDict[y]}getSpinner(y){return this.hitObjectDict[y]}}r.Beatmap=u,u.EMPTY_BEATMAP=new u([],a.DEFAULT_BEATMAP_DIFFICULTY,[],new h.ControlPointInfo);const d=m=>(0,c.isHitCircle)(m)?m.hitTime:m.endTime;function f({hitObjects:m,timingPoints:y}){let g=0;m.length>0?g=d(m[m.length-1]):y.length>0&&(g=y[y.length-1].time);const E=new Map;function T(b,A){b=Math.round(b*1e3)/1e3;const C=E.get(b);C===void 0?E.set(b,A):E.set(b,C+A)}for(let b=0;b<y.length;b++){const A=y[b];if(A.time>g)T(A.beatLength,0);else{const C=b===0?0:A.time,R=b+1===y.length?g:y[b+1].time;T(A.beatLength,R-C)}}const _=[];for(const b of E.keys())_.push({beatLength:b,duration:E.get(b)});if(_.sort((b,A)=>A.duration-b.duration),_.length!==0)return _[0].beatLength}r.mostCommonBeatLength=f},"./src/core/beatmap/BeatmapBuilder.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.buildBeatmap=void 0;const a=o("./src/core/hitobjects/HitCircle.ts"),l=o("./src/core/mods/Mods.ts"),c=o("./src/core/mods/StackingMod.ts"),h=o("./src/core/hitobjects/slider/SliderCheckPointGenerator.ts"),u=o("./src/core/hitobjects/slider/SliderPath.ts"),d=o("./src/core/hitobjects/Slider.ts"),f=o("./src/core/hitobjects/SliderCheckPoint.ts"),m=o("./src/core/beatmap/Beatmap.ts"),y=o("./src/core/hitobjects/Spinner.ts"),g=o("./src/math/index.ts"),E=o("./src/core/mods/HardRockMod.ts");function T({x:N,y:U}){return{x:N,y:U}}function _(N,U,v,P){const q=new a.HitCircle;return q.id=N,q.position=T(U.position),q.unstackedPosition=T(U.position),q.hitTime=U.time,q.scale=(0,g.circleSizeToScale)(P.circleSize),q.approachDuration=(0,g.approachRateToApproachDuration)(P.approachRate),q.fadeInDuration=(0,g.getFadeInDuration)(P.approachRate),q}function b(N,U,v){const P=new f.SliderCheckPoint(N),{time:q,spanStartTime:$,spanIndex:et,spanProgress:H}=v;return P.id=U,P.offset=N.path.positionAt(H),P.type=v.type,P.hitTime=q,P.spanIndex=et,P.spanStartTime=$,P.spanProgress=H,P}function A(N){const U=[];let v=0;for(const P of(0,h.generateSliderCheckpoints)(N.startTime,N.spanDuration,N.velocity,N.tickDistance,N.path.distance,N.spanCount,N.legacyLastTickOffset)){const q=`${N.id}/${v++}`;U.push(b(N,q,P))}return U}function C(N){return N.map(({type:U,offset:v})=>({type:U,offset:T(v)}))}function R(N,U,v,P){const q=(0,g.approachRateToApproachDuration)(P.approachRate);(0,g.getFadeInDuration)(P.approachRate);const $=(0,g.circleSizeToScale)(P.circleSize),et=U.time,H=v.timingPointAt(et),k=v.difficultyPointAt(et),F=d.Slider.BASE_SCORING_DISTANCE*P.sliderMultiplier*k.speedMultiplier,z=N.toString(),X=new a.HitCircle;X.id=`${N.toString()}/HEAD`,X.unstackedPosition=T(U.position),X.position=T(U.position),X.hitTime=U.time,X.approachDuration=q,X.scale=$,X.sliderId=z;const j=new d.Slider(X);return j.id=z,j.repeatCount=U.repeatCount,j.legacyLastTickOffset=U.legacyLastTickOffset,j.velocity=F/H.beatLength,j.tickDistance=F/P.sliderTickRate*U.tickDistanceMultiplier,j.path=new u.SliderPath(C(U.pathPoints),U.length),j.checkPoints=A(j),j}function O(N,U,v,P){const q=new y.Spinner;return q.id=N,q.startTime=U.time,q.duration=U.duration,q}function M(N,U,v,P){switch(U.type){case"HIT_CIRCLE":return _(N.toString(),U,v,P);case"SLIDER":return R(N,U,v,P);case"SPINNER":return O(N.toString(),U)}throw new Error("Type not recognized...")}function w(N,U){let v=-1,P=0;for(let q=0;q<U.length;q++){const{newCombo:$,comboSkip:et,type:H}=N[q],k=U[q];(q===0||$||H==="SPINNER")&&(v+=et+1,P=0),k instanceof a.HitCircle?(k.comboSetIndex=v,k.withinComboSetIndex=P++):k instanceof d.Slider&&(k.head.comboSetIndex=v,k.head.withinComboSetIndex=P++)}}function I(N){for(const U of N){const v=l.ModSettings[U].difficultyAdjuster;if(v!==void 0)return v}return U=>U}const L={addStacking:!0,mods:[]};function D(N,U){const{beatmapVersion:v,stackLeniency:P}=N.blueprintInfo,{mods:q,addStacking:$}=Object.assign(Object.assign({},L),U),et=I(q)(N.defaultDifficulty),H=N.hitObjectSettings.map((k,F)=>M(F,k,N.controlPointInfo,et));return w(N.hitObjectSettings,H),q.includes("HARD_ROCK")&&E.HardRockMod.flipVertically(H),$&&(0,c.modifyStackingPosition)(H,P,v),new m.Beatmap(H,et,q,N.controlPointInfo)}r.buildBeatmap=D},"./src/core/beatmap/BeatmapDifficulty.ts":(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.DEFAULT_BEATMAP_DIFFICULTY=void 0,r.DEFAULT_BEATMAP_DIFFICULTY=Object.freeze({drainRate:5,circleSize:5,overallDifficulty:5,approachRate:5,sliderMultiplier:1,sliderTickRate:1})},"./src/core/beatmap/ControlPoints/ControlPoint.ts":(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ControlPoint=void 0;class o{get time(){var l,c;return(c=(l=this.controlPointGroup)===null||l===void 0?void 0:l.time)!==null&&c!==void 0?c:0}compareTo(l){return this.time-l.time}attachGroup(l){this.controlPointGroup=l}}r.ControlPoint=o},"./src/core/beatmap/ControlPoints/ControlPointGroup.ts":(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ControlPointGroup=void 0;class o{constructor(l){this.time=0,this.controlPoints=[],this.time=l}add(l){var c,h;const u=this.controlPoints.findIndex(d=>d.type===l.type);if(u>-1){const d=this.controlPoints[u];this.controlPoints.splice(u,1),(c=this.controlPointInfo)===null||c===void 0||c.groupItemRemoved(d)}l.attachGroup(this),this.controlPoints.push(l),(h=this.controlPointInfo)===null||h===void 0||h.groupItemAdded(l)}}r.ControlPointGroup=o},"./src/core/beatmap/ControlPoints/ControlPointInfo.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ControlPointInfo=void 0;const a=o("./src/core/beatmap/ControlPoints/DifficultyControlPoint.ts"),l=o("./src/core/beatmap/ControlPoints/TimingControlPoint.ts"),c=o("./src/core/beatmap/ControlPoints/EffectControlPoint.ts"),h=o("./src/core/beatmap/ControlPoints/SampleControlPoint.ts"),u=o("./src/core/beatmap/ControlPoints/ControlPointGroup.ts"),d=o("./src/math/index.ts"),f=o("./src/core/utils/SortedList.ts");class m{constructor(){this.difficultyPoints=new f.SortedList,this.timingPoints=new f.SortedList,this.effectPoints=new f.SortedList,this.samplePoints=new f.SortedList,this.groups=[]}difficultyPointAt(g){return this.binarySearchWithFallback(this.difficultyPoints.list,g,a.DifficultyControlPoint.DEFAULT)}samplePointAt(g){return this.binarySearchWithFallback(this.samplePoints.list,g,this.samplePoints.length>0?this.samplePoints.list[0]:h.SampleControlPoint.DEFAULT)}add(g,E){return this.checkAlreadyExisting(g,E)?!1:(this.groupAt(g,!0).add(E),!0)}groupAt(g,E=!1){const T=new u.ControlPointGroup(g),_=this.groups.find(b=>(0,d.floatEqual)(b.time,g));return _||(E?(T.controlPointInfo=this,this.groups.push(T),this.groups.sort((b,A)=>b.time-A.time),T):null)}groupItemAdded(g){switch(g.type){case l.TimingControlPoint.TYPE:this.timingPoints.add(g);break;case c.EffectControlPoint.TYPE:this.effectPoints.add(g);break;case h.SampleControlPoint.TYPE:this.samplePoints.add(g);break;case a.DifficultyControlPoint.TYPE:this.difficultyPoints.add(g);break}}groupItemRemoved(g){switch(g.type){case l.TimingControlPoint.TYPE:this.timingPoints.remove(g);break;case c.EffectControlPoint.TYPE:this.effectPoints.remove(g);break;case h.SampleControlPoint.TYPE:this.samplePoints.remove(g);break;case a.DifficultyControlPoint.TYPE:this.difficultyPoints.remove(g);break}}timingPointAt(g){return this.binarySearchWithFallback(this.timingPoints.list,g,this.timingPoints.length>0?this.timingPoints.get(0):l.TimingControlPoint.DEFAULT)}effectPointAt(g){return this.binarySearchWithFallback(this.effectPoints.list,g,c.EffectControlPoint.DEFAULT)}binarySearchWithFallback(g,E,T){const _=this.binarySearch(g,E);return _??T}binarySearch(g,E){if(g===null)throw new Error("Argument null");if(g.length===0||E<g[0].time)return null;let T=0,_=g.length;for(;T<_;){const b=T+(_-T>>1);g[b].time<=E?T=b+1:_=b}return g[T-1]}checkAlreadyExisting(g,E){let T=null;switch(E.type){case l.TimingControlPoint.TYPE:T=this.binarySearch(this.timingPoints.list,g);break;case c.EffectControlPoint.TYPE:T=this.effectPointAt(g);break;case h.SampleControlPoint.TYPE:T=this.binarySearch(this.samplePoints.list,g);break;case a.DifficultyControlPoint.TYPE:T=this.difficultyPointAt(g);break}return T?E.isRedundant(T):!1}}r.ControlPointInfo=m},"./src/core/beatmap/ControlPoints/DifficultyControlPoint.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.DifficultyControlPoint=void 0;const a=o("./src/core/beatmap/ControlPoints/ControlPoint.ts");class l extends a.ControlPoint{constructor(){super(...arguments),this.speedMultiplier=1}get type(){return l.TYPE}isRedundant(h){return!1}}r.DifficultyControlPoint=l,l.DEFAULT=new l,l.TYPE="DifficultyControlPoint"},"./src/core/beatmap/ControlPoints/EffectControlPoint.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.EffectControlPoint=void 0;const a=o("./src/core/beatmap/ControlPoints/ControlPoint.ts");class l extends a.ControlPoint{constructor(){super(...arguments),this.kiaiMode=!1,this.omitFirstBarLine=!0}isRedundant(h){if(this.omitFirstBarLine||h.type!==l.TYPE)return!1;const u=h;return this.kiaiMode===u.kiaiMode&&this.omitFirstBarLine===u.omitFirstBarLine}get type(){return l.TYPE}}r.EffectControlPoint=l,l.TYPE="EffectControlPoint",l.DEFAULT=new l},"./src/core/beatmap/ControlPoints/SampleControlPoint.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.SampleControlPoint=void 0;const a=o("./src/core/beatmap/ControlPoints/ControlPoint.ts");class l extends a.ControlPoint{constructor(){super(...arguments),this.sampleBank=l.DEFAULT_BANK,this.sampleVolume=100}isRedundant(h){if(h.type!==l.TYPE)return!1;const u=h;return this.sampleBank===u.sampleBank&&this.sampleVolume===u.sampleVolume}get type(){return l.TYPE}}r.SampleControlPoint=l,l.TYPE="SampleControlPoint",l.DEFAULT_BANK="normal",l.DEFAULT=new l},"./src/core/beatmap/ControlPoints/TimingControlPoint.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.TimingControlPoint=void 0;const a=o("./src/core/beatmap/ControlPoints/ControlPoint.ts"),l=o("./src/core/beatmap/TimeSignatures.ts");class c extends a.ControlPoint{constructor(){super(...arguments),this.beatLength=1e3,this.timeSignature=l.TimeSignatures.SimpleQuadruple}get BPM(){return 6e4/this.beatLength}get type(){return c.TYPE}isRedundant(u){return!1}}r.TimingControlPoint=c,c.TYPE="TimingControlPoint"},"./src/core/beatmap/LegacyEffectFlag.ts":(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.LegacyEffectFlags=void 0,function(o){o[o.None=0]="None",o[o.Kiai=1]="Kiai",o[o.OmitFirstBarLine=8]="OmitFirstBarLine"}(r.LegacyEffectFlags||(r.LegacyEffectFlags={}))},"./src/core/beatmap/TimeSignatures.ts":(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.TimeSignatures=void 0,function(o){o[o.SimpleQuadruple=4]="SimpleQuadruple",o[o.SimpleTriple=3]="SimpleTriple"}(r.TimeSignatures||(r.TimeSignatures={}))},"./src/core/blueprint/Blueprint.ts":(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0})},"./src/core/blueprint/BlueprintParser.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.parseBlueprint=r.BlueprintSections=r.parseOsuHitObjectSetting=r.LegacyHitSampleInfo=void 0;const a=o("./src/math/index.ts"),l=o("./src/core/hitobjects/slider/PathType.ts"),c=o("./src/core/beatmap/TimeSignatures.ts"),h=o("./src/core/beatmap/LegacyEffectFlag.ts"),u=o("./src/core/beatmap/ControlPoints/TimingControlPoint.ts"),d=o("./src/core/beatmap/ControlPoints/DifficultyControlPoint.ts"),f=o("./src/core/beatmap/ControlPoints/EffectControlPoint.ts"),m=o("./src/core/beatmap/ControlPoints/SampleControlPoint.ts"),y=o("./src/core/audio/HitSampleInfo.ts"),g=o("./src/core/audio/LegacySampleBank.ts"),E=o("./src/core/beatmap/ControlPoints/ControlPointInfo.ts"),T=/^\s*\[(.+?)]\s*$/,_=36;function b(X){const j=X.indexOf("//");return j>=0?X.substr(0,j):X}var A;(function(X){X[X.Circle=1]="Circle",X[X.Slider=2]="Slider",X[X.NewCombo=4]="NewCombo",X[X.Spinner=8]="Spinner",X[X.ComboSkip=112]="ComboSkip",X[X.Hold=128]="Hold"})(A||(A={}));var C;(function(X){X[X.None=0]="None",X[X.Normal=1]="Normal",X[X.Whistle=2]="Whistle",X[X.Finish=4]="Finish",X[X.Clap=8]="Clap"})(C||(C={}));class R extends y.HitSampleInfo{constructor(j,V=null,W=0,K=0,tt=!1){super(j,V,K>=2?K.toString():null,W),this.isLayered=tt,this.customSampleBank=K}}r.LegacyHitSampleInfo=R;function O(X,j){return(X&j)!==0}function M(X,j=":"){var V,W;const K=X.split(j,2);return[K[0].trim(),(W=(V=K[1])===null||V===void 0?void 0:V.trim())!==null&&W!==void 0?W:""]}function w(X){switch(X[0]){default:case"C":return l.PathType.Catmull;case"B":return l.PathType.Bezier;case"L":return l.PathType.Linear;case"P":return l.PathType.PerfectCurve}}class I extends d.DifficultyControlPoint{constructor(j){super(),this.bpmMultiplier=j<0?(0,a.clamp)(-j,10,1e4)/100:1}}function L(X,j){const V=X.split("|"),W=[];let K=0,tt=0,ct=!0;for(;++tt<V.length;){if(V[tt].length>1)continue;const ht=tt<V.length-1?V[tt+1]:null,pt=U(V.slice(K,tt),ht,ct,j);W.push(...pt),K=tt,ct=!1}return tt>K&&W.push(...U(V.slice(K,tt),null,ct,j)),W}function D(X,j,V,W){const[K,tt]=X.split(":").map(parseFloat),ct=a.Vec2.sub({x:K,y:tt},j);V[W]={offset:ct}}function N(X){return(0,a.floatEqual)(0,(X[1].y-X[0].y)*(X[2].x-X[0].x)-(X[1].x-X[0].x)*(X[2].y-X[0].y))}function U(X,j,V,W){let K=w(X[0]);const tt=V?1:0,ct=X.length-1,ht=j!==null?1:0,pt=new Array(tt+ct+ht);for(let vt=0;vt<tt;vt++)pt[vt]={offset:a.Vec2.Zero};for(let vt=1;vt<X.length;vt++)D(X[vt],W,pt,tt+vt-1);j!==null&&D(j,W,pt,pt.length-1),K===l.PathType.PerfectCurve&&(pt.length!==3?K=l.PathType.Bezier:N(pt.map(vt=>vt.offset))&&(K=l.PathType.Linear)),pt[0].type=K;let It=0,Ct=0;const Dt=[];for(;++Ct<pt.length-ht;)a.Vec2.equal(pt[Ct].offset,pt[Ct-1].offset)&&Ct!==pt.length-ht-1&&(pt[Ct-1].type=K,Dt.push(...pt.slice(It,Ct)),It=Ct+1);return Ct>It&&Dt.push(...pt.slice(It,Ct)),Dt}function v(X){const j=X.split(","),V={x:parseFloat(j[0]),y:parseFloat(j[1])},W=0,K=parseFloat(j[2])+W,tt=parseInt(j[3]),ct=(tt&A.ComboSkip)>>4,ht=O(tt,A.NewCombo),pt=tt&~A.ComboSkip&~A.NewCombo;if(parseInt(j[4]),O(pt,A.Circle))return{type:"HIT_CIRCLE",time:K,position:V,newCombo:ht,comboSkip:ct};if(O(pt,A.Slider)){let It;const Ct=parseInt(j[6]);if(Ct>9e3)throw new Error("Slides count is way too high");const Dt=Math.max(0,Ct-1),vt=L(j[5],V);return j.length>7&&(It=Math.max(0,parseFloat(j[7])),It===0&&(It=void 0)),{type:"SLIDER",time:K,position:V,repeatCount:Dt,comboSkip:ct,newCombo:ht,pathPoints:vt,length:It,legacyLastTickOffset:_,tickDistanceMultiplier:1}}if(O(pt,A.Spinner)){const It=Math.max(0,parseFloat(j[5])+W-K);return{type:"SPINNER",comboSkip:ct,newCombo:ht,time:K,position:V,duration:It}}throw Error("Unknown type")}r.parseOsuHitObjectSetting=v;const P=()=>({audioLeadIn:0,beatmapVersion:0,stackLeniency:.7,onlineBeatmapId:void 0,metadata:{artist:"",title:"",titleUnicode:"",audioFile:"",artistUnicode:"",source:"",tags:"",previewTime:0,backgroundFile:"",backgroundOffset:{x:0,y:0}}}),q=()=>({circleSize:5,drainRate:5,overallDifficulty:5,sliderMultiplier:1,sliderTickRate:1});class ${constructor(j,V=F){this.applyOffsets=!0,this.defaultSampleVolume=100,this.hitObjectSettings=[],this.controlPointInfo=new E.ControlPointInfo,this.defaultSampleBank=g.LegacySampleBank.None,this.pendingControlPoints=[],this.pendingControlPointTypes={},this.pendingControlPointsTime=0,this.data=j,this.currentSection=null,this.formatVersion=V.formatVersion,this.sectionsToRead=V.sectionsToRead,this.blueprintInfo=P(),this.blueprintDifficulty=q(),this.sectionsFinishedReading=[],this.offset=this.formatVersion<=4?24:0}isFinishedReading(){return this.sectionsToRead<=this.sectionsFinishedReading}parseLine(j){const V=b(j);if(V){if(!this.currentSection&&V.includes("osu file format v")){this.blueprintInfo.beatmapVersion=parseInt(V.split("osu file format v")[1],10);return}if(T.test(V)){this.currentSection!==null&&this.sectionsToRead.includes(this.currentSection)&&this.sectionsFinishedReading.push(this.currentSection),this.currentSection=T.exec(V)[1];return}if(!(this.currentSection===null||this.sectionsToRead.indexOf(this.currentSection)===-1))switch(this.currentSection){case"General":this.handleGeneral(V);break;case"Metadata":this.handleMetadata(V);break;case"Difficulty":this.handleDifficulty(V);break;case"HitObjects":this.handleHitObjects(V);break;case"TimingPoints":this.handleTimingPoints(V);break;case"Events":this.handleEvents(V);break;case"Editor":this.handleEditor(V);break}}}handleEvents(j){const[V,W,...K]=j.split(",");switch(V){case"0":{const[tt,ct,ht]=K;this.blueprintInfo.metadata.backgroundFile=tt.replace(/"/g,""),this.blueprintInfo.metadata.backgroundOffset={x:parseInt(ct??"0"),y:parseInt(ht??"0")}}}}handleGeneral(j){const[V,W]=M(j),K=this.blueprintInfo,tt=K.metadata;switch(V){case"AudioFilename":tt.audioFile=W;break;case"AudioLeadIn":K.audioLeadIn=parseInt(W);break;case"PreviewTime":break;case"Countdown":break;case"SampleSet":this.defaultSampleBank=parseInt(W);break;case"SampleVolume":break;case"StackLeniency":K.stackLeniency=Math.fround(parseFloat(W));break}}handleEditor(j){M(j)}handleMetadata(j){const[V,W]=M(j),tt=this.blueprintInfo.metadata;switch(V){case"Title":tt.title=W;break;case"TitleUnicode":tt.titleUnicode=W;break;case"Artist":tt.artist=W;break;case"ArtistUnicode":tt.artistUnicode=W;break;case"Creator":break;case"Version":break;case"Source":break;case"Tags":tt.tags=W;break}}handleDifficulty(j){const[V,W]=M(j),K=this.blueprintDifficulty;switch(V){case"HPDrainRate":K.drainRate=parseFloat(W);break;case"CircleSize":K.circleSize=parseFloat(W);break;case"OverallDifficulty":K.overallDifficulty=parseFloat(W);break;case"ApproachRate":K.approachRate=parseFloat(W);break;case"SliderMultiplier":K.sliderMultiplier=parseFloat(W);break;case"SliderTickRate":K.sliderTickRate=parseFloat(W);break}}handleHitObjects(j){const V=v(j);V&&this.hitObjectSettings.push(V)}handleTimingPoints(j){const V=j.split(","),W=this.getOffsetTime(parseFloat(V[0].trim())),K=parseFloat(V[1].trim()),tt=K<0?100/-K:1;let ct=c.TimeSignatures.SimpleQuadruple;V.length>=3&&(ct=V[2][0]==="0"?c.TimeSignatures.SimpleQuadruple:parseInt(V[2]));let ht=this.defaultSampleBank;V.length>=4&&(ht=parseInt(V[3])),V.length>=5&&parseInt(V[4]);let pt=this.defaultSampleVolume;V.length>=6&&(pt=parseInt(V[5]));let It=!0;V.length>=7&&(It=V[6][0]==="1");let Ct=!1,Dt=!1;if(V.length>=8){const Ht=parseInt(V[7]);Ct=O(Ht,h.LegacyEffectFlags.Kiai),Dt=O(Ht,h.LegacyEffectFlags.OmitFirstBarLine)}let vt=g.LegacySampleBank[ht].toLowerCase();if(vt==="none"&&(vt="normal"),It){const Ht=this.createTimingControlPoint();if(Number.isNaN(K))throw Error("NaN");Ht.beatLength=(0,a.clamp)(K,et,H),Ht.timeSignature=ct,this.addControlPoint(W,Ht,!0)}{const Ht=new I(K);Ht.speedMultiplier=k(tt,{min:.1,max:10,precision:.01}),this.addControlPoint(W,Ht,It)}{const Ht=new f.EffectControlPoint;Ht.kiaiMode=Ct,Ht.omitFirstBarLine=Dt,this.addControlPoint(W,Ht,It)}{const Ht=new m.SampleControlPoint;Ht.sampleBank=vt,Ht.sampleVolume=pt,this.addControlPoint(W,Ht,It)}}createTimingControlPoint(){return new u.TimingControlPoint}addControlPoint(j,V,W){(0,a.floatEqual)(j,this.pendingControlPointsTime)||this.flushPendingPoints(),W?this.pendingControlPoints.splice(0,0,V):this.pendingControlPoints.push(V),this.pendingControlPointsTime=j}flushPendingPoints(){for(let j=this.pendingControlPoints.length-1;j>=0;j--){const V=this.pendingControlPoints[j].type;this.pendingControlPointTypes[V]||(this.pendingControlPointTypes[V]=!0,this.controlPointInfo.add(this.pendingControlPointsTime,this.pendingControlPoints[j]))}this.pendingControlPoints=[],this.pendingControlPointTypes={}}getOffsetTime(j){return j+(this.applyOffsets?this.offset:0)}parse(){var j;if(!this.data)throw new Error("No data given");const V=this.data.split(`
`).map(W=>W.trim());for(const W of V){try{this.parseLine(W)}catch(K){console.error(`Failed to parse line ${W} due to: `,K)}if(this.isFinishedReading())break}return this.flushPendingPoints(),{blueprintInfo:this.blueprintInfo,defaultDifficulty:Object.assign(Object.assign({},this.blueprintDifficulty),{approachRate:(j=this.blueprintDifficulty.approachRate)!==null&&j!==void 0?j:this.blueprintDifficulty.overallDifficulty}),hitObjectSettings:this.hitObjectSettings,controlPointInfo:this.controlPointInfo}}}$.LATEST_VERSION=14;const et=6,H=6e4;function k(X,{min:j,max:V,precision:W}){return(0,a.clamp)(X,j,V)}r.BlueprintSections=["General","Metadata","Difficulty","HitObjects","TimingPoints","Events","Editor","Colours"];const F={formatVersion:$.LATEST_VERSION,sectionsToRead:r.BlueprintSections};function z(X,j){const V=Object.assign(Object.assign({},F),j);return new $(X,V).parse()}r.parseBlueprint=z},"./src/core/blueprint/HitObjectSettings.ts":(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0})},"./src/core/gameplay/GameState.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.cloneGameState=r.defaultGameState=r.NOT_PRESSING=void 0;const a=o("./src/math/index.ts");r.NOT_PRESSING=727727727;const l=()=>({eventIndex:0,currentTime:0,cursorPosition:a.Vec2.Zero,hitCircleVerdict:{},sliderBodyState:new Map,checkPointVerdict:{},spinnerState:new Map,sliderVerdict:{},clickWasUseful:!1,latestHitObjectIndex:0,aliveHitCircleIds:new Set,aliveSliderIds:new Set,aliveSpinnerIds:new Set,judgedObjects:[],pressingSince:[r.NOT_PRESSING,r.NOT_PRESSING]});r.defaultGameState=l;function c(h){const{aliveHitCircleIds:u,aliveSliderIds:d,aliveSpinnerIds:f,spinnerState:m,sliderBodyState:y,checkPointVerdict:g,hitCircleVerdict:E,sliderVerdict:T,eventIndex:_,clickWasUseful:b,currentTime:A,cursorPosition:C,latestHitObjectIndex:R,pressingSince:O,judgedObjects:M}=h;return{eventIndex:_,aliveHitCircleIds:new Set(u),aliveSliderIds:new Set(d),aliveSpinnerIds:new Set(f),hitCircleVerdict:Object.assign({},E),sliderVerdict:Object.assign({},T),checkPointVerdict:Object.assign({},g),currentTime:A,cursorPosition:C,latestHitObjectIndex:R,judgedObjects:[...M],clickWasUseful:b,sliderBodyState:new Map(y),spinnerState:new Map(m),pressingSince:O.slice()}}r.cloneGameState=c},"./src/core/gameplay/GameStateEvaluator.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.newPressingSince=r.GameStateEvaluator=void 0;const a=o("./src/math/index.ts"),l=o("./src/core/gameplay/GameState.ts"),c=o("./src/core/hitobjects/Types.ts"),h=o("./src/core/replays/Replay.ts"),u=o("./src/core/mods/Mods.ts");function d(C,R){const O=[],M=R[2],w=I=>{O.push({time:I.hitTime-I.approachDuration,hitObjectId:I.id,type:"HIT_CIRCLE_SPAWN"}),O.push({time:I.hitTime+M+1,hitObjectId:I.id,type:"HIT_CIRCLE_FORCE_KILL"})};for(const I of C.hitObjects)(0,c.isHitCircle)(I)?w(I):(0,c.isSlider)(I)?(w(I.head),O.push({time:I.startTime,hitObjectId:I.id,type:"SLIDER_START"}),O.push({time:I.endTime,hitObjectId:I.id,type:"SLIDER_END"}),I.checkPoints.forEach(L=>{O.push({time:L.hitTime,hitObjectId:L.id,type:"SLIDER_CHECK_POINT"})})):(0,c.isSpinner)(I)&&(O.push({time:I.startTime,hitObjectId:I.id,type:"SPINNER_START"}),O.push({time:I.endTime,hitObjectId:I.id,type:"SPINNER_END"}));return O.sort((I,L)=>I.time-L.time),O}const f={noteLockStyle:"STABLE",hitWindowStyle:"OSU_STABLE"},m={GREAT:0,OK:1,MEH:2,MISS:3};function y(C,R,O){return Math.abs(R)<=C[m[O]]}class g{constructor(R,O){this.beatmap=R,this.gameState=(0,l.defaultGameState)(),this.frame={time:0,position:{x:0,y:0},actions:[]},this.options=Object.assign(Object.assign({},f),O),this.hitWindows=(0,a.hitWindowsForOD)(R.difficulty.overallDifficulty,this.options.hitWindowStyle==="OSU_LAZER"),this.events=d(R,this.hitWindows)}judgeHitCircle(R,O){this.gameState.hitCircleVerdict[R]=O,this.gameState.aliveHitCircleIds.delete(R),this.gameState.judgedObjects.push(R)}handleHitCircleSpawn(R,O){this.gameState.aliveHitCircleIds.add(O)}handleHitCircleForceKill(R,O){if(!this.gameState.aliveHitCircleIds.has(O))return;const M={judgementTime:R,type:"MISS",missReason:"TIME_EXPIRED"};this.judgeHitCircle(O,M)}handleSliderStart(R,O){this.gameState.aliveSliderIds.add(O)}handleSliderEnding(R,O){var M;const w=this.beatmap.getSlider(O),I=this.gameState.hitCircleVerdict[w.head.id];I===void 0&&this.judgeHitCircle(w.head.id,{judgementTime:w.endTime,type:"MISS",missReason:"SLIDER_FINISHED_FASTER"});const L=w.checkPoints.length+1;let D=0;I===void 0||I.type==="MISS"||D++;for(const N of w.checkPoints)D+=!((M=this.gameState.checkPointVerdict[N.id])===null||M===void 0)&&M.hit?1:0;this.gameState.sliderVerdict[w.id]=_(L,D),this.gameState.judgedObjects.push(w.id),this.gameState.aliveSliderIds.delete(O),this.gameState.sliderBodyState.delete(O)}predictedCursorPositionAt(R){const O=this.gameState.currentTime,M=this.frame.time,w=this.gameState.cursorPosition,I=this.frame.position;if(O===M)return w;const L=(R-O)/(M-O);return a.Vec2.interpolate(w,I,L)}handleSliderCheckPoint(R,O){const M=this.predictedCursorPositionAt(R),w=this.beatmap.getSliderCheckPoint(O);this.updateSliderBodyTracking(R,M,this.gameState.pressingSince);const I=w.slider.id,L=this.gameState.sliderBodyState.get(I);if(L===void 0)throw Error("Somehow the slider body has no state while there is a checkpoint alive.");this.gameState.checkPointVerdict[O]={hit:L.isTracking},this.gameState.judgedObjects.push(O)}handleSpinnerStart(R){this.gameState.aliveSpinnerIds.add(R)}handleSpinnerEnd(R){this.gameState.aliveSpinnerIds.delete(R),this.gameState.judgedObjects.push(R)}handleEvent(R){const{hitObjectId:O,time:M,type:w}=R;switch(w){case"HIT_CIRCLE_SPAWN":this.handleHitCircleSpawn(M,O);break;case"HIT_CIRCLE_FORCE_KILL":this.handleHitCircleForceKill(M,O);break;case"SLIDER_START":this.handleSliderStart(M,O);break;case"SLIDER_END":this.handleSliderEnding(M,O);break;case"SLIDER_CHECK_POINT":this.handleSliderCheckPoint(M,O);break;case"SPINNER_START":this.handleSpinnerStart(O);break;case"SPINNER_END":this.handleSpinnerEnd(O);break}}handleAliveHitCircles(){const R=this.beatmap.appliedMods.includes("RELAX");if(!this.hasFreshClickThisFrame&&!R)return;const{noteLockStyle:O}=this.options,M=this.gameState.currentTime;let w=!1;const I=Array.from(this.gameState.aliveHitCircleIds.values());for(let L=0;L<I.length;L++){const D=I[L],N=this.beatmap.getHitCircle(D);if(!a.Vec2.withinDistance(N.position,this.gameState.cursorPosition,Math.fround(N.radius))){O==="STABLE"&&(w=!0),O==="LAZER"&&M<=N.hitTime&&(w=!0);continue}if(w)break;const v=M-N.hitTime;if(R&&v<-u.RELAX_LENIENCY)break;let P=!1;for(const q of["GREAT","OK","MEH"])if(y(this.hitWindows,v,q)){this.judgeHitCircle(N.id,{judgementTime:M,type:q}),P=!0;break}if(P||(y(this.hitWindows,v,"MISS")&&(this.judgeHitCircle(N.id,{judgementTime:M,type:"MISS",missReason:"HIT_TOO_EARLY"}),P=!0),P))break}}get hasFreshClickThisFrame(){return this.gameState.pressingSince.includes(this.gameState.currentTime)}headHitTime(R){const O=this.gameState.hitCircleVerdict[R];if(!(!O||O.type==="MISS"))return O.judgementTime}updateSliderBodyTracking(R,O,M){var w,I;for(const L of this.gameState.aliveSliderIds){const D=this.beatmap.getSlider(L),N=this.headHitTime(D.head.id),U=(I=(w=this.gameState.sliderBodyState.get(L))===null||w===void 0?void 0:w.isTracking)!==null&&I!==void 0?I:!1,v=this.beatmap.appliedMods.includes("RELAX"),P=T(U,D,O,R,M,N,v);this.gameState.sliderBodyState.set(L,{isTracking:P})}}handleEventsUntilTime(R){const{gameState:O,events:M}=this;for(;O.eventIndex<M.length;){const w=M[O.eventIndex];if(w.time>R)break;O.eventIndex+=1,this.handleEvent(w)}}evaluate(R,O){this.gameState=R,this.frame=O,this.handleEventsUntilTime(O.time-1),this.gameState.cursorPosition=O.position,this.gameState.currentTime=O.time,this.gameState.pressingSince=(0,r.newPressingSince)(this.gameState.pressingSince,O.actions,O.time),this.gameState.clickWasUseful=!1,this.handleAliveHitCircles(),this.updateSliderBodyTracking(O.time,O.position,this.gameState.pressingSince),this.handleEventsUntilTime(O.time)}}r.GameStateEvaluator=g;const E=(C,R)=>(R-C.startTime)/C.duration;function T(C,R,O,M,w,I,L){if(!(w.findIndex(P=>P!==l.NOT_PRESSING)>=0)&&!L||M<R.startTime||R.endTime<=M)return!1;const N=E(R,M),U=(C?2.4:1)*R.radius;return a.Vec2.distance(R.ballPositionAt(N),O)>U?!1:I===void 0?!0:w.findIndex(P=>P>=I)>=0}function _(C,R){return R===C?"GREAT":R===0?"MISS":R*2>=C?"OK":"MEH"}const b=C=>[C.includes(h.OsuAction.leftButton),C.includes(h.OsuAction.rightButton)],A=(C,R,O)=>{const M=b(R),w=[...C];for(let I=0;I<w.length;I++)M[I]?w[I]=Math.min(w[I],O):w[I]=l.NOT_PRESSING;return w};r.newPressingSince=A},"./src/core/gameplay/GameStateTimeMachine.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.BucketedGameStateTimeMachine=void 0;const a=o("./src/core/gameplay/GameState.ts"),l=o("./src/math/index.ts"),c=o("./src/core/gameplay/GameStateEvaluator.ts");class h{constructor(d,f,m,y){this.beatmap=f,this.settings=m,this.currentIndex=0,this.storedGameState=[],this.frames=[{time:-727727,position:new l.Vec2(0,0),actions:[]},...d],this.bucketSize=y??Math.ceil(Math.sqrt(this.frames.length)),this.storedGameState[0]=(0,a.defaultGameState)(),this.currentGameState=(0,a.cloneGameState)(this.storedGameState[0]),this.evaluator=new c.GameStateEvaluator(f,m)}getHighestCachedIndex(d){for(let f=0;f<this.frames.length;f+=this.bucketSize)if(d<this.frames[f].time||!this.storedGameState[f])return f-this.bucketSize;return 0}gameStateAt(d){const f=this.getHighestCachedIndex(d);for((this.currentIndex<f||d<this.frames[this.currentIndex].time)&&(this.currentIndex=f,this.currentGameState=(0,a.cloneGameState)(this.storedGameState[this.currentIndex]));this.currentIndex+1<this.frames.length;){const m=this.frames[this.currentIndex+1];if(d<m.time)break;this.evaluator.evaluate(this.currentGameState,m),this.currentIndex+=1,this.currentIndex%this.bucketSize===0&&(this.storedGameState[this.currentIndex]=(0,a.cloneGameState)(this.currentGameState))}return this.currentGameState}}r.BucketedGameStateTimeMachine=h},"./src/core/gameplay/GameplayAnalysisEvent.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.retrieveEvents=r.isHitObjectJudgement=void 0;const a=o("./src/core/utils/index.ts"),l=h=>h.type==="HitObjectJudgement";r.isHitObjectJudgement=l;function c(h,u){var d;const f=[],m=(0,a.normalizeHitObjects)(u);for(const y in h.hitCircleVerdict){const g=h.hitCircleVerdict[y],E=m[y],T=E.sliderId!==void 0,_=g.type;f.push({type:"HitObjectJudgement",time:g.judgementTime,hitObjectId:y,position:E.position,verdict:_,isSliderHead:T})}for(const y in h.sliderVerdict){const g=h.sliderVerdict[y],E=m[y],T=E.endPosition;f.push({time:E.endTime,hitObjectId:y,position:T,verdict:g,type:"HitObjectJudgement"});for(const _ of E.checkPoints){const b=h.checkPointVerdict[_.id],A=(d=b==null?void 0:b.hit)!==null&&d!==void 0?d:!1,C=_.type==="LAST_LEGACY_TICK";f.push({time:E.endTime,position:_.position,type:"CheckpointJudgement",hit:A,isLastTick:C})}}return f}r.retrieveEvents=c},"./src/core/gameplay/GameplayInfo.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.GameplayInfoEvaluator=r.defaultGameplayInfo=r.osuStableAccuracy=void 0;const a=o("./src/core/hitobjects/HitCircle.ts"),l=o("./src/core/hitobjects/Slider.ts"),c=o("./src/core/hitobjects/SliderCheckPoint.ts");function h(m,y,g){let E=m.currentCombo;switch(y){case"HIT_CIRCLE":case"TICK":case"REPEAT":case"SPINNER":E=g?E+1:0;break;case"LAST_LEGACY_TICK":E+=g?1:0;break}return{currentCombo:E,maxComboSoFar:Math.max(m.maxComboSoFar,E)}}function u(m){if(m.length!==4)return;const y=[300,100,50,0];let g=0,E=0;for(let T=0;T<m.length;T++)E+=y[T]*m[T],g+=y[0]*m[T];if(g!==0)return E/g}r.osuStableAccuracy=u;const d={scoringSystem:"ScoreV1"};r.defaultGameplayInfo=Object.freeze({currentCombo:0,maxComboSoFar:0,verdictCounts:[0,0,0,0],accuracy:0,score:0});class f{constructor(y,g){this.beatmap=y,this.options=Object.assign(Object.assign({},d),g),this.comboInfo={maxComboSoFar:0,currentCombo:0},this.verdictCount={MISS:0,MEH:0,GREAT:0,OK:0},this.judgedObjectsIndex=0}evaluateHitObject(y,g,E){this.comboInfo=h(this.comboInfo,y,g!=="MISS"),E||(this.verdictCount[g]+=1)}evaluateSliderCheckpoint(y,g){this.comboInfo=h(this.comboInfo,y,g)}countAsArray(){return["GREAT","OK","MEH","MISS"].map(y=>this.verdictCount[y])}evaluateReplayState(y){var g;for(this.judgedObjectsIndex>=y.judgedObjects.length+1&&(this.comboInfo={maxComboSoFar:0,currentCombo:0},this.verdictCount={MISS:0,MEH:0,GREAT:0,OK:0},this.judgedObjectsIndex=0);this.judgedObjectsIndex<y.judgedObjects.length;){const T=y.judgedObjects[this.judgedObjectsIndex++],_=this.beatmap.getHitObject(T);if(_ instanceof c.SliderCheckPoint){const b=y.checkPointVerdict[_.id].hit;this.evaluateSliderCheckpoint(_.type,b)}else if(_ instanceof a.HitCircle){const b=y.hitCircleVerdict[T].type,A=_.sliderId!==void 0;this.evaluateHitObject(_.type,b,A)}else if(_ instanceof l.Slider){const b=y.sliderVerdict[_.id];this.evaluateHitObject(_.type,b)}else this.evaluateHitObject("SPINNER","GREAT")}const E=this.countAsArray();return{score:0,verdictCounts:E,accuracy:(g=u(E))!==null&&g!==void 0?g:1,currentCombo:this.comboInfo.currentCombo,maxComboSoFar:this.comboInfo.maxComboSoFar}}}r.GameplayInfoEvaluator=f},"./src/core/gameplay/Verdicts.ts":(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0})},"./src/core/hitobjects/HitCircle.ts":(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.HitCircle=void 0;class o{constructor(){this.id="",this.hitTime=0,this.approachDuration=0,this.fadeInDuration=0,this.comboSetIndex=0,this.withinComboSetIndex=0,this.scale=1,this.position={x:0,y:0},this.unstackedPosition={x:0,y:0}}get type(){return"HIT_CIRCLE"}get radius(){return o.OBJECT_RADIUS*this.scale}get spawnTime(){return this.hitTime-this.approachDuration}get timeFadeIn(){return this.fadeInDuration}opacityAt(l,c){if(l>this.hitTime)return 0;let h=this.spawnTime,u=this.timeFadeIn;if(c){let d=h+u,f=this.approachDuration*.3;return Math.min(Math.min(Math.max((l-h)/u,0),1),1-Math.min(Math.max((l-d)/f,0),1))}return Math.min(Math.max((l-h)/u,0),1)}}r.HitCircle=o,o.OBJECT_RADIUS=64},"./src/core/hitobjects/Slider.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Slider=void 0;const a=o("./src/core/hitobjects/slider/SliderPath.ts"),l=o("./src/math/index.ts");class c{constructor(u){this.id="",this.path=new a.SliderPath([]),this.checkPoints=[],this.velocity=1,this.tickDistance=0,this.tickDistanceMultiplier=1,this.repeatCount=0,this.head=u}get type(){return"SLIDER"}get spawnTime(){return this.head.spawnTime}get spanCount(){return this.repeatCount+1}get scale(){return this.head.scale}get radius(){return this.head.radius}get spanDuration(){return this.duration/this.spanCount}get duration(){return this.endTime-this.startTime}get startTime(){return this.head.hitTime}get endTime(){return this.startTime+this.spanCount*this.path.distance/this.velocity}get startPosition(){return this.head.position}get endPosition(){return l.Vec2.add(this.head.position,this.ballOffsetAt(1))}get unstackedEndPosition(){return l.Vec2.add(this.head.unstackedPosition,this.ballOffsetAt(1))}ballPositionAt(u){return l.Vec2.add(this.head.position,this.ballOffsetAt(u))}ballOffsetAt(u){const d=u*this.spanCount;let f=d%1;return Math.floor(d)%2===1&&(f=1-f),this.path.positionAt(f)}}r.Slider=c,c.BASE_SCORING_DISTANCE=100},"./src/core/hitobjects/SliderCheckPoint.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.SliderCheckPoint=void 0;const a=o("./src/math/index.ts");class l{constructor(h){this.slider=h,this.id="",this.type="TICK",this.spanIndex=0,this.spanProgress=0,this.spanStartTime=0,this.offset={x:0,y:0},this.hitTime=0}get position(){return a.Vec2.add(this.slider.startPosition,this.offset)}get scale(){return this.slider.scale}}r.SliderCheckPoint=l},"./src/core/hitobjects/Spinner.ts":(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Spinner=void 0;class o{constructor(){this.id="",this.startTime=0,this.duration=0,this.spinsRequired=1,this.maximumBonusSpins=1}get spawnTime(){return this.startTime}get endTime(){return this.startTime+this.duration}get type(){return"SPINNER"}}r.Spinner=o},"./src/core/hitobjects/Types.ts":(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.isSpinner=r.isSlider=r.isHitCircle=void 0;const o=c=>c.type==="HIT_CIRCLE";r.isHitCircle=o;const a=c=>c.type==="SLIDER";r.isSlider=a;const l=c=>c.type==="SPINNER";r.isSpinner=l},"./src/core/hitobjects/slider/PathApproximator.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PathApproximator=void 0;const a=o("./src/math/index.ts"),l=Math.fround(.25),c=Math.fround(.1),h=50,u=f=>Math.fround(f);class d{static approximateBezier(m,y=0){var g;const E=[],T=m.length-1;if(T<0)return E;const _=[],b=[],A=[...m];if(y>0&&y<T){for(let M=0;M<T-y;M++){const w=new Array(y+1);w[0]=A[M];for(let I=0;I<y-1;I++){w[I+1]=A[M+1];for(let L=1;L<y-I;L++){const D=Math.min(L,T-y-M);A[M+L]=A[M+L].scale(D).add(A[M+L+1]).scale(1/(D+1))}}w[y]=A[M+1],_.push(w)}_.push(A.slice(T-y,A.length)),_.reverse()}else y=T,_.push(A);const C=new Array(y+1),R=new Array(y*2+1),O=R;for(;_.length>0;){const M=_.pop();if(d._bezierIsFlatEnough(M)){d._bezierApproximate(M,E,C,R,y+1),b.push(M);continue}const w=(g=b.pop())!==null&&g!==void 0?g:new Array(y+1);d._bezierSubdivide(M,O,w,C,y+1);for(let I=0;I<y+1;++I)M[I]=O[I];_.push(w),_.push(M)}return E.push(m[T]),E}static approximateCatmull(m){const y=[],g=m.length;for(let E=0;E<g-1;E++){const T=E>0?m[E-1]:m[E],_=m[E],b=E<g-1?m[E+1]:_.add(_).sub(T),A=E<g-2?m[E+2]:b.add(b).sub(_);for(let C=0;C<h;C++)y.push(d._catmullFindPoint(T,_,b,A,Math.fround(C/h))),y.push(d._catmullFindPoint(T,_,b,A,Math.fround((C+1)/h)))}return y}static circularArcProperties(m){const y=m[0],g=m[1],E=m[2];if((0,a.floatEqual)(0,(0,a.float32)((0,a.float32_mul)(g.y-y.y,E.x-y.x)-(0,a.float32_mul)(g.x-y.x,E.y-y.y))))return;const T=(0,a.float32_mul)(2,(0,a.float32_add)((0,a.float32_add)((0,a.float32_mul)(y.x,g.sub(E).y),(0,a.float32_mul)(g.x,E.sub(y).y)),(0,a.float32_mul)(E.x,y.sub(g).y))),_=u(y.lengthSquared()),b=u(g.lengthSquared()),A=u(E.lengthSquared()),C=u((0,a.float32_add)((0,a.float32_add)((0,a.float32_mul)(_,g.sub(E).y),(0,a.float32_mul)(b,E.sub(y).y)),(0,a.float32_mul)(A,y.sub(g).y))),R=u((0,a.float32_add)((0,a.float32_add)((0,a.float32_mul)(_,E.sub(g).x),(0,a.float32_mul)(b,y.sub(E).x)),(0,a.float32_mul)(A,g.sub(y).x))),O=new a.Vec2(C,R).divide(T),M=y.sub(O),w=E.sub(O),I=u(M.length()),L=Math.atan2(M.y,M.x);let D=Math.atan2(w.y,w.x);for(;D<L;)D+=2*Math.PI;let N=1,U=D-L,v=E.sub(y);return v=new a.Vec2(v.y,-v.x),a.Vec2.dot(v,g.sub(y))<0&&(N=-N,U=2*Math.PI-U),{thetaStart:L,thetaRange:U,direction:N,radius:I,center:O}}static approximateCircularArc(m){const y=d.circularArcProperties(m);if(!y)return d.approximateBezier(m);const{radius:g,center:E,thetaRange:T,thetaStart:_,direction:b}=y,A=2*g<=c?2:Math.max(2,Math.ceil(T/(2*Math.acos(1-(0,a.float32_div)(c,g))))),C=[];for(let R=0;R<A;++R){const O=R/(A-1),M=_+b*O*T,w=new a.Vec2(u(Math.cos(M)),u(Math.sin(M))).scale(g);C.push(E.add(w))}return C}static approximateLinear(m){return[...m]}static approximateLagrangePolynomial(m){const g=[],E=d._barycentricWeights(m);let T=m[0].x,_=m[0].x;for(let A=1;A<m.length;A++)T=Math.min(T,m[A].x),_=Math.max(_,m[A].x);const b=_-T;for(let A=0;A<51;A++){const C=T+b/50*A,R=Math.fround(d._barycentricLagrange(m,E,C));g.push(new a.Vec2(C,R))}return g}static _barycentricWeights(m){const y=m.length,g=[];for(let E=0;E<y;E++){g[E]=1;for(let T=0;T<y;T++)E!==T&&(g[E]*=m[E].x-m[T].x);g[E]=1/g[E]}return g}static _barycentricLagrange(m,y,g){if(m===null||m.length===0)throw new Error("points must contain at least one point");if(m.length!==y.length)throw new Error("points must contain exactly as many items as {nameof(weights)}");let E=0,T=0;for(let _=0,b=m.length;_<b;_++){if(g===m[_].x)return m[_].y;const A=y[_]/(g-m[_].x);E+=A*m[_].y,T+=A}return E/T}static _bezierIsFlatEnough(m){for(let y=1;y<m.length-1;y++)if(m[y-1].sub(m[y].scale(2)).add(m[y+1]).lengthSquared()>l**2*4)return!1;return!0}static _bezierSubdivide(m,y,g,E,T){const _=E;for(let b=0;b<T;++b)_[b]=m[b];for(let b=0;b<T;++b){y[b]=_[0],g[T-b-1]=_[T-b-1];for(let A=0;A<T-b-1;A++)_[A]=_[A].add(_[A+1]),_[A]=_[A].divide(2)}}static _bezierApproximate(m,y,g,E,T){const _=E,b=g;d._bezierSubdivide(m,_,b,g,T);for(let A=0;A<T-1;++A)_[T+A]=b[A+1];y.push(m[0]);for(let A=1;A<T-1;++A){const C=2*A;let R=_[C-1].add(_[C].scale(2)).add(_[C+1]);R=R.scale(Math.fround(.25)),y.push(R)}}static _catmullFindPoint(m,y,g,E,T){const _=Math.fround(T*T),b=Math.fround(T*_);return new a.Vec2(Math.fround(.5*(2*y.x+(-m.x+g.x)*T+(2*m.x-5*y.x+4*g.x-E.x)*_+(-m.x+3*y.x-3*g.x+E.x)*b)),Math.fround(.5*(2*y.y+(-m.y+g.y)*T+(2*m.y-5*y.y+4*g.y-E.y)*_+(-m.y+3*y.y-3*g.y+E.y)*b)))}}r.PathApproximator=d},"./src/core/hitobjects/slider/PathControlPoint.ts":(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0})},"./src/core/hitobjects/slider/PathType.ts":(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.PathType=void 0,function(o){o[o.Catmull=0]="Catmull",o[o.Bezier=1]="Bezier",o[o.Linear=2]="Linear",o[o.PerfectCurve=3]="PerfectCurve"}(r.PathType||(r.PathType={}))},"./src/core/hitobjects/slider/SliderCheckPointGenerator.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.generateSliderCheckpoints=void 0;const a=o("./src/math/index.ts");function*l(h,u,d,f,m,y,g){for(let E=y;E<=m&&!(E>=m-g);E+=y){const T=E/m,_=f?1-T:T;yield{type:"TICK",spanIndex:h,spanStartTime:u,time:u+_*d,spanProgress:T}}}function*c(h,u,d,f,m,y,g){const E=Math.min(1e5,m);f=(0,a.clamp)(f,0,E);const T=d*10;if(f!==0)for(let O=0;O<y;O++){const M=h+O*u,w=O%2===1,I=l(O,M,u,w,E,f,T),L=[];for(const D of I)L.push(D);w&&L.reverse();for(const D of L)yield D;O<y-1&&(yield{type:"REPEAT",spanIndex:O,spanStartTime:M,time:M+u,spanProgress:(O+1)%2})}const _=y*u,b=y-1,A=h+b*u,C=Math.max(h+_/2,A+u-(g??0));let R=(C-A)/u;y%2===0&&(R=1-R),yield{type:"LAST_LEGACY_TICK",spanIndex:b,spanStartTime:A,time:C,spanProgress:R}}r.generateSliderCheckpoints=c},"./src/core/hitobjects/slider/SliderPath.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.SliderPath=void 0;const a=o("./src/core/hitobjects/slider/PathType.ts"),l=o("./src/math/index.ts"),c=o("./src/core/hitobjects/slider/PathApproximator.ts");function h(d){return d.map(f=>new l.Vec2(f.x,f.y))}class u{constructor(f,m){this._min={x:0,y:0},this._max={x:0,y:0},this.controlPoints=f,this._invalid=!0,this._cumulativeLength=[],this._calculatedPath=[],this._expectedDistance=m}get cumulativeLengths(){return this.ensureValid(),this._cumulativeLength}get calculatedPath(){return this.ensureValid(),this._calculatedPath}makeInvalid(){this._invalid=!0}ensureValid(){this._invalid&&(this.calculatePath(),this.calculateLength(),this.calculateBoundaryBox(),this._invalid=!1)}calculateSubPath(f,m){switch(m){case a.PathType.Catmull:return c.PathApproximator.approximateCatmull(h(f));case a.PathType.Linear:return c.PathApproximator.approximateLinear(h(f));case a.PathType.PerfectCurve:if(f.length!==3)break;const y=c.PathApproximator.approximateCircularArc(h(f));if(y.length===0)break;return y}return c.PathApproximator.approximateBezier(h(f))}get boundaryBox(){return this.ensureValid(),[this._min,this._max]}calculateBoundaryBox(){let f=3e3,m=-3e3,y=3e3,g=-3e3;return this._calculatedPath.forEach(E=>{f=Math.min(f,E.x),m=Math.max(m,E.x),y=Math.min(y,E.y),g=Math.max(g,E.y)}),this._min=new l.Vec2(f,y),this._max=new l.Vec2(m,g),[this._min,this._max]}calculatePath(){var f;this._calculatedPath=[];const m=this.controlPoints.length;if(m===0)return;const y=this.controlPoints.map(E=>E.offset);let g=0;for(let E=0;E<m;E++){if(this.controlPoints[E].type===void 0&&E<m-1)continue;const T=y.slice(g,E+1),_=(f=this.controlPoints[g].type)!==null&&f!==void 0?f:a.PathType.Linear;for(const b of this.calculateSubPath(T,_)){const A=this._calculatedPath.length;(A===0||!l.Vec2.equal(this._calculatedPath[A-1],b))&&this._calculatedPath.push(b)}g=E}}calculateLength(){this._cumulativeLength=new Array(this._calculatedPath.length),this._cumulativeLength[0]=0;for(let m=1;m<this._calculatedPath.length;m++)this._cumulativeLength[m]=this._cumulativeLength[m-1]+Math.fround(l.Vec2.distance(this._calculatedPath[m-1],this._calculatedPath[m]));const f=this._cumulativeLength[this._cumulativeLength.length-1];if(this._expectedDistance!==void 0&&f!==this._expectedDistance){if(this.controlPoints.length>=2&&l.Vec2.equal(this.controlPoints[this.controlPoints.length-1].offset,this.controlPoints[this.controlPoints.length-2].offset)&&this._expectedDistance>f){this._cumulativeLength.push(f);return}this._cumulativeLength.splice(this._cumulativeLength.length-1);let m=this._calculatedPath.length-1;if(f>this._expectedDistance)for(;this._cumulativeLength.length>0&&this._cumulativeLength[this._cumulativeLength.length-1]>=this._expectedDistance;)this._cumulativeLength.splice(this._cumulativeLength.length-1),this._calculatedPath.splice(m--,1);if(m<=0){this._cumulativeLength.push(0);return}const y=l.Vec2.sub(this._calculatedPath[m],this._calculatedPath[m-1]).normalized(),g=this._expectedDistance-this._cumulativeLength[this._cumulativeLength.length-1];this._calculatedPath[m]=l.Vec2.add(this._calculatedPath[m-1],y.scale(Math.fround(g))),this._cumulativeLength.push(this._expectedDistance)}}get distance(){const f=this.cumulativeLengths,m=f.length;return m>0?f[m-1]:0}indexOfDistance(f){const m=this.cumulativeLengths.findIndex(y=>y>=f);if(m===void 0)throw new Error("Cumulative lengths or distance wrongly programmed");return m}positionAt(f){const m=this.distance*(0,l.clamp)(f,0,1);return this.interpolateVertices(this.indexOfDistance(m),m)}interpolateVertices(f,m){const y=this.calculatedPath;if(y.length===0)return l.Vec2.Zero;if(f<=0)return y[0];if(f>=y.length)return y[y.length-1];const g=y[f-1],E=y[f],T=this.cumulativeLengths[f-1],_=this.cumulativeLengths[f];if((0,l.doubleEqual)(T,_))return g;const b=(m-T)/(_-T);return l.Vec2.interpolate(g,E,b)}}r.SliderPath=u},"./src/core/index.ts":function(n,r,o){var a=this&&this.__createBinding||(Object.create?function(u,d,f,m){m===void 0&&(m=f);var y=Object.getOwnPropertyDescriptor(d,f);(!y||("get"in y?!d.__esModule:y.writable||y.configurable))&&(y={enumerable:!0,get:function(){return d[f]}}),Object.defineProperty(u,m,y)}:function(u,d,f,m){m===void 0&&(m=f),u[m]=d[f]}),l=this&&this.__exportStar||function(u,d){for(var f in u)f!=="default"&&!Object.prototype.hasOwnProperty.call(d,f)&&a(d,u,f)};Object.defineProperty(r,"__esModule",{value:!0}),r.parseReplayFramesFromRaw=r.parseBlueprint=void 0,l(o("./src/core/audio/HitSampleInfo.ts"),r),l(o("./src/core/beatmap/ControlPoints/ControlPoint.ts"),r),l(o("./src/core/beatmap/ControlPoints/ControlPointGroup.ts"),r),l(o("./src/core/beatmap/ControlPoints/DifficultyControlPoint.ts"),r),l(o("./src/core/beatmap/ControlPoints/TimingControlPoint.ts"),r),l(o("./src/core/mods/HardRockMod.ts"),r),l(o("./src/core/mods/Mods.ts"),r),l(o("./src/core/mods/StackingMod.ts"),r),l(o("./src/core/beatmap/BeatmapBuilder.ts"),r),l(o("./src/core/beatmap/BeatmapDifficulty.ts"),r),l(o("./src/core/beatmap/Beatmap.ts"),r),l(o("./src/core/blueprint/Blueprint.ts"),r),l(o("./src/core/blueprint/HitObjectSettings.ts"),r);var c=o("./src/core/blueprint/BlueprintParser.ts");Object.defineProperty(r,"parseBlueprint",{enumerable:!0,get:function(){return c.parseBlueprint}}),l(o("./src/core/hitobjects/slider/PathApproximator.ts"),r),l(o("./src/core/hitobjects/slider/PathControlPoint.ts"),r),l(o("./src/core/hitobjects/slider/PathType.ts"),r),l(o("./src/core/hitobjects/slider/SliderPath.ts"),r),l(o("./src/core/hitobjects/HitCircle.ts"),r),l(o("./src/core/hitobjects/Types.ts"),r),l(o("./src/core/hitobjects/Slider.ts"),r),l(o("./src/core/hitobjects/SliderCheckPoint.ts"),r),l(o("./src/core/hitobjects/Spinner.ts"),r),l(o("./src/core/gameplay/GameplayAnalysisEvent.ts"),r),l(o("./src/core/gameplay/GameplayInfo.ts"),r),l(o("./src/core/gameplay/GameState.ts"),r),l(o("./src/core/gameplay/GameStateEvaluator.ts"),r),l(o("./src/core/gameplay/GameStateTimeMachine.ts"),r),l(o("./src/core/gameplay/Verdicts.ts"),r),l(o("./src/core/replays/RawReplayData.ts"),r),l(o("./src/core/replays/Replay.ts"),r),l(o("./src/core/replays/ReplayClicks.ts"),r);var h=o("./src/core/replays/ReplayParser.ts");Object.defineProperty(r,"parseReplayFramesFromRaw",{enumerable:!0,get:function(){return h.parseReplayFramesFromRaw}}),l(o("./src/core/playfield.ts"),r),l(o("./src/core/utils/index.ts"),r)},"./src/core/mods/EasyMod.ts":(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.EasyMod=void 0;const o=.5;class a{}r.EasyMod=a,a.difficultyAdjuster=l=>Object.assign(Object.assign({},l),{overallDifficulty:l.overallDifficulty*o,approachRate:l.approachRate*o,drainRate:l.drainRate*o,circleSize:l.circleSize*o})},"./src/core/mods/HardRockMod.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.HardRockMod=void 0;const a=o("./src/core/hitobjects/Types.ts"),l=o("./src/core/playfield.ts");function c(u){const{x:d,y:f}=u;return{x:d,y:l.OSU_PLAYFIELD_HEIGHT-f}}class h{}r.HardRockMod=h,h.difficultyAdjuster=u=>Object.assign(Object.assign({},u),{overallDifficulty:Math.min(10,u.overallDifficulty*1.4),approachRate:Math.min(10,u.approachRate*1.4),drainRate:Math.min(10,u.drainRate*1.4),circleSize:Math.min(10,u.circleSize*1.3)}),h.flipVertically=u=>{u.forEach(d=>{(0,a.isHitCircle)(d)?(d.position=c(d.position),d.unstackedPosition=c(d.unstackedPosition)):(0,a.isSlider)(d)&&(d.head.position=c(d.head.position),d.head.unstackedPosition=c(d.head.unstackedPosition),d.path.controlPoints.forEach(f=>{f.offset.y*=-1}),d.path.makeInvalid(),d.checkPoints.forEach(f=>{f.offset.y*=-1}))})}},"./src/core/mods/Mods.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.RELAX_LENIENCY=r.ModSettings=r.OsuClassicMods=void 0;const a=o("./src/core/mods/HardRockMod.ts"),l=o("./src/core/mods/EasyMod.ts");r.OsuClassicMods=["EASY","HALF_TIME","NO_FAIL","HARD_ROCK","SUDDEN_DEATH","PERFECT","DOUBLE_TIME","NIGHT_CORE","HIDDEN","FLASH_LIGHT","AUTO_PLAY","AUTO_PILOT","RELAX","SPUN_OUT","SCORE_V2"],r.ModSettings={EASY:{name:"Easy",difficultyAdjuster:l.EasyMod.difficultyAdjuster,scoreMultiplier:.5},HARD_ROCK:{name:"Hard Rock",scoreMultiplier:1.06,difficultyAdjuster:a.HardRockMod.difficultyAdjuster},DOUBLE_TIME:{name:"Double Time",scoreMultiplier:1.12},FLASH_LIGHT:{name:"Flash Light",scoreMultiplier:1.12},HALF_TIME:{name:"Half Time",scoreMultiplier:.3},HIDDEN:{name:"Hidden",scoreMultiplier:1.06},NIGHT_CORE:{name:"Night Core",scoreMultiplier:1.12},NO_FAIL:{name:"No Fail",scoreMultiplier:.5},AUTO_PLAY:{name:"Auto Play"},AUTO_PILOT:{name:"Auto Pilot"},PERFECT:{name:"Perfect"},RELAX:{name:"Relax"},SCORE_V2:{name:"Score V2"},SPUN_OUT:{name:"Spun Out"},SUDDEN_DEATH:{name:"Sudden Death"}},r.RELAX_LENIENCY=12},"./src/core/mods/StackingMod.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.modifyStackingPosition=void 0;const a=o("./src/math/index.ts"),l=o("./src/core/hitobjects/Types.ts");function c(C,R){const O=(0,a.float32_mul)(C,(0,a.float32_mul)(R,-6.4));return{x:O,y:O}}function h(C,R,O){const M=c(R,O);return a.Vec2.add(C,M)}const u=3,d=C=>(0,l.isSlider)(C)?C.head:C,f=C=>d(C).approachDuration,m=C=>d(C).hitTime,y=C=>d(C).position,g=C=>(0,l.isSlider)(C)?C.endPosition:C.position,E=C=>(0,l.isSlider)(C)?C.endTime:C.hitTime;function T(C){const R=new Map;function O(w,I){R.set(d(w).id,I)}function M(w){var I;return(I=R.get(d(w).id))!==null&&I!==void 0?I:0}for(const w of C)(0,l.isSpinner)(w)||O(w,0);return{stackingHeights:R,setH:O,H:M}}function _(C,R){const w=C.length-1,{stackingHeights:I,setH:L,H:D}=T(C);let N=0;for(let U=w;U>0;U--){let v=U,P=C[U];if((0,l.isSpinner)(P)||D(P)!==0)continue;const q=f(P)*R;if((0,l.isHitCircle)(P))for(;--v>=0;){const $=C[v];if((0,l.isSpinner)($)||m(P)-E($)>q)break;if(v<N&&(L($,0),N=v),(0,l.isSlider)($)&&a.Vec2.distance(g($),y(P))<u){const et=D(P)-D($)+1;for(let H=v+1;H<=U;H++){const k=C[H];(0,l.isSpinner)(k)||a.Vec2.distance(g($),y(k))<u&&L(k,D(k)-et)}break}a.Vec2.distance(y($),y(P))<u&&(L($,D(P)+1),P=$)}else for(;--v>=0;){const $=C[v];if(!(0,l.isSpinner)($)){if(m(P)-m($)>q)break;a.Vec2.distance(g($),y(P))<u&&(L($,D(P)+1),P=$)}}}return I}function b(C,R){const{stackingHeights:O,H:M,setH:w}=T(C);for(let I=0;I<C.length;I++){const L=C[I];if((0,l.isSpinner)(L)||M(L)!==0&&!(0,l.isSlider)(L))continue;let D=E(L),N=0;for(let U=I+1;U<C.length;U++){const v=f(L)*R,P=C[U];if((0,l.isSpinner)(P))continue;if(m(P)-v>D)break;const q=(0,l.isSlider)(L)?L.endPosition:L.position;a.Vec2.withinDistance(y(P),y(L),u)?(w(L,M(L)+1),D=E(P)):a.Vec2.withinDistance(y(P),q,u)&&(N++,w(P,M(P)-N),D=E(P))}}return O}function A(C,R,O){const M=O>=6?_(C,R):b(C,R);C.forEach(w=>{if((0,l.isSpinner)(w))return;const I=d(w),L=M.get(I.id);if(L===void 0)throw Error("Stack height can't be undefined");I.position=h(I.position,L,I.scale)})}r.modifyStackingPosition=A},"./src/core/playfield.ts":(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.OSU_PLAYFIELD_WIDTH=r.OSU_PLAYFIELD_HEIGHT=void 0,r.OSU_PLAYFIELD_HEIGHT=384,r.OSU_PLAYFIELD_WIDTH=512},"./src/core/replays/RawReplayData.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.modsToBitmask=r.modsFromBitmask=r.ReplayModBit=r.RawReplayData=void 0;const a=o("./src/core/mods/Mods.ts");class l{constructor(){this.gameMode=0,this.gameVersion=0,this.beatmapMD5="",this.playerName="",this.replayMD5="",this.number_300s=0,this.number_100s=0,this.number_50s=0,this.gekis=0,this.katus=0,this.misses=0,this.score=0,this.max_combo=0,this.perfect_combo=0,this.mods=0,this.life_bar="",this.timestamp=0,this.replay_length=0,this.replay_data="",this.unknown=0}}r.RawReplayData=l,r.ReplayModBit={NO_FAIL:1,EASY:2,HIDDEN:8,HARD_ROCK:16,SUDDEN_DEATH:32,DOUBLE_TIME:64,RELAX:128,HALF_TIME:256,NIGHT_CORE:512,FLASH_LIGHT:1024,AUTO_PLAY:2048,SPUN_OUT:4096,AUTO_PILOT:8192,PERFECT:16384,SCORE_V2:536870912};function c(u){const d=[];for(const f of a.OsuClassicMods){const m=r.ReplayModBit[f];(u&m)>0&&d.push(f)}return d}r.modsFromBitmask=c;function h(u){let d=0;for(const f of u)d|=1<<r.ReplayModBit[f];return d}r.modsToBitmask=h},"./src/core/replays/Replay.ts":(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.ReplayButtonState=r.OsuAction=void 0,function(o){o[o.leftButton=0]="leftButton",o[o.rightButton=1]="rightButton"}(r.OsuAction||(r.OsuAction={})),function(o){o[o.None=0]="None",o[o.Left1=1]="Left1",o[o.Right1=2]="Right1",o[o.Left2=4]="Left2",o[o.Right2=8]="Right2",o[o.Smoke=16]="Smoke"}(r.ReplayButtonState||(r.ReplayButtonState={}))},"./src/core/replays/ReplayClicks.ts":(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.calculateReplayClicks=void 0;function o(a){const l=[[],[]],c=[null,null];for(const h of a)for(let u=0;u<2;u++){const d=h.actions.includes(u);!d&&c[u]?(l[u].push([c[u],h.time]),c[u]=null):d&&c[u]===null&&(c[u]=h.time)}for(let h=0;h<2;h++)c[h]!==null&&l[h].push([c[h],1e9]);return l}r.calculateReplayClicks=o},"./src/core/replays/ReplayParser.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.parseReplayFramesFromRaw=void 0;const a=o("./src/core/replays/Replay.ts"),l=131072,c=(u,d)=>(u&d)!==0,h=u=>{const d=u.split(",");let f=0;const m=[];for(let E=0;E<d.length;E++){const T=d[E].split("|");if(T.length<4||T[0]==="-12345")continue;const _=parseFloat(T[0]),b=parseFloat(T[1]),A=parseFloat(T[2]);if(Math.abs(b)>l||Math.abs(A)>l)throw Error("Value overflow while parsing mouse coordinates");if(f+=_,E<2&&b===256&&A===-500||_<0)continue;const C=[],R=parseInt(T[3]);(c(R,a.ReplayButtonState.Left1)||c(R,a.ReplayButtonState.Left2))&&C.push(a.OsuAction.leftButton),(c(R,a.ReplayButtonState.Right1)||c(R,a.ReplayButtonState.Right2))&&C.push(a.OsuAction.rightButton),m.push({actions:C,position:{x:b,y:A},time:f})}const y=[];let g;for(let E=0;E<m.length;E++)if(g===void 0||m[E].time!==g.time)y.push(m[E]),g=m[E];else{for(let T=0;T<m[E].actions.length;T++){const _=m[E].actions[T];g.actions.includes(_)||g.actions.push(_)}g.actions.sort()}return y};r.parseReplayFramesFromRaw=h},"./src/core/utils/SortedList.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.SortedList=void 0;const a=o("./src/math/index.ts");class l{constructor(){this.list=[]}indexOf(h){return this.list.findIndex(u=>(0,a.floatEqual)(h.compareTo(u),0))}add(h){const u=this.list.findIndex(d=>h.compareTo(d)<0);u===-1?this.list.splice(this.list.length,0,h):this.list.splice(u,0,h)}remove(h){const u=this.indexOf(h);u>-1&&this.list.splice(u,1)}get(h){return this.list[h]}get length(){return this.list.length}}r.SortedList=l},"./src/core/utils/index.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.determineDefaultPlaybackSpeed=r.normalizeHitObjects=void 0;const a=o("./src/core/hitobjects/Slider.ts");function l(h){const u={};return h.forEach(d=>{if(u[d.id]=d,d instanceof a.Slider){u[d.head.id]=d.head;for(const f of d.checkPoints)u[f.id]=f}}),u}r.normalizeHitObjects=l;function c(h){for(let u=0;u<h.length;u++){if(h[u]==="DOUBLE_TIME"||h[u]==="NIGHT_CORE")return 1.5;if(h[u]==="HALF_TIME")return .75}return 1}r.determineDefaultPlaybackSpeed=c},"./src/index.ts":function(n,r,o){var a=this&&this.__createBinding||(Object.create?function(h,u,d,f){f===void 0&&(f=d);var m=Object.getOwnPropertyDescriptor(u,d);(!m||("get"in m?!u.__esModule:m.writable||m.configurable))&&(m={enumerable:!0,get:function(){return u[d]}}),Object.defineProperty(h,f,m)}:function(h,u,d,f){f===void 0&&(f=d),h[f]=u[d]}),l=this&&this.__exportStar||function(h,u){for(var d in h)d!=="default"&&!Object.prototype.hasOwnProperty.call(u,d)&&a(u,h,d)};Object.defineProperty(r,"__esModule",{value:!0}),r.buildBeatmap=r.parseBlueprint=void 0;var c=o("./src/core/index.ts");Object.defineProperty(r,"parseBlueprint",{enumerable:!0,get:function(){return c.parseBlueprint}}),Object.defineProperty(r,"buildBeatmap",{enumerable:!0,get:function(){return c.buildBeatmap}}),l(o("./src/lib/pp.ts"),r),l(o("./src/lib/diff.ts"),r)},"./src/lib/diff.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.calculateDifficultyAttributes=void 0;const a=o("./src/core/index.ts"),l=o("./src/math/index.ts"),c=o("./src/lib/skills/aim.ts"),h=o("./src/lib/skills/speed.ts"),u=o("./src/lib/skills/flashlight.ts"),d=w=>(0,a.isHitCircle)(w)?w.hitTime:w.startTime,f=w=>(0,a.isHitCircle)(w)?w.hitTime:w.endTime,m=w=>(0,a.isHitCircle)(w)?w.position:w.head.position,y=50,g=y*2.4,E=y*1.8;function T(w){const I=w.checkPoints[w.checkPoints.length-1].hitTime-w.startTime;let L=0,D=I/w.spanDuration;D%2>=1?D=1-D%1:D%=1;let N=l.Vec2.add(w.startPosition,w.path.positionAt(D)),U=w.startPosition;const v=y/w.radius,P=w.checkPoints.length;for(let q=0;q<P;q++){const $=w.checkPoints[q],et=$.type==="LAST_LEGACY_TICK"?w.endPosition:$.position;let H=l.Vec2.sub(et,U),k=v*H.length(),F=E;if(q===P-1){const z=l.Vec2.sub(N,U);z.length()<H.length()&&(H=z),k=v*H.length()}else $.type==="REPEAT"&&(F=y);k>F&&(U=l.Vec2.add(U,l.Vec2.scale(H,(0,l.float32_div)(k-F,k))),k*=(k-F)/k,L=(0,l.float32_add)(L,k)),q===P-1&&(N=U)}return L=(0,l.float32_mul)(L,Math.pow(1+w.repeatCount/2.5,.4)),{lazyTravelTime:I,lazyTravelDistance:L,lazyEndPosition:N}}const _=()=>({deltaTime:0,travelTime:0,travelDistance:0,jumpDistance:0,movementDistance:0,movementTime:0,strainTime:0,endTime:0,startTime:0,angle:null});function b(w,I){const L=[_()],D=25,N=P=>P/I,U={};function v(P){return U[P.id]===void 0&&(U[P.id]=T(P)),U[P.id]}for(let P=1;P<w.length;P++){const q=w[P-2],$=w[P-1],et=w[P],H=function(){const F=_();F.startTime=N(d(et)),F.endTime=N(f(et)),F.deltaTime=N(d(et)-d($));const z=Math.max(F.deltaTime,D);if(F.strainTime=z,(0,a.isSpinner)(et)||(0,a.isSpinner)($))return F;let X=(0,l.float32_div)(y,et.radius);if(et.radius<30){const W=(0,l.float32_div)(Math.min(30-et.radius,5),50);X*=1+W}function j(W){if((0,a.isHitCircle)(W))return W.position;const{lazyEndPosition:K}=v(W);return K??W.startPosition}const V=j($);if(F.jumpDistance=l.Vec2.distance(l.Vec2.scale(m(et),X),l.Vec2.scale(V,X)),(0,a.isSlider)($)){const{lazyTravelTime:W,lazyTravelDistance:K}=v($);F.travelDistance=K,F.travelTime=Math.max(W/I,D),F.movementTime=Math.max(z-F.travelTime,D);const tt=(0,l.float32)(l.Vec2.distance($.endPosition,m(et))*X);F.movementDistance=Math.max(0,Math.min(F.jumpDistance-(g-E),tt-g))}else F.movementTime=z,F.movementDistance=F.jumpDistance;if(q!==void 0&&!(0,a.isSpinner)(q)){const W=j(q),K=l.Vec2.sub(W,m($)),tt=l.Vec2.sub(m(et),V),ct=(0,l.float32)(l.Vec2.dot(K,tt)),ht=(0,l.float32_add)((0,l.float32_mul)(K.x,tt.y),-(0,l.float32_mul)(K.y,tt.x));F.angle=Math.abs(Math.atan2(ht,ct))}return F}();L.push(H)}return L}function A(w){let I=0,L=0,D=0,N=0;for(const U of w)I++,(0,a.isHitCircle)(U)&&L++,(0,a.isSpinner)(U)&&N++,(0,a.isSlider)(U)&&(D++,I+=U.checkPoints.length);return{maxCombo:I,hitCircleCount:L,sliderCount:D,spinnerCount:N}}const C=.0675,R=(w,I)=>(0,l.approachDurationToApproachRate)((0,l.approachRateToApproachDuration)(w)/I),O=(w,I)=>(0,l.hitWindowGreatToOD)((0,l.overallDifficultyToHitWindowGreat)(w)/I);function M({appliedMods:w,difficulty:I,hitObjects:L,controlPointInfo:D},N){const U=(0,a.determineDefaultPlaybackSpeed)(w),v=b(L,U),P=(0,l.hitWindowsForOD)(I.overallDifficulty,!0)[0]/U,q=(0,c.calculateAim)(L,v,!0,N),$=(0,c.calculateAim)(L,v,!1,N),et=(0,h.calculateSpeed)(L,v,P,N),H=(0,u.calculateFlashlight)(L,v,N,w.includes("HIDDEN")),k=(0,h.calculateRelevantNotes)(L,v,P,N),{hitCircleCount:F,sliderCount:z,spinnerCount:X,maxCombo:j}=A(L),V=O(I.overallDifficulty,U),W=R(I.approachRate,U),K=(0,a.mostCommonBeatLength)({hitObjects:L,timingPoints:D.timingPoints.list}),tt=(K===void 0?0:(0,l.beatLengthToBPM)(K))*U,ct=[];for(let ht=0;ht<q.length;ht++){let pt=Math.sqrt(q[ht])*C;const It=Math.sqrt($[ht])*C;let Ct=Math.sqrt(et[ht])*C,Dt=Math.sqrt(H[ht])*C;const vt=pt>0?It/pt:1;w.includes("RELAX")&&(pt*=.9,Ct=0,Dt*=.7);const Ht=Math.pow(5*Math.max(1,pt/.0675)-4,3)/1e5,Ft=Math.pow(5*Math.max(1,Ct/.0675)-4,3)/1e5;let Ti=0;w.includes("FLASH_LIGHT")&&(Ti=Math.pow(Dt,2)*25);const ll=Math.pow(Math.pow(Ht,1.1)+Math.pow(Ft,1.1)+Math.pow(Ti,1.1),1/1.1),If=ll>1e-5?Math.cbrt(1.14)*.027*(Math.cbrt(1e5/Math.pow(2,1/1.1)*ll)+4):0;ct.push({aimDifficulty:pt,speedDifficulty:Ct,flashlightDifficulty:Dt,sliderFactor:vt,speedNotes:k,starRating:If,hitCircleCount:F,sliderCount:z,spinnerCount:X,maxCombo:j,overallDifficulty:V,approachRate:W,mostCommonBPM:tt,drainRate:I.drainRate})}return ct}r.calculateDifficultyAttributes=M},"./src/lib/pp.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.calculatePerformanceAttributes=void 0;const a=o("./src/core/index.ts"),l=o("./src/math/index.ts");function c(h,u){var d;const{hitCircleCount:f,sliderCount:m,spinnerCount:y,aimDifficulty:g,speedDifficulty:E,flashlightDifficulty:T,approachRate:_,drainRate:b,overallDifficulty:A,sliderFactor:C,maxCombo:R,speedNotes:O}=h,{mods:M,countMeh:w,countGreat:I,countMiss:L,countOk:D,maxCombo:N}=u,U=(d=(0,a.osuStableAccuracy)([I,D,w,L]))!==null&&d!==void 0?d:0,v=I+D+w+L;let P=function(){let j=0;if(m>0){const V=R-.1*m;N<V&&(j=V/Math.max(1,N))}return j=Math.min(j,v),Math.max(L,j)}(),q=1.14;if(M.includes("NO_FAIL")&&(q*=Math.max(.9,1-.02*P)),M.includes("SPUN_OUT")&&(q*=1-Math.pow(y/v,.85)),M.includes("RELAX")){const X=Math.max(0,A>0?1-Math.pow(A/13.33,1.8):1),j=Math.max(0,A>0?1-Math.pow(A/13.33,5):1);P=Math.min(P+D*X+w*j,v),q*=.6}const $=R<=0?1:Math.min(Math.pow(N,.8)/Math.pow(R,.8),1),et=function(){let j=g;M.includes("TOUCH_DEVICE")&&(j=Math.pow(j,.8));let V=Math.pow(5*Math.max(1,j/.0675)-4,3)/1e5;const W=.95+.4*Math.min(1,v/2e3)+(v>2e3?Math.log10(v/2e3)*.5:0);V*=W,P>0&&(V*=.97*Math.pow(1-Math.pow(P/v,.775),P)),V*=$;let K=0;_>10.33?K=.3*(_-10.33):_<8&&(K=.05*(8-_)),M.includes("RELAX")&&(K=0),V*=1+K*W,M.includes("BLINDS")?V*=1.3+v*(.0016/(1+2*P))*Math.pow(U,16)*(1-.003*b*b):M.includes("HIDDEN")&&(V*=1+.04*(12-_));const tt=m*.15;if(m>0){const ct=(0,l.clamp)(Math.min(D+w+L,R-N),0,tt),ht=(1-C)*Math.pow(1-ct/tt,3)+C;V*=ht}return V*=U,V*=.98+Math.pow(A,2)/2500,V}(),H=function(){const j=v-O,V=Math.max(0,I-j),W=Math.max(0,D-Math.max(0,j-I)),K=Math.max(0,w-Math.max(0,j-I-D)),tt=O==0?0:(V*6+W*2+K)/(O*6);let ct=Math.pow(5*Math.max(1,E/.0675)-4,3)/1e5;const ht=.95+.4*Math.min(1,v/2e3)+(v>2e3?Math.log10(v/2e3)*.5:0);ct*=ht,P>0&&(ct*=.97*Math.pow(1-Math.pow(P/v,.775),Math.pow(P,.875))),ct*=$;let pt=0;return _>10.33&&(pt=.3*(_-10.33)),ct*=1+pt*ht,M.includes("BLINDS")?ct*=1.12:M.includes("HIDDEN")&&(ct*=1+.04*(12-_)),ct*=(.95+Math.pow(A,2)/750)*Math.pow((U+tt)/2,(14.5-Math.max(A,8))/2),ct*=Math.pow(.99,w<v/500?0:w-v/500),ct}(),k=function(){if(M.includes("RELAX"))return 0;let j;const V=f;V>0?j=((I-(v-V))*6+D*2+w)/(V*6):j=0,j<0&&(j=0);let W=Math.pow(1.52163,A)*Math.pow(j,24)*2.83;return W*=Math.min(1.15,Math.pow(V/1e3,.3)),M.includes("BLINDS")?W*=1.14:M.includes("HIDDEN")&&(W*=1.08),M.includes("FLASH_LIGHT")&&(W*=1.02),W}(),F=function(){if(!M.includes("FLASH_LIGHT"))return 0;let j=T;M.includes("TOUCH_DEVICE")&&(j=Math.pow(j,.8));let V=Math.pow(j,2)*25;return P>0&&(V*=.97*Math.pow(1-Math.pow(P/v,.775),Math.pow(P,.875))),V*=$,V*=.7+.1*Math.min(1,v/200)+(v>200?.2*Math.min(1,(v-200)/200):0),V*=.5+U/2,V*=.98+Math.pow(A,2)/2500,V}(),z=Math.pow(Math.pow(et,1.1)+Math.pow(H,1.1)+Math.pow(k,1.1)+Math.pow(F,1.1),1/1.1)*q;return{aim:et,speed:H,accuracy:k,flashlight:F,effectiveMissCount:P,total:z}}r.calculatePerformanceAttributes=c},"./src/lib/skills/aim.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.calculateAim=void 0;const a=o("./src/core/index.ts"),l=o("./src/math/index.ts"),c=o("./src/lib/skills/strain.ts"),h=1.5,u=1.95,d=1.35,f=.75,m=23.55,y=.15,g=A=>Math.pow(y,A/1e3),E=A=>Math.pow(Math.sin(3/4*(Math.min(5/6*Math.PI,Math.max(Math.PI/6,A))-Math.PI/6)),2),T=A=>1-E(A);function _(A,C,R){if(A.length===0)return[];const O=[0];let M=0;for(let w=1;w<C.length;w++){const I=A[w-2],L=A[w-1],D=A[w],N=C[w-2],U=C[w-1],v=C[w],P=function(){if(w<=2||(0,a.isSpinner)(D)||(0,a.isSpinner)(L))return 0;let q=v.jumpDistance/v.strainTime;if((0,a.isSlider)(L)&&R){const X=v.movementDistance/v.movementTime,j=v.travelDistance/v.travelTime;q=Math.max(q,X+j)}let $=U.jumpDistance/U.strainTime;if((0,a.isSlider)(I)&&R){const X=U.movementDistance/U.movementTime,j=U.travelDistance/U.travelTime;$=Math.max($,X+j)}let et=0,H=0,k=0,F=0,z=q;if(Math.max(v.strainTime,U.strainTime)<1.25*Math.min(v.strainTime,U.strainTime)&&v.angle!==null&&U.angle!==null&&N.angle!==null){const X=v.angle,j=U.angle,V=N.angle,W=Math.min(q,$);et=E(X),H=T(X),v.strainTime>100?H=0:H*=T(j)*Math.min(W,125/v.strainTime)*Math.pow(Math.sin(Math.PI/2*Math.min(1,(100-v.strainTime)/25)),2)*Math.pow(Math.sin(Math.PI/2*((0,l.clamp)(v.jumpDistance,50,100)-50)/50),2),et*=W*(1-Math.min(et,Math.pow(E(j),3))),H*=.5+.5*(1-Math.min(H,Math.pow(T(V),3)))}if(Math.max($,q)!==0){$=(U.jumpDistance+U.travelDistance)/U.strainTime,q=(v.jumpDistance+v.travelDistance)/v.strainTime;const X=Math.pow(Math.sin(Math.PI/2*Math.abs($-q)/Math.max($,q)),2),j=Math.min(125/Math.min(v.strainTime,U.strainTime),Math.abs($-q));Math.abs($-q)*Math.pow(Math.sin(Math.PI/2*Math.min(1,Math.min(v.jumpDistance,U.jumpDistance)/100)),2),F=j*X,F*=Math.pow(Math.min(v.strainTime,U.strainTime)/Math.max(v.strainTime,U.strainTime),2)}return v.travelTime!==0&&(k=v.travelDistance/v.travelTime),z+=Math.max(H*u,et*h+F*f),R&&(z+=k*d),z}();M*=g(v.deltaTime),M+=P*m,O.push(M)}return O}function b(A,C,R,O){const M=_(A,C,R);return(0,c.calculateDifficultyValues)(C,M,{decayWeight:.9,difficultyMultiplier:1.06,sectionDuration:400,reducedSectionCount:10,strainDecay:g},O)}r.calculateAim=b},"./src/lib/skills/flashlight.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.calculateFlashlight=void 0;const a=o("./src/core/index.ts"),l=o("./src/math/index.ts"),c=o("./src/lib/skills/strain.ts"),h=.05,u=.15,d=10,f=T=>Math.pow(u,T/1e3),m=T=>(0,a.isHitCircle)(T)?T.position:T.head.position,y=T=>(0,a.isHitCircle)(T)?T.unstackedPosition:T.unstackedEndPosition;function g(T,_,b){if(T.length===0)return[];let A=0;const C=[A],R=.4,O=.2;for(let M=1;M<_.length;M++){const w=T[M],I=_[M],L=function(){if((0,a.isSpinner)(w))return 0;const D=52/w.radius;let N=1,U=0,v=0;const P=Math.min(M-1,d);for(let q=0;q<P;q++){const $=T[M-q-1],et=_[M-q-1];if((0,a.isSpinner)($))continue;const H=l.Vec2.distance(m(w),y($));U+=_[M].strainTime,q===0&&(N=Math.min(1,H/75));const k=Math.min(1,et.jumpDistance/D/25),F=1+R*(1-((0,a.isSpinner)(w)?1:(0,a.isHitCircle)(w)?w.opacityAt(w.hitTime,b):w.head.opacityAt(w.head.hitTime,b)));v+=k*F*D*H/U}return v=Math.pow(N*v,2),b&&(v*=1+O),v}();A*=f(I.deltaTime),A+=L*h,C.push(A)}return C}function E(T,_,b,A){const C=g(T,_,A);return(0,c.calculateDifficultyValues)(_,C,{decayWeight:.9,difficultyMultiplier:1.06,sectionDuration:400,reducedSectionCount:10,strainDecay:f},b)}r.calculateFlashlight=E},"./src/lib/skills/speed.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.calculateRelevantNotes=r.calculateSpeed=r.calculateSpeedStrains=void 0;const a=o("./src/core/index.ts"),l=o("./src/math/index.ts"),c=o("./src/lib/skills/strain.ts"),h=125,u=.75,d=5e3,f=75,m=40,y=1375,g=.3,E=32,T=C=>Math.pow(g,C/1e3);function _(C,R,O){let M=0;const w=[0];for(let I=1;I<C.length;I++){const L=C[I],D=R[I];R[I-1];const N=R[I+1],U=Math.min(E,I-1),v=et=>R[I-1-et],P=et=>C[I-1-et],q=function(){if((0,a.isSpinner)(L))return 0;let et=D.strainTime;const H=O*2;let k=1;if(N!==void 0){const X=Math.max(1,D.deltaTime),j=Math.max(1,N.deltaTime),V=Math.abs(j-X),W=X/Math.max(X,V),K=Math.pow(Math.min(1,X/H),2);k=Math.pow(W,1-K)}et/=(0,l.clamp)(et/H/.93,.92,1);let F=1;et<f&&(F=1+.75*Math.pow((f-et)/m,2));const z=Math.min(h,D.travelDistance+D.movementDistance);return(F+F*Math.pow(z/h,3.5))*k/et}(),$=function(){if((0,a.isSpinner)(L))return 0;let et=0,H=0,k=1,F=0,z=!1,X=0;for(;X<U-2&&D.startTime-v(X).startTime<d;)X++;for(let j=X;j>0;j--){const V=v(j-1),W=v(j),K=v(j+1);let tt=(d-(D.startTime-V.startTime))/d;tt=Math.min((U-j)/U,tt);const ct=V.strainTime,ht=W.strainTime,pt=K.strainTime,It=1+6*Math.min(.5,Math.pow(Math.sin(Math.PI/(Math.min(ht,ct)/Math.max(ht,ct))),2));let Ct=Math.min(1,Math.max(0,Math.abs(ht-ct)-O*.6)/(O*.6));Ct=Math.min(1,Ct);let Dt=Ct*It;z?ht>1.25*ct||ht*1.25<ct?((0,a.isSlider)(P(j-1))&&(Dt*=.125),(0,a.isSlider)(P(j))&&(Dt*=.25),et==k&&(Dt*=.25),et%2==k%2&&(Dt*=.5),pt>ht+10&&ht>ct+10&&(Dt*=.125),H+=Math.sqrt(Dt*F)*tt*Math.sqrt(4+k)/2*Math.sqrt(4+et)/2,F=Dt,et=k,ht*1.25<ct&&(z=!1),k=1):k<7&&k++:ht>1.25*ct&&(z=!0,F=Dt,k=1)}return Math.sqrt(4+H*u)/2}();M*=T(D.strainTime),M+=q*y,w.push(M*$)}return w}r.calculateSpeedStrains=_;function b(C,R,O,M){const w=_(C,R,O);return(0,c.calculateDifficultyValues)(R,w,{decayWeight:.9,difficultyMultiplier:1.04,sectionDuration:400,reducedSectionCount:5,strainDecay:T},M)}r.calculateSpeed=b;function A(C,R,O,M){const w=_(C,R,O);if(w.length===0)return 0;const I=Math.max(...w);if(I===0)return 0;let L=0;return w.forEach(D=>{L+=1/(1+Math.exp(-(D/I*12-6)))}),L}r.calculateRelevantNotes=A},"./src/lib/skills/strain.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.calculateDifficultyValues=void 0;const a=o("./src/math/index.ts");o("./src/core/index.ts");const l=.75;function c(h,u,{sectionDuration:d,reducedSectionCount:f,difficultyMultiplier:m,strainDecay:y,decayWeight:g},E){if(h.length===0)return[];const T=(R,O)=>Math.floor(O/R)*R,_=[],b=[];let A=T(d,h[0].startTime),C=0;E||b.push(0);for(let R=1;R<h.length;R++){const O=h[R-1].startTime,M=h[R].startTime;for(;A+d<M;)_.push(C),A+=d,C=u[R-1]*y(A-O);if(C=Math.max(C,u[R]),E&&R+1<h.length)continue;const w=[..._,C],I=(N,U)=>U-N;w.sort(I);for(let N=0;N<Math.min(w.length,f);N++){const U=Math.log10((0,a.lerp)(1,10,(0,a.clamp)(N/f,0,1)));w[N]*=(0,a.lerp)(l,1,U)}let L=1;w.sort(I);let D=0;for(const N of w)D+=N*L,L*=g;b.push(D*m)}return b}r.calculateDifficultyValues=c},"./src/math/Vec2.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.Vec2=void 0;const a=o("./src/math/float32.ts");class l{constructor(h,u){this.x=(0,a.float32)(h),this.y=(0,a.float32)(u)}static withinDistance(h,u,d){return(h.x-u.x)**2+(h.y-u.y)**2<=d**2}static distance(h,u){return Math.fround(Math.sqrt(l.distanceSquared(h,u)))}static distanceSquared(h,u){const d=h.x-u.x,f=h.y-u.y;return d**2+f**2}static equal(h,u){return h.x===u.x&&h.y===u.y}static add(h,u){return new l((0,a.float32)(h.x)+(0,a.float32)(u.x),(0,a.float32)(h.y)+(0,a.float32)(u.y))}static dot(h,u){return Math.fround(h.x*u.x+h.y*u.y)}static sub(h,u){return new l((0,a.float32)(h.x)-(0,a.float32)(u.x),(0,a.float32)(h.y)-(0,a.float32)(u.y))}static scale(h,u){return new l((0,a.float32_mul)(h.x,u),(0,a.float32_mul)(h.y,u))}static divide(h,u){return new l((0,a.float32_div)(h.x,u),(0,a.float32_div)(h.y,u))}static interpolate(h,u,d){return l.add(h,l.sub(u,h).scale(d))}add(h){return l.add(this,h)}sub(h){return l.sub(this,h)}divide(h){return l.divide(this,h)}scale(h){return l.scale(this,h)}lengthSquared(){return this.x*this.x+this.y*this.y}length(){return(0,a.float32)(Math.sqrt(this.x**2+this.y**2))}equals(h){return l.equal(this,h)}normalized(){const h=this.length();return this.x=(0,a.float32_div)(this.x,h),this.y=(0,a.float32_div)(this.y,h),this}}r.Vec2=l,l.Zero=new l(0,0)},"./src/math/colors.ts":(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.rgbToInt=void 0;function o(a){if(a.length<3)throw Error("Not at least three values provided");let l=0;for(let c=0;c<3;c++)l=l*256+a[c];return l}r.rgbToInt=o},"./src/math/difficulty.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.overallDifficultyToHitWindowGreat=r.hitWindowsForOD=r.hitWindowGreatToOD=r.difficultyRangeForOd=r.getFadeInDuration=r.approachDurationToApproachRate=r.approachRateToApproachDuration=r.difficultyRange=r.circleSizeToScale=void 0;const a=o("./src/math/float32.ts");function l(_){return(0,a.float32)((1-.7*(_-5)/5)/2)}r.circleSizeToScale=l;function c(_,b,A,C){return _>5?A+(C-A)*(_-5)/5:_<5?A-(A-b)*(5-_)/5:A}r.difficultyRange=c;const h=450;function u(_){return c(_,1800,1200,h)}r.approachRateToApproachDuration=u;function d(_){return _>1200?(1800-_)/120:(1200-_)/150+5}r.approachDurationToApproachRate=d;function f(_){const b=u(_);return 400*Math.min(1,b/h)}r.getFadeInDuration=f;function m(_,b){return c(_,b.od0,b.od5,b.od10)}r.difficultyRangeForOd=m;function y(_){return(80-_)/6}r.hitWindowGreatToOD=y;const g=[[80,50,20],[140,100,60],[200,150,100],[400,400,400]];function E(_,b){function A(C){return g.map(([R,O,M])=>c(C,R,O,M))}return b?A(_):A(_).map(C=>C-1)}r.hitWindowsForOD=E;function T(_){const[b,A,C]=g[0];return c(_,b,A,C)}r.overallDifficultyToHitWindowGreat=T},"./src/math/easing.ts":(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.lerp=r.applyInterpolation=r.applyEasing=r.Easing=void 0;var o;(function(f){f[f.LINEAR=0]="LINEAR",f[f.OUT=1]="OUT",f[f.OUT_QUINT=2]="OUT_QUINT",f[f.OUT_ELASTIC=3]="OUT_ELASTIC",f[f.IN_CUBIC=4]="IN_CUBIC"})(o=r.Easing||(r.Easing={}));const a=2*Math.PI/.3,l=.3/4,c=Math.pow(2,-11);function h(f,m){switch(m){case o.LINEAR:return f;case o.OUT:return f*(2-f);case o.OUT_QUINT:return--f*f*f*f*f+1;case o.OUT_ELASTIC:return Math.pow(2,-10*f)*Math.sin((f-l)*a)+1-c*f;case o.IN_CUBIC:return f*f*f}return f}r.applyEasing=h;function u(f,m,y,g,E,T=o.LINEAR){if(m>=y)return console.error("startTime should be less than endTime"),g;const _=h((f-m)/(y-m),T);return(E-g)*_+g}r.applyInterpolation=u;function d(f,m,y){return f+(m-f)*y}r.lerp=d},"./src/math/float32.ts":(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.float32_sqrt=r.float32_div=r.float32_mul=r.float32_add=r.float32=void 0;function o(u){return Math.fround(u)}r.float32=o;function a(u,d){return o(o(u)+o(d))}r.float32_add=a;function l(u,d){return o(o(u)*o(d))}r.float32_mul=l;function c(u,d){return o(o(u)/o(d))}r.float32_div=c;function h(u){return o(Math.sqrt(o(u)))}r.float32_sqrt=h},"./src/math/index.ts":function(n,r,o){var a=this&&this.__createBinding||(Object.create?function(c,h,u,d){d===void 0&&(d=u);var f=Object.getOwnPropertyDescriptor(h,u);(!f||("get"in f?!h.__esModule:f.writable||f.configurable))&&(f={enumerable:!0,get:function(){return h[u]}}),Object.defineProperty(c,d,f)}:function(c,h,u,d){d===void 0&&(d=u),c[d]=h[u]}),l=this&&this.__exportStar||function(c,h){for(var u in c)u!=="default"&&!Object.prototype.hasOwnProperty.call(h,u)&&a(h,c,u)};Object.defineProperty(r,"__esModule",{value:!0}),l(o("./src/math/colors.ts"),r),l(o("./src/math/difficulty.ts"),r),l(o("./src/math/easing.ts"),r),l(o("./src/math/time.ts"),r),l(o("./src/math/utils.ts"),r),l(o("./src/math/sliders.ts"),r),l(o("./src/math/Vec2.ts"),r),l(o("./src/math/float32.ts"),r)},"./src/math/sliders.ts":(n,r,o)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.sliderRepeatAngle=void 0;const a=o("./src/math/Vec2.ts");function l(c,h){if(c.length<2)return 0;const u=h?c.length-1:0,d=h?-1:1,f=c[u],m=c[u+d],y=a.Vec2.sub(m,f);return Math.atan2(y.y,y.x)}r.sliderRepeatAngle=l},"./src/math/time.ts":(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.beatLengthToBPM=r.formatGameTime=r.parseMs=r.addZero=void 0;function o(h,u=2){const d=Number(h)<0;let f=h.toString(),m=0;return d&&(f=f.slice(1)),m=u-f.length+1,f=new Array(m).join("0").concat(f),(d?"-":"")+f}r.addZero=o;function a(h){const u=h>0?Math.floor:Math.ceil;return{days:u(h/864e5),hours:u(h/36e5)%24,minutes:u(h/6e4)%60,seconds:u(h/1e3)%60,milliseconds:u(h)%1e3,microseconds:u(h*1e3)%1e3,nanoseconds:u(h*1e6)%1e3}}r.parseMs=a;function l(h,u){const{hours:d,seconds:f,minutes:m,milliseconds:y}=a(h);let g=d>0?`${d}:`:"";return g=g+(d>0?o(m):m)+":",g=g+o(f),u?g+"."+o(y,3):g}r.formatGameTime=l;function c(h){return 6e4/h}r.beatLengthToBPM=c},"./src/math/utils.ts":(n,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.clamp=r.doubleEqual=r.floatEqual=r.approximatelyEqual=void 0;function o(d,f,m){return Math.abs(d-f)<m}r.approximatelyEqual=o;const a=.001;function l(d,f){return o(d,f,a)}r.floatEqual=l;const c=1e-7;function h(d,f){return o(d,f,c)}r.doubleEqual=h;function u(d,f,m){return Math.max(f,Math.min(d,m))}r.clamp=u}},t={};function e(n){var r=t[n];if(r!==void 0)return r.exports;var o=t[n]={exports:{}};return i[n].call(o.exports,o,o.exports,e),o.exports}var s=e("./src/index.ts");pf=s})();const we=pf;class Lt{constructor(){S(this,"container");S(this,"sprite");S(this,"mask");S(this,"filter");S(this,"dim");S(this,"blob");S(this,"videoHTML");S(this,"texture");S(this,"videoTexture");S(this,"offset",0);S(this,"w",1);S(this,"h",1)}static init(){return this.container=new ut,this.sprite=new Mt,this.mask=new ft,this.dim=new ft,this.filter=new Cd({kernelSize:9,quality:10,strength:50}),this.filter.strength=0,this.container.filters=[this.filter],this.mask.rect(0,0,p.MASTER_CONTAINER.w,p.MASTER_CONTAINER.h).fill(0),this.dim.rect(0,0,p.MASTER_CONTAINER.w,p.MASTER_CONTAINER.h).fill(0),this.container.addChild(this.sprite,this.dim,this.mask),this.container.y=(innerWidth<innerHeight,60),this.container.label="Hello",this.container.mask=this.mask,this._src=null,this.container}static reset(){this.sprite.texture=void 0,this._src=void 0,this._videoSrc=void 0,this.texture=void 0,this.videoTexture=void 0,this.offset=0}static get src(){return this._src}static set src(t){this._src=t,this.setBG()}static get videoSrc(){return this._videoSrc}static set videoSrc(t){this._videoSrc=t,this.setVideoBG()}static changeStrength(t){this.filter.strength=t/20*100}static changeOpacity(t){const e=p.MASTER_CONTAINER.w/this.w,s=p.MASTER_CONTAINER.h/this.h,n=Math.max(e,s);this.dim.clear().rect(0,0,this.w*n,this.h*n).fill({color:0,alpha:t})}static manuallyUpdateSize(){this.sprite.scale.set(1),this.w!==this.sprite.width&&(this.w=this.sprite.width),this.h!==this.sprite.height&&(this.h=this.sprite.height);const t=p.MASTER_CONTAINER.w/this.w,e=p.MASTER_CONTAINER.h/this.h,s=Math.max(t,e);this.sprite.scale.set(s),this.sprite.x=(p.MASTER_CONTAINER.w-this.w*s)/2,this.sprite.y=(p.MASTER_CONTAINER.h-this.h*s)/2,this.mask.clear().rect(0,0,this.w*s,this.h*s).fill({color:0,alpha:1}),this.dim.clear().rect(0,0,this.w*s,this.h*s).fill({color:0,alpha:p.ALPHA}),this.container.y=60-Y.HEIGHT_REDUCTION}static updateSize(){p.EMIT_STACK.length!==0&&this.manuallyUpdateSize()}static async setBG(){const t=await bt.load({src:this.src,loadParser:"loadTextures"});this.texture=t,this.sprite.texture=t,this.manuallyUpdateSize();const e=JSON.parse(localStorage.getItem("settings"));this.changeStrength(e.background.blur)}static playVideo(t){if(!this.videoHTML||!this.videoSrc||!p.IS_VIDEO)return;const e=Math.max(t-Lt.offset,0);this.videoHTML.currentTime=e/1e3,this.videoHTML.playbackRate=p.PLAYBACK_RATE,this.videoHTML.play()}static pauseVideo(t){if(!this.videoHTML||!this.videoSrc||!p.IS_VIDEO)return;this.videoHTML.pause();const e=Math.max(t-Lt.offset,0);this.videoHTML.currentTime=e/1e3}static seekTo(t){!this.videoHTML||!this.videoSrc||!p.IS_VIDEO||(this.videoHTML.currentTime=Math.max(t-Lt.offset,0)/1e3)}static switch(t){if(this.videoSrc){if(console.log(t),t==="VIDEO"){this.sprite.texture=this.videoTexture,this.manuallyUpdateSize();return}this.sprite.texture=this.texture,this.manuallyUpdateSize()}}static async setVideoBG(){const t=await bt.load({src:this.videoSrc,data:{autoPlay:!1},loadParser:"loadVideo"});this.videoTexture=t,this.videoHTML=t.source.resource,this.videoHTML.autoplay=!1,this.videoHTML.currentTime=0,this.videoHTML.pause(),p.IS_VIDEO&&(this.sprite.texture=t,this.manuallyUpdateSize())}}var wt={};Object.defineProperty(wt,"__esModule",{value:!0});var Rx=wt.linear=iA,wx=wt.easeInSine=sA,Ix=wt.easeOutSine=nA,Mx=wt.easeInOutSine=rA,Ox=wt.easeInQuad=oA,wa=wt.easeOutQuad=aA,vx=wt.easeInOutQuad=lA,Px=wt.easeInCubic=cA,Lx=wt.easeOutCubic=hA,Nx=wt.easeInOutCubic=uA,Dx=wt.easeInQuart=dA,kx=wt.easeOutQuart=fA,Hx=wt.easeInOutQuart=pA,Fx=wt.easeInQuint=mA,Bx=wt.easeOutQuint=gA,Ux=wt.easeInOutQuint=yA,Gx=wt.easeInExpo=SA,jx=wt.easeOutExpo=TA,Wx=wt.easeInOutExpo=EA,Vx=wt.easeInCirc=_A,zx=wt.easeOutCirc=bA,$x=wt.easeInOutCirc=xA,Yx=wt.easeInBack=AA,Xx=wt.easeOutBack=CA,qx=wt.easeInOutBack=RA,Kx=wt.easeInElastic=wA,Zx=wt.easeOutElastic=IA,Jx=wt.easeInOutElastic=MA,Qx=wt.easeOutBounce=sl,tA=wt.easeInBounce=mf,eA=wt.easeInOutBounce=OA;function iA(i){return i}function sA(i){return-1*Math.cos(i*(Math.PI/2))+1}function nA(i){return Math.sin(i*(Math.PI/2))}function rA(i){return-.5*(Math.cos(Math.PI*i)-1)}function oA(i){return i*i}function aA(i){return i*(2-i)}function lA(i){return i<.5?2*i*i:-1+(4-2*i)*i}function cA(i){return i*i*i}function hA(i){var t=i-1;return t*t*t+1}function uA(i){return i<.5?4*i*i*i:(i-1)*(2*i-2)*(2*i-2)+1}function dA(i){return i*i*i*i}function fA(i){var t=i-1;return 1-t*t*t*t}function pA(i){var t=i-1;return i<.5?8*i*i*i*i:1-8*t*t*t*t}function mA(i){return i*i*i*i*i}function gA(i){var t=i-1;return 1+t*t*t*t*t}function yA(i){var t=i-1;return i<.5?16*i*i*i*i*i:1+16*t*t*t*t*t}function SA(i){return i===0?0:Math.pow(2,10*(i-1))}function TA(i){return i===1?1:-Math.pow(2,-10*i)+1}function EA(i){if(i===0||i===1)return i;var t=i*2,e=t-1;return t<1?.5*Math.pow(2,10*e):.5*(-Math.pow(2,-10*e)+2)}function _A(i){var t=i/1;return-1*(Math.sqrt(1-t*i)-1)}function bA(i){var t=i-1;return Math.sqrt(1-t*t)}function xA(i){var t=i*2,e=t-2;return t<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-e*e)+1)}function AA(i){var t=arguments.length<=1||arguments[1]===void 0?1.70158:arguments[1],e=i/1;return e*e*((t+1)*e-t)}function CA(i){var t=arguments.length<=1||arguments[1]===void 0?1.70158:arguments[1],e=i/1-1;return e*e*((t+1)*e+t)+1}function RA(i){var t=arguments.length<=1||arguments[1]===void 0?1.70158:arguments[1],e=i*2,s=e-2,n=t*1.525;return e<1?.5*e*e*((n+1)*e-n):.5*(s*s*((n+1)*s+n)+2)}function wA(i){var t=arguments.length<=1||arguments[1]===void 0?.7:arguments[1];if(i===0||i===1)return i;var e=i/1,s=e-1,n=1-t,r=n/(2*Math.PI)*Math.asin(1);return-(Math.pow(2,10*s)*Math.sin((s-r)*(2*Math.PI)/n))}function IA(i){var t=arguments.length<=1||arguments[1]===void 0?.7:arguments[1],e=1-t,s=i*2;if(i===0||i===1)return i;var n=e/(2*Math.PI)*Math.asin(1);return Math.pow(2,-10*s)*Math.sin((s-n)*(2*Math.PI)/e)+1}function MA(i){var t=arguments.length<=1||arguments[1]===void 0?.65:arguments[1],e=1-t;if(i===0||i===1)return i;var s=i*2,n=s-1,r=e/(2*Math.PI)*Math.asin(1);return s<1?-.5*(Math.pow(2,10*n)*Math.sin((n-r)*(2*Math.PI)/e)):Math.pow(2,-10*n)*Math.sin((n-r)*(2*Math.PI)/e)*.5+1}function sl(i){var t=i/1;if(t<1/2.75)return 7.5625*t*t;if(t<2/2.75){var e=t-.5454545454545454;return 7.5625*e*e+.75}else if(t<2.5/2.75){var s=t-.8181818181818182;return 7.5625*s*s+.9375}else{var n=t-.9545454545454546;return 7.5625*n*n+.984375}}function mf(i){return 1-sl(1-i)}function OA(i){return i<.5?mf(i*2)*.5:sl(i*2-1)*.5+.5}const As=vf({__proto__:null,default:wt,easeInBack:Yx,easeInBounce:tA,easeInCirc:Vx,easeInCubic:Px,easeInElastic:Kx,easeInExpo:Gx,easeInOutBack:qx,easeInOutBounce:eA,easeInOutCirc:$x,easeInOutCubic:Nx,easeInOutElastic:Jx,easeInOutExpo:Wx,easeInOutQuad:vx,easeInOutQuart:Hx,easeInOutQuint:Ux,easeInOutSine:Mx,easeInQuad:Ox,easeInQuart:Dx,easeInQuint:Fx,easeInSine:wx,easeOutBack:Xx,easeOutBounce:Qx,easeOutCirc:zx,easeOutCubic:Lx,easeOutElastic:Zx,easeOutExpo:jx,easeOutQuad:wa,easeOutQuart:kx,easeOutQuint:Bx,easeOutSine:Ix,linear:Rx},[wt]);class vA{constructor({easing:t,startTime:e,endTime:s,params:n}){S(this,"easing");S(this,"startTime");S(this,"endTime");S(this,"params");this.easing=t,this.startTime=e,this.endTime=s,this.params=n,this.duration=Math.max(n.length-1,1)*(s-e)}execute(t,e){try{const{sprite:s}=t;if(e<this.startTime){t.props.alpha=this.params.at(0);return}if(this.duration===0||e>this.startTime+this.duration){t.props.alpha=this.params.at(-1);return}if(this.params.length===1){t.props.alpha=this.params.at(0);return}const n=Math.floor((e-this.startTime)/this.duration*(this.params.length-1)),r=ot((e-this.startTime)%this.duration/this.duration,0,1),o=ce[this.easing]==="easeOutElasticHalf"?ts:ce[this.easing]==="easeOutElasticQuart"?In:As[ce[this.easing]];if(!o)throw new Error(this.easing);const a=this.params[n]+(this.params[n+1]-this.params[n])*o(r);t.props.alpha=a}catch(s){console.log(s)}}}class Bo{constructor({easing:t,startTime:e,endTime:s,paramsX:n,paramsY:r}){S(this,"startTime");S(this,"endTime");S(this,"paramsX");S(this,"paramsY");this.easing=t,this.startTime=e,this.endTime=s,this.paramsX=n,this.paramsY=r,this.duration=Math.max(Math.max(n.length-1,r.length-1),1)*(s-e)}execute(t,e){const{sprite:s}=t;if(e<this.startTime){this.paramsX.length>0&&(t.props.posX=this.paramsX.at(0)),this.paramsY.length>0&&(t.props.posY=this.paramsY.at(0));return}if(this.duration===0||e>this.startTime+this.duration){this.paramsX.length>0&&(t.props.posX=this.paramsX.at(-1)),this.paramsY.length>0&&(t.props.posY=this.paramsY.at(-1));return}if(this.paramsX.length===1&&(t.props.posX=this.paramsX.at(0),this.paramsY.length===0)||this.paramsY.length===1&&(t.props.posY=this.paramsY.at(0),this.paramsX.length===0)||this.paramsX.length===1||this.paramsY.length===1)return;const n=Math.floor((e-this.startTime)/this.duration*Math.max(this.paramsX.length-1,this.paramsY.length-1)),r=ot((e-this.startTime)%this.duration/this.duration,0,1),o=ce[this.easing]==="easeOutElasticHalf"?ts:ce[this.easing]==="easeOutElasticQuart"?In:As[ce[this.easing]]??As[ce[0]];if(this.paramsX.length>0){const a=this.paramsX[n],l=this.paramsX[n+1],c=a+(l-a)*o(r);t.props.posX=c}if(this.paramsY.length>0){const a=this.paramsY[n],l=this.paramsY[n+1],c=a+(l-a)*o(r);t.props.posY=c}}}class lh{constructor({easing:t,startTime:e,endTime:s,paramsX:n,paramsY:r}){S(this,"easing");S(this,"startTime");S(this,"endTime");S(this,"paramsX");S(this,"paramsY");this.easing=t,this.startTime=e,this.endTime=s,this.paramsX=n,this.paramsY=r,this.duration=Math.max(n.length-1,1)*(s-e)}execute(t,e){const{sprite:s}=t;if(e<this.startTime){t.props.scaleX=this.paramsX.at(0),t.props.scaleY=this.paramsY.at(0);return}if(e>this.startTime+this.duration){this.paramsX.length>0&&(t.props.scaleX=this.paramsX.at(-1),t.props.scaleY=this.paramsY.at(-1));return}if(this.paramsX.length===1){t.props.scaleX=this.paramsX.at(0),t.props.scaleY=this.paramsY.at(0);return}const n=Math.floor((e-this.startTime)/this.duration*(this.paramsX.length-1)),r=ot((e-this.startTime)%this.duration/this.duration,0,1),o=ce[this.easing]==="easeOutElasticHalf"?ts:ce[this.easing]==="easeOutElasticQuart"?In:As[ce[this.easing]];if(this.paramsX.length>0){const a=this.paramsX[n],l=this.paramsX[n+1],c=this.paramsY[n],h=this.paramsY[n+1],u=a+(l-a)*o(r),d=c+(h-c)*o(r);t.props.scaleX=u,t.props.scaleY=d}}}class PA{constructor({easing:t,startTime:e,endTime:s,params:n}){S(this,"easing");S(this,"startTime");S(this,"endTime");S(this,"params");this.easing=t,this.startTime=e,this.endTime=s,this.params=n,this.duration=Math.max(n.length-1,1)*(s-e)}execute(t,e){try{const{sprite:s}=t;if(e<this.startTime){t.props.rotation=this.params.at(0);return}if(this.duration===0||e>this.startTime+this.duration){t.props.rotation=this.params.at(-1);return}if(this.params.length===1){t.props.rotation=this.params.at(0);return}const n=Math.floor((e-this.startTime)/this.duration*(this.params.length-1)),r=ot((e-this.startTime)%this.duration/this.duration,0,1),o=ce[this.easing]==="easeOutElasticHalf"?ts:ce[this.easing]==="easeOutElasticQuart"?In:As[ce[this.easing]];if(!o)throw new Error(this.easing);const a=this.params[n]+(this.params[n+1]-this.params[n])*o(r);t.props.rotation=a}catch(s){console.log(s)}}}class LA{constructor({easing:t,startTime:e,endTime:s,paramsR:n,paramsG:r,paramsB:o}){S(this,"startTime");S(this,"endTime");S(this,"paramsR");S(this,"paramsG");S(this,"paramsB");this.easing=t,this.startTime=e,this.endTime=s,this.paramsR=n,this.paramsG=r,this.paramsB=o,this.duration=Math.max(n.length-1,1)*(s-e)}execute(t,e){const{sprite:s}=t;if(e<this.startTime){t.props.tint=this.paramsR.at(0)<<16|this.paramsG.at(0)<<8|this.paramsB.at(0);return}if(this.duration===0||e>this.startTime+this.duration){this.paramsR.length>0&&(t.props.tint=this.paramsR.at(-1)<<16|this.paramsG.at(-1)<<8|this.paramsB.at(-1));return}if(this.paramsR.length===1){t.props.tint=this.paramsR.at(0)<<16|this.paramsG.at(0)<<8|this.paramsB.at(0);return}const n=Math.floor((e-this.startTime)/this.duration*(this.paramsR.length-1)),r=ot((e-this.startTime)%this.duration/this.duration,0,1),o=ce[this.easing]==="easeOutElasticHalf"?ts:ce[this.easing]==="easeOutElasticQuart"?In:As[ce[this.easing]];if(this.paramsR.length>0){const a=this.paramsR[n]+(this.paramsR[n+1]-this.paramsR[n])*o(r),l=this.paramsG[n]+(this.paramsG[n+1]-this.paramsG[n])*o(r),c=this.paramsB[n]+(this.paramsB[n+1]-this.paramsB[n])*o(r);t.props.tint=a<<16|l<<8|c}}}class NA{constructor({easing:t,startTime:e,endTime:s,params:n}){S(this,"easing");S(this,"startTime");S(this,"endTime");S(this,"params");this.easing=t,this.startTime=e,this.endTime=s,this.params=n,this.duration=Math.max(n.length-1,1)*(s-e)}execute(t,e){const{sprite:s}=t;if(e<this.startTime){switch(this.params.at(0)){case"A":{t.props.blendMode="add";break}case"H":{t.props.flipW=!0;break}case"V":{t.props.flipH=!0;break}}return}if(t.props.blendMode="normal",this.duration===0||e>this.startTime+this.duration){switch(this.params.at(-1)){case"A":{t.props.blendMode="add";break}case"H":{t.props.flipW=!0;break}case"V":{t.props.flipH=!0;break}}return}if(this.params.length===1){switch(this.params.at(0)){case"A":{t.props.blendMode="add";break}case"H":{t.props.flipW=!0;break}case"V":{t.props.flipH=!0;break}}return}const n=Math.floor((e-this.startTime)/this.duration*(this.params.length-1));switch(this.params.at(n)){case"A":{t.props.blendMode="add";break}case"H":{t.props.flipW=!0;break}case"V":{t.props.flipH=!0;break}}}}class ch{constructor({startTime:t,loopCount:e,rawCommands:s}){S(this,"startTime");S(this,"loopCount");S(this,"commands");this.startTime=t,this.loopCount=e,this.commands=this.parse(s),this.oneIterationStart=Math.min(...Object.values(this.commands).reduce((n,r)=>[...n,...r],[]).map(n=>n.startTime)),this.oneIterationEnd=Math.max(...Object.values(this.commands).reduce((n,r)=>[...n,...r],[]).map(n=>n.startTime+n.duration)),this.duration=(this.oneIterationEnd-this.oneIterationStart)*this.loopCount,this.endTime=this.startTime+this.duration}parse(t){const e=(t.match(new RegExp(`${xt.REGEX.FADE.source}`,"gm"))??[]).map(u=>Yt.fadeParse(u)),s=(t.match(new RegExp(`${xt.REGEX.MOVE.source}`,"gm"))??[]).map(u=>Yt.moveParse(u)),n=(t.match(new RegExp(`${xt.REGEX.MOVE_X.source}`,"gm"))??[]).map(u=>Yt.moveXParse(u)),r=(t.match(new RegExp(`${xt.REGEX.MOVE_Y.source}`,"gm"))??[]).map(u=>Yt.moveYParse(u)),o=(t.match(new RegExp(`${xt.REGEX.SCALE.source}`,"gm"))??[]).map(u=>Yt.scaleParse(u)),a=(t.match(new RegExp(`${xt.REGEX.VECTOR.source}`,"gm"))??[]).map(u=>Yt.vectorParse(u)),l=(t.match(new RegExp(`${xt.REGEX.ROTATE.source}`,"gm"))??[]).map(u=>Yt.rotateParse(u)),c=(t.match(new RegExp(`${xt.REGEX.COLOUR.source}`,"gm"))??[]).map(u=>Yt.colourParse(u)),h=(t.match(new RegExp(`${xt.REGEX.PARAMETER.source}`,"gm"))??[]).map(u=>Yt.parameterParse(u));return{fade:e,move:s,moveX:n,moveY:r,scale:o,vector:a,rotate:l,colour:c,parameter:h}}execute(t,e){if(e<this.startTime||e>this.endTime)return;const s=(e-this.startTime)%(this.oneIterationEnd-this.oneIterationStart);Object.values(this.commands).forEach(n=>{n.forEach((r,o,a)=>{s<r.startTime&&o!==0||o!==0&&a[o-1].startTime===r.startTime&&a[o-1].duration===r.duration||r.execute(t,s)})})}}function DA(i){return new Worker("/dist/assets/StoryboardWorker-CEjZkpCy.js",{name:i==null?void 0:i.name})}const ce={0:"linear",1:"easeOutSine",2:"easeInSine",3:"easeInQuad",4:"easeOutQuad",5:"easeInOutQuad",6:"easeInCubic",7:"easeOutCubic",8:"easeInOutCubic",9:"easeInQuart",10:"easeOutQuart",11:"easeInOutQuart",12:"easeInQuint",13:"easeOutQuint",14:"easeInOutQuint",15:"easeInSine",16:"easeOutSine",17:"easeInOutSine",18:"easeInExpo",19:"easeOutExpo",20:"easeInOutExpo",21:"easeInCirc",22:"easeOutCirc",23:"easeInOutCirc",24:"easeInElastic",25:"easeOutElastic",26:"easeOutElasticHalf",27:"easeOutElasticQuart",28:"easeInOutElastic",29:"easeInBack",30:"easeOutBack",31:"easeInOutBack",32:"easeInBounce",33:"easeOutBounce",34:"easeInOutBounce"},gf={TopLeft:[0,0],TopCentre:[.5,0],TopRight:[1,0],CentreLeft:[0,.5],Centre:[.5,.5],CentreRight:[1,.5],BottomLeft:[0,1],BottomCentre:[.5,1],BottomRight:[1,1]},yf={Background:0,Fail:1,Pass:2,Foreground:3};class Yt{constructor(t,e){S(this,"raw");S(this,"commands",[]);S(this,"isInRender",!1);S(this,"isOsu",!1);S(this,"props",{posX:0,posY:0,scaleX:1,scaleY:1,alpha:1,tint:16777215,rotation:0,blendMode:"normal",flipH:!1,flipW:!1});this.raw=t,this.isOsu=e,this.sprite=new Mt,this.sprite.visible=!1,this.getSpriteInfo(),this.commands=this.parse(t),this.startTime=Math.min(...Object.values(this.commands).reduce((s,n)=>[...s,...n],[]).map(s=>s.startTime)),this.endTime=Math.max(...Object.values(this.commands).reduce((s,n)=>[...s,...n],[]).map(s=>s.startTime+s.duration))}static fadeParse(t,e){let[,s,n,r,...o]=t.split(",");return r===""&&(r=n),(e==null?void 0:e.texturepath)===xt.backgroundFilename&&o.at(0)==="0"&&(xt.BLACK_BG=!0,p.IS_STORYBOARD&&(Lt.sprite.tint=0)),new vA({easing:s,startTime:parseFloat(n),endTime:parseFloat(r),params:o.map(a=>parseFloat(a))})}static moveParse(t){let[,e,s,n,...r]=t.split(",");n===""&&(n=s);const o=r.filter((l,c)=>c%2===0),a=r.filter((l,c)=>c%2!==0);return new Bo({easing:e,startTime:parseFloat(s),endTime:parseFloat(n),paramsX:o.map(l=>parseFloat(l)),paramsY:a.map(l=>parseFloat(l))})}static moveXParse(t){let[,e,s,n,...r]=t.split(",");return n===""&&(n=s),new Bo({easing:e,startTime:parseFloat(s),endTime:parseFloat(n),paramsX:r.map(o=>parseFloat(o)),paramsY:[]})}static moveYParse(t){let[,e,s,n,...r]=t.split(",");return n===""&&(n=s),new Bo({easing:e,startTime:parseFloat(s),endTime:parseFloat(n),paramsX:[],paramsY:r.map(o=>parseFloat(o))})}static scaleParse(t){let[,e,s,n,...r]=t.split(",");return n===""&&(n=s),new lh({easing:e,startTime:parseFloat(s),endTime:parseFloat(n),paramsX:r.map(o=>parseFloat(o)),paramsY:r.map(o=>parseFloat(o))})}static vectorParse(t){let[,e,s,n,...r]=t.split(",");n===""&&(n=s);const o=r.filter((l,c)=>c%2===0),a=r.filter((l,c)=>c%2!==0);return new lh({easing:e,startTime:parseFloat(s),endTime:parseFloat(n),paramsX:o.map(l=>parseFloat(l)),paramsY:a.map(l=>parseFloat(l))})}static rotateParse(t){let[,e,s,n,...r]=t.split(",");return n===""&&(n=s),new PA({easing:e,startTime:parseFloat(s),endTime:parseFloat(n),params:r.map(o=>parseFloat(o))})}static colourParse(t){let[,e,s,n,...r]=t.split(",");n===""&&(n=s);const o=r.filter((c,h)=>h%3===0),a=r.filter((c,h)=>h%3===1),l=r.filter((c,h)=>h%3===2);return new LA({easing:e,startTime:parseFloat(s),endTime:parseFloat(n),paramsR:o.map(c=>parseFloat(c)),paramsG:a.map(c=>parseFloat(c)),paramsB:l.map(c=>parseFloat(c))})}static parameterParse(t){let[,e,s,n,...r]=t.split(",");return n===""&&(n=s),new NA({easing:e,startTime:parseFloat(s),endTime:parseFloat(n),params:r})}static loopParse(t){const[e,...s]=t.split(`
`),[,n,r]=e.split(","),o=s.join(`
`);return new ch({startTime:parseFloat(n),loopCount:parseInt(r),rawCommands:o})}getSpriteInfo(){const[t]=this.raw.split(`
`),[,e,s,n,r,o]=t.split(",");this.layer=e,this.origin=s,this.texturepath=n.slice(1,-1).replaceAll("\\","/"),this.base_x=parseFloat(r),this.base_y=parseFloat(o),this.props.posX=this.base_x,this.props.posY=this.base_y,this.sprite.anchor.set(...gf[this.origin]),this.sprite.label=`${this.texturepath} ${this.layer}`,this.sprite.zIndex=yf[this.layer]}loadTexture(){this.texture=xt.TEXTURES[this.texturepath],this.sprite.texture=this.texture}parse(t){const e=(t.match(new RegExp(`^${xt.REGEX.FADE.source}`,"gm"))??[]).map(d=>Yt.fadeParse(d,this)),s=(t.match(new RegExp(`^${xt.REGEX.MOVE.source}`,"gm"))??[]).map(d=>Yt.moveParse(d)),n=(t.match(new RegExp(`^${xt.REGEX.MOVE_X.source}`,"gm"))??[]).map(d=>Yt.moveXParse(d)),r=(t.match(new RegExp(`^${xt.REGEX.MOVE_Y.source}`,"gm"))??[]).map(d=>Yt.moveYParse(d)),o=(t.match(new RegExp(`^${xt.REGEX.SCALE.source}`,"gm"))??[]).map(d=>Yt.scaleParse(d)),a=(t.match(new RegExp(`^${xt.REGEX.VECTOR.source}`,"gm"))??[]).map(d=>Yt.vectorParse(d)),l=(t.match(new RegExp(`^${xt.REGEX.ROTATE.source}`,"gm"))??[]).map(d=>Yt.rotateParse(d)),c=(t.match(new RegExp(`^${xt.REGEX.COLOUR.source}`,"gm"))??[]).map(d=>Yt.colourParse(d)),h=(t.match(new RegExp(`^${xt.REGEX.PARAMETER.source}`,"gm"))??[]).map(d=>Yt.parameterParse(d)),u=(t.match(new RegExp(`^${xt.REGEX.LOOP_BLOCK.source}`,"gm"))??[]).map(d=>Yt.loopParse(d));return{fade:e,move:s,moveX:n,moveY:r,scale:o,vector:a,rotate:l,colour:c,parameter:h,loop:u}}draw(t){if(t<this.startTime||t>this.endTime){this.isInRender&&(this.isInRender=!1,this.sprite.visible=!1);return}this.isInRender||(this.isInRender=!0,this.sprite.visible=!0),Object.values(this.commands).forEach(e=>{e.forEach((s,n,r)=>{t<s.startTime&&n!==0||n!==0&&r[n-1].startTime===s.startTime&&r[n-1].duration===s.duration&&!(s instanceof ch)||s.execute(this,t)})}),this.sprite.x=this.props.posX*p.SB_SCALE_RATE,this.sprite.y=this.props.posY*p.SB_SCALE_RATE,this.sprite.alpha=this.props.alpha,this.sprite.scale.set(this.props.scaleX*p.SB_SCALE_RATE*(this.props.flipW?-1:1),this.props.scaleY*p.SB_SCALE_RATE*(this.props.flipH?-1:1)),this.sprite.rotation=this.props.rotation,this.sprite.tint=this.props.tint,this.sprite.blendMode=this.props.blendMode}}class hh extends Yt{constructor(e,s){super(e,s);S(this,"currentFrame",0)}getSpriteInfo(){const[e]=this.raw.split(`
`),[,s,n,r,o,a,l,c,h]=e.split(",");this.layer=s,this.origin=n,this.texturepath=r.slice(1,-1).replaceAll("\\","/"),this.base_x=parseFloat(o),this.base_y=parseFloat(a),this.frameCount=parseInt(l),this.frameDelay=parseFloat(c),this.loopType=h,this.props.posX=this.base_x,this.props.posY=this.base_y,this.sprite.anchor.set(...gf[this.origin]),this.sprite.label=`${this.texturepath} ${this.layer}`,this.sprite.zIndex=yf[this.layer]}loadTexture(){this.texture=xt.TEXTURES[`${this.texturepath.split(".").slice(0,-1).join(".")}0.${this.texturepath.split(".").at(-1)}`],this.sprite.texture=this.texture}draw(e){if(super.draw(e),e<this.startTime)return;const s=Math.floor((e-this.startTime)/this.frameDelay);if(this.loopType==="LoopOnce"&&this.currentFrame>=this.frameCount-1)return;const n=s%this.frameCount;n!==this.currentFrame&&(this.currentFrame=n,this.sprite.texture=xt.TEXTURES[`${this.texturepath.split(".").slice(0,-1).join(".")}${n}.${this.texturepath.split(".").at(-1)}`])}}const yt=class yt{static init(){this.container=new ut,this.container.label="Storyboard",this.container.eventMode="none",this.mask=new ft,this.mask.label="MASK",this.mask.clear().rect(p.MASTER_CONTAINER.h*(4/3-16/9)/2,0,p.MASTER_CONTAINER.h*16/9,p.MASTER_CONTAINER.h).fill(16777215),this.container.mask=this.mask,this.container.addChild(this.mask),this.REGEX.COMMAND_REGEX=new RegExp(`${yt.REGEX.FADE.source}|${yt.REGEX.MOVE.source}|${yt.REGEX.MOVE_X.source}|${yt.REGEX.MOVE_Y.source}|${yt.REGEX.SCALE.source}|${yt.REGEX.VECTOR.source}|${yt.REGEX.ROTATE.source}|${yt.REGEX.COLOUR.source}|${yt.REGEX.PARAMETER.source}`),this.REGEX.LOOP_BLOCK=new RegExp(`${yt.REGEX.LOOP.source}((\\r)?\\n(_| )(${yt.REGEX.COMMAND_REGEX.source}))+`,"gm"),this.REGEX.SPRITE_BLOCK=new RegExp(`(${yt.REGEX.SPRITE.source}|${yt.REGEX.ANIMATION.source})((\\r)?\\n(${yt.REGEX.COMMAND_REGEX.source}|${this.REGEX.LOOP_BLOCK.source}))+`,"gm"),this.REGEX.FORBIDDEN=new RegExp(`((Sprite|Animation),.*?)(?=(\r)?
((Sprite|Animation),.*?))`,"gm")}static load(t,e){const r=(t.match(this.REGEX.VARIABLE)??[]).map(c=>{const[h,...u]=c.split("=");return{key:h,value:u.join("")}}).reduce((c,h)=>c.replaceAll(h.key,h.value),t),o=r.match(this.REGEX.FORBIDDEN)??[];return o.length>0&&(yt.BLACK_BG=!0,p.IS_STORYBOARD&&(Lt.sprite.tint=0)),(o.reduce((c,h)=>c.replaceAll(h,""),r).match(this.REGEX.SPRITE_BLOCK)??[]).map(c=>c.split(",").at(0)==="Sprite"?new Yt(c,e??!1):new hh(c,e??!1))}static async parse(t,e,s,n){yt.backgroundFilename=n;const r=yt.load(t.replaceAll("\r","")),o=yt.load(e.replaceAll("\r",""),!0);yt.sprites=[...o,...r];const a=yt.sprites.reduce((l,c)=>c instanceof hh?[...l,...Array(c.frameCount).fill(!0).map((h,u)=>`${c.texturepath.split(".").slice(0,-1).join(".")}${u}.${c.texturepath.split(".").at(-1)}`)]:[...l,c.texturepath],[]);for(const l of a){if(yt.TEXTURES[l])continue;const c=s.find(f=>f.filename.toLowerCase()===l.toLowerCase());if(!c){yt.TEXTURES[l]=new _t;continue}const h=await c.getData(new zip.BlobWriter(`image/${l.split(".").at(-1)}`)),u=URL.createObjectURL(h),d=await bt.load({src:u,loadParser:"loadTextures"});yt.TEXTURES[l]=d}for(const l of yt.sprites)l.loadTexture(),yt.container.addChild(l.sprite)}static reset(){yt.sprites=[],yt.backgroundFilename="",yt.BLACK_BG=!1,yt.TEXTURES={},yt.WORKER.postMessage({type:"clear"})}static draw(t){p.EMIT_STACK.length>0&&(this.container.x=p.SB_OFFSET_X,this.container.y=p.SB_OFFSET_Y,this.mask.clear().rect(p.MASTER_CONTAINER.h*(4/3-16/9)/2,0,p.MASTER_CONTAINER.h*16/9,p.MASTER_CONTAINER.h).fill(16777215)),p.IS_STORYBOARD&&yt.sprites.forEach(e=>e.draw(t))}};S(yt,"rawOsb"),S(yt,"sprites",[]),S(yt,"backgroundFilename",""),S(yt,"BLACK_BG",!1),S(yt,"TEXTURES",{}),S(yt,"WORKER",new DA),S(yt,"filtered",[]),S(yt,"REGEX",{FADE:/(_| )F,[0-9]{1,2},-?[0-9]+(\.[0-9]+)?,(-?[0-9]+(\.[0-9]+)?)?(,-?[0-9]+(\.[0-9]+)?(E(\+|-)[0-9]+)?)+/g,MOVE:/(_| )M,[0-9]{1,2},-?[0-9]+(\.[0-9]+)?,(-?[0-9]+(\.[0-9]+)?)?(,-?[0-9]+(\.[0-9]+)?(E(\+|-)[0-9]+)?)+/g,MOVE_X:/(_| )MX,[0-9]{1,2},-?[0-9]+(\.[0-9]+)?,(-?[0-9]+(\.[0-9]+)?)?(,-?[0-9]+(\.[0-9]+)?(E(\+|-)[0-9]+)?)+/g,MOVE_Y:/(_| )MY,[0-9]{1,2},-?[0-9]+(\.[0-9]+)?,(-?[0-9]+(\.[0-9]+)?)?(,-?[0-9]+(\.[0-9]+)?(E(\+|-)[0-9]+)?)+/g,SCALE:/(_| )S,[0-9]{1,2},-?[0-9]+(\.[0-9]+)?,(-?[0-9]+(\.[0-9]+)?)?(,-?[0-9]+(\.[0-9]+)?(E(\+|-)[0-9]+)?)+/g,VECTOR:/(_| )V,[0-9]{1,2},-?[0-9]+(\.[0-9]+)?,(-?[0-9]+(\.[0-9]+)?)?(,-?[0-9]+(\.[0-9]+)?(E(\+|-)[0-9]+)?)+/g,ROTATE:/(_| )R,[0-9]{1,2},-?[0-9]+(\.[0-9]+)?,(-?[0-9]+(\.[0-9]+)?)?(,-?[0-9]+(\.[0-9]+)?(E(\+|-)[0-9]+)?)+/g,COLOUR:/(_| )C,[0-9]{1,2},-?[0-9]+(\.[0-9]+)?,(-?[0-9]+(\.[0-9]+)?)?(,-?[0-9]+(\.[0-9]+)?(E(\+|-)[0-9]+)?)+/g,PARAMETER:/(_| )P,[0-9]{1,2},-?[0-9]+(\.[0-9]+)?,(-?[0-9]+(\.[0-9]+)?)?(,(H|V|A))+/g,LOOP:/(_| )L,-?[0-9]+(\.[0-9]+)?,[0-9]+/g,SPRITE:/Sprite,(0|1|2|3|Background|Foreground|Pass|Fail),([0-9]|Top(Left|Right|Centre)|Centre(Left|Right)?|Bottom(Left|Right|Centre)|Custom),"((?:\w+\\?)*\\)?[;\+\/\\\!\(\)\[\]\{\}\&\%\#a-zA-Z0-9\s\._\-\~\@']+\.[a-zA-Z0-9]+",-?[0-9]+(\.[0-9]+)?,-?[0-9]+(\.[0-9]+)?/g,ANIMATION:/Animation,(0|1|2|3|Background|Foreground|Pass|Fail),([0-9]|Top(Left|Right|Centre)|Centre(Left|Right)?|Bottom(Left|Right|Centre)|Custom),"((?:\w+\\?)*\\)?[;\+\/\\\!\(\)\[\]\{\}\&\%\#a-zA-Z0-9\s\._\-\~\@']+\.[a-zA-Z0-9]+",-?[0-9]+(\.[0-9]+)?,-?[0-9]+(\.[0-9]+)?,-?[0-9]+(\.[0-9]+)?,-?[0-9]+(\.[0-9]+)?,(LoopOnce|LoopForever)/g,VARIABLE:/^\$[0-9A-Za-z]+=.+/gm});let xt=yt;function nl(){const i=document.querySelector("#settingsPanel"),t=document.querySelector("#block");i.style.left===""?i.classList.add("opened"):i.classList.remove("opened"),i.style.left=i.style.left===""?"0px":"",i.style.opacity=i.style.opacity===""?"1":"",t.style.display=i.style.opacity==="1"?"block":"",setTimeout(()=>{t.style.opacity=i.style.opacity==="1"?.5:""},0)}document.querySelector("#settingsButton").onclick=nl;document.body.addEventListener("click",i=>{const t=document.querySelector("#settingsPanel").contains(i.target);document.querySelector("#settingsButton").contains(i.target)||t||(settingsPanel.style.left="",settingsPanel.style.opacity="",settingsPanel.classList.remove("opened"),block.style.opacity=settingsPanel.style.opacity==="1"?.5:"",setTimeout(()=>{block.style.display=settingsPanel.style.opacity==="1"?"block":""},200))});document.body.addEventListener("change",i=>{const t=i.target;if(t.checked&&["nerinyan","custom","sayobot","chimu"].includes(t.value)){document.querySelector("[data-mirror]").style.display="block";const e=JSON.parse(localStorage.getItem("settings"));if(e.mirror.val=t.value,localStorage.setItem("settings",JSON.stringify(e)),document.querySelector(".mirrorIndicator").textContent=`Too slow? Switch to another mirror (currently using: ${t.value==="custom"?"Custom":document.querySelector(`[for=${t.value}]`).textContent})`,t.value==="custom")return;document.querySelector(`[data-mirror=${t.value}]`).style.display="none"}});[...document.querySelectorAll("[data-mirror]")].forEach(i=>{i.onclick=()=>{const t=JSON.parse(localStorage.getItem("settings"));t.mirror.val=i.dataset.mirror,localStorage.setItem("settings",JSON.stringify(t)),location.reload()}});function kA(i){const t=JSON.parse(localStorage.getItem("settings"));t.mirror.custom=i.value,localStorage.setItem("settings",JSON.stringify(t))}document.querySelector("#custom-mirror").onblur=()=>kA(document.querySelector("#custom-mirror"));function HA(i){document.querySelector("#resolutionVal").innerHTML=parseFloat(i.value).toFixed(2);const t=JSON.parse(localStorage.getItem("settings"));t.renderer.resolution=parseFloat(i.value),localStorage.setItem("settings",JSON.stringify(t)),p.RESOLUTION=parseFloat(i.value)}document.querySelector("#resolution").oninput=()=>HA(document.querySelector("#resolution"));function FA(i){Lt.changeOpacity(i.value),p.ALPHA=i.value,document.querySelector("#bgDimVal").innerHTML=`${parseInt(i.value*100)}%`;const t=JSON.parse(localStorage.getItem("settings"));t.background.dim=i.value,localStorage.setItem("settings",JSON.stringify(t))}document.querySelector("#dim").oninput=()=>FA(document.querySelector("#dim"));function BA(i){document.querySelector("#bgBlurVal").innerHTML=`${parseInt(i.value/20*100)}%`,Lt.changeStrength(i.value);const t=JSON.parse(localStorage.getItem("settings"));t.background.blur=i.value,localStorage.setItem("settings",JSON.stringify(t))}document.querySelector("#blur").oninput=()=>BA(document.querySelector("#blur"));function UA(i){p.MASTER_VOL=i.value,document.querySelector("#masterVal").innerHTML=`${parseInt(i.value*100)}%`;const t=JSON.parse(localStorage.getItem("settings"));t.volume.master=i.value,localStorage.setItem("settings",JSON.stringify(t)),p.BEATMAP_FILE!==void 0&&(p.BEATMAP_FILE.audioNode.gainNode.gain.value=p.MASTER_VOL*p.MUSIC_VOL,jt.masterGainNode.gain.value=p.MASTER_VOL*p.HS_VOL)}document.querySelector("#master").oninput=()=>UA(document.querySelector("#master"));function GA(i){p.MUSIC_VOL=i.value,document.querySelector("#musicVal").innerHTML=`${parseInt(i.value*100)}%`;const t=JSON.parse(localStorage.getItem("settings"));t.volume.music=i.value,localStorage.setItem("settings",JSON.stringify(t)),p.BEATMAP_FILE!==void 0&&(p.BEATMAP_FILE.audioNode.gainNode.gain.value=p.MASTER_VOL*p.MUSIC_VOL)}document.querySelector("#music").oninput=()=>GA(document.querySelector("#music"));function jA(i){p.HS_VOL=i.value,document.querySelector("#effectVal").innerHTML=`${parseInt(i.value/.4*100)}%`;const t=JSON.parse(localStorage.getItem("settings"));t.volume.hs=i.value,localStorage.setItem("settings",JSON.stringify(t)),jt.masterGainNode.gain.value=p.MASTER_VOL*p.HS_VOL,p.BEATMAP_FILE}document.querySelector("#effect").oninput=()=>jA(document.querySelector("#effect"));function WA(i){Pr.SOFT_OFFSET=i.value,document.querySelector("#softoffsetVal").innerHTML=`${parseInt(i.value)}ms`;const t=JSON.parse(localStorage.getItem("settings"));t.mapping.offset=i.value,localStorage.setItem("settings",JSON.stringify(t)),p.BEATMAP_FILE}document.querySelector("#softoffset").oninput=()=>WA(document.querySelector("#softoffset"));function Sf(i){p.MAPPING.beatsnap=i.value,document.querySelector("#beatVal").innerHTML=`1/${i.value}`;const t=JSON.parse(localStorage.getItem("settings"));t.mapping.beatsnap=i.value,localStorage.setItem("settings",JSON.stringify(t))}document.querySelector("#beat").oninput=()=>Sf(document.querySelector("#beat"));function Or(i){const e={addStacking:!0,mods:["HARD_ROCK","EASY","DOUBLE_TIME","HALF_TIME"].filter((o,a)=>i[a])},s=we.parseBlueprint(p.BEATMAP_FILE.osuFile),n=we.buildBeatmap(s,e),r=we.calculateDifficultyAttributes(n,!0)[0];p.STATS.CS=ii(n.difficulty.circleSize),p.STATS.AR=ii((r==null?void 0:r.approachRate)??n.difficulty.approachRate),p.STATS.OD=ii((r==null?void 0:r.overallDifficulty)??n.difficulty.overallDifficulty),p.STATS.HP=ii(n.difficulty.drainRate),p.STATS.SR=ii((r==null?void 0:r.starRating)??0),p.STATS.srContainer.color=parseInt(pe(al((r==null?void 0:r.starRating)??0)).formatHex().slice(1),16),((r==null?void 0:r.starRating)??0)>=6.5?p.STATS.SRSprite.style.fill=parseInt(pe("hsl(45, 100%, 70%)").formatHex().slice(1),16):p.STATS.SRSprite.style.fill=0,p.STATS.update()}function VA(i){p.MODS[i.name]=!p.MODS[i.name],p.SLIDER_APPEARANCE[i.name]=!p.SLIDER_APPEARANCE[i.name],p.MAPPING[i.name]=!p.MAPPING[i.name],i.name==="NC"&&(p.MODS.DT=!1,p.MODS.HT=!1,p.MODS.DC=!1,document.querySelector("#DT").checked=!1,document.querySelector("#HT").checked=!1,document.querySelector("#DC").checked=!1),i.name==="DT"&&(p.MODS.NC=!1,p.MODS.HT=!1,p.MODS.DC=!1,document.querySelector("#NC").checked=!1,document.querySelector("#HT").checked=!1,document.querySelector("#DC").checked=!1),i.name==="DC"&&(p.MODS.HT=!1,p.MODS.DT=!1,p.MODS.NC=!1,document.querySelector("#HT").checked=!1,document.querySelector("#NC").checked=!1,document.querySelector("#DT").checked=!1),i.name==="HT"&&(p.MODS.DC=!1,p.MODS.DT=!1,p.MODS.NC=!1,document.querySelector("#DC").checked=!1,document.querySelector("#NC").checked=!1,document.querySelector("#DT").checked=!1);const t=!p.MODS.DT&&!p.MODS.NC?1:1.5,e=!p.MODS.HT&&!p.MODS.DC?1:.75;if(["snaking","sliderend","hitAnim","ignoreSkin","showGrid","disablePerfect"].includes(i.name)){const n=JSON.parse(localStorage.getItem("settings"));n.sliderAppearance[i.name]=p.SLIDER_APPEARANCE[i.name],localStorage.setItem("settings",JSON.stringify(n)),document.querySelector("#showGrid").checked?p.GRID.alpha=1:p.GRID.alpha=.01;return}if(i.name==="aa"){const n=JSON.parse(localStorage.getItem("settings"));n.renderer.aa=i.checked,localStorage.setItem("settings",JSON.stringify(n)),p.APP.renderer.antialias=i.checked}if(i.name==="disableBMHS"){p.DISABLE_BMHS=!p.DISABLE_BMHS;const n=JSON.parse(localStorage.getItem("settings"));n.volume.disableBMHS=p.DISABLE_BMHS,localStorage.setItem("settings",JSON.stringify(n));return}if(i.name==="video"){const n=p.BEATMAP_FILE.audioNode.isPlaying;p.BEATMAP_FILE.audioNode.isPlaying&&p.BEATMAP_FILE.audioNode.pause(),p.IS_VIDEO=!p.IS_VIDEO,Lt.switch(p.IS_VIDEO?"VIDEO":"STATIC");const r=JSON.parse(localStorage.getItem("settings"));r.background.video=p.IS_VIDEO,localStorage.setItem("settings",JSON.stringify(r)),n&&p.BEATMAP_FILE.audioNode.play();return}if(i.name==="transcode"){const n=JSON.parse(localStorage.getItem("settings"));n.background.transcodeVideo=!n.background.transcodeVideo,localStorage.setItem("settings",JSON.stringify(n));return}if(i.name==="storyboard"){const n=p.BEATMAP_FILE.audioNode.isPlaying;p.BEATMAP_FILE.audioNode.isPlaying&&p.BEATMAP_FILE.audioNode.pause(),p.IS_STORYBOARD=!p.IS_STORYBOARD,xt.container.visible=p.IS_STORYBOARD,xt.BLACK_BG&&p.IS_STORYBOARD?Lt.sprite.tint=0:Lt.sprite.tint=16777215;const r=JSON.parse(localStorage.getItem("settings"));r.background.storyboard=p.IS_STORYBOARD,localStorage.setItem("settings",JSON.stringify(r)),n&&p.BEATMAP_FILE.audioNode.play()}if(["showGreenLine"].includes(i.name)){const n=JSON.parse(localStorage.getItem("settings"));n.mapping[i.name]=p.MAPPING[i.name],localStorage.setItem("settings",JSON.stringify(n)),Y.SHOW_GREENLINE=p.MAPPING[i.name];return}if(!p.BEATMAP_FILE)return;const s=p.BEATMAP_FILE.audioNode.isPlaying;p.BEATMAP_FILE.audioNode.isPlaying&&p.BEATMAP_FILE.audioNode.pause(),p.PLAYBACK_RATE=1*t*e,B.updateModdedStats(),p.BEATMAP_FILE.beatmapRenderData.applyStacking(),s&&p.BEATMAP_FILE.audioNode.play(),Or([p.MODS.HR,p.MODS.EZ,p.MODS.DT||p.MODS.NC,p.MODS.HT||p.MODS.DC])}[...document.querySelectorAll("input[type=checkbox]")].forEach(i=>{i.onclick=()=>VA(i)});function zA(){const i=document.querySelector("#skinDropdown");if(!i.open){i.show(),i.style.display="flex";return}i.close(),i.style.display=""}document.querySelector(".skinSelector").onclick=zA;function $A(){const i=document.querySelector("#rendererDropdown");if(!i.open){i.show(),i.style.display="flex";return}i.close(),i.style.display=""}document.querySelector(".rendererSelector").onclick=$A;document.body.addEventListener("click",i=>{const t=document.querySelector("#skinDropdown").getBoundingClientRect(),e=document.querySelector(".seekTo").getBoundingClientRect(),s=document.querySelector("#rendererDropdown").getBoundingClientRect();(i.clientX<t.left||i.clientX>t.right||i.clientY<t.top||i.clientY>t.bottom)&&document.querySelector("#skinDropdown").open&&i.target!==document.querySelector(".skinSelector")&&(document.querySelector("#skinDropdown").close(),document.querySelector("#skinDropdown").style.display=""),(i.clientX<s.left||i.clientX>s.right||i.clientY<s.top||i.clientY>s.bottom)&&document.querySelector("#rendererDropdown").open&&i.target!==document.querySelector(".rendererSelector")&&(document.querySelector("#rendererDropdown").close(),document.querySelector("#rendererDropdown").style.display=""),(i.clientX<e.left||i.clientX>e.right||i.clientY<e.top||i.clientY>e.bottom)&&document.querySelector(".seekTo").open&&i.target!==document.querySelector(".contentWrapper")&&i.target!==document.querySelector(".contentWrapper canvas")&&Jr()});[...document.querySelectorAll(".skinName")].forEach(i=>{i.onclick=Rf});function YA(){const i=JSON.parse(localStorage.getItem("settings"));i.renderer.val=this.parentElement.dataset.renderer,localStorage.setItem("settings",JSON.stringify(i)),document.querySelector(".rendererSelector").textContent=this.textContent,location.reload()}[...document.querySelectorAll(".renderer")].forEach(i=>{i.onclick=YA});const oe=new URLSearchParams(window.location.search);class XA{constructor(t){S(this,"baseSlider");S(this,"endPosition");S(this,"hitCircle");S(this,"props",{alpha:null,x:null,y:null});const e=t.realTrackPoints.at(-1);this.hitCircle=new Pe(e.x,e.y,t.endTime,null),this.hitCircle.number.obj.alpha=0,this.baseSlider=t,this.endPosition=e}updatePosition(){const t=this.baseSlider.stackHeight,e=B.moddedStats.stackOffset,s=this.endPosition.x+t*e,n=p.MODS.HR?384-this.endPosition.y+t*e:this.endPosition.y+t*e;this.props.x!==s&&(this.props.x=s,this.hitCircle.obj.x=this.props.x*p.SCALE_RATE),this.props.y!==n&&(this.props.y=n,this.hitCircle.obj.y=this.props.y*p.SCALE_RATE)}getAlpha(t){const e=B.moddedStats.preempt,s=B.moddedStats.fadeIn,n=this.baseSlider.time-e+e/3;if(t<this.baseSlider.endTime&&!p.SLIDER_APPEARANCE.snaking)return this.baseSlider.opacity;if(t<n)return 0;if(t>=n&&t<n+s)return(t-n)/s*.9;if(t>n+s&&p.MODS.HD)return this.baseSlider.opacity*.9;if(t>=n+s&&t<this.baseSlider.endTime)return .9}draw(t){if(!p.SLIDER_APPEARANCE.sliderend||at.SKIN_ENUM[p.SKINNING.type]==="ARGON"){this.props.alpha!==0&&(this.props.alpha=0,this.hitCircle.obj.alpha=0);return}this.hitCircle.colourHaxedIdx=this.baseSlider.colourHaxedIdx,this.hitCircle.colourIdx=this.baseSlider.colourIdx,this.hitCircle.draw(t),this.hitCircle.number.obj.alpha=0,this.updatePosition();const e=this.getAlpha(t);e!==void 0&&(this.props.alpha!==e||this.hitCircle.props.alpha!==e)&&(this.props.alpha=e,this.hitCircle.hitCircleContainer.alpha=e)}}const qA=`precision mediump float;\r
attribute vec4 aPosition;\r
attribute float isCirc;\r
\r
out float dist;\r
\r
uniform float dx, ox, dy, oy;\r
uniform float inverse;\r
uniform vec2 ballPosition;\r
uniform float startt;\r
uniform float endt;\r
\r
void main() {\r
    dist = aPosition[3];\r
\r
    float distance_var = 0.0;\r
    if (aPosition[2] < startt || aPosition[2] > endt) distance_var = 1.0;\r
\r
    float x = aPosition[0];\r
    float y = aPosition[1];\r
\r
    if (isCirc == 1.0) {\r
        x += ballPosition[0];\r
        y += ballPosition[1];\r
    }\r
\r
    y = inverse == 0.0 ? y : 384.0 - y;\r
\r
    if (isCirc == 1.0) {\r
        gl_Position = vec4(x, y, aPosition[3], 1.0);\r
    } else {\r
        gl_Position = vec4(x, y, aPosition[3] + 2.0 * distance_var, 1.0);\r
    }\r
    gl_Position.x = -1.0 + x * dx + ox;\r
    gl_Position.y = (y * dy + 1.0) + oy;\r
}`,KA=`in float dist;\r
\r
out vec4 finalColor;\r
\r
uniform float circleBaseScale;\r
\r
uniform float alpha;\r
uniform float bodyAlpha;\r
uniform vec4 borderColor;\r
uniform vec4 innerColor;\r
uniform vec4 outerColor;\r
uniform float borderWidth;\r
\r
void main() {\r
    float position = dist / circleBaseScale;\r
\r
    float a = 1.0;\r
    float innerWidth = 1.0 - borderWidth;\r
    float blurRate = 0.02;\r
\r
    // Set body color\r
    vec4 color = mix(innerColor, outerColor, position);\r
\r
    // Set border color\r
    if (position >= innerWidth + blurRate) {\r
        color = borderColor;\r
    }\r
\r
    // Set body alpha\r
    if (position < innerWidth) {\r
        a = bodyAlpha;\r
    }\r
\r
    // Anti-aliasing at outer edge\r
    if (1.0 - position < blurRate) {\r
        a = (1.0 - position) / blurRate; \r
    }\r
\r
    // Anti-aliasing at inner edge\r
    if (position >= innerWidth && position < innerWidth + blurRate) {\r
        float mu = (position - innerWidth) / blurRate;\r
        color = borderColor * mu + (1.0 - mu) * color;\r
\r
        // a = 1.0;\r
        // if (skinning != 0.0) a = 1.0 * mu + (1.0 - mu) * 0.7;\r
        a = 1.0 * mu + (1.0 - mu) * bodyAlpha;\r
    }\r
\r
    color.a = 1.0;\r
\r
    finalColor = vec4(color.rgb, 1.0) * a * alpha * (position > 1.0 ? 0.0 : 1.0);\r
    // finalColor = vec4(vec3(1.0 - position), 1.0) * (position > 1.0 ? 0.0 : 1.0);\r
}`,uh=`struct CustomUniforms {\r
    // Vertex Uniforms\r
    dx: f32,\r
    ox: f32,\r
    dy: f32,\r
    oy: f32,\r
    inverse: f32,\r
    startt: f32,\r
    endt: f32,\r
    stackOffset: f32,\r
    ballPosition: vec2<f32>,\r
    // Fragment Uniforms\r
    circleBaseScale: f32,\r
    alpha: f32,\r
    bodyAlpha: f32,\r
    borderColor: vec4<f32>,\r
    innerColor: vec4<f32>,\r
    outerColor: vec4<f32>,\r
    borderWidth: f32,\r
}\r
\r
struct VertexOutput {\r
    @builtin(position) position : vec4<f32>,\r
    @location(0) dist : f32,\r
}\r
\r
@group(0) @binding(0) var<uniform> customUniforms : CustomUniforms;\r
\r
@vertex\r
fn vsMain(\r
    @location(0) aPosition: vec4<f32>,\r
    @location(1) isCirc: f32,\r
) -> VertexOutput {\r
    var dist = aPosition[3];\r
\r
    var distance_var = 0.0;\r
    if (aPosition[2] < customUniforms.startt || aPosition[2] > customUniforms.endt) {\r
        distance_var = 1.0;\r
    }\r
\r
    var x: f32 = aPosition.x;\r
    var y: f32 = aPosition.y;\r
\r
    if (isCirc == 1.0) {\r
        x += customUniforms.ballPosition.x;\r
        y += customUniforms.ballPosition.y;\r
    }\r
\r
    if (customUniforms.inverse > 0) {\r
        y = 384.0 - y;\r
    }\r
\r
    var z: f32 = aPosition[3] + 2.0 * distance_var;\r
\r
    var offset_x = customUniforms.ox;\r
    var offset_y = customUniforms.oy;\r
\r
    if (isCirc == 1.0) {\r
        return VertexOutput(\r
            vec4<f32>(\r
                -1.0 + x * customUniforms.dx + offset_x,\r
                (y * customUniforms.dy + 1.0) + offset_y,\r
                aPosition[3],\r
                1.0\r
            ),\r
            dist\r
        );\r
    }\r
\r
    return VertexOutput(\r
        vec4<f32>(\r
            -1.0 + x * customUniforms.dx + offset_x,\r
            (y * customUniforms.dy + 1.0) + offset_y,\r
            z,\r
            1.0\r
        ),\r
        dist\r
    );\r
}\r
\r
@fragment\r
fn fsMain(\r
    input: VertexOutput\r
) -> @location(0) vec4<f32> {\r
    var position = input.dist / customUniforms.circleBaseScale;\r
\r
    var a = 1.0;\r
    var innerWidth = 1.0 - customUniforms.borderWidth;\r
    var blurRate = 0.02;\r
\r
    var color: vec4<f32> = mix(customUniforms.innerColor, customUniforms.outerColor, position);\r
\r
    if (position >= innerWidth + blurRate) {\r
        color = customUniforms.borderColor;\r
    }\r
\r
    if (position < innerWidth) {\r
        a = customUniforms.bodyAlpha;\r
    }\r
\r
    if (1.0 - position < blurRate) {\r
        a = (1.0 - position) / blurRate; \r
    }\r
\r
    if (position >= innerWidth && position < innerWidth + blurRate) {\r
        var mu: f32 = (position - innerWidth) / blurRate;\r
        color = customUniforms.borderColor * mu + (1.0 - mu) * color;\r
\r
        a = 1.0 * mu + (1.0 - mu) * customUniforms.bodyAlpha;\r
    }\r
\r
    color[3] = 1.0;\r
\r
    if (position > 1.0) {\r
        return vec4<f32>(0.0, 0.0, 0.0, 0.0);\r
    }\r
    \r
    return vec4<f32>(color[0], color[1], color[2], 1.0) * a * customUniforms.alpha;\r
    // return vec4<f32>(vec3<f32>(1.0 - position), 1.0);\r
}`,dh=`@vertex\r
fn vsMain(\r
    @location(0) aPosition: vec2f\r
) -> @builtin(position) vec4f {\r
    return vec4f(aPosition, 1.0, 1.0);\r
}\r
\r
@fragment\r
fn fsMain(\r
    @builtin(position) position: vec4f\r
) -> @location(0) vec4f {\r
    return vec4f(0, 0, 0, 1);\r
}`,ZA=`in vec2 aPosition;\r
\r
void main() {\r
    gl_Position = vec4(aPosition, 1.0, 1.0);\r
}`,JA=`out vec4 finalColor;\r
\r
void main() {\r
    finalColor = vec4(0.0, 0.0, 0.0, 0.0);\r
}`,QA={"point-list":0,"line-list":1,"line-strip":2,"triangle-list":3,"triangle-strip":4};function t1(i,t,e,s,n){return i<<24|t<<16|e<<10|s<<5|n}const e1=new xe({attributes:{aPosition:new Float32Array([-1,-1,-1,1,1,1,1,-1])},indexBuffer:new Uint16Array([0,1,2,0,2,3])}),i1=ni.from({vertex:ZA,fragment:JA}),s1=Le.from({vertex:{source:dh,entryPoint:"vsMain"},fragment:{source:dh,entryPoint:"fsMain"}}),n1=$e.from({gl:i1,gpu:s1}),r1={"-1":"always",0:"less",1:"equal"};class o1 extends dT{constructor(e){super({render:s=>{s.gpu&&this.webGPURender(s,e),s.gl&&this.webGLRender(s,e)}});S(this,"passCount",0)}createPipeline(e,s,n,r,o){const a=e.gpu.device,l=e.pipeline._createVertexBufferLayouts(s,n),c=e.state.getColorTargets(r);c[0].writeMask=e.pipeline._colorMask;const h=e.shader.getProgramData(n).pipeline,u={vertex:{module:e.pipeline._getModule(n.vertex.source),entryPoint:n.vertex.entryPoint,buffers:l},fragment:{module:e.pipeline._getModule(n.fragment.source),entryPoint:n.fragment.entryPoint,targets:c},primitive:{topology:o,cullMode:r.cullMode},layout:h,multisample:{count:e.pipeline._multisampleCount},label:"PIXI Pipeline"};return e.pipeline._depthStencilAttachment&&(u.depthStencil={...e.pipeline._stencilState,format:"depth24plus-stencil8",depthWriteEnabled:r.depthTest,depthCompare:r1[this.passCount]}),a.createRenderPipeline(u)}getPipeline(e,s,n,r){s._layoutKey||(hT(s,n.attributeData),e.pipeline._generateBufferKey(s));const o=s.topology,a=t1(s._layoutKey,n._layoutKey,r.data,r._blendModeId,QA[o]);return e.pipeline._pipeCache[a]||(e.pipeline._pipeCache[a]=this.createPipeline(e,s,n,r,o)),e.pipeline._pipeCache[a]}setPipeline(e,s,n,r){const o=this.getPipeline(e,s,n,r);e.encoder.setPipeline(o)}draw(e,s,n,r){e.renderTarget.renderTarget.depth=!0,this.setPipeline(e,s,n.gpuProgram,r),e.encoder.setGeometry(s,n.gpuProgram),e.encoder._setShaderBindGroups(n,void 0),e.encoder.renderPassEncoder.drawIndexed(s.indexBuffer.data.length,s.instanceCount,0)}drawGPUSlider(e,s,n){const r=s.transform.ox,o=s.transform.oy;s.shader.resources.customUniforms.uniforms.ox=r,s.shader.resources.customUniforms.uniforms.oy=o,this.draw(e,s.geometry,s.shader,n)}drawGPUCircle(e,s,n){this.draw(e,s.circleGeometry,s.shader,n)}webGPURender(e,s){const n=pr.for2d();n.depthTest=!0;const r=s.transform.ox,o=s.transform.oy;this.passCount=-1,e.pipeline.setColorMask(0),this.draw(e,e1,n1,n),this.passCount=0,e.pipeline.setColorMask(0),s.shader.resources.customUniforms.uniforms.startt=s.startt,s.shader.resources.customUniforms.uniforms.endt=s.endt,this.drawGPUSlider(e,s,n),s.startt===0&&s.endt===1||this.drawGPUCircle(e,s,n),this.passCount=1,e.pipeline.setColorMask(15),this.drawGPUSlider(e,s,n),s.startt===0&&s.endt===1||this.drawGPUCircle(e,s,n),n.depthTest=!1,s.shader.resources.customUniforms.uniforms.ox=r,s.shader.resources.customUniforms.uniforms.oy=o}webGLRender(e,s){const n=pr.for2d(),r=4,o=e.gl;o.clearDepth(1),o.clear(o.DEPTH_BUFFER_BIT),o.colorMask(!1,!1,!1,!1),e.state.set(n),e.state.setDepthTest(!0);let a,l;const c=s.transform.ox,h=s.transform.oy;function u(m,y){e.shader.bind(y),e.geometry.bind(m,y.glProgram),a=m.indexBuffer.data.BYTES_PER_ELEMENT===2?o.UNSIGNED_SHORT:o.UNSIGNED_INT,l=m.indexBuffer.data.length}function d(){u(s.circleGeometry,s.shader),o.drawElements(r,l,a,0)}function f(){s.shader.resources.customUniforms.uniforms.ox=c,s.shader.resources.customUniforms.uniforms.oy=h,u(s.geometry,s.shader),o.drawElements(r,l,a,0)}s.shader.resources.customUniforms.uniforms.startt=s.startt,s.shader.resources.customUniforms.uniforms.endt=s.endt,s.startt===0&&s.endt===1||d(),f(),o.depthFunc(o.EQUAL),o.colorMask(!0,!0,!0,!0),s.startt===0&&s.endt===1||d(),f(),o.depthFunc(o.LESS),e.state.setDepthTest(!1),s.shader.resources.customUniforms.uniforms.ox=c,s.shader.resources.customUniforms.uniforms.oy=h}}const Kn=64,Ce=class Ce{constructor(t,e,s,n,r){S(this,"container");S(this,"filter");S(this,"bodyMesh");S(this,"circleMesh");S(this,"shader");S(this,"angleList");S(this,"slider");S(this,"startt",0);S(this,"endt",1);S(this,"scaleRate",1);S(this,"transform",{ox:0,oy:0,dx:0,dy:0});S(this,"ballPosition",{x:0,y:0});this.angleList=t,this.isSelected=r,this.slider=n;const o=ni.from({vertex:qA,fragment:KA}),a=Le.from({vertex:{source:uh,entryPoint:"vsMain"},fragment:{source:uh,entryPoint:"fsMain"}});a.autoAssignGlobalUniforms=!0,a.autoAssignLocalUniforms=!0,this.shader=$e.from({gl:o,gpu:a,resources:{customUniforms:{dx:{value:0,type:"f32"},ox:{value:0,type:"f32"},dy:{value:0,type:"f32"},oy:{value:0,type:"f32"},inverse:{value:0,type:"f32"},startt:{value:0,type:"f32"},endt:{value:0,type:"f32"},stackOffset:{value:0,type:"f32"},ballPosition:{value:[0,0],type:"vec2<f32>"},circleBaseScale:{value:1,type:"f32"},alpha:{value:1,type:"f32"},bodyAlpha:{value:1,type:"f32"},borderColor:{value:[1,1,1,1],type:"vec4<f32>"},innerColor:{value:[0,0,0,0],type:"vec4<f32>"},outerColor:{value:[0,0,0,0],type:"vec4<f32>"},borderWidth:{value:.128,type:"f32"}}}}),this.geometry=e,this.circleGeometry=s,this.container=new o1(this),this.tint=[0,0,0,1]}update(){const t=parseInt(p.SKINNING.type),e=this.isSelected,s=at.SLIDER_TRACK_OVERRIDE,n=this.tint,r=t===0||t===1||e?n:t===2||t===3?[1,1,1,1]:at.SLIDER_BORDER??[1,1,1,1],o=t===0||t===1?n:s??this.tint,a=B.moddedStats.radius/54.4*(t!==0||e?1:.95),l=e?0:t!==0?.7:1,c=t===0?.128*1.65:.115;let h,u;switch(t){case 0:{u=Ce.darken(o,4),h=Ce.darken(o,4);break}case 1:{u=Ce.darken(o,2),h=Ce.darken(o,.5);break}case 3:{u=Ce.lighten(o,.1),h=Ce.darken(o,.5);break}default:{u=Ce.darken(o,.1),h=Ce.lighten(o,.5);break}}const d=B.moddedStats.stackOffset,f=2*(p.WIDTH/512)/p.APP.renderer.width,m=-2*p.HEIGHT/p.APP.renderer.height/384,y=this.slider.stackHeight*d*f,g=this.slider.stackHeight*d*m,E={dx:f,ox:2*(p.MASTER_CONTAINER.x+p.OFFSET_X)/p.APP.renderer.width+y,dy:m,oy:-2*(p.MASTER_CONTAINER.y+p.OFFSET_Y+p.WRAPPER.y)/p.APP.renderer.height+g};this.transform=E,this.shader.resources.customUniforms.uniforms.dx=E.dx,this.shader.resources.customUniforms.uniforms.ox=E.ox,this.shader.resources.customUniforms.uniforms.dy=E.dy,this.shader.resources.customUniforms.uniforms.oy=E.oy,this.shader.resources.customUniforms.uniforms.inverse=p.MODS.HR?1:0,this.shader.resources.customUniforms.uniforms.stackOffset=this.slider.stackHeight*d;const T=Ce.getPointAtT(this.angleList,this.startt,this.endt);this.ballPosition=T,this.shader.resources.customUniforms.uniforms.ballPosition=[T.x,T.y],this.shader.resources.customUniforms.uniforms.circleBaseScale=a,this.shader.resources.customUniforms.uniforms.bodyAlpha=l,this.shader.resources.customUniforms.uniforms.borderColor=r,this.shader.resources.customUniforms.uniforms.innerColor=h,this.shader.resources.customUniforms.uniforms.outerColor=u,this.shader.resources.customUniforms.uniforms.borderWidth=c}get alpha(){}set alpha(t){this.shader.resources.customUniforms.uniforms.alpha=t}static curveGeometry(t,e){const s=new Array;for(let l=0;l<t.length;++l)(l==0||Math.abs(t[l].x-t[l-1].x)>1e-5||Math.abs(t[l].y-t[l-1].y)>1e-5)&&s.push(t[l]);let n=new Array,r=new Array;const o=new Array;n.push(s[0].x,s[0].y,s[0].t,0),o.push({x:s[0].x,y:s[0].y,z:s[0].t,t:0});for(let l=1;l<s.length;++l){let c=s[l].x,h=s[l].y,u=s[l].t,d=s[l-1].x,f=s[l-1].y,m=s[l-1].t,y=c-d,g=h-f,E=Math.hypot(y,g),T=e*-g/E,_=e*y/E;n.push(d+T,f+_,m,1),n.push(d-T,f-_,m,1),n.push(c+T,h+_,u,1),n.push(c-T,h-_,u,1),n.push(c,h,u,0),o.push({x:d+T,y:f+_,z:m,t:1}),o.push({x:d-T,y:f-_,z:m,t:1}),o.push({x:c+T,y:h+_,z:u,t:1}),o.push({x:c-T,y:h-_,z:u,t:1}),o.push({x:c,y:h,z:u,t:0});let b=5*l+1;r.push(b-6,b-5,b-1,b-5,b-1,b-3),r.push(b-6,b-4,b-1,b-4,b-1,b-2)}function a(l,c,h,u){let d=Math.atan2(n[4*c+1]-n[4*l+1],n[4*c]-n[4*l]),f=Math.atan2(n[4*h+1]-n[4*l+1],n[4*h]-n[4*l]);d>f&&(f+=2*Math.PI);let m=f-d,y=Math.ceil(Kn*Math.abs(m)/(2*Math.PI));m/=y;let g=c;for(let E=1;E<y;++E){n.push(n[4*l]+e*Math.cos(d+E*m),n[4*l+1]+e*Math.sin(d+E*m),u,1),o.push({x:n[4*l]+e*Math.cos(d+E*m),y:n[4*l+1]+e*Math.sin(d+E*m),z:u,t:1});let T=n.length/4-1;r.push(l,g,T),g=T}r.push(l,g,h)}for(let l=1;l<s.length-1;++l){let c=s[l].x-s[l-1].x,h=s[l].y-s[l-1].y,u=s[l+1].x-s[l].x,d=s[l+1].y-s[l].y;c*d-u*h>0?a(5*l,5*l-1,5*l+2,s[l].t):a(5*l,5*l+1,5*l-2,s[l].t)}return a(0,1,2,s[0].t),a(5*s.length-5,5*s.length-6,5*s.length-7,s.at(-1).t),new xe({attributes:{aPosition:new Float32Array(n),isCirc:new Float32Array(new Array(n.length/4).fill(0))},indexBuffer:r})}static circleGeometry(t){let e=new Array,s=new Array;e.push(0,0,0,0);for(let n=0;n<Kn;++n){let r=2*Math.PI/Kn*n;e.push(t*Math.cos(r),t*Math.sin(r),0,1),s.push(0,n+1,(n+1)%Kn+1)}return new xe({attributes:{aPosition:new Float32Array(e),isCirc:new Float32Array(new Array(e.length/4).fill(1))},indexBuffer:s})}static getPointAtT(t,e,s){let n=0;if(e==0&&s==1?n=e:e==0?n=s:s==1&&(n=e),isNaN(n)&&(n=0),n<=0)return t.at(0);if(n>=1)return t.at(-1);const r=Math.floor(n*(t.length-1)),o=Math.ceil(n*(t.length-1)),l=(n*(t.length-1)-r)/(o-r),c=t[r].x+l*(t[o].x-t[r].x),h=t[r].y+l*(t[o].y-t[r].y),u=l>=.5?t[o].angle:t[r].angle;return{x:c,y:h,t:n,angle:u}}static lighten(t,e){e*=.5;const s=[];return s[0]=Math.min(1,t[0]*(1+.5*e)+1*e),s[1]=Math.min(1,t[1]*(1+.5*e)+1*e),s[2]=Math.min(1,t[2]*(1+.5*e)+1*e),s}static darken(t,e){const s=Math.max(1,1+e),n=[];return n[0]=Math.min(1,t[0]/s),n[1]=Math.min(1,t[1]/s),n[2]=Math.min(1,t[2]/s),n}};S(Ce,"RADIUS",54.4*(236/256));let _i=Ce;class a1{constructor(t,e){S(this,"curve");S(this,"geometry");S(this,"sliderContainer");S(this,"selSliderContainer");this.curve=t,this.geometry=_i.curveGeometry(this.curve,_i.RADIUS),this.circle=_i.circleGeometry(_i.RADIUS),this.sliderContainer=new _i(this.curve,this.geometry,this.circle,e,!1),this.selSliderContainer=new _i(this.curve,this.geometry,this.circle,e,!0)}}const l1=`in vec2 aPosition;\r
in vec2 aUV;\r
\r
out vec2 vUV;\r
\r
uniform mat3 uProjectionMatrix;\r
uniform mat3 uWorldTransformMatrix;\r
\r
uniform mat3 uTransformMatrix;\r
\r
void main() {\r
    mat3 mvp = uProjectionMatrix * uWorldTransformMatrix * uTransformMatrix;\r
    gl_Position = vec4((mvp * vec3(aPosition, 1.0)).xy, 0.0, 1.0);\r
\r
    vUV = aUV;\r
}`,c1=`in vec2 vUV;\r
uniform float t;\r
uniform float a;\r
uniform vec4 color;\r
\r
vec4 getColor(float x) {\r
    x = mod(x - t, 1.0) * 4.0;\r
\r
    float blurRate = 0.02;\r
\r
    if (mod(x, 1.0) >= 0.0 && mod(x, 1.0) < blurRate) {\r
        if (mod(floor(x), 2.0) == 0.0)\r
            return vec4(color.rgb * (mod(x, 1.0) / blurRate), 1.0);\r
        \r
        return vec4(color.rgb * (1.0 - mod(x, 1.0) / blurRate), 1.0);\r
    }\r
\r
    if (mod(floor(x), 2.0) == 0.0) {\r
        return color;\r
    }\r
\r
    return vec4(0.0, 0.0, 0.0, 1.0);\r
}\r
\r
void main() {\r
    float x = (vUV.x - 0.5) * 2.0;\r
    float y = (vUV.y - 0.5) * 2.0;\r
    float dist = sqrt(x * x + y * y);\r
    float blurRate = 0.02;\r
\r
    if (dist >= 1.0) {\r
        gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);\r
        return;\r
    }\r
\r
    float max_x = sqrt(1.0 - y * y) * 0.8 + 0.2;\r
    float virt_x = max_x == 0.0 ? 0.0 : x / max_x; \r
    float dest_x = asin(virt_x) / (3.14159265358 / 2.0);\r
    vec4 fcolor = getColor(dest_x / 2.0 + 0.5);\r
\r
    if (dist < 1.0 && dist >= 1.0 - blurRate) {\r
        float diff = 1.0 - dist;\r
        gl_FragColor = fcolor * (diff / blurRate) * a;\r
        return;\r
    }\r
\r
    gl_FragColor = fcolor * a;\r
}`,fh=`struct GlobalUniforms {\r
    projectionMatrix : mat3x3<f32>,\r
    worldTransformMatrix : mat3x3<f32>,\r
    worldColorAlpha : vec4<f32>,\r
    uResolution : vec2<f32>,\r
}\r
\r
struct LocalUniforms {\r
    uTransformMatrix : mat3x3<f32>,\r
    uColor : vec4<f32>,\r
    uRound : f32,\r
}\r
\r
struct CustomUniforms {\r
    t: f32,\r
    a: f32,\r
    color: vec4<f32>\r
}\r
\r
struct VertexOutput {\r
    @builtin(position) position: vec4<f32>,\r
    @location(0) vUV: vec2<f32>\r
}\r
\r
@group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;\r
@group(1) @binding(0) var<uniform> localUniforms : LocalUniforms;\r
@group(2) @binding(0) var<uniform> customUniforms : CustomUniforms;\r
\r
fn modulo(x: f32, y: f32) -> f32 {\r
    return x % y;\r
}\r
\r
@vertex\r
fn vsMain(\r
    @location(0) aPosition: vec2<f32>,\r
    @location(1) aUV: vec2<f32>\r
) -> VertexOutput {\r
    var mvp = globalUniforms.projectionMatrix * globalUniforms.worldTransformMatrix * localUniforms.uTransformMatrix;\r
    return VertexOutput(\r
        vec4<f32>(mvp * vec3<f32>(aPosition, 1.0), 1.0),\r
        aUV\r
    );\r
}\r
\r
fn getColor(x: f32) -> vec4<f32> {\r
    var x_ = modulo(x - customUniforms.t, 1.0) * 4.0;\r
\r
    var blurRate = 0.02;\r
\r
    if (modulo(x_, 1.0) >= 0.0 && modulo(x_, 1.0) < blurRate) {\r
        if (modulo(floor(x_), 2.0) == 0.0) {\r
            return vec4<f32>(customUniforms.color.rgb * (modulo(x_, 1.0) / blurRate), 1.0);\r
        }\r
        \r
        return vec4<f32>(customUniforms.color.rgb * (1.0 - modulo(x_, 1.0) / blurRate), 1.0);\r
    }\r
\r
    if (modulo(floor(x_), 2.0) == 0.0) {\r
        return customUniforms.color;\r
    }\r
\r
    return vec4<f32>(0.0, 0.0, 0.0, 1.0);\r
}\r
\r
@fragment\r
fn fsMain(\r
    input : VertexOutput\r
) -> @location(0) vec4<f32> {\r
    var x = (input.vUV.x - 0.5) * 2.0;\r
    var y = (input.vUV.y - 0.5) * 2.0;\r
    var dist = sqrt(x * x + y * y);\r
    var blurRate = 0.02;\r
\r
    if (dist >= 1.0) {\r
        return vec4<f32>(0.0, 0.0, 0.0, 0.0);\r
    }\r
\r
    var max_x = sqrt(1.0 - y * y) * 0.8 + 0.2;\r
\r
    var virt_x = 0.0; \r
    if (max_x != 0.0) {\r
        virt_x = x / max_x;\r
    }\r
\r
    var dest_x = asin(virt_x) / (3.14159265358 / 2.0);\r
    var fcolor = getColor(dest_x / 2.0 + 0.5);\r
\r
    if (dist < 1.0 && dist >= 1.0 - blurRate) {\r
        var diff = 1.0 - dist;\r
        return fcolor * (diff / blurRate) * customUniforms.a;\r
    }\r
\r
    return fcolor * customUniforms.a;\r
}`;class h1{constructor(t){S(this,"baseSlider");S(this,"obj");S(this,"arrow");S(this,"ring");S(this,"bg");S(this,"followCircle");S(this,"sliderB");this.baseSlider=t,this.obj=new ut;const e=new Mt(st.ARGON.SLIDER_FOLLOW_CIRCLE.texture),s=new Mt(st.ARGON.SLIDER_B.arrow.texture),n=new Mt(st.ARGON.SLIDER_B.ring.texture),r=new ft().circle(0,0,59).fill(16777215),o=new Mt(st.ARGON.SLIDER_B.gradient.texture);o.mask=r;const a=new xe({attributes:{aPosition:new Float32Array([-59,-59,59,-59,-59,59,-59,59,59,-59,59,59]),aUV:new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1])}}),l=$e.from({gl:{vertex:l1,fragment:c1},gpu:{vertex:{source:fh,entryPoint:"vsMain"},fragment:{source:fh,entryPoint:"fsMain"}},resources:{customUniforms:{t:{value:0,type:"f32"},a:{value:0,type:"f32"},color:{value:[1,1,1,1],type:"vec4<f32>"}}}}),c=new Oi({geometry:a,shader:l}),h=new Mt({texture:st.BALL_SPEC.texture,blendMode:"add"}),u=new Mt({texture:st.BALL_ND.texture,blendMode:"multiply"});h.anchor.set(.5),u.anchor.set(.5);const d=new ut;d.addChild(c),d.addChild(u),d.addChild(h),e.anchor.set(.5),s.anchor.set(.5),n.anchor.set(.5),o.anchor.set(.5),n.scale.set(st.ARGON.SLIDER_B.ring.isHD?.5:1);const f=new ut;f.addChild(r),f.addChild(o),f.addChild(s),f.addChild(n),f.addChild(d),this.obj.addChild(e),this.obj.addChild(f),this.arrow=s,this.ring=n,this.bg=o,this.followCircle=e,this.sliderB=f,this.shader=l,this.defaultContainer=d,this.defaultB=c}draw(t){const e=at.SKIN_ENUM[p.SKINNING.type],s=e!=="CUSTOM"?st[e]:st.CUSTOM[at.SKIN_IDX],n=B.moddedStats.radius/54.4*(e==="ARGON"?.95:1),r=s.SLIDER_FOLLOW_CIRCLE.isHD?.25:.5;if(this.followCircle.texture=s.SLIDER_FOLLOW_CIRCLE.texture,this.arrow.texture=s.SLIDER_B.arrow.texture,this.ring.texture=s.SLIDER_B.ring.texture,this.bg.texture=s.SLIDER_B.gradient.texture,this.followCircle.scale.set(r),this.ring.scale.set(s.SLIDER_B.ring.isHD?.5:1),this.obj.alpha=1,this.sliderB.alpha=1,this.shader.resources.customUniforms.uniforms.a=1,this.followCircle.alpha=1,this.followCircle.scale.set(2.4*r),(t<this.baseSlider.time||t>=this.baseSlider.endTime+200)&&(this.obj.alpha=0),t>=this.baseSlider.time&&t<this.baseSlider.time+300){const m=ot((t-this.baseSlider.time)/Math.min(200,this.baseSlider.sliderTime),0,1),y=ot((t-this.baseSlider.time)/Math.min(180,this.baseSlider.sliderTime),0,1);this.sliderB.alpha=bi(m),this.shader.resources.customUniforms.uniforms.a=bi(m),this.followCircle.alpha=bi(y),this.followCircle.scale.set((1.5+ji(y)*.9)*r)}this.arrow.scale.set(.7,.8);let o=this.baseSlider.getPointAtTime(t)??this.baseSlider.realTrackPoints.at(-1);t<this.baseSlider.time&&(o=this.baseSlider.realTrackPoints.at(0)),this.arrow.angle=p.MODS.HR?-o.angle:o.angle,this.defaultB.angle=p.MODS.HR?-o.angle:o.angle;const a=B.moddedStats.stackOffset;let{x:l,y:c}=o;p.MODS.HR&&(c=384-c),this.obj.scale.set(n*p.SCALE_RATE*(236/256)**2),this.obj.x=(l+this.baseSlider.stackHeight*a)*(p.WIDTH/512),this.obj.y=(c+this.baseSlider.stackHeight*a)*(p.WIDTH/512);const h=p.SLIDER_APPEARANCE.ignoreSkin?at.DEFAULT_COLORS:B.COLORS,u=p.SLIDER_APPEARANCE.ignoreSkin?this.baseSlider.colourIdx:this.baseSlider.colourHaxedIdx;if(this.bg.tint=h[u%h.length],this.bg.angle=-this.obj.angle,this.ring.visible=!0,this.defaultContainer.visible=!1,this.followCircle.tint=16777215,e==="ARGON"&&(this.followCircle.tint=h[u%h.length]),e==="LEGACY"&&(this.ring.visible=!1,this.defaultContainer.visible=!0),t>this.baseSlider.endTime){const m=ot((t-this.baseSlider.endTime)/100,0,1);this.sliderB.alpha=1-bi(m),this.shader.resources.customUniforms.uniforms.a=1-bi(m);const y=ot((t-this.baseSlider.endTime)/100,0,1);this.followCircle.alpha=1-bi(y),this.followCircle.scale.set((1+ji(1-y)*1.4)*r)}const d=.15/this.baseSlider.velocity*(100/6),f=Math.min(t-this.baseSlider.time,this.baseSlider.endTime-this.baseSlider.time)%d/d;this.shader.resources.customUniforms.uniforms.t=f,this.shader.resources.customUniforms.uniforms.color=[((h[u%h.length]&16711680)>>16)/255,((h[u%h.length]&65280)>>8)/255,(h[u%h.length]&255)/255,1]}}class u1{constructor(t,e,s,n,r,o){S(this,"baseSlider");S(this,"time");S(this,"willHit",!1);S(this,"idx");S(this,"position");S(this,"angle");S(this,"stackHeight");S(this,"obj");S(this,"ringSprite");S(this,"arrowSprite");S(this,"baseUnit",200/2);S(this,"hitCircle");this.baseSlider=t,this.time=e,this.position=s,this.angle=n,this.stackHeight=r,this.idx=o;const a=new Mt(st.ARGON.REVERSE_ARROW.arrow.texture);a.anchor.set(.5),this.arrowSprite=a;const l=new Mt(st.ARGON.REVERSE_ARROW.ring.texture);l.anchor.set(.5),l.scale.set(.5*(229/200)),this.ringSprite=l,this.hitCircle=new Pe(0,0,this.time,null),this.obj=new ut,this.obj.addChild(this.hitCircle.obj),this.obj.addChild(l),this.obj.addChild(a)}calculatePulseAtTime(t){const e=t%300;let s=0;return e<=35&&(s=e/35),e>35&&e<285&&(s=1-(e-35)/250),s}playHitsound(t,e){var n;if(!p.BEATMAP_FILE.audioNode.isPlaying||!t||!e||t<this.time||e>=this.time)return;if(!nt.REPLAY_DATA){this.baseSlider.hitSounds.sliderReverse[this.idx].play();return}const s=Qi(nt.EVAL_LIST,this.baseSlider.time,(r,o)=>r.time<o?-1:r.time>o?1:0);((n=nt.EVAL_LIST[s])==null?void 0:n.checkPointState.filter(r=>r.type==="Slider Repeat")[this.idx].eval)===1&&this.baseSlider.hitSounds.sliderReverse[this.idx].play()}draw(t){this.hitCircle.colourHaxedIdx=this.baseSlider.colourHaxedIdx,this.hitCircle.colourIdx=this.baseSlider.colourIdx,this.hitCircle.draw(t),this.hitCircle.number.obj.alpha=0,this.hitCircle.hitCircleContainer.alpha=p.SLIDER_APPEARANCE.sliderend&&p.SKINNING.type!=="0"?.9:0;const e=at.SKIN_ENUM[p.SKINNING.type],s=e!=="CUSTOM"?st[e]:st.CUSTOM[at.SKIN_IDX];this.ringSprite.texture=s.REVERSE_ARROW.ring.texture,this.arrowSprite.texture=s.REVERSE_ARROW.arrow.texture;const n=B.moddedStats.stackOffset,r=B.moddedStats.radius/54.4,o=p.MODS.HR?384-this.position.y:this.position.y;this.obj.x=(this.position.x+this.baseSlider.stackHeight*n)*(p.WIDTH/512),this.obj.y=(o+this.baseSlider.stackHeight*n)*(p.WIDTH/512),this.obj.rotation=p.MODS.HR?Math.PI*2-this.angle:this.angle,this.hitCircle.obj.rotation=p.MODS.HR?-(Math.PI*2-this.angle):-this.angle,this.hitCircle.obj.x=0,this.hitCircle.obj.y=0;let a=this.calculatePulseAtTime(t);const l=r*p.SCALE_RATE*(s.REVERSE_ARROW.arrow.isHD?.5:1)*(236/256)**2*(e==="ARGON"?.95:1);if(this.arrowSprite.scale.set(l*(1+ji(a)*.2)),this.ringSprite.scale.set(229/200*l),this.ringSprite.x=ji(a)*-6*p.SCALE_RATE,this.obj.scale.set(1),this.obj.alpha=0,this.idx===0&&t<this.baseSlider.time){this.obj.alpha=ot((this.baseSlider.opacity-.5)*2,0,1);return}t>this.baseSlider.time&&p.MODS.HD&&(this.hitCircle.hitCircleContainer.alpha=p.SLIDER_APPEARANCE.sliderend&&p.SKINNING.type!=="0"?this.baseSlider.opacity*.9:0);const c=Math.min(300,this.baseSlider.sliderTime);if(this.idx!==0){if(t<this.time-this.baseSlider.sliderTime*2)return;if(t>=this.time-this.baseSlider.sliderTime*2&&t<this.time-this.baseSlider.sliderTime*2+c){this.obj.alpha=(t-(this.time-this.baseSlider.sliderTime*2))/c;return}}if(t<this.time){this.obj.alpha=1;return}if(p.MODS.HD){this.obj.alpha=1,t>this.time&&(this.obj.alpha=0);return}const h=this.baseSlider.endTime-this.baseSlider.time,u=Math.min(300,h);this.arrowSprite.scale.set(l),this.ringSprite.x=0;const d=(t-this.time)/u;this.obj.scale.set(ot(ji(d),0,1)*.5+1),this.obj.alpha=ot(1-ji(d),0,1),t>this.time+u&&(this.obj.alpha=0)}}class d1{constructor(t,e,s){S(this,"hitTime",-1);S(this,"info");S(this,"spanIdx");S(this,"obj");S(this,"graphic");S(this,"slider");S(this,"scale");S(this,"hitSound");this.info=t,this.slider=e,this.obj=new ut,this.graphic=new ft().setStrokeStyle({width:3,color:16777215,alpha:1,cap:"round",alignment:1}).circle(0,0,4).stroke(),this.obj.addChild(this.graphic),this.scale=B.moddedStats.radius/54.4,this.spanIdx=s,this.getHitSound()}getHitSound(){let t=vs(B.timingPointsList,this.info.time,(a,l)=>a.time<l?-1:a.time>l?1:0);for(;B.timingPointsList[t].time>this.info.time&&t>0;)t--;const{sampleIdx:e,sampleSet:s,sampleVol:n}=B.timingPointsList[t],r=this.slider.hitSounds.defaultSet.normal;let o=ue.HIT_SAMPLES[B.SAMPLE_SET];s!==0&&(o=ue.HIT_SAMPLES[s]),r!==0&&(o=ue.HIT_SAMPLES[r]),this.hitSound=new jt([`${o}-slidertick${e}`],n/100)}playHitsound(t,e){var n;if(!this.hitSound||!p.BEATMAP_FILE.audioNode.isPlaying||!t||!e||t<this.info.time||e>=this.info.time)return;if(!nt.REPLAY_DATA){this.hitSound.play();return}const s=Qi(nt.EVAL_LIST,this.slider.time,(r,o)=>r.time<o?-1:r.time>o?1:0);((n=nt.EVAL_LIST[s])==null?void 0:n.checkPointState.filter(r=>r.type==="Slider Tick")[this.spanIdx].eval)===1&&this.hitSound.play()}draw(t){const e=at.SKIN_ENUM[p.SKINNING.type],s=this.slider.time-B.moddedStats.preempt/2+this.spanIdx*(B.moddedStats.preempt/2/this.slider.sliderParts.filter(c=>c.type==="Slider Tick").length);let n=600;this.info.time-s<n&&(n=this.info.time-s);const r=B.moddedStats.stackOffset,o=B.moddedStats.radius/54.4;let{x:a,y:l}=this.info;if(p.MODS.HR&&(l=384-l),this.obj.x=(a+this.slider.stackHeight*r)*p.SCALE_RATE,this.obj.y=(l+this.slider.stackHeight*r)*p.SCALE_RATE,this.graphic.tint=16777215,e!=="LEGACY"&&e!=="CUSTOM"){const c=p.SLIDER_APPEARANCE.ignoreSkin?at.DEFAULT_COLORS:B.COLORS,h=p.SLIDER_APPEARANCE.ignoreSkin?this.slider.colourIdx:this.slider.colourHaxedIdx,u=c[h%c.length];this.graphic.tint=u}if(t<s){this.obj.alpha=0;return}if(t>=s&&t<s+n){const c=ot((t-s)/150,0,1);this.obj.alpha=c;const h=ot((t-s)/n,0,1),u=Q1(h);this.obj.scale.set(o*p.SCALE_RATE*(.5+u*.5));return}this.obj.alpha=1,this.obj.scale.set(o*p.SCALE_RATE),t>this.info.time&&(this.obj.alpha=0)}}class Gt{constructor(t,e,s){S(this,"x");S(this,"y");S(this,"z");S(this,"angle");this.x=t,this.y=e,this.z=s}static dist(t,e){const s=e.x-t.x,n=e.y-t.y;return Math.hypot(s,n)}static rotate(t,e,s){const n=t.x+(e.x-t.x)*Math.cos(s)-(e.y-t.y)*Math.sin(s),r=t.y+(e.x-t.x)*Math.sin(s)+(e.y-t.y)*Math.cos(s);return new Gt(n,r)}static lerp(t,e,s){const n=t.x+(e.x-t.x)*s,r=t.y+(e.y-t.y)*s;return new Gt(n,r)}static add(t,e){return new Gt(t.x+e.x,t.y+e.y)}static subtract(t,e){return new Gt(t.x-e.x,t.y-e.y)}}class Gs extends Gt{constructor(e,s,n,r){super(e,s);S(this,"t");S(this,"angle");this.t=n,this.angle=r}}class Ee{constructor(t,e){S(this,"x");S(this,"y");this.x=e.x-t.x,this.y=e.y-t.y}get length(){return Math.hypot(this.x,this.y)}get angle(){const t=this.x/this.length,e=this.y/this.length;return Math.atan2(e,t)*180/Math.PI}static dot(t,e){return t.x*e.x+t.y*e.y}static angle(t,e){return Math.acos(Ee.dot(t,e)/(t.length*e.length))}static cross(t,e){const s=t.y-e.y,n=e.x-t.x,r=t.x*e.y-e.x*t.y;return new Gt(s,n,r)}static normalize(t){const e=structuredClone(t);return e.x=t.x/t.length,e.y=t.y/t.length,e}}function ph(i,t){if(t<0||t>i)return 0;if(t==0||t==i)return 1;let e=1;for(var s=0;s<t;s++)e=e*(i-s)/(s+1);return e}function f1(i,t){let e=t.length-1,s=0,n=0;for(let r=0;r<=e;r++)n=n+ph(e,r)*Math.pow(1-i,e-r)*Math.pow(i,r)*t[r].x,s=s+ph(e,r)*Math.pow(1-i,e-r)*Math.pow(i,r)*t[r].y;return{x:n,y:s}}function p1(i,t,e){const s=i.x**2-t.x**2+i.y**2-t.y**2,n=i.x**2-e.x**2+i.y**2-e.y**2,r=t.x-i.x,o=e.x-i.x,a=t.y-i.y,l=e.y-i.y,c=-a/l;if(r===0&&o===0||a===0&&l===0)return null;const h=l===0?-n/(2*o):-(s+n*c)/(2*(r+o*c)),u=a===0?-(n+2*h*o)/(2*l):-(s+2*h*r)/(2*a);return new Gt(h,u)}class m1{constructor(t,e,s,n){S(this,"raw");S(this,"nodes");S(this,"type");S(this,"length");S(this,"points");this.time=n,this.nodes=t,this.type=e,this.length=s,this.points=this.process()}parse(){const[t]=this.raw.match(/^(-?)[0-9]+,(-?)[0-9]+,(-?)[0-9]+,[0-9]+,[0-9],(L|P|B|C)(\|(-?)[0-9]+:(-?)[0-9]+)+,[0-9]+,[0-9]+/g)??[];if(!t)throw new Error(`Raw string is not a slider format!
${this.raw}`);const[e,s,n,r,o,a,l,c]=t.split(","),h=parseFloat(e),u=parseFloat(s),d=parseFloat(c),[f,...m]=a.split("|");return{nodesList:[new Gt(h,u),...m.map(g=>{const[E,T]=g.split(":");return new Gt(parseFloat(E),parseFloat(T))})],type:f,length:d}}process(){switch(this.type){case"L":return this.processLinear();case"P":return this.processPerfect();case"B":return this.processBezier();case"C":return this.processCatmull()}}processLinear(){const t=[];let e=0;for(let s=1;s<this.nodes.length;s++){const n=this.nodes[s],r=this.nodes[s-1],a=new Ee(r,n).angle,l=Math.min(Gt.dist(r,n),512);for(let c=0;c<=l&&!(e+1>this.length);c++){const h=new Gs(r.x+(n.x-r.x)*(c/l),r.y+(n.y-r.y)*(c/l),(e+1)/this.length,a);t.push(h),e++}}return t}processPerfect(){if(this.nodes.length<3)return this.processLinear();if(this.nodes.length>3)return this.processBezier();const[t,e,s]=this.nodes,n=p1(t,e,s);if(n===null||Math.abs(n.x)===1/0||Math.abs(n.y)===1/0)return this.processLinear();const r=new Ee(e,t),o=new Ee(e,s),a=new Ee(n,t),l=new Ee(n,s),c=Math.sign(Ee.cross(r,o).z??0),h=2*Math.PI-Ee.angle(a,l),u=h/(2*Math.PI)*(2*Math.PI*a.length),d=h/u,f=[new Gs(t.x,t.y,0)];for(let m=1;m<=this.length;m++){const y=Gt.rotate(n,t,-c*d*m),g=new Ee(f.at(-1),y);f.push(new Gs(y.x,y.y,m/this.length,g.angle))}return f[0].angle=f[1].angle,f}processSubPathBezier(t){const e=[new Gt(t[0].x,t[0].y)];let s=1;for(;s<=this.length;){const n=f1(s/this.length,t),r=Gt.dist(e.at(-1),n);if(s+1>this.length){const o=new Gt(n.x,n.y),a=new Ee(e.at(-1),o);o.angle=a.angle,e.push(o);break}if(r>1){const o=Gt.lerp(e.at(-1),n,1/r),a=new Ee(e.at(-1),o);o.angle=a.angle,e.push(o)}r<=1&&s++}return e[0].angle=e[1].angle,e}processBezier(){const t=this.nodes.map((o,a)=>a===this.nodes.length-1?null:Gt.dist(o,this.nodes[a+1])===0?a:null).filter(o=>o!==null),e=t.map((o,a)=>a===0?this.nodes.slice(0,o+1):this.nodes.slice(t[a-1]+1,o+1));e.push(this.nodes.slice((t.at(-1)??-1)+1));const s=[];for(const o of e){const a=this.processSubPathBezier(o);s.push(...a)}const n=[];let r=0;for(let o=0;o<s.length;o++){if(o===0){n.push(s[o]);continue}const a=Gt.dist(s[o-1],s[o]);if(r+a>this.length)break;n.push(s[o]),r+=a}return n.map((o,a,l)=>new Gs(o.x,o.y,a/l.length,o.angle))}getCatmullPoint(t,e,s,n,r){const a=0+Gt.dist(t,e)**r,l=a+Gt.dist(e,s)**r,c=l+Gt.dist(s,n)**r,h=(l-a)*((t.x-e.x)/(0-a)-(t.x-s.x)/(0-l)+(e.x-s.x)/(a-l)),u=(l-a)*((t.y-e.y)/(0-a)-(t.y-s.y)/(0-l)+(e.y-s.y)/(a-l)),d=(l-a)*((e.x-s.x)/(a-l)-(e.x-n.x)/(a-c)+(s.x-n.x)/(l-c)),f=(l-a)*((e.y-s.y)/(a-l)-(e.y-n.y)/(a-c)+(s.y-n.y)/(l-c)),m=2*e.x-2*s.x+h+d,y=2*e.y-2*s.y+u+f,g=-3*e.x+3*s.x-2*h-d,E=-3*e.y+3*s.y-2*u-f,T=h,_=u,b=e.x,A=e.y,C=Math.floor(Gt.dist(t,e)),R=[];for(let O=1;O<=C;O++){const M=O/C,w=m*M*M*M+g*M*M+T*M+b,I=y*M*M*M+E*M*M+_*M+A;R.push(new Gt(w,I))}return R}processCatmull(){if(this.nodes.length<3)return this.processLinear();const t=new Gt(2*this.nodes[0].x-this.nodes[1].x,2*this.nodes[0].y-this.nodes[1].y),e=new Gt(2*this.nodes.at(-1).x-this.nodes.at(-2).x,2*this.nodes.at(-1).y-this.nodes.at(-2).y),s=[t,...this.nodes,e],n=[];for(let a=1;a<s.length-2;a++)n.push(...this.getCatmullPoint(s[a-1],s[a],s[a+1],s[a+2],0));const r=[];let o=0;for(let a=0;a<n.length;a++){if(a===0){r.push(n[a]);continue}const l=Gt.dist(n[a-1],n[a]);if(o+l>this.length)break;const c=new Ee(n[a-1],n[a]);n[a].angle=c.angle,r.push(n[a]),o+=l}return r[0].angle=r[1].angle,r.map((a,l,c)=>new Gs(a.x,a.y,l/c.length,a.angle))}}class Qt{constructor(t,e,s,n,r,o,a,l,c,h){S(this,"ILLEGAL",!1);S(this,"originalArr",[]);S(this,"angleList",[]);S(this,"realTrackPoints");S(this,"sliderParts");S(this,"sliderEndEvalPosition");S(this,"sliderEndVisualPosition");S(this,"sliderLength");S(this,"svMultiplier");S(this,"baseSV");S(this,"beatStep");S(this,"startTime");S(this,"endTime");S(this,"repeat");S(this,"sliderType");S(this,"stackHeight",0);S(this,"time");S(this,"hitTime");S(this,"SliderMesh");S(this,"SliderSelectedMesh");S(this,"obj");S(this,"selected");S(this,"selectedSliderEnd");S(this,"hitCircle");S(this,"revArrows",[]);S(this,"ticks",[]);S(this,"ball");S(this,"sliderEnd");S(this,"angleE");S(this,"angleS");S(this,"colourIdx",1);S(this,"colourHaxedIdx",1);S(this,"comboIdx",1);S(this,"isHover",!1);S(this,"isVisible",!1);S(this,"opacity",0);S(this,"hitSounds");S(this,"scaleRate",1);S(this,"isHR",!1);S(this,"judgementContainer");S(this,"judgement");S(this,"skinType");this.sliderType=e;const u=t.split("|").map(y=>({x:y.split(":")[0],y:y.split(":")[1]}));this.startPosition={x:parseFloat(u[0].x),y:parseFloat(u[0].y)};const d=[];for(let y=0;y<u.length;y++){if(u[y+1]&&this.Dist(u[y],u[y+1])===0){d.push({type:"Red Anchor",position:u[y]}),y++;continue}d.push({type:"White Anchor",position:u[y]})}this.nodes=d,this.originalArr=u,this.sliderLength=s,this.svMultiplier=ot(n,.1,20),this.repeat=l,this.baseSV=r,this.beatStep=parseFloat(o),this.velocity=2*r/(this.beatStep*(this.svMultiplier<0?1:ot(-(-100/this.svMultiplier),10,1e3))),this.time=a,this.endTime=a+this.sliderLength*this.repeat/(this.svMultiplier*this.baseSV)*o,this.hitTime=this.time,this.startTime=a-B.stats.preempt,this.killTime=this.endTime+240,this.sliderTime=o*Ue(this.sliderLength/(this.svMultiplier*this.baseSV),2),this.sliderTicksCount=(Math.ceil(Ue(this.sliderLength/this.svMultiplier/(r/B.stats.sliderTickRate),1))-1)*this.repeat,this.hitCircle=new Pe(u[0].x,u[0].y,a),this.hitCircle.hitTime=this.hitTime,this.hitSounds=c;const f=new ut;if(this.obj=f,s<0){this.ILLEGAL=!0,B.hasILLEGAL=!0;return}const m=new m1(u.map(y=>({x:parseFloat(y.x),y:parseFloat(y.y)})),e,s,a);if(this.angleList=m.points,this.sliderEndVisualPosition=structuredClone(this.angleList.at(-1)),this.angleList.length===0||this.sliderTicksCount>1e6){this.ILLEGAL=!0,B.hasILLEGAL=!0,this.angleList.length===0&&this.angleList.push(this.originalArr[0]);return}if(this.realTrackPoints=[...Array(this.repeat).keys()].reduce((y,g,E)=>{let T=[];return E%2===0&&(T=y.concat(this.angleList.slice(0,-1))),E%2!==0&&(T=y.concat([...this.angleList].reverse().slice(0,-1).map(_=>({..._,angle:_.angle+180})))),E===this.repeat-1&&(E%2===0?T.push(this.angleList.at(-1)):T.push({...this.angleList[0],angle:this.angleList[0].angle+180})),T},[]).map((y,g)=>({...y,t:g/((this.angleList.length-1)*this.repeat+1)})),this.getSliderPart(),this.endPosition=this.realTrackPoints.at(-1),this.sliderEnd=new XA(this),this.repeat>1&&this.angleList.length<2&&(B.hasILLEGAL=!0,this.ILLEGAL=!0),this.repeat>1){const y=this.angleList.length===1?1:this.angleList.at(-1).x-this.angleList.at(-2).x,g=this.angleList.length===1?1:this.angleList.at(-1).y-this.angleList.at(-2).y,E=Math.abs(g/y),T=this.angleList.length===1?1:this.angleList[0].x-this.angleList[1].x,_=this.angleList.length===1?1:this.angleList[0].y-this.angleList[1].y,b=Math.abs(_/T);let A=y>=0?Math.atan(E)*180/Math.PI:180-Math.atan(E)*180/Math.PI;A=((g>=0?A:-A)+180)*Math.PI/180;let C=T>=0?Math.atan(b)*180/Math.PI:180-Math.atan(b)*180/Math.PI;C=((_>=0?C:-C)+180)*Math.PI/180,this.angleE=A,this.angleS=C,this.sliderParts.filter(R=>R.type==="Slider Repeat").forEach((R,O)=>{const M=O%2===0?this.angleE:this.angleS,w=new u1(this,R.time,R,M,this.stackHeight,O);this.revArrows.push(w)})}this.sliderParts.filter(y=>y.type==="Slider Tick").forEach((y,g)=>{const E=new d1(y,this,g);this.ticks.push(E)}),this.sliderGeometryContainer=new a1(this.angleList,this),this.SliderMesh=this.sliderGeometryContainer.sliderContainer,this.selected=this.sliderGeometryContainer.selSliderContainer.container,this.SliderMeshContainer=new ut,this.SliderMeshContainer.addChild(this.SliderMesh.container),this.ball=new h1(this),this.judgementContainer=new ut,f.addChild(this.SliderMeshContainer),f.addChild(this.judgementContainer),this.ticks.forEach(y=>f.addChild(y.obj)),f.addChild(this.sliderEnd.hitCircle.obj),this.revArrows.forEach(y=>f.addChild(y.obj)),this.nodesContainer=new ut,this.nodesLine=new ft().setStrokeStyle({width:2,color:16777215}).moveTo(this.nodes[0].position.x,this.nodes[0].position.y),this.nodesContainer.addChild(this.nodesLine),this.nodesGraphics=this.nodes.map(y=>{const g=y.type==="White Anchor"?16777215:16711680,E=y.position.x,T=y.position.y;this.nodesLine.lineTo(E,T);const _=new ft().circle(0,0,5).fill(g);return this.nodesContainer.addChild(_),_}),this.nodesLine.stroke(),this.selectedSliderEnd=new Mt(p.SKINNING.type==="0"?st.SELECTED_ARGON.texture:st.SELECTED.texture),this.selectedSliderEnd.anchor.set(.5),f.addChild(this.hitCircle.obj),f.addChild(this.ball.obj),f.addChild(this.nodesContainer),f.label=`${Math.round(this.time)}-SLIDER`}binom(t,e){if(e<0||e>t)return 0;if(e==0||e==t)return 1;for(var s=1,n=0;n<e;n++)s=s*(t-n)/(n+1);return s}bezier(t,e){var s=e.length-1,n=0,r=0;for(let o=0;o<=s;o++)r=r+this.binom(s,o)*Math.pow(1-t,s-o)*Math.pow(t,o)*e[o].x,n=n+this.binom(s,o)*Math.pow(1-t,s-o)*Math.pow(t,o)*e[o].y;return{x:r,y:n}}drawSelected(){if(this.ILLEGAL)return;this.sliderGeometryContainer.selSliderContainer.alpha=1,this.sliderGeometryContainer.selSliderContainer.tint=Object.values(Xe(p.SKINNING.type==="0"?"#edab00":"#3197ff")).map(o=>o/255),this.sliderGeometryContainer.selSliderContainer.update(),this.hitCircle.drawSelected();const t=B.moddedStats.radius/54.4,e=this.sliderEndVisualPosition,s=B.moddedStats.stackOffset,n=e.x+this.stackHeight*s,r=p.MODS.HR?384-e.y+this.stackHeight*s:e.y+this.stackHeight*s;this.selectedSliderEnd.x=n*p.SCALE_RATE,this.selectedSliderEnd.y=r*p.SCALE_RATE,this.selectedSliderEnd.scale.set(t*p.SCALE_RATE*(236/256)**2*(p.SKINNING.type==="0"?1:.5))}playHitsound(t,e){var s,n;if(!(!t||!e)&&(this.hitSounds.defaultSet.hitSoundIdx!==0&&this.hitSounds.sliderWhistle.playLoop(t>=this.hitTime,t<=this.endTime,this.endTime-t),this.hitSounds.sliderSlide.playLoop(t>=this.hitTime,t<=this.endTime,this.endTime-t),!!p.BEATMAP_FILE.audioNode.isPlaying)){if(t>=this.hitTime&&e<this.hitTime){if(!nt.REPLAY_DATA){this.hitSounds.sliderHead.play();return}const r=Qi(nt.EVAL_LIST,this.time,(o,a)=>o.time<a?-1:o.time>a?1:0);((s=nt.EVAL_LIST[r])==null?void 0:s.checkPointState.findLast(o=>o.type==="Slider Head").eval)===1&&this.hitSounds.sliderHead.play();return}if(t>=this.endTime&&e<this.endTime){if(!nt.REPLAY_DATA){this.hitSounds.sliderTail.play();return}const r=Qi(nt.EVAL_LIST,this.time,(o,a)=>o.time<a?-1:o.time>a?1:0);if(((n=nt.EVAL_LIST[r])==null?void 0:n.checkPointState.findLast(o=>o.type==="Slider End").eval)===1){this.hitSounds.sliderTail.play();return}}}}handleSkinChange(){this.skinType!==p.SKINNING.type&&(this.skinType=p.SKINNING.type,this.selectedSliderEnd.texture=p.SKINNING.type==="0"?st.SELECTED_ARGON.texture:st.SELECTED.texture,this.hitCircle.handleSkinChange())}drawBorder(t){this.handleSkinChange();const e=B.moddedStats.stackOffset,s=B.moddedStats.preempt,n=B.moddedStats.fadeIn,r=240;let o=0;p.MODS.HD?(o=1-(t-this.time)/(this.endTime-this.time),t<this.time&&(o=(t-(this.time-s))/n)):(o=1,t<this.time&&(o=(t-(this.time-s))/n),t>this.endTime&&(o=1-(t-this.endTime)/r,p.SLIDER_APPEARANCE.snaking&&this.hitTime<=this.killTime&&(o=0))),o=ot(o,0,1),this.opacity=o,this.SliderMesh.alpha=o;const a=ot((t-this.time)/(this.endTime-this.time),0,1);p.SLIDER_APPEARANCE.snaking?t<this.hitTime?(this.SliderMesh.startt=0,this.SliderMesh.endt=ot(o*2,0,1),this.hitTime>this.endTime&&(this.SliderMesh.endt=1)):t>=this.hitTime&&(this.repeat%2===0?(this.SliderMesh.startt=0,this.SliderMesh.endt=1-ot((a-1)*this.repeat+1,0,1)):(this.SliderMesh.startt=ot((a-1)*this.repeat+1,0,1),this.SliderMesh.endt=1)):(this.SliderMesh.startt=0,this.SliderMesh.endt=1);const l=p.SLIDER_APPEARANCE.ignoreSkin?at.DEFAULT_COLORS:B.COLORS,c=p.SLIDER_APPEARANCE.ignoreSkin?this.colourIdx:this.colourHaxedIdx;this.SliderMesh.tint=Object.values(Xe(`#${l[c%l.length].toString(16).padStart(6,"0")}`)).map(h=>h/255),this.SliderMesh.update(),(this.scaleRate!==p.SCALE_RATE||this.isHR!==p.MODS.HR)&&(this.scaleRate=p.SCALE_RATE,this.isHR=p.MODS.HR,this.nodesLine.clear().setStrokeStyle({width:2,color:16777215}),this.nodesGraphics.forEach((h,u)=>{let{x:d,y:f}=this.nodes[u].position;if(p.MODS.HR&&(f=384-f),d=(parseInt(d)+this.stackHeight*e)*p.SCALE_RATE,f=(parseInt(f)+this.stackHeight*e)*p.SCALE_RATE,h.x=d,h.y=f,u===0){this.nodesLine.moveTo(d,f);return}this.nodesLine.lineTo(d,f).stroke()})),(this.isHover&&this.isVisible)!==this.nodesContainer.visible&&(this.nodesContainer.visible=this.isHover&&this.isVisible)}updateJudgement(t){if(!this.judgement)return;this.judgement.draw(t);const e=this.realTrackPoints.at(-1),s=B.moddedStats.stackOffset,n=(e.x+this.stackHeight*s)*p.WIDTH/512,r=p.MODS.HR?(384-e.y+this.stackHeight*s)*p.WIDTH/512:(e.y+this.stackHeight*s)*p.WIDTH/512;this.judgement.obj.x=n,this.judgement.obj.y=r}draw(t){this.ILLEGAL||(this.isVisible=t>=this.startTime&&t<this.killTime,this.drawBorder(t),this.hitCircle.draw(t),this.sliderEnd.draw(t),this.revArrows.forEach(e=>e.draw(t)),this.ticks.forEach(e=>e.draw(t)),this.ball.draw(t),this.updateJudgement(t))}Dist(t,e){return Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)}getPointAtTime(t){if(t<=this.time)return this.realTrackPoints.at(0);if(t>=this.endTime)return this.realTrackPoints.at(-1);let e=(t-this.time)/(this.endTime-this.time)*(this.realTrackPoints.length-1);isNaN(e)&&(e=0);const s=Math.floor(e),n=Math.ceil(e),o=(e-s)/(n-s),a=this.realTrackPoints[s].x+o*(this.realTrackPoints[n].x-this.realTrackPoints[s].x),l=this.realTrackPoints[s].y+o*(this.realTrackPoints[n].y-this.realTrackPoints[s].y),c=o>=.5?this.realTrackPoints[n].angle:this.realTrackPoints[s].angle,h=(t-this.time)/(this.endTime-this.time);return{x:a,y:l,t:h,angle:c}}getSliderPart(){const t=[],e=this.endTime;for(let r=0;r<this.sliderTicksCount/this.repeat;r++)t.push(this.angleList[Math.round((r+1)*this.beatStep/this.sliderTime/B.stats.sliderTickRate*(this.angleList.length-1))]);const s=[],n={...this.realTrackPoints[Math.round(ot((this.killTime-this.time-36)/(e-this.time),0,1)*(this.realTrackPoints.length-1))],type:"Slider End",time:e-36<this.time?e-15:e-36};for(let r=0;r<this.repeat;r++){const o=this.sliderTime-this.sliderTicksCount/this.repeat*this.beatStep,a=r%2===0?this.angleList.at(-1):this.angleList[0];r%2===0?s.push(...t.map((l,c)=>({...l,type:"Slider Tick",time:r*this.sliderTime+Math.floor(this.time+(c+1)*this.beatStep/B.stats.sliderTickRate)}))):s.push(...t.toReversed().map((l,c)=>({...l,type:"Slider Tick",time:(r-1)*this.sliderTime+Math.floor(this.time+this.sliderTime+c*this.beatStep/B.stats.sliderTickRate+o)}))),r<this.repeat-1&&s.push({...a,type:"Slider Repeat",time:this.time+Math.round((r+1)*this.sliderTime)})}this.sliderParts=s,this.sliderEndEvalPosition=n}eval(t){var y,g,E,T;const e=this.endTime,s=54.4-4.48*B.stats.circleSize;let n=nt.CURSOR_DATA[t],r=t,o=this.hitCircle.eval(t);for(;!o;)if(o=this.hitCircle.eval(++t),!nt.CURSOR_DATA[t])return null;if(o===null)return null;let a=o.val===0?"UNTRACKING":"TRACKING",l=0;const c=this.sliderParts.concat([this.sliderEndEvalPosition]).sort((_,b)=>_.time>b.time?1:_.time<b.time?-1:0),h=[{type:"Slider Head",eval:o.val===0?0:1}],u=B.moddedStats.stackOffset,d={x:this.stackHeight*u,y:this.stackHeight*u};let f=o.inputTime;for(;n.time<=e;){const _=this.getPointAtTime(n.time);if(!_){if(n=nt.CURSOR_DATA[++r],!n)break;continue}const b=p.MODS.HR?Dr(Oa(_),d):Dr(_,d);if(a==="TRACKING"&&(n.inputArray.length===0||Ue(Qs(n,b)/(2.4*s),5)>1)&&(a="UNTRACKING"),a==="UNTRACKING"&&n.inputArray.length!==0&&Ue(Qs(n,b)/s,5)<1&&(a="TRACKING",f||(f=n.time)),c[l]&&((y=nt.CURSOR_DATA[r+1])==null?void 0:y.time)>((g=c[l])==null?void 0:g.time)){if(n.time!==((E=c[l])==null?void 0:E.time)){const A=nt.CURSOR_DATA[r+1],C=Z1(n,A,(c[l].time-n.time)/(A.time-n.time));a==="TRACKING"&&(n.inputArray.length===0||Ue(Qs(C,p.MODS.HR?Oa(c[l]):c[l])/(2.4*s),5)>1)&&(a="UNTRACKING"),a==="UNTRACKING"&&n.inputArray.length!==0&&Ue(Qs(n,c[l])/s,5)<1&&(a="TRACKING",f||(f=n.time))}h.push({type:c[l].type,eval:a==="TRACKING"&&n.time<=c[l].time?1:0}),l++}if((!c[l]||c[l].time>=((T=nt.CURSOR_DATA[r+1])==null?void 0:T.time))&&r++,n=nt.CURSOR_DATA[r],!n)break}return{val:h.every(_=>_.eval===1)?300:h.every(_=>_.eval===0)?0:h.filter(_=>_.eval===1).length*2>=1+this.sliderTicksCount*this.repeat+this.repeat?100:50,valV2:o.val,checkPointState:h,delta:o.delta,inputTime:f}}get approachCircleObj(){return this.hitCircle.approachCircleObj}}const Ia=(i,t)=>{const e=p.CURRENT_X,s=p.CURRENT_Y;p.BEATMAP_FILE.audioNode.getCurrentTime();const n=p.START_X,r=p.START_Y;let o=ot(B.stats.approachRate*(p.MODS.HR?1.4:1)*(p.MODS.EZ?.5:1),0,10);const a=B.difficultyRange(o,1800,1200,450),l=p.BEATMAP_FILE.beatmapRenderData.objectsController.objectsList.filter(c=>{const h=c.obj.time-a,u=p.SLIDER_APPEARANCE.hitAnim?c.obj.killTime:Math.max(c.obj.time+800,c.obj.killTime);return h<=Math.min(p.DRAGGING_START,p.DRAGGING_END)&&u>=Math.max(p.DRAGGING_START,p.DRAGGING_END)||h>=Math.min(p.DRAGGING_START,p.DRAGGING_END)&&u<=Math.max(p.DRAGGING_START,p.DRAGGING_END)||h>=Math.min(p.DRAGGING_START,p.DRAGGING_END)&&h<=Math.max(p.DRAGGING_START,p.DRAGGING_END)||u>=Math.min(p.DRAGGING_START,p.DRAGGING_END)&&u<=Math.max(p.DRAGGING_START,p.DRAGGING_END)}).filter(c=>{const h={x:Math.min(e,n),y:Math.min(s,r)},u={x:Math.max(e,n),y:Math.max(s,r)};if(c.obj instanceof Pe){const d=c.obj.originalX+B.moddedStats.stackOffset*c.obj.stackHeight,f=(p.MODS.HR?384-c.obj.originalY:c.obj.originalY)+B.moddedStats.stackOffset*c.obj.stackHeight;return d>=h.x&&d<=u.x&&f>=h.y&&f<=u.y}return c.obj instanceof Qt?c.obj.angleList.some(m=>{const y=m.x+B.moddedStats.stackOffset*c.obj.stackHeight,g=(p.MODS.HR?384-m.y:m.y)+B.moddedStats.stackOffset*c.obj.stackHeight;return y+B.moddedStats.stackOffset*c.obj.stackHeight>=h.x&&y+B.moddedStats.stackOffset*c.obj.stackHeight<=u.x&&g+B.moddedStats.stackOffset*c.obj.stackHeight>=h.y&&g+B.moddedStats.stackOffset*c.obj.stackHeight<=u.y}):!1});l.length?p.SELECTED=l.map(c=>c.obj.time):i&&!i.ctrlKey&&(p.SELECTED=[])},mh=(i,t,e)=>{const n=B.moddedStats.radius*.921875,r=p.BEATMAP_FILE.beatmapRenderData.objectsController.objectsList[e.idx];if(r.obj instanceof Pe){const o=r.obj.originalX+B.moddedStats.stackOffset*r.obj.stackHeight,a=(p.MODS.HR?384-r.obj.originalY:r.obj.originalY)+B.moddedStats.stackOffset*r.obj.stackHeight;return(i-o)**2+(t-a)**2<=n**2}return r.obj instanceof Qt?r.obj.angleList.some(l=>{const c=l.x+B.moddedStats.stackOffset*r.obj.stackHeight,h=(p.MODS.HR?384-l.y:l.y)+B.moddedStats.stackOffset*r.obj.stackHeight;return(i-c)**2+(t-h)**2<=n**2}):!1};var Tf={exports:{}};function g1(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Uo={exports:{}};const y1={},S1=Object.freeze(Object.defineProperty({__proto__:null,default:y1},Symbol.toStringTag,{value:"Module"})),T1=hm(S1);var gh;function E1(){return gh||(gh=1,function(i,t){(function(e,s){i.exports=s()})(js,function(){var e=e||function(s,n){var r;if(typeof window<"u"&&window.crypto&&(r=window.crypto),typeof self<"u"&&self.crypto&&(r=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(r=globalThis.crypto),!r&&typeof window<"u"&&window.msCrypto&&(r=window.msCrypto),!r&&typeof js<"u"&&js.crypto&&(r=js.crypto),!r&&typeof g1=="function")try{r=T1}catch{}var o=function(){if(r){if(typeof r.getRandomValues=="function")try{return r.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof r.randomBytes=="function")try{return r.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},a=Object.create||function(){function T(){}return function(_){var b;return T.prototype=_,b=new T,T.prototype=null,b}}(),l={},c=l.lib={},h=c.Base=function(){return{extend:function(T){var _=a(this);return T&&_.mixIn(T),(!_.hasOwnProperty("init")||this.init===_.init)&&(_.init=function(){_.$super.init.apply(this,arguments)}),_.init.prototype=_,_.$super=this,_},create:function(){var T=this.extend();return T.init.apply(T,arguments),T},init:function(){},mixIn:function(T){for(var _ in T)T.hasOwnProperty(_)&&(this[_]=T[_]);T.hasOwnProperty("toString")&&(this.toString=T.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),u=c.WordArray=h.extend({init:function(T,_){T=this.words=T||[],_!=n?this.sigBytes=_:this.sigBytes=T.length*4},toString:function(T){return(T||f).stringify(this)},concat:function(T){var _=this.words,b=T.words,A=this.sigBytes,C=T.sigBytes;if(this.clamp(),A%4)for(var R=0;R<C;R++){var O=b[R>>>2]>>>24-R%4*8&255;_[A+R>>>2]|=O<<24-(A+R)%4*8}else for(var M=0;M<C;M+=4)_[A+M>>>2]=b[M>>>2];return this.sigBytes+=C,this},clamp:function(){var T=this.words,_=this.sigBytes;T[_>>>2]&=4294967295<<32-_%4*8,T.length=s.ceil(_/4)},clone:function(){var T=h.clone.call(this);return T.words=this.words.slice(0),T},random:function(T){for(var _=[],b=0;b<T;b+=4)_.push(o());return new u.init(_,T)}}),d=l.enc={},f=d.Hex={stringify:function(T){for(var _=T.words,b=T.sigBytes,A=[],C=0;C<b;C++){var R=_[C>>>2]>>>24-C%4*8&255;A.push((R>>>4).toString(16)),A.push((R&15).toString(16))}return A.join("")},parse:function(T){for(var _=T.length,b=[],A=0;A<_;A+=2)b[A>>>3]|=parseInt(T.substr(A,2),16)<<24-A%8*4;return new u.init(b,_/2)}},m=d.Latin1={stringify:function(T){for(var _=T.words,b=T.sigBytes,A=[],C=0;C<b;C++){var R=_[C>>>2]>>>24-C%4*8&255;A.push(String.fromCharCode(R))}return A.join("")},parse:function(T){for(var _=T.length,b=[],A=0;A<_;A++)b[A>>>2]|=(T.charCodeAt(A)&255)<<24-A%4*8;return new u.init(b,_)}},y=d.Utf8={stringify:function(T){try{return decodeURIComponent(escape(m.stringify(T)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(T){return m.parse(unescape(encodeURIComponent(T)))}},g=c.BufferedBlockAlgorithm=h.extend({reset:function(){this._data=new u.init,this._nDataBytes=0},_append:function(T){typeof T=="string"&&(T=y.parse(T)),this._data.concat(T),this._nDataBytes+=T.sigBytes},_process:function(T){var _,b=this._data,A=b.words,C=b.sigBytes,R=this.blockSize,O=R*4,M=C/O;T?M=s.ceil(M):M=s.max((M|0)-this._minBufferSize,0);var w=M*R,I=s.min(w*4,C);if(w){for(var L=0;L<w;L+=R)this._doProcessBlock(A,L);_=A.splice(0,w),b.sigBytes-=I}return new u.init(_,I)},clone:function(){var T=h.clone.call(this);return T._data=this._data.clone(),T},_minBufferSize:0});c.Hasher=g.extend({cfg:h.extend(),init:function(T){this.cfg=this.cfg.extend(T),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(T){return this._append(T),this._process(),this},finalize:function(T){T&&this._append(T);var _=this._doFinalize();return _},blockSize:16,_createHelper:function(T){return function(_,b){return new T.init(b).finalize(_)}},_createHmacHelper:function(T){return function(_,b){return new E.HMAC.init(T,b).finalize(_)}}});var E=l.algo={};return l}(Math);return e})}(Uo)),Uo.exports}(function(i,t){(function(e,s){i.exports=s(E1())})(js,function(e){return function(s){var n=e,r=n.lib,o=r.WordArray,a=r.Hasher,l=n.algo,c=[];(function(){for(var y=0;y<64;y++)c[y]=s.abs(s.sin(y+1))*4294967296|0})();var h=l.MD5=a.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(y,g){for(var E=0;E<16;E++){var T=g+E,_=y[T];y[T]=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360}var b=this._hash.words,A=y[g+0],C=y[g+1],R=y[g+2],O=y[g+3],M=y[g+4],w=y[g+5],I=y[g+6],L=y[g+7],D=y[g+8],N=y[g+9],U=y[g+10],v=y[g+11],P=y[g+12],q=y[g+13],$=y[g+14],et=y[g+15],H=b[0],k=b[1],F=b[2],z=b[3];H=u(H,k,F,z,A,7,c[0]),z=u(z,H,k,F,C,12,c[1]),F=u(F,z,H,k,R,17,c[2]),k=u(k,F,z,H,O,22,c[3]),H=u(H,k,F,z,M,7,c[4]),z=u(z,H,k,F,w,12,c[5]),F=u(F,z,H,k,I,17,c[6]),k=u(k,F,z,H,L,22,c[7]),H=u(H,k,F,z,D,7,c[8]),z=u(z,H,k,F,N,12,c[9]),F=u(F,z,H,k,U,17,c[10]),k=u(k,F,z,H,v,22,c[11]),H=u(H,k,F,z,P,7,c[12]),z=u(z,H,k,F,q,12,c[13]),F=u(F,z,H,k,$,17,c[14]),k=u(k,F,z,H,et,22,c[15]),H=d(H,k,F,z,C,5,c[16]),z=d(z,H,k,F,I,9,c[17]),F=d(F,z,H,k,v,14,c[18]),k=d(k,F,z,H,A,20,c[19]),H=d(H,k,F,z,w,5,c[20]),z=d(z,H,k,F,U,9,c[21]),F=d(F,z,H,k,et,14,c[22]),k=d(k,F,z,H,M,20,c[23]),H=d(H,k,F,z,N,5,c[24]),z=d(z,H,k,F,$,9,c[25]),F=d(F,z,H,k,O,14,c[26]),k=d(k,F,z,H,D,20,c[27]),H=d(H,k,F,z,q,5,c[28]),z=d(z,H,k,F,R,9,c[29]),F=d(F,z,H,k,L,14,c[30]),k=d(k,F,z,H,P,20,c[31]),H=f(H,k,F,z,w,4,c[32]),z=f(z,H,k,F,D,11,c[33]),F=f(F,z,H,k,v,16,c[34]),k=f(k,F,z,H,$,23,c[35]),H=f(H,k,F,z,C,4,c[36]),z=f(z,H,k,F,M,11,c[37]),F=f(F,z,H,k,L,16,c[38]),k=f(k,F,z,H,U,23,c[39]),H=f(H,k,F,z,q,4,c[40]),z=f(z,H,k,F,A,11,c[41]),F=f(F,z,H,k,O,16,c[42]),k=f(k,F,z,H,I,23,c[43]),H=f(H,k,F,z,N,4,c[44]),z=f(z,H,k,F,P,11,c[45]),F=f(F,z,H,k,et,16,c[46]),k=f(k,F,z,H,R,23,c[47]),H=m(H,k,F,z,A,6,c[48]),z=m(z,H,k,F,L,10,c[49]),F=m(F,z,H,k,$,15,c[50]),k=m(k,F,z,H,w,21,c[51]),H=m(H,k,F,z,P,6,c[52]),z=m(z,H,k,F,O,10,c[53]),F=m(F,z,H,k,U,15,c[54]),k=m(k,F,z,H,C,21,c[55]),H=m(H,k,F,z,D,6,c[56]),z=m(z,H,k,F,et,10,c[57]),F=m(F,z,H,k,I,15,c[58]),k=m(k,F,z,H,q,21,c[59]),H=m(H,k,F,z,M,6,c[60]),z=m(z,H,k,F,v,10,c[61]),F=m(F,z,H,k,R,15,c[62]),k=m(k,F,z,H,N,21,c[63]),b[0]=b[0]+H|0,b[1]=b[1]+k|0,b[2]=b[2]+F|0,b[3]=b[3]+z|0},_doFinalize:function(){var y=this._data,g=y.words,E=this._nDataBytes*8,T=y.sigBytes*8;g[T>>>5]|=128<<24-T%32;var _=s.floor(E/4294967296),b=E;g[(T+64>>>9<<4)+15]=(_<<8|_>>>24)&16711935|(_<<24|_>>>8)&4278255360,g[(T+64>>>9<<4)+14]=(b<<8|b>>>24)&16711935|(b<<24|b>>>8)&4278255360,y.sigBytes=(g.length+1)*4,this._process();for(var A=this._hash,C=A.words,R=0;R<4;R++){var O=C[R];C[R]=(O<<8|O>>>24)&16711935|(O<<24|O>>>8)&4278255360}return A},clone:function(){var y=a.clone.call(this);return y._hash=this._hash.clone(),y}});function u(y,g,E,T,_,b,A){var C=y+(g&E|~g&T)+_+A;return(C<<b|C>>>32-b)+g}function d(y,g,E,T,_,b,A){var C=y+(g&T|E&~T)+_+A;return(C<<b|C>>>32-b)+g}function f(y,g,E,T,_,b,A){var C=y+(g^E^T)+_+A;return(C<<b|C>>>32-b)+g}function m(y,g,E,T,_,b,A){var C=y+(E^(g|~T))+_+A;return(C<<b|C>>>32-b)+g}n.MD5=a._createHelper(h),n.HmacMD5=a._createHmacHelper(h)}(Math),e.MD5})})(Tf);var _1=Tf.exports;const b1=Wr(_1);class Ie{constructor(t,e,s){S(this,"time");S(this,"endTime");S(this,"obj");S(this,"approachCircle");S(this,"hitSounds");S(this,"comboIdx",1);S(this,"colourIdx",-1);S(this,"colourHaxedIdx",-1);S(this,"judgementContainer");S(this,"judgement");this.time=t,this.hitTime=e,this.killTime=e+240,this.endTime=e;const n=new ut,r=new ut,o=new ft().setStrokeStyle({width:2,color:16777215,alpha:1,cap:"round",alignment:0}).circle(0,0,192).stroke();r.addChild(o);const a=new ft().setStrokeStyle({width:2,color:16777215,alpha:1,cap:"round",alignment:0}).circle(0,0,5).stroke();this.judgementContainer=new ut,n.addChild(this.judgementContainer),n.addChild(r),n.addChild(a),n.x=256*p.WIDTH/512,n.y=192*p.WIDTH/512,this.obj=n,this.obj.label=`${Math.round(this.time)}-SPINNER`,this.approachCircle=r,this.hitSounds=s}playHitsound(t,e){if(!p.BEATMAP_FILE.audioNode.isPlaying||!t||!e||t<this.endTime||e>=this.endTime)return;if(!nt.REPLAY_DATA){this.hitSounds.play();return}nt.EVAL_LIST.find(n=>n.time===this.time)&&this.hitSounds.play()}draw(t){if(this.obj.x=256*p.SCALE_RATE,this.obj.y=192*p.SCALE_RATE,this.playHitsound(t),t<this.time){let e=ot(B.stats.approachRate*(p.MODS.HR?1.4:1)*(p.MODS.EZ?.5:1),0,10);const s=e<5?800+400*(5-e)/5:e>5?800-500*(e-5)/5:800;this.obj.alpha=1-Math.min(1,Math.max(0,(this.time-t)/s)),this.approachCircle.scale.set(1*p.SCALE_RATE);return}if(this.time<=t&&t<=this.hitTime){const e=1-Math.max(0,Math.min(1,(t-this.time)/(this.hitTime-this.time)));this.approachCircle.scale.set(e*p.SCALE_RATE),this.obj.alpha=1;return}if(t>this.hitTime){this.obj.alpha=1-Math.min(1,Math.max(0,(t-this.hitTime)/240)),this.approachCircle.scale.set(0*p.SCALE_RATE);return}}eval(t){const e=this.hitTime-this.time;let s=0,n=0,r=0,o=0,a=0,l=0,c,h=0,u=0;const d=B.stats.overallDifficulty,f=B.difficultyRange(d,3,5,7.5),m=Math.floor(e/1e3*f),y=nt.IS_OLD_VER?m:Math.max(0,m/4),g=nt.IS_OLD_VER?m+1:m,E=8e-5+Math.max(0,(5e3-e)/1e3/2e3);let T=0,_=t;for(;nt.CURSOR_DATA[_].time<this.hitTime;){if(nt.CURSOR_DATA[_].time<this.time){_++;continue}const A=J1(nt.CURSOR_DATA[_]),C=Math.atan2(A.y,A.x);let R=A.time-nt.CURSOR_DATA[_-1].time;nt.CURSOR_DATA[_-1].time===0&&(R=100/6);const O=hr(E*R,nt.MODS);if(s>n){const U=O;n+=Math.min(s-n,U)}else{const U=-O;n+=Math.max(s-n,U)}n=ot(n,-.05,.05),c=c||(nt.IS_OLD_VER?0:C);let M=C-c;const w=-Math.PI;M<w?M=2*Math.PI+C-c:-M<w&&(M=-2*Math.PI-c+C);const I=.9**(R/100*6);T=I*T+(1-I)*R,M===0?(r++,r<2?s/=3:s=0):(r=0,(A.inputArray.length===0||A.time<this.time)&&(M=0),Math.abs(M)<Math.PI?hr(T,nt.MODS)>100/6*1.04?R>0?s=M/hr(T,nt.MODS):s=0:s=M/(100/6):s=0),c=C;const L=n*R;if(o+=Math.min(1,Math.abs(L/Math.PI)),Math.floor(o)==l){_++;continue}a++;let D=0,N=0;a>m+3&&(a-(m+3))%2===0?(D+=1100,N+=600):a>1&&a%2===0&&(D+=100,N+=100),l=Math.floor(o),h+=D,u+=N,_++}let b=0;return nt.IS_OLD_VER?b=y===0?300:a<y?0:a>g?300:a>g-2?100:50:b=a<y?0:a>g?300:a>g-1?100:50,{val:b,valV2:b,bonus:h,bonusV2:u,inputTime:-1}}get approachCircleObj(){return null}}class Be{static async init(){const t=de.measureText("a",this.username.style);this.username.x=10,this.username.y=(40-t.height)/2,this.container.label="User",this.container.x=10,this.container.y=p.WRAPPER.h-20,this.container.addChild(this.graphics,this.username,this.modsContainer),this.container.visible=!1,await es(e=>{for(const s of["DoubleTime","Easy","Flashlight","HalfTime","HardRock","Hidden","Nightcore","NoFail","Perfect","ScoreV2","SpunOut","SuddenDeath"])e(async()=>this.textures[s]=await bt.load({src:`/static/mods/${s}.png`,loadParser:"loadTextures"}))})}static forceResize(){let t=60;innerWidth/innerHeight<1?(t=40,this.container.x=10,this.container.y=p.MASTER_CONTAINER.h+40-t):(this.container.x=10,this.container.y=p.APP.renderer.height-130),this.username.style={fontFamily:"Torus",fontWeight:500,fontSize:innerWidth/innerHeight<1?12:16,fill:16777215,wordWrap:!0};const e=de.measureText(this.username.text,this.username.style);this.username.x=20,this.username.y=(t-e.height)/2,this.mods.forEach((s,n)=>{s.width=innerWidth/innerHeight<1?21.25:42.5,s.height=innerWidth/innerHeight<1?20:40,s.x=n*(innerWidth/innerHeight<1?10:20)}),this.modsContainer.x=30+e.width,this.modsContainer.y=(t-(innerWidth/innerHeight<1?20:40))/2,this.graphics.clear().roundRect(0,0,40+e.width+this.modsContainer.width,t,5).fill({color:0,alpha:.5})}static resize(){p.EMIT_STACK.length!==0&&this.forceResize()}static async updateInfo(t){if(console.log(t),!t){this.container.visible=!1;return}this.container.visible=!0,this.username.text=t.username,this.modsContainer.removeChildren(),this.mods=t.mods.map(e=>{const s=new Mt;return s.texture=this.textures[e],this.modsContainer.addChild(s),s}),this.forceResize()}}S(Be,"container",new ut),S(Be,"graphics",new ft),S(Be,"username",new Ve({style:{fontFamily:"Torus",fontWeight:500,fontSize:16,fill:16777215,wordWrap:!0}})),S(Be,"mods",[]),S(Be,"modsContainer",new ut),S(Be,"textures",{});var Nt;(function(i){i.LOAD="LOAD",i.EXEC="EXEC",i.FFPROBE="FFPROBE",i.WRITE_FILE="WRITE_FILE",i.READ_FILE="READ_FILE",i.DELETE_FILE="DELETE_FILE",i.RENAME="RENAME",i.CREATE_DIR="CREATE_DIR",i.LIST_DIR="LIST_DIR",i.DELETE_DIR="DELETE_DIR",i.ERROR="ERROR",i.DOWNLOAD="DOWNLOAD",i.PROGRESS="PROGRESS",i.LOG="LOG",i.MOUNT="MOUNT",i.UNMOUNT="UNMOUNT"})(Nt||(Nt={}));const x1=(()=>{let i=0;return()=>i++})(),A1=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),C1=new Error("called FFmpeg.terminate()");var _e,Ci,ui,Wi,Vi,kr,he;class R1{constructor(){Ei(this,_e,null);Ei(this,Ci,{});Ei(this,ui,{});Ei(this,Wi,[]);Ei(this,Vi,[]);S(this,"loaded",!1);Ei(this,kr,()=>{Et(this,_e)&&(Et(this,_e).onmessage=({data:{id:t,type:e,data:s}})=>{switch(e){case Nt.LOAD:this.loaded=!0,Et(this,Ci)[t](s);break;case Nt.MOUNT:case Nt.UNMOUNT:case Nt.EXEC:case Nt.FFPROBE:case Nt.WRITE_FILE:case Nt.READ_FILE:case Nt.DELETE_FILE:case Nt.RENAME:case Nt.CREATE_DIR:case Nt.LIST_DIR:case Nt.DELETE_DIR:Et(this,Ci)[t](s);break;case Nt.LOG:Et(this,Wi).forEach(n=>n(s));break;case Nt.PROGRESS:Et(this,Vi).forEach(n=>n(s));break;case Nt.ERROR:Et(this,ui)[t](s);break}delete Et(this,Ci)[t],delete Et(this,ui)[t]})});Ei(this,he,({type:t,data:e},s=[],n)=>Et(this,_e)?new Promise((r,o)=>{const a=x1();Et(this,_e)&&Et(this,_e).postMessage({id:a,type:t,data:e},s),Et(this,Ci)[a]=r,Et(this,ui)[a]=o,n==null||n.addEventListener("abort",()=>{o(new DOMException(`Message # ${a} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(A1));S(this,"load",({classWorkerURL:t,...e}={},{signal:s}={})=>(Et(this,_e)||(Ps(this,_e,t?new Worker(new URL(t,import.meta.url),{type:"module"}):new Worker(new URL("/dist/assets/worker-BAOIWoxA.js",import.meta.url),{type:"module"})),Et(this,kr).call(this)),Et(this,he).call(this,{type:Nt.LOAD,data:e},void 0,s)));S(this,"exec",(t,e=-1,{signal:s}={})=>Et(this,he).call(this,{type:Nt.EXEC,data:{args:t,timeout:e}},void 0,s));S(this,"ffprobe",(t,e=-1,{signal:s}={})=>Et(this,he).call(this,{type:Nt.FFPROBE,data:{args:t,timeout:e}},void 0,s));S(this,"terminate",()=>{const t=Object.keys(Et(this,ui));for(const e of t)Et(this,ui)[e](C1),delete Et(this,ui)[e],delete Et(this,Ci)[e];Et(this,_e)&&(Et(this,_e).terminate(),Ps(this,_e,null),this.loaded=!1)});S(this,"writeFile",(t,e,{signal:s}={})=>{const n=[];return e instanceof Uint8Array&&n.push(e.buffer),Et(this,he).call(this,{type:Nt.WRITE_FILE,data:{path:t,data:e}},n,s)});S(this,"mount",(t,e,s)=>{const n=[];return Et(this,he).call(this,{type:Nt.MOUNT,data:{fsType:t,options:e,mountPoint:s}},n)});S(this,"unmount",t=>{const e=[];return Et(this,he).call(this,{type:Nt.UNMOUNT,data:{mountPoint:t}},e)});S(this,"readFile",(t,e="binary",{signal:s}={})=>Et(this,he).call(this,{type:Nt.READ_FILE,data:{path:t,encoding:e}},void 0,s));S(this,"deleteFile",(t,{signal:e}={})=>Et(this,he).call(this,{type:Nt.DELETE_FILE,data:{path:t}},void 0,e));S(this,"rename",(t,e,{signal:s}={})=>Et(this,he).call(this,{type:Nt.RENAME,data:{oldPath:t,newPath:e}},void 0,s));S(this,"createDir",(t,{signal:e}={})=>Et(this,he).call(this,{type:Nt.CREATE_DIR,data:{path:t}},void 0,e));S(this,"listDir",(t,{signal:e}={})=>Et(this,he).call(this,{type:Nt.LIST_DIR,data:{path:t}},void 0,e));S(this,"deleteDir",(t,{signal:e}={})=>Et(this,he).call(this,{type:Nt.DELETE_DIR,data:{path:t}},void 0,e))}on(t,e){t==="log"?Et(this,Wi).push(e):t==="progress"&&Et(this,Vi).push(e)}off(t,e){t==="log"?Ps(this,Wi,Et(this,Wi).filter(s=>s!==e)):t==="progress"&&Ps(this,Vi,Et(this,Vi).filter(s=>s!==e))}}_e=new WeakMap,Ci=new WeakMap,ui=new WeakMap,Wi=new WeakMap,Vi=new WeakMap,kr=new WeakMap,he=new WeakMap;var yh;(function(i){i.MEMFS="MEMFS",i.NODEFS="NODEFS",i.NODERAWFS="NODERAWFS",i.IDBFS="IDBFS",i.WORKERFS="WORKERFS",i.PROXYFS="PROXYFS"})(yh||(yh={}));const w1=new Error("failed to get response body reader"),I1=new Error("failed to complete download"),M1="Content-Length",O1=i=>new Promise((t,e)=>{const s=new FileReader;s.onload=()=>{const{result:n}=s;n instanceof ArrayBuffer?t(new Uint8Array(n)):t(new Uint8Array)},s.onerror=n=>{var r,o;e(Error(`File could not be read! Code=${((o=(r=n==null?void 0:n.target)==null?void 0:r.error)==null?void 0:o.code)||-1}`))},s.readAsArrayBuffer(i)}),Go=async i=>{let t;if(typeof i=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(i)?t=atob(i.split(",")[1]).split("").map(e=>e.charCodeAt(0)):t=await(await fetch(i)).arrayBuffer();else if(i instanceof URL)t=await(await fetch(i)).arrayBuffer();else if(i instanceof File||i instanceof Blob)t=await O1(i);else return new Uint8Array;return new Uint8Array(t)},v1=async(i,t)=>{var n;const e=await fetch(i);let s;try{const r=parseInt(e.headers.get(M1)||"-1"),o=(n=e.body)==null?void 0:n.getReader();if(!o)throw w1;const a=[];let l=0;for(;;){const{done:u,value:d}=await o.read(),f=d?d.length:0;if(u){if(r!=-1&&r!==l)throw I1;t&&t({url:i,total:r,received:l,delta:f,done:u});break}a.push(d),l+=f,t&&t({url:i,total:r,received:l,delta:f,done:u})}const c=new Uint8Array(l);let h=0;for(const u of a)c.set(u,h),h+=u.length;s=c.buffer}catch(r){console.log("failed to send download progress event: ",r),s=await e.arrayBuffer()}return s},jo=async(i,t,e=!1,s)=>{const n=e?await v1(i,s):await(await fetch(i)).arrayBuffer(),r=new Blob([n],{type:t});return URL.createObjectURL(r)};class P1{constructor(t,e=!1){this.loadFn=t,e&&this.load().then()}async load(){return this.loadPromise??(this.loadPromise=this.loadFn()),this.loadPromise}loadInBackground(){this.load().then()}}const ls=class ls{static loadInBackground(){this.loader.loadInBackground()}static async ensureLoaded(){return this.loader.load()}static async toMp3({blob:t,ext:e}){await this.ensureLoaded(),this.ffmpeg.on("progress",({progress:n,time:r})=>{document.querySelector("#loadingText").textContent=`Transcoding .ogg audio to .mp3 using FFmpeg: ${(n*100).toFixed(2)}%`}),await this.ffmpeg.writeFile(`audio.${e}`,await Go(t)),await this.ffmpeg.exec(["-i",`audio.${e}`,"-c","mp3","audio.mp3"]);const s=await this.ffmpeg.readFile("audio.mp3");return new Blob([s.buffer],{type:"audio/mp3"})}static async changeRate({blob:t,ext:e}){await this.ensureLoaded(),console.log("Hellis!",t,e),this.ffmpeg.on("progress",({progress:o,time:a})=>{document.querySelector("#loadingText").textContent=`Timestretching audio using FFmpeg: ${(o*100).toFixed(2)}%`});let s=performance.now();await this.ffmpeg.writeFile(`audio.${e}`,await Go(t)),await Promise.all([this.ffmpeg.exec(["-i",`audio.${e}`,"-c","mp3","-af","atempo=1.5","dt.mp3"]),this.ffmpeg.exec(["-i",`audio.${e}`,"-c","mp3","-af","atempo=0.75","ht.mp3"])]);const[n,r]=await Promise.all([this.ffmpeg.readFile("dt.mp3"),this.ffmpeg.readFile("ht.mp3")]);return console.log("Took: ",performance.now()-s," to render audio"),{dt:new Blob([n.buffer],{type:`audio/${e}`}),ht:new Blob([r.buffer],{type:`audio/${e}`})}}static async transcode({blob:t,ext:e}){if(await this.ensureLoaded(),e==="mp4"||e==="m4v"||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i))return URL.createObjectURL(t);this.ffmpeg.on("progress",({progress:r,time:o})=>{document.querySelector("#loadingText").textContent=`Transcoding video to mp4 using FFmpeg: ${(r*100).toFixed(2)}%`}),await this.ffmpeg.writeFile(`input.${e}`,await Go(t)),JSON.parse(localStorage.getItem("settings")).background.transcodeVideo?await this.ffmpeg.exec(["-i",`input.${e}`,"-preset","ultrafast","-threads","8","output.mp4"]):await this.ffmpeg.exec(["-i",`input.${e}`,"-c","copy","-preset","ultrafast","-threads","8","output.mp4"]);const n=await this.ffmpeg.readFile("output.mp4");return URL.createObjectURL(new Blob([n.buffer],{type:"video/mp4"}))}};S(ls,"ffmpeg",new R1),ls.ffmpeg.on("log",({message:t})=>{console.log(t)}),S(ls,"loader",new P1(async()=>{if(navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i))return;const t="https://unpkg.com/@ffmpeg/core-mt@0.12.6/dist/esm";await ls.ffmpeg.load({coreURL:await jo(`${t}/ffmpeg-core.js`,"text/javascript"),wasmURL:await jo(`${t}/ffmpeg-core.wasm`,"application/wasm"),workerURL:await jo(`${t}/ffmpeg-core.worker.js`,"text/javascript")})}));let vr=ls;const cs=class cs{constructor(t,e){S(this,"isFromFile",!1);S(this,"osuFile");S(this,"mapId");S(this,"audioBlobURL");S(this,"backgroundBlobURL");S(this,"audio");S(this,"audioArrayBuffer");S(this,"audioNode");S(this,"beatmapRenderData");S(this,"hitsoundList",[]);S(this,"title");S(this,"artist");S(this,"diff");S(this,"md5Map");S(this,"isLoaded",!1);S(this,"hasOgg",!1);S(this,"hasVideo",!1);S(this,"hasNonMp4",!1);this.mapId=t,this.isFromFile=e,this.constructMap()}async getOsuFile(){const t=(await Ut.get(`https://preview.tryz.id.vn/api/b/${this.mapId}/osu`)).data;this.md5Map=b1(t).toString(),this.osuFile=t.replaceAll("\r","")}async readBlobAsBuffer(t){return await new Promise(s=>{let n=new FileReader;n.onload=r=>s(n.result),n.readAsArrayBuffer(t)})}static async downloadCustom(t){document.querySelector(".loading").style.display="",document.querySelector(".loading").style.opacity=1,document.querySelector("#loadingText").textContent=`Downloading map.
Might take a while if your internet is slow`;try{return(await Ut.get(`https://preview.tryz.id.vn/download/${t}`,{signal:cs.SIGNALER.signal,responseType:"blob",onDownloadProgress:s=>{document.querySelector("#loadingText").textContent=`Downloading map.
Unknown size (${(isNaN(s.rate)?0:s.rate/1048576).toFixed(2)}MiB/s)
Might take a while if your internet is slow`}})).data}catch(e){throw console.error(e),"Cannot download map from this URL"}finally{document.querySelector(".loading").style.opacity=0,document.querySelector(".loading").style.display="none"}}async downloadOsz(t){try{document.querySelector("#loadingText").textContent=`Downloading map.
Might take a while if your internet is slow`;const s=JSON.parse(localStorage.getItem("settings")).mirror.val,n=document.querySelector("#custom-mirror").value,r={nerinyan:"https://api.nerinyan.moe/d/$setId",sayobot:"https://dl.sayobot.cn/beatmaps/download/$setId",chimu:"https://catboy.best/d/$setId"};if(!r[s]&&n==="")throw"You need a beatmap mirror download link first!";const o=(r[s]??n).replace("$setId",t),l=(await Ut.get(o,{signal:cs.SIGNALER.signal,responseType:"blob",headers:{Accept:"application/x-osu-beatmap-archive"},onDownloadProgress:c=>{document.querySelector("#loadingText").textContent=`Downloading map.
${(c.progress*100).toFixed(2)}% (${(isNaN(c.rate)?0:c.rate/1024**2).toFixed(2)}MiB/s)
Might take a while if your internet is slow`}})).data;return p.DROP_BLOB=l,l}catch(e){throw console.log(e),`This map is not available on the selected beatmap provider
Please open the settings to choose another one.`}}async getOsz(){var I,L,D,N,U,v,P,q,$,et,H,k,F,z,X,j,V;let t;if(!this.isFromFile){if(t=(await Ut.get(`https://preview.tryz.id.vn/api/b/${this.mapId}`)).data,this.artist=t.artist_unicode,this.title=t.title_unicode,this.diff=t.beatmaps.filter(W=>W.id===parseInt(this.mapId))[0].version,document.title=`${this.artist} - ${this.title} [${this.diff}] | JoSu!`,t.beatmaps.filter(W=>W.id===parseInt(this.mapId))[0].mode!=="osu")throw new Error("Not a standard map!");p.INFO.title=t.title,p.INFO.artist=t.artist,p.INFO.difficulty=t.beatmaps.find(W=>W.id==this.mapId).version,p.INFO.mapper=t.creator}const e=t==null?void 0:t.id;e&&!this.isFromFile?B.HREF=`https://osu.ppy.sh/beatmapsets/${e}#osu/${this.mapId}`:B.HREF=null;const s=this.isFromFile?p.DROP_BLOB:await this.downloadOsz(e),n=new zip.BlobReader(s),r=new zip.ZipReader(n),o=await r.getEntries();if(this.isFromFile){const K=await o.filter(Ft=>Ft.filename===p.DIFF_FILE_NAME).at(0).getData(new zip.BlobWriter("text/plain"));this.osuFile=await K.text();const tt=this.osuFile.split(`
`),ct=(D=tt.filter(Ft=>/Artist:.+/g.test(Ft)).at(0))==null?void 0:D.replace("Artist:",""),ht=(N=tt.filter(Ft=>/ArtistUnicode:.+/g.test(Ft)).at(0))==null?void 0:N.replace("ArtistUnicode:",""),pt=(U=tt.filter(Ft=>/Title:.+/g.test(Ft)).at(0))==null?void 0:U.replace("Title:",""),It=(v=tt.filter(Ft=>/TitleUnicode:.+/g.test(Ft)).at(0))==null?void 0:v.replace("TitleUnicode:",""),Ct=(P=tt.filter(Ft=>/Creator:.+/g.test(Ft)).at(0))==null?void 0:P.replace("Creator:",""),Dt=(q=tt.filter(Ft=>/Version:.+/g.test(Ft)).at(0))==null?void 0:q.replace("Version:",""),vt=($=tt.filter(Ft=>/BeatmapID:.+/g.test(Ft)).at(0))==null?void 0:$.replace("BeatmapID:",""),Ht=(et=tt.filter(Ft=>/BeatmapSetID:.+/g.test(Ft)).at(0))==null?void 0:et.replace("BeatmapSetID:","");if(p.INFO.title=pt,p.INFO.artist=ct,p.INFO.difficulty=Dt,p.INFO.mapper=Ct,document.title=`${ht} - ${It} [${Dt}] | JoSu!`,Ht&&vt&&Ht>0&&vt>0){const Ft=window.location.search.replaceAll("?","").replaceAll(/b=[0-9]+/g,"").split("&").filter(Ti=>Ti!=="").join("&");window.history.pushState({},"JoSu!",`${origin}${origin.includes("github.io")?"/beatmap-viewer-web":""}/?b=${vt}${Ft!==""?`&${Ft}`:""}${window.location.hash}`),B.HREF=`https://osu.ppy.sh/beatmapsets/${Ht}#osu/${vt}`}else{const Ft=window.location.search.replaceAll("?","").replaceAll(/b=[0-9]+/g,"");window.history.pushState({},"JoSu!",`${origin}${origin.includes("github.io")?"/beatmap-viewer-web":""}/?${Ft}${window.location.hash}`),B.HREF=null}}else{await this.getOsuFile();const W=document.querySelector(".difficultyList");W.innerHTML="";const K=[];for(const tt of o){if(tt.filename.split(".").at(-1)!=="osu")continue;const ht=await(await tt.getData(new zip.BlobWriter("text/plain"))).text(),pt=(I=ht.split(`
`).filter(Ti=>/Mode:\s[0-9]+/g.test(Ti)).at(0))==null?void 0:I.replace("Mode: ","");if(parseInt(pt)!==0)continue;const It={addStacking:!0,mods:[]},Ct=we.parseBlueprint(ht),Dt=we.buildBeatmap(Ct,It),vt=we.calculateDifficultyAttributes(Dt,!0)[0],Ht=(L=ht.split(`
`).filter(Ti=>/Version:.+/g.test(Ti)).at(0))==null?void 0:L.replace("Version:",""),Ft=wf({name:Ht,fileName:tt.filename,starRating:(vt==null?void 0:vt.starRating)??0});K.push(Ft)}K.sort((tt,ct)=>-tt.starRating+ct.starRating);for(const tt of K)W.appendChild(tt.ele)}const a=["HARD_ROCK","EASY","DOUBLE_TIME","HALF_TIME"],l=[p.MODS.HR,p.MODS.EZ,p.MODS.DT,p.MODS.HT],c={addStacking:!0,mods:a.filter((W,K)=>l[K])},h=we.parseBlueprint(this.osuFile),u=we.buildBeatmap(h,c),d=we.calculateDifficultyAttributes(u,!0)[0];p.STATS.CS=ii(u.difficulty.circleSize),p.STATS.AR=ii(u.difficulty.approachRate),p.STATS.OD=ii(u.difficulty.overallDifficulty),p.STATS.HP=ii(u.difficulty.drainRate),p.STATS.SR=ii((d==null?void 0:d.starRating)??0),p.STATS.srContainer.color=parseInt(pe(al((d==null?void 0:d.starRating)??0)).formatHex().slice(1),16),((d==null?void 0:d.starRating)??0)>=6.5?p.STATS.SRSprite.style.fill=parseInt(pe("hsl(45, 100%, 70%)").formatHex().slice(1),16):p.STATS.SRSprite.style.fill=0,p.STATS.update();const f=parseInt(this.osuFile.split(`
`)[0].slice(-3)),m=this.osuFile.split(`
`).filter(W=>W.match(/AudioFilename: /g))[0];let y;m?y=m.replace("AudioFilename: ","").replace("\r","").replace(`
`,"").trim():y=f<=3&&((H=this.osuFile.split(`
`)[3])==null?void 0:H.trim())||"audio.mp3";const g=((z=(F=(k=this.osuFile.split(`
`).filter(W=>W.match(/0,0,"*.*"/g)).at(0))==null?void 0:k.match(/".*?\.[a-zA-Z0-9]+"/g))==null?void 0:F.at(0))==null?void 0:z.replaceAll('"',""))||null,E=(j=(X=this.osuFile.split(`
`).filter(W=>W.match(/Video,-?[0-9]+,"*.*"/g)).at(0))==null?void 0:X.match(/".*?\.[a-zA-Z0-9]+"/g).at(0))==null?void 0:j.replaceAll('"',""),T=parseInt(((V=this.osuFile.split(`
`).filter(W=>W.match(/Video,-?[0-9]+,"*.*"/g)).at(0))==null?void 0:V.split(",").at(1))??0);console.log(y,g,E??""),document.querySelector("#loadingText").innerHTML="Setting up Audio<br>Might take long if the audio file is large";let _=o.find(W=>W.filename===y);if(!_){const W=[".mp3",".ogg",".wav",".flac"];_=o.find(K=>W.some(tt=>K.filename.toLowerCase().endsWith(tt))),_&&(console.log(`Audio file "${y}" not found, using "${_.filename}" instead`),y=_.filename)}if(!_)throw"This map has no audio file";let b=await _.getData(new zip.BlobWriter(`audio/${y.split(".").at(-1)}`));y.split(".").at(-1)==="ogg"&&(this.hasOgg=!0),this.audioBlobURL=URL.createObjectURL(b);const A=await this.readBlobAsBuffer(b);console.log("Audio Loaded");const C=o.filter(W=>W.filename===g).at(0);if(C){document.querySelector("#loadingText").innerHTML="Setting up Background";const W=await C.getData(new zip.BlobWriter(`image/${g.split(".").at(-1)}`));this.backgroundBlobURL=URL.createObjectURL(W),console.log("Background Loaded"),Lt.src=this.backgroundBlobURL,document.body.style.backgroundImage=`url(${this.backgroundBlobURL})`;const K=new Image;K.src=this.backgroundBlobURL,K.complete?xh(K):K.addEventListener("load",()=>xh(K))}const R=o.filter(W=>W.filename===E).at(0);if(R){const W=E.split(".").at(-1);document.querySelector("#loadingText").innerHTML="Setting up Background Video";const K=await R.getData(new zip.BlobWriter(`video/${W}`));W!=="mp4"?(this.videoBlobURL=await vr.transcode({blob:K,ext:W}),this.hasNonMp4=!0):this.videoBlobURL=URL.createObjectURL(K),console.log(this.videoBlobURL),console.log("Video Loaded"),Lt.videoSrc=this.videoBlobURL,Lt.offset=T,console.log(T)}R&&(this.hasVideo=!0),Lt.switch(p.IS_VIDEO?"VIDEO":"STATIC");const O=o.find(W=>W.filename.split(".").at(-1)==="osb");if(O){document.querySelector("#loadingText").innerHTML="Setting up Storyboard";const K=await(await O.getData(new zip.BlobWriter("text/plain"))).text();await xt.parse(K,this.osuFile,o,g)}const M=o.filter(W=>/(normal|soft|drum)-(hitnormal|hitwhistle|hitclap|hitfinish|slidertick|sliderwhistle|sliderslide)([1-9][0-9]*)?/.test(W.filename)),w=[];document.querySelector("#loadingText").innerHTML="Setting up Hitsounds<br>Might take long if there are many hitsound files";for(const W of M){W.filename.split(".").at(-1)==="ogg"&&(this.hasOgg=!0);const K=new zip.BlobWriter(`audio/${W.filename.split(".").at(-1)}`),tt=await W.getData(K),ct=await this.readBlobAsBuffer(tt);w.push({filename:W.filename,buf:ct})}return this.hitsoundList=w,console.log("Hitsound Loaded"),r.close(),document.querySelector("#loadingText").innerHTML="Setting up HitObjects",console.log("Get .osz completed"),{audioArrayBuffer:A}}async loadHitsounds(){jt.SAMPLES.MAP={};for(const t of this.hitsoundList){const e=t.filename.replace(t.filename.match(/normal|soft|drum/)[0],"").replaceAll(t.filename.match(/hitnormal|hitwhistle|hitfinish|hitclap|slidertick|sliderwhistle|sliderslide/),"").replace("-","").split(".")[0];await q1(t.filename.split(".")[0].replaceAll(`${e}`,""),e===""?1:parseInt(e),t.buf)}}async constructMap(){var t,e;try{if(this.mapId==="2087153")throw"This beatmap should not be loaded under any circumstances. Please provide a different beatmap.";p.WORKER.postMessage({type:"clear"}),p.CONTAINER.removeChildren().forEach(a=>a.destroy()),Y.destruct(),Lt.reset(),xt.reset(),B.CURRENT_MAPID=this.mapId,document.querySelector(".loading").style.display="",document.querySelector(".loading").style.opacity=1;const{audioArrayBuffer:n}=await this.getOsz();if(this.audioNode=new Pr,await this.loadHitsounds(),document.querySelector("#loadingText").textContent="Setting up Audio",await this.audioNode.createBufferNode({base:n}),document.querySelector("#loadingText").textContent="Setting up HitObjects",this.beatmapRenderData=new B(this.osuFile,0),document.querySelector(".loading").style.opacity=0,document.querySelector(".loading").style.display="none",document.querySelector("#loadingText").textContent="Getting map data",document.querySelector("#choose-diff").disabled=!1,document.querySelector("#close").disabled=!1,nt.REPLAY_DATA&&nt.REPLAY_DATA.md5map!==this.md5Map&&nt.reset(),nt.CURSOR_DATA)nt.eval(),document.querySelector("#HD").disabled=!0,document.querySelector("#HR").disabled=!0,document.querySelector("#DT").disabled=!0,document.querySelector("#NC").disabled=!0,document.querySelector("#EZ").disabled=!0,document.querySelector("#HT").disabled=!0,document.querySelector("#DC").disabled=!0,Or([p.MODS.HR,p.MODS.EZ,p.MODS.DT,p.MODS.HT]),Be.updateInfo({username:nt.REPLAY_DATA.player,mods:nt.MODS});else{Be.updateInfo();const l=(oe.get("m")&&/[A-Za-z]+/g.test(oe.get("m"))?oe.get("m").match(/.{2}/g):[]).reduce((u,d)=>["HD","HR","DT","HT","EZ","DC","NC"].includes(d.toUpperCase())?[...u,d.toUpperCase()]:u,[]).map(u=>u.toUpperCase());document.querySelector("#HD").disabled=!1,document.querySelector("#HR").disabled=!1,document.querySelector("#DT").disabled=!1,document.querySelector("#NC").disabled=!1,document.querySelector("#EZ").disabled=!1,document.querySelector("#HT").disabled=!1,document.querySelector("#DC").disabled=!1,p.MODS.HR=l.includes("HR"),p.MODS.DT=l.includes("NC")?!1:l.includes("DT"),p.MODS.NC=l.includes("NC"),p.MODS.HD=l.includes("HD"),p.MODS.EZ=l.includes("EZ"),p.MODS.HT=l.includes("DC")?!1:l.includes("HT"),p.MODS.DC=l.includes("DC");const c=!p.MODS.DT&&!p.MODS.NC?1:1.5,h=!p.MODS.HT&&!p.MODS.DC?1:.75;p.PLAYBACK_RATE=1*c*h,B.updateModdedStats(),document.querySelector("#HD").checked=p.MODS.HD,document.querySelector("#HR").checked=p.MODS.HR,document.querySelector("#DT").checked=p.MODS.DT,document.querySelector("#NC").checked=p.MODS.NC,document.querySelector("#EZ").checked=p.MODS.EZ,document.querySelector("#HT").checked=p.MODS.HT,document.querySelector("#DC").checked=p.MODS.DC,Or([p.MODS.HR,p.MODS.EZ,p.MODS.DT||p.MODS.NC,p.MODS.HT||p.MODS.DC])}p.appResize();const r=tC()==="iOS";this.hasOgg&&r&&(new di({message:"This beatmap contains .ogg files, which are not supported on iOS devices.",autoTimeout:!1,type:"warning"}).notify(),this.hasOgg=!1),this.hasVideo&&r&&(new di({message:"This beatmap contains video, which is not supported on iOS devices.",autoTimeout:!1,type:"warning"}).notify(),this.hasVideo=!1);const o=JSON.parse(localStorage.getItem("settings"));this.hasNonMp4&&!o.background.transcodeVideo&&(new di({message:'Check "Transcode Video" in settings if you have playback issues. (might take longer to load)',autoTimeout:!1,type:"warning"}).notify(),this.hasNonMp4=!1),document.onkeydown=a=>{switch(a=a||window.event,a.key){case"ArrowLeft":Cs(a.shiftKey,!1);break;case"ArrowRight":Cs(a.shiftKey,!0);break;case" ":document.querySelector(".difficultySelector").style.display!=="block"&&document.activeElement!==document.querySelector("#jumpToTime")&&bf();break}if(a.key==="c"&&a.ctrlKey&&p.SELECTED.length){const l=this.beatmapRenderData.objectsController.objectsList.filter(f=>p.SELECTED.includes(f.obj.time)),c=l.reduce((f,m)=>f.obj.time>m.obj.time?m:f),h=Math.floor(c.obj.time%1e3).toString().padStart(3,"0"),u=Math.floor(c.obj.time/1e3%60).toString().padStart(2,"0"),d=Math.floor(c.obj.time/1e3/60).toString().padStart(2,"0");navigator.clipboard.writeText(`${d}:${u}:${h} (${l.map(f=>f.obj.comboIdx).join(",")}) - `),new di({message:"Object(s) timestamp copied"}).notify()}if(a.key==="a"&&a.ctrlKey){if(document.activeElement===document.querySelector("#jumpToTime")||document.activeElement===document.querySelector("#mapInput"))return;a.preventDefault(),p.SELECTED=this.beatmapRenderData.objectsController.objectsList.filter(l=>!(l.obj instanceof Ie)).map(l=>l.obj.time)}if(a.key==="Escape"){if(document.querySelector(".seekTo").open&&Jr(),document.querySelector("#settingsPanel").style.opacity==="1"){nl();return}if(p.SHOW_METADATA){Xr();return}if(p.SHOW_TIMING_PANEL){yn();return}p.SELECTED=[]}},oe.get("b")===B.CURRENT_MAPID&&oe.get("t")&&/[0-9]+/g.test(oe.get("t"))&&((e=(t=p.BEATMAP_FILE)==null?void 0:t.audioNode)==null||e.seekTo(parseInt(oe.get("t")))),this.isLoaded=!0}catch(s){new di({message:s,autoTimeout:!1,type:"error"}).notify(),console.error(s),document.querySelector(".loading").style.opacity=0,document.querySelector(".loading").style.display="none",p.BEATMAP_FILE=void 0}}};S(cs,"CURRENT_MAPID"),S(cs,"SIGNALER",new AbortController);let Zi=cs;function L1(i){return new Worker("/dist/assets/AudioWorker-C9w2WVtH.js",{name:i==null?void 0:i.name})}const Ai=class Ai{constructor(){S(this,"raw_buf");S(this,"buf");S(this,"dt_buf");S(this,"ht_buf");S(this,"src");S(this,"currentTime",1);S(this,"startTime",0);S(this,"absStartTime",0);S(this,"isPlaying",!1);S(this,"isLoaded",!1);Ai.SOFT_OFFSET=JSON.parse(localStorage.getItem("settings")).mapping.offset}stretchAudio(t,e){const s=new L1;return new Promise(n=>{s.postMessage({data:t,stretchFactor:e,rate:p.AUDIO_CTX.sampleRate}),s.onmessage=({data:r})=>{n(r.data)}})}async createBufferNode({base:t,dt:e,ht:s}){this.raw_buf=t;const n=await p.AUDIO_CTX.decodeAudioData(t);await p.AUDIO_CTX.audioWorklet.addModule("./lib/phase-vocoder.min.js"),this.phazeNode=new AudioWorkletNode(p.AUDIO_CTX,"phase-vocoder-processor"),this.raw_buf=n,this.buf=n,oe.get("b")&&oe.get("t")&&oe.get("b")===Zi.CURRENT_MAPID&&this.seekTo(parseInt(oe.get("t"))),this.gainNode=p.AUDIO_CTX.createGain(),this.isLoaded=!0}seekTo(t){if(t!==0&&!t||this.buf===void 0||t>this.raw_buf.duration*1e3)return;const e=this.isPlaying;this.isPlaying&&this.pause(),this.currentTime=t,p.WORKER.postMessage({type:"seek",time:t}),xt.WORKER.postMessage({type:"seek",time:t}),Lt.seekTo(t),e&&this.play()}play(t){if(!this.isPlaying&&this.gainNode){this.src=p.AUDIO_CTX.createBufferSource(),this.gainNode.gain.value=p.MUSIC_VOL*p.MASTER_VOL*(p.PLAYBACK_RATE!==1&&(p.MODS.DT||p.MODS.HT)?3:1);const e=this.buf;if((p.MODS.NC||p.MODS.DC||p.MODS.HT||p.MODS.DT)&&(this.src.playbackRate.value=p.PLAYBACK_RATE),this.src.buffer=e,this.src.onended=()=>{this.getCurrentTime()>=this.raw_buf.duration*1e3&&(console.log("Ended"),this.pause(),this.seekTo(0),se.playButton.sprite.texture=se.playButton.texture)},p.MODS.HT||p.MODS.DT){let s=this.phazeNode.parameters.get("pitchFactor");s.value=1/p.PLAYBACK_RATE,this.src.connect(this.phazeNode),this.phazeNode.connect(this.gainNode)}else this.src.connect(this.gainNode);this.gainNode.connect(p.AUDIO_CTX.destination),this.startTime=p.AUDIO_CTX.currentTime*1e3,this.absStartTime=performance.now(),this.src.start(p.AUDIO_CTX.currentTime-(Ai.SOFT_OFFSET<0?Ai.SOFT_OFFSET/1e3:0),this.currentTime/1e3+(Ai.SOFT_OFFSET>=0?Ai.SOFT_OFFSET/1e3:0)),p.WORKER.postMessage({type:"start"}),xt.WORKER.postMessage({type:"start"}),Lt.playVideo(this.currentTime),this.isPlaying=!0}}pause(){this.isPlaying&&(p.WORKER.postMessage({type:"stop"}),xt.WORKER.postMessage({type:"stop"}),this.src.stop(),this.src.disconnect(),this.gainNode.disconnect(),this.currentTime+=(performance.now()-this.absStartTime)*p.PLAYBACK_RATE,Lt.pauseVideo(this.currentTime),this.isPlaying=!1)}getCurrentTime(){if(!this.isPlaying)return this.currentTime;const t=performance.now()-this.absStartTime-(p.AUDIO_CTX.currentTime*1e3-this.startTime);return t>20&&(this.pause(),this.play(),console.log(`Shifted ${t}`)),this.currentTime+(performance.now()-this.absStartTime)*p.PLAYBACK_RATE}get duration(){var t;return((t=this.raw_buf)==null?void 0:t.duration)*1e3}};S(Ai,"SOFT_OFFSET",0);let Pr=Ai;const He=class He{constructor(t,e){S(this,"audioObj");S(this,"sliderHead",!1);S(this,"sliderTail",!1);S(this,"vol",1);S(this,"isPlaying",!1);S(this,"srcs",[]);S(this,"gainNode");S(this,"currentTimeout");this.audioObj=t,this.vol=e??1}play(t){p.IS_SEEKING||!p.SHOULD_PLAY_HITSOUND||(this.srcs=[],this.audioObj.forEach(e=>{const s=p.AUDIO_CTX.createBufferSource(),n=p.AUDIO_CTX.createGain();if(this.gainNode=n,n.gain.value=this.vol,He.SAMPLES.MAP[e]&&!p.DISABLE_BMHS)s.buffer=He.SAMPLES.MAP[e];else{const r=at.SKIN_ENUM[p.SKINNING.type],o=r!=="CUSTOM"||!He.SAMPLES.CUSTOM[at.SKIN_IDX]?He.SAMPLES[r]:He.SAMPLES.CUSTOM[at.SKIN_IDX];s.buffer=o[e.replaceAll(/\d/g,"")]}s.connect(n),n.connect(He.masterGainNode),s.start(),s.onended=()=>{s.disconnect(),n.disconnect()},this.isPlaying=!0,t&&(s.loop=!0),this.srcs.push(s)}))}playLoop(t,e,s){this.gainNode&&(this.gainNode.gain.value=Si.CURRENT_SV.sampleVol/100),t&&e&&!this.isPlaying&&p.BEATMAP_FILE.audioNode.isPlaying&&(clearTimeout(this.currentTimeout),this.play(!0),this.currentTimeout=setTimeout(()=>{this.srcs.forEach(n=>{n.stop(),n.disconnect()}),this.isPlaying=!1},s??0)),this.isPlaying&&(!t||!e||!p.BEATMAP_FILE.audioNode.isPlaying)&&(this.srcs.forEach(n=>{n.stop(),n.disconnect()}),this.isPlaying=!1)}};S(He,"masterGainNode"),S(He,"SAMPLES",{ARGON:{},LEGACY:{},CUSTOM:{},MAP:{}}),S(He,"DEFAULT_SAMPLES",{ARGON:{},LEGACY:{}});let jt=He;const it=class it{static async changeSkin(){if(p.SKINNING.type!=="4"){it.DEFAULT_COLORS=[16760832,51712,1211647,15865913],it.HIT_CIRCLE_PREFIX="default",it.SLIDER_BORDER=null,it.SLIDER_TRACK_OVERRIDE=null,document.querySelector(".skinSelector").textContent=it.SKIN_NAME[p.SKINNING.type];return}if(!it.SKIN_LIST[it.SKIN_IDX]){p.SKINNING.type="2",it.SKIN_IDX=-1,it.DEFAULT_COLORS=[16760832,51712,1211647,15865913],it.HIT_CIRCLE_PREFIX="default",it.SLIDER_BORDER=null,it.SLIDER_TRACK_OVERRIDE=null,document.querySelector(".skinSelector").textContent="Legacy";return}it.SLIDER_BORDER=it.SKIN_LIST[it.SKIN_IDX].ini.SLIDER_BORDER,it.SLIDER_TRACK_OVERRIDE=it.SKIN_LIST[it.SKIN_IDX].ini.SLIDER_TRACK_OVERRIDE,it.HIT_CIRCLE_PREFIX=it.SKIN_LIST[it.SKIN_IDX].ini.HIT_CIRCLE_PREFIX,it.DEFAULT_COLORS=it.SKIN_LIST[it.SKIN_IDX].ini.DEFAULT_COLORS,document.querySelector(".skinSelector").textContent=it.SKIN_LIST[it.SKIN_IDX].ini.NAME}static async getBase64(t,e){const s=t.find(r=>r.filename===`${e}@2x.png`)??t.find(r=>r.filename===`${e}.png`)??null;return s?{base64:await s.getData(new zip.Data64URIWriter("image/png")),isHD:s.filename.includes("@2x")}:{}}static async readSkinIni(t){var d,f,m,y;const r=(await(await t.find(g=>g.filename.toLowerCase()==="skin.ini").getData(new zip.BlobWriter("text/plain"))).text()).split(`
`).map(g=>g.trim()).filter(g=>!/^(\/\/|\#|\;).*/g.test(g)),o=r.find(g=>g.includes("Name: ")).trim().replace("Name: ",""),a=(d=r.find(g=>g.includes("SliderBorder:")))==null?void 0:d.replaceAll(" ","").match(/[0-9]{0,3},[0-9]{0,3},[0-9]{0,3}/g).at(0).split(",").map(g=>g/255).concat([1]),l=(f=r.find(g=>/^SliderTrackOverride\s*:/.test(g)))==null?void 0:f.replaceAll(" ","").match(/[0-9]{0,3},[0-9]{0,3},[0-9]{0,3}/g).at(0).split(",").map(g=>g/255).concat([1]),c=parseInt(((m=r.find(g=>g.includes("HitCircleOverlap:")))==null?void 0:m.replaceAll(" ","").match(/[0-9]+/g).at(0))??"0"),h=(y=r.find(g=>g.includes("HitCirclePrefix:")))==null?void 0:y.replaceAll(" ","").replaceAll("HitCirclePrefix:","").replaceAll("\r","");let u=r.filter(g=>/Combo[0-9]+:/g.test(g.replaceAll(" ","").replaceAll("\r"))&&g.replaceAll(" ","").slice(0,2)!=="//"&&g.replaceAll(" ","")[0]!==";"&&g.replaceAll(" ","")[0]!=="#").map(g=>`rgb(${g.replaceAll(" ","").replaceAll("\r","").replaceAll(/Combo[0-9]+:/g,"")})`).map(g=>parseInt(g.replaceAll("\r","").replaceAll("rgb(","").replaceAll(")","").split(",").map(E=>parseInt(E).toString(16).padStart(2,"0")).join(""),16));return u.length===0&&(u=[16760832,51712,1211647,15865913]),it.SLIDER_BORDER=a??null,it.SLIDER_TRACK_OVERRIDE=l??null,it.HIT_CIRCLE_OVERLAP=c??0,it.HIT_CIRCLE_PREFIX=h??"default",it.DEFAULT_COLORS=u,{NAME:o,SLIDER_BORDER:a??null,SLIDER_TRACK_OVERRIDE:l??null,HIT_CIRCLE_OVERLAP:c,HIT_CIRCLE_PREFIX:h??"default",DEFAULT_COLORS:u}}static async getHitsounds(t){const e=t.filter(n=>/^(normal|soft|drum)-(hitnormal|hitwhistle|hitclap|hitfinish|slidertick|sliderwhistle|sliderslide)([1-9][0-9]*)?/.test(n.filename)),s=[];for(const n of e){const r=new zip.BlobWriter(`audio/${n.filename.split(".").at(-1)}`),o=await n.getData(r),a=await it.readBlobAsBuffer(o);s.push({filename:n.filename,buf:a,blob:o})}return s}static async loadHitsounds(t,e){jt.SAMPLES.CUSTOM[e]||(jt.SAMPLES.CUSTOM[e]={});for(const s of["normal","soft","drum"])for(const n of["hitnormal","hitwhistle","hitclap","hitfinish","slidertick","sliderwhistle","sliderslide"]){const r=`${s}-${n}`,o=t.find(a=>a.filename.split(".")[0]===r);if(!o){jt.SAMPLES.CUSTOM[e][r]=jt.DEFAULT_SAMPLES.LEGACY[r];continue}try{const a=await p.AUDIO_CTX.decodeAudioData(o.buf);jt.SAMPLES.CUSTOM[e][r]=a}catch{continue}}}static async readBlobAsBuffer(t){return await new Promise(s=>{let n=new FileReader;n.onload=r=>s(n.result),n.readAsArrayBuffer(t)})}static async getAllBase64s(t){const e=await it.getBase64(t,"hitcircle"),s=await it.getBase64(t,"hitcircleoverlay");let n=await it.getBase64(t,"sliderb0");const r=await it.getBase64(t,"sliderfollowcircle"),o=await it.getBase64(t,"reversearrow"),a=await it.getBase64(t,"approachcircle");let l=[...Array(10)].fill(null,0,10);n.base64||(n=await it.getBase64(t,"sliderb"));for(let c=0;c<10;c++)l[c]=await it.getBase64(t,`${it.HIT_CIRCLE_PREFIX}-${c}`)??{};return{HIT_CIRCLE:e,HIT_CIRCLE_OVERLAY:s,SLIDER_B:n,SLIDER_FOLLOW_CIRCLE:r,REVERSE_ARROW:o,APPROACH_CIRCLE:a,DEFAULTS:l}}static async import(t){it.SLIDER_BORDER=null,it.SLIDER_TRACK_OVERRIDE=null,it.HIT_CIRCLE_OVERLAP=0;const e=new zip.BlobReader(t),s=new zip.ZipReader(e),n=await s.getEntries(),r=await it.readSkinIni(n),o=await it.getHitsounds(n),a=await it.getAllBase64s(n),l={ini:r,samples:o,base64s:a};await qt.addToObjStore(l);const c=(await qt.getAllKeys()).at(-1);for(const h of["HIT_CIRCLE","HIT_CIRCLE_OVERLAY","SLIDER_B","REVERSE_ARROW","DEFAULTS","SLIDER_FOLLOW_CIRCLE","APPROACH_CIRCLE"]){if(!a[h])continue;if(h==="DEFAULTS"){await st.updateNumberTextures(a[h],c);continue}const{base64:u,isHD:d}=a[h];await st.updateTextureFor(h,u,d,c)}await it.loadHitsounds(o,c),await ol(),it.SKIN_IDX=c,p.SKINNING.type="4",it.changeSkin(),s.close(),new di({message:`${l.ini.NAME} imported`}).notify()}};S(it,"HIT_CIRCLE",null),S(it,"HIT_CIRCLE_OVERLAY",null),S(it,"SLIDER_B",null),S(it,"SLIDER_FOLLOW_CIRCLE",null),S(it,"REVERSE_ARROW",null),S(it,"APPROACH_CIRCLE",null),S(it,"DEFAULTS",[...Array(10)].fill(null,0,10)),S(it,"SLIDER_BORDER",null),S(it,"SLIDER_TRACK_OVERRIDE",null),S(it,"HIT_CIRCLE_OVERLAP",0),S(it,"HIT_CIRCLE_OVERLAP_ARGON",20),S(it,"HIT_CIRCLE_PREFIX","default"),S(it,"DEFAULT_COLORS",[16760832,51712,1211647,15865913]),S(it,"SKIN_ENUM",{ARGON:"0",TINTED:"1",LEGACY:"2",TRIANGLES:"3",CUSTOM:"4",0:"ARGON",1:"LEGACY",2:"LEGACY",3:"LEGACY",4:"CUSTOM"}),S(it,"SKIN_NAME",{0:"Argon",1:"Tinted Legacy",2:"Legacy",3:"Triangles",4:""}),S(it,"SKIN_IDX",-1),S(it,"SKIN_LIST",[]);let at=it;class N1{constructor(t){S(this,"obj");S(this,"hitCircle");var s,n;this.hitCircle=t;const e=new Mt(st.ARGON.APPROACH_CIRCLE.texture);e.anchor.set(.5),e.zIndex=((n=(s=p.BEATMAP_FILE)==null?void 0:s.audioNode)==null?void 0:n.raw_buf.duration)*1e3+1,this.obj=e}draw(t){const e=at.SKIN_ENUM[p.SKINNING.type],s=e!=="CUSTOM"?st[e]:st.CUSTOM[at.SKIN_IDX],n=s.APPROACH_CIRCLE.isHD?.5:1;this.obj.texture=s.APPROACH_CIRCLE.texture;const r=p.SLIDER_APPEARANCE.ignoreSkin?at.DEFAULT_COLORS:B.COLORS,o=p.SLIDER_APPEARANCE.ignoreSkin?this.hitCircle.colourIdx:this.hitCircle.colourHaxedIdx;this.obj.tint=r[o%r.length];let a=1;if(t<=this.hitCircle.time){const d=(t-(this.hitCircle.time-B.moddedStats.preempt))/B.moddedStats.preempt;a=Math.max(-3*Math.min(d,1)+4,1)}const l=this.hitCircle.originalX,c=p.MODS.HR?384-this.hitCircle.originalY:this.hitCircle.originalY,h=this.hitCircle.stackHeight*B.moddedStats.stackOffset;this.obj.x=(l+h)*p.SCALE_RATE,this.obj.y=(c+h)*p.SCALE_RATE;const u=B.moddedStats.radius/54.4;this.obj.scale.set(n*a*p.SCALE_RATE*u*(e==="ARGON"?.94:(236/256)**2)),this.obj.alpha=this.hitCircle.opacity,(p.MODS.HD||t>this.hitCircle.time)&&(this.obj.alpha=0)}}class Ef{constructor(t){S(this,"obj");S(this,"hitObject");S(this,"number",0);S(this,"sprites",[]);this.hitObject=t,this.obj=new ut}draw(t){this.number!==this.hitObject.comboIdx&&(this.obj.removeChildren().forEach(n=>n.destroy()),this.sprites.length=0,this.number=this.hitObject.comboIdx??0,this.number.toString().split("").forEach((n,r)=>{const o=new Mt;o.anchor.set(.5),this.sprites.push(o),this.obj.addChild(o)}));let e=null;this.number.toString().split("").forEach((s,n)=>{const r=at.SKIN_ENUM[p.SKINNING.type],o=r!=="CUSTOM"?st[r]:st.CUSTOM[at.SKIN_IDX],a=this.sprites[n];if(a.texture=o.DEFAULTS[s].texture,a.scale.set(o.DEFAULTS[s].isHD?.5*.8:.8),e){const l=r==="ARGON"?at.HIT_CIRCLE_OVERLAP_ARGON:r==="LEGACY"?at.HIT_CIRCLE_OVERLAP:at.SKIN_LIST[at.SKIN_IDX].ini.HIT_CIRCLE_OVERLAP;a.x=e.x+e.width/2+a.width/2-l*.8}e=a}),this.obj.alpha=1,this.obj.x=-e.x/2,t>this.hitObject.hitTime+1&&p.SLIDER_APPEARANCE.hitAnim&&(this.obj.alpha=0)}}class Pe{constructor(t,e,s,n){S(this,"startTime");S(this,"hitTime");S(this,"endTime");S(this,"killTime");S(this,"positionX");S(this,"positionY");S(this,"endX");S(this,"endY");S(this,"originalX");S(this,"originalY");S(this,"stackHeight",0);S(this,"time");S(this,"obj");S(this,"selected");S(this,"judgementObj");S(this,"hitCircleSprite");S(this,"hitCircleOverlaySprite");S(this,"number");S(this,"approachCircleObj");S(this,"comboIdx",1);S(this,"colourIdx",1);S(this,"colourHaxedIdx",1);S(this,"opacity",0);S(this,"hitSounds");S(this,"skinIdx",0);S(this,"skinType",0);S(this,"props",{color:null,opacity:null,glowOpacity:null,glowScale:null,blendMode:null,expand:null,x:null,y:null});S(this,"judgementContainer");S(this,"judgement");S(this,"isHit",!1);this.originalX=parseInt(t),this.originalY=parseInt(e),this.startPosition={x:this.originalX,y:this.originalY},this.endPosition={x:this.originalX,y:this.originalY},this.time=s,this.endTime=s,this.hitTime=s,this.startTime=s-B.stats.preempt,this.killTime=s+240;const r=new Mt(p.SKINNING.type==="0"?st.SELECTED_ARGON.texture:st.SELECTED.texture);r.anchor.set(.5),r.scale.set(p.SKINNING.type==="0"?1:.5),this.selected=r;const o=new Mt(st.ARGON.HIT_CIRCLE_OVERLAY.texture);o.anchor.set(.5),o.scale.set(st.ARGON.HIT_CIRCLE_OVERLAY.isHD?.5:1),this.hitCircleOverlaySprite=o;const a=new Mt(st.ARGON.HIT_CIRCLE.texture);a.anchor.set(.5),a.scale.set(st.ARGON.HIT_CIRCLE.isHD?.5:1),this.hitCircleSprite=a,this.number=new Ef(this),this.judgementContainer=new ut;const l=new ut;l.addChild(a),l.addChild(o),l.addChild(this.number.obj),this.hitCircleContainer=l;const c=new ut;c.addChild(this.judgementContainer),c.addChild(this.hitCircleContainer),this.approachCircleObj=new N1(this),this.obj=c,this.obj.label=`${Math.round(this.time)}-HITCIRCLE`,this.hitSounds=n}drawSelected(){const t=B.moddedStats.radius/54.4,e=this.stackHeight,s=B.moddedStats.stackOffset,n=this.originalX+e*s,r=p.MODS.HR?384-this.originalY+e*s:this.originalY+e*s;this.selected.x=n*p.SCALE_RATE,this.selected.y=r*p.SCALE_RATE,this.selected.scale.set(t*p.SCALE_RATE*(236/256)**2*(this.skinType==="0"?1:.5))}playHitsound(t,e){if(!this.hitSounds||!p.BEATMAP_FILE.audioNode.isPlaying||!t||!e||t<this.hitTime||e>=this.hitTime||this.judgement&&this.judgement.val===0)return;if(!nt.REPLAY_DATA){this.hitSounds.play();return}Qi(nt.EVAL_LIST,this.time,(n,r)=>n.time<r?-1:n.time>r?1:0)!==-1&&this.hitSounds.play()}handleSkinChange(){if(this.skinIdx===at.SKIN_IDX&&this.skinType===p.SKINNING.type)return;this.skinIdx=at.SKIN_IDX,this.skinType=p.SKINNING.type;const t=at.SKIN_ENUM[this.skinType],e=t!=="CUSTOM"?st[t]:st.CUSTOM[this.skinIdx];this.hitCircleSprite.texture=e.HIT_CIRCLE.texture,this.hitCircleSprite.scale.set(e.HIT_CIRCLE.isHD?.5:1),this.hitCircleOverlaySprite.texture=e.HIT_CIRCLE_OVERLAY.texture,this.hitCircleOverlaySprite.scale.set(e.HIT_CIRCLE_OVERLAY.isHD?.5:1),this.selected.texture=p.SKINNING.type==="0"?st.SELECTED_ARGON.texture:st.SELECTED.texture,this.skinType!=="0"?this.hitCircleSprite.alpha=.9:this.hitCircleSprite.alpha=1}updateColor(t){const e=p.SLIDER_APPEARANCE.ignoreSkin?at.DEFAULT_COLORS:B.COLORS,s=p.SLIDER_APPEARANCE.ignoreSkin?this.colourIdx:this.colourHaxedIdx;let n=e[s%e.length];this.skinType==="1"&&(n=parseInt(pe(`#${n.toString(16).padStart(6,"0")}`).darker().hex().slice(1),16)),this.skinType==="0"&&t>this.hitTime&&(n=parseInt(pe(`#${n.toString(16).padStart(6,"0")}`).brighter(1).hex().slice(1),16)),!p.SLIDER_APPEARANCE.hitAnim&&t>this.hitTime&&(n=16777215),this.props.color!==n&&(this.props.color=n,this.hitCircleSprite.tint=this.props.color)}updateOpacity(t){const e=B.moddedStats.preempt,s=B.moddedStats.fadeIn,n=p.SLIDER_APPEARANCE.hitAnim?240:800;let r=0;p.MODS.HD?t<this.time-e+s?r=(t-(this.time-e))/s:r=1-(t-(this.time-e+s))/(e*.3):t<this.hitTime?r=(t-(this.time-e))/s:this.skinType!=="0"||this.skinType==="0"&&!p.SLIDER_APPEARANCE.hitAnim?r=1-(t-this.hitTime)/n:r=1-bi((t-this.hitTime)/800),r=ot(r,0,1),this.opacity=r,this.hitTime>this.killTime&&t>this.killTime-50&&(r=ot((this.killTime-t)/50,0,r)),r!==this.props.opacity&&(this.props.opacity=r,this.hitCircleContainer.alpha=this.props.opacity)}updateExpand(t){const e=B.moddedStats.radius/54.4*(this.skinType==="0"?.95:1);let s=1;this.skinType!=="0"?(p.SLIDER_APPEARANCE.hitAnim&&t>this.hitTime&&(s=.5*ot((t-this.hitTime)/240,0,1)+1),s=Math.max(s,1)):p.SLIDER_APPEARANCE.hitAnim&&t>this.hitTime&&(s=1-.2*ts(ot((t-this.hitTime)/400,0,1)));const n=s*e*p.SCALE_RATE*(236/256)**2;this.props.expand!==n&&(this.props.expand=n,this.hitCircleContainer.scale.set(this.props.expand))}updatePosition(){const t=this.stackHeight,e=B.moddedStats.stackOffset,s=(this.originalX+t*e)*p.SCALE_RATE,n=(p.MODS.HR?384-this.originalY+t*e:this.originalY+t*e)*p.SCALE_RATE;this.props.x!==s&&(this.props.x=s,this.obj.x=s),this.props.y!==n&&(this.props.y=n,this.obj.y=n)}updateJudgement(t){this.judgement&&this.judgement.draw(t)}updateSprite(t){let e=1,s=1;if(t>this.hitTime&&this.skinType==="0"&&p.SLIDER_APPEARANCE.hitAnim&&(e=1-ot((t-this.hitTime)/400,0,1)),this.props.glowOpacity!==e&&(this.props.glowOpacity=e,this.hitCircleSprite.alpha=this.props.glowOpacity),this.skinType!=="0"||!p.SLIDER_APPEARANCE.hitAnim){let r=this.props.blendMode;if(r="normal",this.props.blendMode!==r&&(this.props.blendMode=r,this.hitCircleSprite.blendMode=this.props.blendMode),this.props.glowScale!==s){const o=at.SKIN_ENUM[this.skinType],a=o!=="CUSTOM"?st[o]:st.CUSTOM[this.skinIdx];this.props.glowScale=s,this.hitCircleSprite.scale.set(this.props.glowScale*(a.HIT_CIRCLE.isHD?.5:1))}return}if(t<=this.hitTime?s=1:s=1-.1*ts(ot((t-this.hitTime)/400,0,1)),this.props.glowScale!==s&&(this.props.glowScale=s,this.hitCircleSprite.scale.set(this.props.glowScale)),this.isHit===t>this.hitTime)return;this.isHit=t>this.hitTime;let n=this.props.blendMode;this.isHit||(this.hitCircleSprite.texture=st.ARGON.HIT_CIRCLE.texture,n="normal"),this.isHit&&(this.hitCircleSprite.texture=st.ARGON.GLOW.texture,n="add"),this.props.blendMode!==n&&(this.props.blendMode=n,this.hitCircleSprite.blendMode=this.props.blendMode)}draw(t){this.handleSkinChange(),this.updateSprite(t),this.updateColor(t),this.updateOpacity(t),this.updateExpand(t),this.updatePosition(),this.updateJudgement(t),this.number.draw(t),this.approachCircleObj.draw(t)}eval(t){var c,h;const e=B.moddedStats.radius,s=nt.CURSOR_DATA[t];if(!s||s.time-this.time<=-B.hitWindows.MEH)return null;if(s.time-this.time>=B.hitWindows.MEH)return{val:0,valV2:0};if(((c=nt.EVAL_LIST.at(-1))==null?void 0:c.eval)===0&&Math.abs(s.time-(((h=nt.EVAL_LIST.at(-1))==null?void 0:h.time)??s.time))<B.hitWindows.MEH)return null;const n=nt.CURSOR_DATA[t-1];if(s.inputArray.length===0||n.inputArray.length>s.inputArray.length||n.inputArray.length===s.inputArray.length&&JSON.stringify(n.inputArray)===JSON.stringify(s.inputArray))return null;const r=B.moddedStats.stackOffset,o={x:this.stackHeight*r,y:this.stackHeight*r};if(Ue(Qs(s,p.MODS.HR?Dr(Oa({x:this.originalX,y:this.originalY}),o):Dr({x:this.originalX,y:this.originalY},o))/e,2)>1)return this.hitTime=this.killTime,this.killTime=this.time+B.hitWindows.MEH,null;let a=0;const l=Math.abs(s.time-this.time);return l<B.hitWindows.GREAT&&(a=300),l>=B.hitWindows.GREAT&&l<B.hitWindows.OK&&(a=100),l>=B.hitWindows.OK&&l<B.hitWindows.MEH&&(a=50),a!==0&&(this.hitTime=s.time,this.endTime=this.hitTime,this.killTime=this.endTime+240),{val:a,valV2:a,delta:s.time-this.time,inputTime:s.time}}}const Lr={fps:0,deltaMS:0};class _f{constructor(t){S(this,"_renderer");S(this,"_renderStart",0);S(this,"_lastFrame",0);S(this,"_fpsQueue",[]);S(this,"_msQueue",[]);this._renderer=t}init(){this._renderer.runners.prerender.add(this),this._renderer.runners.postrender.add(this)}destroy(){this._renderer.runners.prerender.remove(this),this._renderer.runners.postrender.remove(this)}prerender(){this._renderStart=performance.now();const t=1e3/(this._renderStart-this._lastFrame);for(this._fpsQueue.push(t);this._fpsQueue.length>100;)this._fpsQueue.shift();Lr.fps=this._fpsQueue.reduce((e,s,n)=>e+s*((n+1)/this._fpsQueue.length),0)/((1/this._fpsQueue.length+1)*(this._fpsQueue.length/2)),this._lastFrame=this._renderStart,p.INIT&&(Si.render(),gT())}postrender(){const t=performance.now()-this._renderStart;for(this._msQueue.push(t);this._msQueue.length>100;)this._msQueue.shift();Lr.deltaMS=this._msQueue.reduce((e,s,n)=>e+s*((n+1)/this._msQueue.length),0)/((1/this._msQueue.length+1)*(this._msQueue.length/2))}}S(_f,"extension",{type:[lt.WebGLSystem,lt.WebGPUSystem],name:"fps"});ne.add(_f);new TextEncoder;const te=class te{constructor(t,e,s){S(this,"hitCirclesList");S(this,"slidersList");S(this,"objectsList");S(this,"judgementList",[]);S(this,"drawTime");S(this,"coloursList");S(this,"breakPeriods");S(this,"currentColor");S(this,"coloursObject");S(this,"lastTimestamp",0);S(this,"lastTime",0);S(this,"tempW",p.WIDTH);S(this,"tempH",p.HEIGHT);S(this,"filtered",[]);S(this,"selected",[]);S(this,"addTop",[]);S(this,"addBack",[]);S(this,"removed",[]);S(this,"addedFp",[]);S(this,"fpBoundary",[]);S(this,"removedFp",[]);S(this,"_in",[]);this.objectsList=t.sort(this.compare),this.hitCirclesList=t.filter(n=>n.obj instanceof Pe||n.obj instanceof Ie),this.slidersList=t.filter(n=>n.obj instanceof Qt),this.breakPeriods=s}compare(t,e){return t.obj.time<e.obj.time?-1:t.obj.time>e.obj.time?1:0}updateOrder(){this.removed.forEach(t=>{p.CONTAINER.removeChild(this.objectsList[t.idx].obj.obj),this.objectsList[t.idx].obj.approachCircleObj&&p.CONTAINER.removeChild(this.objectsList[t.idx].obj.approachCircleObj.obj)}),this.addBack.forEach(t=>{p.CONTAINER.addChildAt(this.objectsList[t.idx].obj.obj,0),this.objectsList[t.idx].obj.approachCircleObj&&p.CONTAINER.addChild(this.objectsList[t.idx].obj.approachCircleObj.obj)}),this.addTop.forEach(t=>{p.CONTAINER.addChild(this.objectsList[t.idx].obj.obj),this.objectsList[t.idx].obj.approachCircleObj&&p.CONTAINER.addChild(this.objectsList[t.idx].obj.approachCircleObj.obj)}),this.addedFp.forEach(t=>{this.objectsList[t.idx].obj.followPoint&&p.CONTAINER.addChild(this.objectsList[t.idx].obj.followPoint.container)}),this.removedFp.forEach(t=>{this.objectsList[t.idx].obj.followPoint&&p.CONTAINER.removeChild(this.objectsList[t.idx].obj.followPoint.container)})}playHitsounds(t,e){Pt.IS_DRAGGING||this.filtered.forEach(s=>{this.objectsList[s.idx].obj.playHitsound(t,e),this.objectsList[s.idx].obj instanceof Qt&&(this.objectsList[s.idx].obj.ticks.forEach(n=>n.playHitsound(t,e)),this.objectsList[s.idx].obj.revArrows.forEach(n=>n.playHitsound(t,e)))})}draw(t,e){var a;t>p.BEATMAP_FILE.audioNode.duration&&p.BEATMAP_FILE.audioNode.pause(),p.DID_MOVE&&p.CURRENT_X!==-1&&p.CURRENT_Y!==-1&&(p.DRAGGING_END=p.BEATMAP_FILE.audioNode.getCurrentTime(),Ia(!1));const s=B.findNearestTimingPoint(t,"timingPointsList",!0),n=B.findNearestTimingPoint(t,"beatStepsList",!0),r=B.findNearestTimingPoint(t,"mergedPoints",!0);r.isKiai!==ae.IS_KIAI&&(ae.IS_KIAI=r.isKiai),JSON.stringify(te.CURRENT_BPM)!==JSON.stringify(n)&&(ae.BPM_TEXT.text=`${Ue(6e4/n.beatstep,2)}BPM`,te.CURRENT_BPM=n,ae.IS_KIAI=r.isKiai),JSON.stringify(s)!==JSON.stringify(te.CURRENT_SV)&&(((a=te.CURRENT_SV)==null?void 0:a.svMultiplier)!==(s==null?void 0:s.svMultiplier)&&(ae.SV_TEXT.text=`${s.svMultiplier.toFixed(2)}x`),te.CURRENT_SV=s,Tt.scrollTo(t));const o=[];if(p.SELECTED.forEach(l=>{const c=Qi(this.objectsList,l,(u,d)=>{if(u.obj.time===d)return 0;if(u.obj.time<d)return-1;if(u.obj.time>d)return 1});if(c===-1)return;const h=this.objectsList[c];o.push(h)}),this.selected.forEach(l=>{o.includes(l)||l.obj instanceof Ie||(p.CONTAINER.removeChild(l.obj.selected),l.obj instanceof Qt&&(p.CONTAINER.removeChild(l.obj.hitCircle.selected),p.CONTAINER.removeChild(l.obj.selectedSliderEnd)))}),o.forEach(l=>{this.selected.includes(l)||l.obj instanceof Ie||(p.CONTAINER.addChild(l.obj.selected),l.obj instanceof Qt&&(p.CONTAINER.addChild(l.obj.hitCircle.selected),p.CONTAINER.addChild(l.obj.selectedSliderEnd)))}),this.selected=o,this.selected.forEach(l=>{l.obj instanceof Ie||l.obj.handleSkinChange()}),this.breakPeriods.some(l=>l[0]<t&&l[1]>t&&(l[1]<te.lastTimestamp||l[0]>te.lastTimestamp))){const l=p.ALPHA;new ve({alpha:l}).to({alpha:l*.7},1e3).easing(Ae.Cubic.Out).onUpdate(c=>{Lt.changeOpacity(c.alpha)}).start()}else if(this.breakPeriods.some(l=>l[0]<te.lastTimestamp&&l[1]>te.lastTimestamp&&(l[1]<t||l[0]>t))){const l=p.ALPHA;new ve({alpha:l*.7}).to({alpha:l},1e3).easing(Ae.Cubic.Out).onUpdate(c=>{Lt.changeOpacity(c.alpha)}).start()}if(this.filtered.forEach(l=>{var c;this.objectsList[l.idx].obj.draw(Math.max(t,0)),(c=this.objectsList[l.idx].obj.followPoint)==null||c.draw(t)}),this.fpBoundary.forEach(l=>{var c;(c=this.objectsList[l.idx].obj.followPoint)==null||c.draw(t)}),this.selected.forEach(l=>{l.obj instanceof Ie||l.obj.drawSelected()}),nt.CURSOR_DATA){let l=vs(nt.CURSOR_DATA.slice(0,-1),t,(f,m)=>f.time<m?-1:f.time>m?1:0);for(;l>0&&nt.CURSOR_DATA[l].time>t;)l--;const c=nt.CURSOR_DATA[l],h=nt.CURSOR_DATA[l+1]??nt.CURSOR_DATA[l],u=c.x+ot((t-c.time)/(h.time-c.time),0,1)*(h.x-c.x),d=c.y+ot((t-c.time)/(h.time-c.time),0,1)*(h.y-c.y);l!==-1&&p.CURSOR.update(l,u,d)}te.lastTimestamp=t}reinitializeAllSliders(){const t=performance.now();this.objectsList.forEach(e=>{e.obj instanceof Qt&&e.obj.reInitialize()}),console.log(`ReInitialize all sliders took: ${performance.now()-t}ms`)}static render(){var e,s,n,r;p.appResize(),Y.resize(),performance.now()-this.lastRenderTime,this.lastRenderTime=performance.now();const t=(s=(e=p.BEATMAP_FILE)==null?void 0:e.audioNode)==null?void 0:s.getCurrentTime();ie.update(t??0),t&&((r=(n=p.BEATMAP_FILE)==null?void 0:n.beatmapRenderData)!=null&&r.objectsController)&&(p.BEATMAP_FILE.beatmapRenderData.objectsController.draw(t),B.hasILLEGAL||Y.draw(t)),ae.update(t??0),se.update(t??0),Pt.update(t??0),Ii.redraw(),Tt.update(t??0),St.update(t??0),xt.draw(t??0),Be.resize(),p.EMIT_STACK.pop(),p.FPS.text=`${Math.round(Lr.fps)}fps
${Lr.deltaMS.toFixed(2)}ms`}};S(te,"CURRENT_BPM"),S(te,"CURRENT_SV"),S(te,"requestID",null),S(te,"lastTimestamp",0),S(te,"lastRenderTime",0),S(te,"sumMS",0);let Si=te;function yn(){Tt.ON_ANIM=!0;let i={game:0,timing:0,metadata:0};p.SHOW_TIMING_PANEL||(i={game:innerWidth<innerHeight?0:400,timing:innerWidth<innerHeight?p.WRAPPER.h*.75:400,metadata:0},document.querySelector(".mapBG").style.width="calc(100% - 410px)"),p.SHOW_TIMING_PANEL&&(i={game:0,timing:0,metadata:0},document.querySelector(".mapBG").style.width=""),p.SHOW_METADATA=!1,p.SHOW_TIMING_PANEL=!p.SHOW_TIMING_PANEL;const t=kd(0,.4,0,1);new ve({reduction:{game:p.REDUCTION,timing:Tt.SIZE_X,metadata:St.SIZE_X}}).easing(e=>t(e)).to({reduction:i},200).onUpdate(e=>{p.REDUCTION=e.reduction.game,St.SIZE_X=e.reduction.metadata,Tt.SIZE_X=e.reduction.timing,Tt.ON_ANIM=!0,p.EMIT_STACK.push(!0)}).onComplete(()=>{Tt.ON_ANIM=!1}).start()}class ae{static get IS_KIAI(){return this._IS_KIAI}static set IS_KIAI(t){if(this._IS_KIAI=t,t){const[e,s,n]=typeof p.COLOR_PALETTES.primary3=="number"?[...Object.values(Xe(`#${p.COLOR_PALETTES.primary3.toString(16).padStart(6,"0")}`)).map(l=>l/1)]:p.COLOR_PALETTES.primary3.slice(1).match(/.{2}/g).map(l=>parseInt(l,16)),[r,o,a]=typeof p.COLOR_PALETTES.primary4=="number"?[...Object.values(Xe(`#${p.COLOR_PALETTES.primary5.toString(16).padStart(6,"0")}`)).map(l=>l/1)]:p.COLOR_PALETTES.primary4.slice(1).match(/.{2}/g).map(l=>parseInt(l,16));this.TWEEN=new ve({r,g:o,b:a}).to({r:e,g:s,b:n},Si.CURRENT_BPM.beatstep).onUpdate(({r:l,g:c,b:h})=>{const u=l<<16|c<<8|h;this.MASTER_CONTAINER.color=u}).easing(Ae.Sinusoidal.InOut).repeat(1/0).start();return}this.TWEEN&&(this.TWEEN.stop(),this.TWEEN=null,this.MASTER_CONTAINER.color=p.COLOR_PALETTES.primary3)}static init(){this.MASTER_CONTAINER=new gi(110,p.WRAPPER.h-60,180,60),this.MASTER_CONTAINER.color=p.COLOR_PALETTES.primary3,this.MASTER_CONTAINER.alpha=1,this.MASTER_CONTAINER.masterContainer.on("click",()=>{yn()}),this.MASTER_CONTAINER.masterContainer.on("tap",()=>yn()),this.MASTER_CONTAINER.masterContainer.on("mouseenter",()=>{this.MASTER_CONTAINER.color=p.COLOR_PALETTES.primary4}),this.MASTER_CONTAINER.masterContainer.on("mouseleave",()=>{this.MASTER_CONTAINER.color=p.COLOR_PALETTES.primary3}),this.BPM_TEXT=new Ve({text:"0BPM",style:{fontFamily:"Torus",fontSize:16,fontWeight:500,fill:16777215}}),this.BPM_TEXT.anchor.set(1,.5),this.BPM_TEXT.x=this.MASTER_CONTAINER.w/2-5,this.BPM_TEXT.y=this.MASTER_CONTAINER.h/2,this.FLAIR=new ft().roundRect(this.MASTER_CONTAINER.w/2+5,this.MASTER_CONTAINER.h/2-10,50,20).fill(10219175),this.SV_TEXT=new Ve({text:"0.00x",style:{fontFamily:"Torus",fontSize:12,fontWeight:500,fill:2105376}}),this.SV_TEXT.anchor.set(.5,.5),this.SV_TEXT.x=this.MASTER_CONTAINER.w/2+5+25,this.SV_TEXT.y=this.MASTER_CONTAINER.h/2,this.MASTER_CONTAINER.container.addChild(this.BPM_TEXT),this.MASTER_CONTAINER.container.addChild(this.FLAIR),this.MASTER_CONTAINER.container.addChild(this.SV_TEXT)}static forceUpdate(){this.MASTER_CONTAINER&&(innerWidth/innerHeight<1?(this.MASTER_CONTAINER.x=p.WRAPPER.w/2,this.MASTER_CONTAINER.y=p.STATS.container.y+p.STATS.container.height+60-Y.HEIGHT_REDUCTION,this.MASTER_CONTAINER.w=p.WRAPPER.w/2):(this.MASTER_CONTAINER.x=110,this.MASTER_CONTAINER.y=p.WRAPPER.h-60,this.MASTER_CONTAINER.w=180),this.MASTER_CONTAINER.h=60,this.BPM_TEXT.x=this.MASTER_CONTAINER.w/2-5,this.BPM_TEXT.y=this.MASTER_CONTAINER.h/2,this.BPM_TEXT.style.fontSize=16,this.FLAIR.clear().roundRect(this.MASTER_CONTAINER.w/2+5,this.MASTER_CONTAINER.h/2-10,50,20).fill(10219175),this.SV_TEXT.x=this.MASTER_CONTAINER.w/2+5+25,this.SV_TEXT.y=this.MASTER_CONTAINER.h/2,this.SV_TEXT.style.fontSize=12)}static update(){p.IS_FULLSCREEN?this.MASTER_CONTAINER.masterContainer.visible=p.IS_HOVERING_PROGRESS:this.MASTER_CONTAINER.masterContainer.visible=!0,p.EMIT_STACK.length!==0&&this.forceUpdate()}}S(ae,"BPM_TEXT"),S(ae,"SV_TEXT"),S(ae,"_IS_KIAI",!1),S(ae,"TWEEN",null);let Js=class{constructor(){S(this,"isAlt",!1);S(this,"container")}async init(t,e,s,n){this.x=t,this.y=e,this._color=p.COLOR_PALETTES.primary2,this.imgURL=s,this.altImgURL=n??s;const[r,o]=await Promise.all([bt.load(this.imgURL),n?bt.load(this.altImgURL):Promise.resolve(void 0)]);this.texture=r,this.altTexture=o??r,this.sprite=new Mt(this.texture),this.sprite.scale.set(this.imgURL==="static/info.png"?1:.75),this.sprite.anchor.set(.5),this.sprite.x=30,this.sprite.y=30,this._onclick=()=>{},this.container=new ut,this.graphics=new ft,this.redraw(),this.container.eventMode="dynamic",this.container.on("mouseenter",()=>this.color=p.COLOR_PALETTES.primary3),this.container.on("mouseleave",()=>this.color=p.COLOR_PALETTES.primary2),this.container.addChild(this.graphics,this.sprite)}get color(){return this._color}set color(t){this._color=t,this.redraw()}get onclick(){return this._onclick}get width(){return 60}get height(){return 60}set onclick(t){this.container.on("click",e=>{t(e),this.redraw()}),this.container.on("tap",e=>{t(e),this.redraw()}),this._onclick=t}redraw(){this.graphics.clear().rect(0,0,60,60).fill(this.color),this.container.x=this.x,this.container.y=this.y,this.sprite.scale.set(this.imgURL==="static/info.png"?1:.75),this.sprite.x=30,this.sprite.y=30}};class se{static async init(){this.MASTER_CONTAINER=new Er,this.MASTER_CONTAINER.color=p.COLOR_PALETTES.primary2,this.MASTER_CONTAINER.alpha=1,this.MASTER_CONTAINER.placeItemsCenter=!0,await es(t=>{this.flex=new dn,this.playButton=new Js,t(async()=>{await this.playButton.init(120,0,"static/play.svg","static/pause.svg"),this.playButton.onclick=()=>bf()}),this.prevButton=new Js,t(async()=>{await this.prevButton.init(60,0,"static/step-back.svg"),this.prevButton.onclick=()=>Cs(null,!1)}),this.nextButton=new Js,t(async()=>{await this.nextButton.init(180,0,"static/step-forward.svg"),this.nextButton.onclick=()=>Cs(null,!0)}),this.infoButton=new Js,t(async()=>{await this.infoButton.init(0,0,"static/info.svg"),this.infoButton.onclick=()=>Xr()})}),this.flex.addChild(this.infoButton.container),this.flex.addChild(this.prevButton.container),this.flex.addChild(this.playButton.container),this.flex.addChild(this.nextButton.container),this.MASTER_CONTAINER.addChild(this.flex.container),this.forceUpdate()}static forceUpdate(){this.MASTER_CONTAINER&&(innerWidth/innerHeight<1?(this.MASTER_CONTAINER.x=0,this.MASTER_CONTAINER.y=ae.MASTER_CONTAINER.y+ae.MASTER_CONTAINER.h,this.MASTER_CONTAINER.width=p.WRAPPER.w):(this.MASTER_CONTAINER.x=290,this.MASTER_CONTAINER.y=p.WRAPPER.h-60,this.MASTER_CONTAINER.width=240),this.MASTER_CONTAINER.container.h=60,this.playButton.redraw(),this.prevButton.redraw(),this.nextButton.redraw(),this.infoButton.redraw(),this.MASTER_CONTAINER.update())}static update(){p.IS_FULLSCREEN?this.MASTER_CONTAINER.container.visible=p.IS_HOVERING_PROGRESS:this.MASTER_CONTAINER.container.visible=!0,p.EMIT_STACK.length!==0&&this.forceUpdate()}}class Ii{static async init(){this.obj=new Js,await this.obj.init(p.WRAPPER.w-60,p.WRAPPER.h-60,"static/maximize.svg","static/minimize.svg"),this.obj.onclick=()=>D1(),this.obj.container.label="Fullscreen Button",this.obj.color=p.COLOR_PALETTES.primary2}static redraw(){p.IS_FULLSCREEN?this.obj.container.visible=p.IS_HOVERING_PROGRESS:this.obj.container.visible=!0,p.EMIT_STACK.length!==0&&this.obj&&(this.obj.x=p.WRAPPER.w-60,innerWidth/innerHeight<1?this.obj.y=se.MASTER_CONTAINER.y:this.obj.y=p.WRAPPER.h-60,this.obj.redraw())}}function D1(){let i=0,t=0;p.IS_FULLSCREEN?(Ii.obj.sprite.texture=Ii.obj.texture,document.body.style.padding="",document.querySelector("#inputContainer").style.maxHeight="400px",document.querySelector("#inputContainer").style.padding="",document.querySelector("#inputContainer").style.margin="",i=0+(Y.SHOW_GREENLINE?-30:0),t=60):(Ii.obj.sprite.texture=Ii.obj.altTexture,document.body.style.padding=0,document.querySelector("#inputContainer").style.maxHeight=0,document.querySelector("#inputContainer").style.padding=0,document.querySelector("#inputContainer").style.margin=0,i=60,t=0+(Y.SHOW_GREENLINE?-30:0)),new wi.Tween({height:t}).to({height:i},200).easing(wi.Easing.Quadratic.InOut).onUpdate(({height:s})=>{Y.HEIGHT_REDUCTION=s}).start(),p.IS_FULLSCREEN=!p.IS_FULLSCREEN,p.EMIT_STACK.push(!0);const e=new URL(window.location.href);e.searchParams.set("fullscreen",p.IS_FULLSCREEN.toString()),history.replaceState({fullscreen:p.IS_FULLSCREEN},document.title,`${e.pathname}${e.search}${window.location.hash}`)}function bf(i){var t,e,s,n;if(!(!((e=(t=p.BEATMAP_FILE)==null?void 0:t.audioNode)!=null&&e.gainNode)||!((n=(s=p.BEATMAP_FILE)==null?void 0:s.audioNode)!=null&&n.buf))){if(!p.BEATMAP_FILE.audioNode.isPlaying){se.playButton.sprite.texture=se.playButton.altTexture,p.BEATMAP_FILE.audioNode.play();return}se.playButton.sprite.texture=se.playButton.texture,p.BEATMAP_FILE.audioNode.pause()}}function Sh(i){const t=Math.floor(i%1e3),e=Math.floor(i/1e3%60),s=Math.floor(i/1e3/60),n=t.toString().padStart(3,"0").split(""),r=e.toString().padStart(2,"0").split("");return{minutes:s.toString().padStart(2,"0").split(""),seconds:r,miliseconds:n}}let fs,Gi=null;function Th(i){var t;(t=p.BEATMAP_FILE)!=null&&t.audioNode&&(fs&&fs.stop(),Gi=i*p.BEATMAP_FILE.audioNode.raw_buf.duration*1e3,fs=new ve({time:p.BEATMAP_FILE.audioNode.getCurrentTime()}).easing(wi.Easing.Sinusoidal.Out).to({time:Gi},100).onUpdate(e=>{p.SHOULD_PLAY_HITSOUND=!1,p.BEATMAP_FILE.audioNode.seekTo(e.time)}).onComplete(()=>{Gi=null,p.SHOULD_PLAY_HITSOUND=!0}).start())}function Cs(i,t){if(!p.BEATMAP_FILE||!p.BEATMAP_FILE.audioNode.isLoaded)return;fs&&fs.stop();let e=1,s=t?1:-1,n;const r=Gi??p.BEATMAP_FILE.audioNode.getCurrentTime(),o=p.BEATMAP_FILE.audioNode.isPlaying;B.beatStepsList.length&&(n=B.beatStepsList.findLast(h=>h.time<=r)??B.beatStepsList[0],e=i?1:n.beatstep/parseInt(p.MAPPING.beatsnap)*(!t&&o?2:1));const a=r-n.time,l=Math.round(a/e),c=ot(Math.floor(n.time+(l+s)*e),0,p.BEATMAP_FILE.audioNode.raw_buf.duration*1e3);if(Gi=c,p.BEATMAP_FILE.audioNode.isPlaying){p.BEATMAP_FILE.audioNode.seekTo(c),Gi=null;return}fs=new ve({time:p.BEATMAP_FILE.audioNode.getCurrentTime()}).easing(wi.Easing.Sinusoidal.Out).to({time:c},100).onUpdate(h=>{p.SHOULD_PLAY_HITSOUND=!1,p.BEATMAP_FILE.audioNode.seekTo(h.time)}).onComplete(()=>{Gi=null,p.SHOULD_PLAY_HITSOUND=!0}).start()}function k1(){const i=window.location.origin,t=p.BEATMAP_FILE!==void 0?parseInt(p.BEATMAP_FILE.audioNode.getCurrentTime()):0,e=B.CURRENT_MAPID||"";navigator.clipboard.writeText(`${i}${i.includes("github.io")?"/beatmap-viewer-how":""}?b=${e}&t=${t}`),new di({message:"Current preview timestamp copied"}).notify()}document.querySelector("#previewURL").onclick=k1;function H1(i){var e;if(!((e=p.BEATMAP_FILE)!=null&&e.audioNode)||!/^[0-9]+:[0-9]+:[0-9]+.*/g.test(i)&&!/^[0-9]+$/g.test(i)){document.querySelector("#jumpToTime").value="";return}let t=i;if(/^[0-9]+:[0-9]+:[0-9]+.*/g.test(i)){const s=i.match(/[0-9]+:[0-9]+:[0-9]+/g)[0],n=parseInt(s.split(":")[0]),r=parseInt(s.split(":")[1]),o=parseInt(s.split(":")[2]);t=n*6e4+r*1e3+o}p.BEATMAP_FILE.audioNode.seekTo(t)}document.querySelector("#jumpToTime").addEventListener("keydown",i=>{i.key==="Enter"&&(H1(document.querySelector("#jumpToTime").value),closePopup())});const Eh=`in vec2 aPosition;\r
in vec3 aColor;\r
\r
out vec3 vColor;\r
\r
uniform mat3 uProjectionMatrix;\r
uniform mat3 uWorldTransformMatrix;\r
uniform mat3 uTransformMatrix;\r
\r
void main() {\r
    mat3 mvp = uProjectionMatrix * uWorldTransformMatrix * uTransformMatrix;\r
    gl_Position = vec4((mvp * vec3(aPosition, 1.0)).xy, 0.0, 1.0);\r
    vColor = aColor;\r
}`,_h=`in vec3 vColor;\r
\r
out vec4 finalColor;\r
\r
void main() {\r
    finalColor = vec4(vColor, 1.0) * 0.6;\r
}`,Zn=`struct GlobalUniforms {\r
    uProjectionMatrix : mat3x3<f32>,\r
    uWorldTransformMatrix : mat3x3<f32>,\r
    uWorldColorAlpha : vec4<f32>,\r
    uResolution : vec2<f32>,\r
}\r
\r
struct LocalUniforms {\r
    uTransformMatrix : mat3x3<f32>,\r
    uColor : vec4<f32>,\r
    uRound : f32,\r
}\r
\r
struct VertexOutput {\r
    @builtin(position) position: vec4<f32>,\r
    @location(0) vColor: vec3<f32>\r
}\r
\r
@group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;\r
@group(1) @binding(0) var<uniform> localUniforms : LocalUniforms;\r
\r
@vertex\r
fn vsMain(\r
    @location(0) aPosition: vec2<f32>,\r
    @location(1) aColor: vec3<f32>\r
) -> VertexOutput {\r
    var mvp: mat3x3<f32> = globalUniforms.uProjectionMatrix * globalUniforms.uWorldTransformMatrix * localUniforms.uTransformMatrix;\r
    var pos: vec3<f32> = mvp * vec3<f32>(\r
        aPosition[0],\r
        aPosition[1],\r
        1.0\r
    );\r
\r
    var vColor: vec3<f32> = aColor;\r
\r
    return VertexOutput(\r
        vec4<f32>(pos[0], pos[1], 0.0, 1.0),\r
        vColor\r
    );\r
}\r
\r
@fragment\r
fn fsMain(\r
    input: VertexOutput\r
) -> @location(0) vec4<f32> {\r
    return vec4<f32>(\r
        input.vColor[0],\r
        input.vColor[1],\r
        input.vColor[2],\r
        1.0,\r
    ) * 0.6;\r
}`;class Pt{static initLine(){this.line=new ft().setStrokeStyle({width:4,cap:"round",color:8962256}).moveTo(0,this.HEIGHT/2).lineTo(this.WIDTH-80,this.HEIGHT/2).stroke()}static initThumb(){this.thumb=new ft().setStrokeStyle({width:4,cap:"round",alignment:0,color:8962256}).roundRect(-20,-5,40,10,10).fill(3028032).stroke().setStrokeStyle().circle(0,0,2).fill(8962256),this.thumb.y=this.HEIGHT/2,this.thumb.eventMode="static",this.thumb.on("mouseenter",t=>{this.restyle(!0)}),this.thumb.on("mouseleave",t=>{this.IS_DRAGGING||this.restyle()})}static initContainer(){this.container=new ut,this.container.addChild(this.line),this.container.addChild(this.thumb),this.container.x=40,this.container.hitArea=new Ot(-40,0,this.WIDTH,this.HEIGHT),this.container.eventMode="static",this.container.on("mousedown",t=>{p.IS_SEEKING=!0,this.handleMouseDown(t)}),this.container.on("mousemove",t=>{this.handleMouseMove(t)}),this.container.on("mouseup",t=>{p.IS_SEEKING=!1,this.handleMouseUp(t)}),this.container.on("mouseleave",t=>{p.IS_SEEKING=!1,this.IS_DRAGGING&&this.handleMouseUp(t)}),this.container.on("touchstart",t=>{this.handleMouseDown(t)}),this.container.on("touchmove",t=>{this.handleMouseMove(t)}),this.container.on("touchend",t=>{this.handleMouseUp(t)}),this.stage.addChild(this.container)}static initBreakKiai(){var n,r;if(this.stage.addChildAt(this.breakKiai,1),this.breakKiai.x=40,this.breakKiai.y=this.HEIGHT/3,!((n=p.BEATMAP_FILE)!=null&&n.audioNode))return;const t=p.BEATMAP_FILE.audioNode.duration,e=this.WIDTH-80,s=this.HEIGHT/3;this.breakKiai.clear(),B.breakPeriods.forEach(o=>{const a=o[0]/t*e,l=o[1]/t*e;this.breakKiai.rect(a,0,l-a,s).fill({color:16777215,alpha:.5})});for(let o=0;o<B.kiaiList.length;o+=2){const a=B.kiaiList[o].time/t*e,l=(((r=B.kiaiList[o+1])==null?void 0:r.time)??t)/t*e;this.breakKiai.rect(a,0,l-a,s).fill({color:14187279,alpha:.5})}}static initTimingPoints(){var a;if(this.timeline.x=40,this.timeline.y=10,!((a=p.BEATMAP_FILE)!=null&&a.audioNode))return;const t=p.BEATMAP_FILE.audioNode.duration,e=this.WIDTH-80,s=this.HEIGHT/2-10,n=[],r=[];B.timingPointsList.forEach((l,c)=>{const h=l.time/t*e,u=l.beatstep?[.96,.26,.35]:[.26,.96,.38];n.push(h,0,h,s/2),r.push(...u,...u)});const o=new xe({attributes:{aPosition:n,aColor:r},topology:"line-list"});this.timeline.geometry=o}static reinitPoints(){this.stage.removeChild(this.timeline),this.timeline=new Oi({geometry:new xe({attributes:{aPosition:[0,0,1,0],aColor:[1,0,0,1,1,1]},topology:"line-list"}),shader:$e.from({gl:ni.from({vertex:Eh,fragment:_h}),gpu:Le.from({vertex:{source:Zn,entryPoint:"vsMain"},fragment:{source:Zn,entryPoint:"fsMain"}})})}),this.timeline.x=40,this.timeline.y=10,this.stage.addChildAt(this.timeline,0)}static init(){this.WIDTH=p.MASTER_CONTAINER.w-590,this.HEIGHT=60,this.MASTER_CONTAINER=new gi(530,p.WRAPPER.h-60,this.WIDTH,this.HEIGHT),this.MASTER_CONTAINER.color=p.COLOR_PALETTES.primary2,this.MASTER_CONTAINER.alpha=1,this.stage=this.MASTER_CONTAINER.container;const t=Le.from({vertex:{source:Zn,entryPoint:"vsMain"},fragment:{source:Zn,entryPoint:"fsMain"}});t.autoAssignGlobalUniforms=!0,t.autoAssignLocalUniforms=!0,this.timeline=new Oi({geometry:new xe({attributes:{aPosition:[0,0,1,0],aColor:[1,0,0,1,1,1]},topology:"line-list"}),shader:$e.from({gl:ni.from({vertex:Eh,fragment:_h}),gpu:t})}),this.timeline.x=40,this.timeline.y=10,this.stage.addChildAt(this.timeline,0),this.breakKiai=new ft,this.breakKiai.eventMode="none",this.stage.addChildAt(this.breakKiai,1),this.initLine(),this.initThumb(),this.initContainer()}static handleMouseDown(t){this.IS_DRAGGING=!0;let{x:e}=this.container.toLocal(t.global),s=this.WIDTH-80;const n=ot(e/s,0,1);Th(n),this.restyle(!0)}static handleMouseMove(t){if(!this.IS_DRAGGING)return;let{x:e}=this.container.toLocal(t.global),s=this.WIDTH-80;const n=ot(e/s,0,1);Th(n)}static handleMouseUp(t){this.IS_DRAGGING=!1,this.restyle()}static forceResize(){if(!this.MASTER_CONTAINER)return;innerWidth/innerHeight<1?(this.MASTER_CONTAINER.x=0,this.MASTER_CONTAINER.y=se.MASTER_CONTAINER.y+se.MASTER_CONTAINER.height,this.MASTER_CONTAINER.w=p.WRAPPER.w):(this.MASTER_CONTAINER.x=530,this.MASTER_CONTAINER.y=p.WRAPPER.h-60,this.MASTER_CONTAINER.w=p.MASTER_CONTAINER.w-590),this.MASTER_CONTAINER.h=60;const t=this.MASTER_CONTAINER.w,e=this.MASTER_CONTAINER.h;this.WIDTH===t&&this.HEIGHT===e||(this.WIDTH=t,this.HEIGHT=e,this.restyle(),this.initTimingPoints(),this.initBreakKiai(),this.thumb.y=this.HEIGHT/2,this.container.x=40,this.container.hitArea=new Ot(-40,0,this.WIDTH,this.HEIGHT))}static resize(){p.IS_FULLSCREEN?this.MASTER_CONTAINER.masterContainer.visible=p.IS_HOVERING_PROGRESS:this.MASTER_CONTAINER.masterContainer.visible=!0,p.EMIT_STACK.length!==0&&this.forceResize()}static restyle(t){let e=p.COLOR_PALETTES.primary2,s=p.COLOR_PALETTES.accent1;e||(e=3028032),s||(s=8962256),this.line.clear().setStrokeStyle({width:4,cap:"round",color:s}).moveTo(0,this.HEIGHT/2).lineTo(this.WIDTH-80,this.HEIGHT/2).stroke(),this.thumb.clear().setStrokeStyle({width:4,cap:"round",alignment:0,color:s}).roundRect(-20,-5,40,10,10).fill(t?s:e).stroke().setStrokeStyle().circle(0,0,2).fill(t?e:s)}static update(t){var e,s,n,r;this.resize(),(s=(e=p.BEATMAP_FILE)==null?void 0:e.audioNode)!=null&&s.buf&&(this.thumb.x=t/(((r=(n=p.BEATMAP_FILE)==null?void 0:n.audioNode)==null?void 0:r.raw_buf.duration)*1e3)*(this.WIDTH-80))}}S(Pt,"renderer"),S(Pt,"stage"),S(Pt,"container"),S(Pt,"line"),S(Pt,"thumb"),S(Pt,"timeline"),S(Pt,"breakKiai"),S(Pt,"timelineObjs",[]),S(Pt,"WIDTH"),S(Pt,"HEIGHT"),S(Pt,"TIMELINE_WIDTH"),S(Pt,"TIMELINE_HEIGHT"),S(Pt,"PERCENTAGE",0),S(Pt,"IS_DRAGGING",!1),S(Pt,"IS_HOVERING",!1);class F1 extends Ef{constructor(e){super(e);S(this,"number",0);S(this,"sprites",[]);S(this,"cache",{number:null})}draw(e,s=""){this.number!==s&&(this.obj.removeChildren().forEach(o=>o.destroy()),this.sprites.length=0,this.number=s??0,this.number.toString().split("").forEach((o,a)=>{const l=new Mt;l.anchor.set(.5),this.sprites.push(l),this.obj.addChild(l)}));let n=null;this.number.toString().split("").forEach((r,o)=>{const a=at.SKIN_ENUM[p.SKINNING.type],l=a!=="CUSTOM"?a==="ARGON"?st.ARGON:st.LEGACY:st.CUSTOM[at.SKIN_IDX],c=this.sprites[o];if(c.texture=l.DEFAULTS[r].texture,c.scale.set(l.DEFAULTS[r].isHD?.5*.8:.8),a==="ARGON"){const h=p.SLIDER_APPEARANCE.ignoreSkin?at.DEFAULT_COLORS:B.COLORS,u=p.SLIDER_APPEARANCE.ignoreSkin?this.hitObject.colourIdx:this.hitObject.colourHaxedIdx,[d,f,m]=u===-1?[1,1,1,1]:[...Object.values(Xe(`#${h[u%h.length].toString(16).padStart(6,"0")}`)).map(g=>g/255),1];.299*d+.587*f+.114*m>.5?c.tint=3355443:c.tint=15066597}else c.tint=16777215;if(n){const h=a==="LEGACY"?at.HIT_CIRCLE_OVERLAP:a==="ARGON"?at.HIT_CIRCLE_OVERLAP_ARGON:at.SKIN_LIST[at.SKIN_IDX].ini.HIT_CIRCLE_OVERLAP;c.x=n.x+n.width/2+c.width/2-h*.8}n=c}),this.obj.alpha=1,this.obj.x=-n.x/2}}const Nr=`struct GlobalUniforms {\r
    projectionMatrix : mat3x3<f32>,\r
    worldTransformMatrix : mat3x3<f32>,\r
    worldColorAlpha : vec4<f32>,\r
    uResolution : vec2<f32>,\r
}\r
\r
struct LocalUniforms {\r
    uTransformMatrix : mat3x3<f32>,\r
    uColor : vec4<f32>,\r
    uRound : f32,\r
}\r
\r
struct CustomUniforms {\r
    tint: vec4<f32>,\r
    selected: f32,\r
    skinType: f32,\r
    isReverse: f32,\r
    nodeTint: vec4<f32>\r
}\r
\r
@group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;\r
@group(1) @binding(0) var<uniform> localUniforms : LocalUniforms;\r
@group(2) @binding(0) var<uniform> customUniforms : CustomUniforms;\r
\r
\r
struct VertexOutput {\r
    @builtin(position) position : vec4<f32>,\r
    @location(0) dist : f32,\r
}\r
\r
@vertex\r
fn vsMain(\r
    @location(0) position : vec2<f32>,\r
    @location(1) dist : f32,\r
) -> VertexOutput {\r
    var mvp = globalUniforms.projectionMatrix * globalUniforms.worldTransformMatrix * localUniforms.uTransformMatrix;\r
\r
    return VertexOutput(\r
        vec4<f32>(mvp * vec3<f32>(position, 1.0), 1.0), \r
        dist\r
    );\r
};\r
\r
fn darken(color: vec4<f32>, strength: f32) -> vec4<f32> {\r
    var scalar: f32 = max(1.0, 1.0 + strength);\r
    var ret: vec4<f32> = vec4<f32>(0, 0, 0, 1);\r
\r
    ret[0] = min(1.0, color[0] / scalar);\r
    ret[1] = min(1.0, color[1] / scalar);\r
    ret[2] = min(1.0, color[2] / scalar);\r
\r
    return ret;\r
}\r
\r
@fragment\r
fn fsMain(input : VertexOutput) -> @location(0) vec4<f32>{\r
    var blurRate = 0.05;\r
    var alpha = 1.0;\r
\r
    var totalAlpha = 0.7;\r
\r
    var tint = customUniforms.tint;\r
\r
    var outerColor = darken(tint, 0.1);\r
    var innerColor = tint;\r
\r
    if (input.dist > 1.0 - blurRate) {\r
        alpha = (1.0 - input.dist) / blurRate;\r
    }\r
\r
    if (customUniforms.skinType != 0.0) {\r
        var color = mix(outerColor, innerColor, input.dist);\r
\r
        if (customUniforms.selected > 0.0) {\r
            color = tint;\r
            totalAlpha = 1.0;\r
        }\r
\r
        color[3] = 1.0;\r
\r
        return color * alpha * totalAlpha;\r
    } else {\r
        totalAlpha = 1.0;\r
\r
        outerColor = darken(tint, 0.4);\r
        \r
        var color = outerColor;\r
        if (input.dist <= 0.8) {\r
            color = innerColor;\r
        }\r
\r
        if (customUniforms.selected > 0.0) {\r
            color = tint;\r
            if (input.dist > 0.8) {\r
                color = vec4<f32>(0.93, 0.67, 0.0, 1.0);\r
            }\r
\r
            totalAlpha = 1.0;\r
        }\r
\r
        if (customUniforms.isReverse > 0.0) {\r
            color = customUniforms.nodeTint;\r
        }\r
\r
        color[3] = 1.0;\r
        return color * alpha * totalAlpha;\r
    }\r
\r
}\r
`,xf=`precision mediump float;\r
attribute vec2 position;\r
attribute float dist;\r
\r
varying float colorDist;\r
\r
uniform mat3 uProjectionMatrix;\r
uniform mat3 uWorldTransformMatrix;\r
uniform mat3 uTransformMatrix;\r
\r
void main() {\r
    colorDist = dist;\r
    gl_Position = vec4((uProjectionMatrix * uWorldTransformMatrix * uTransformMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\r
}`,Af=`precision mediump float;\r
\r
uniform vec4 tint;\r
uniform vec4 nodeTint;\r
uniform float selected;\r
uniform float skinType;\r
uniform float isReverse;\r
\r
varying float colorDist;\r
\r
vec4 lighten(vec4 color, float amount) {\r
    amount *= 0.5;\r
    color.r = min(1.0, color.r * (1.0 + 0.5 * amount) + 1.0 * amount);\r
    color.g = min(1.0, color.g * (1.0 + 0.5 * amount) + 1.0 * amount);\r
    color.b = min(1.0, color.b * (1.0 + 0.5 * amount) + 1.0 * amount);\r
\r
    return color;\r
}\r
\r
vec4 darken(vec4 color, float amount) {\r
    float scalar = max(1.0, 1.0 + amount);\r
    color.r = min(1.0, color.r / scalar);\r
    color.g = min(1.0, color.g / scalar);\r
    color.b = min(1.0, color.b / scalar);\r
    return color;\r
}\r
\r
void main() {\r
    float blurRate = 0.05;\r
    float alpha = 1.0;\r
    float totalAlpha = skinType == 0.0 ? 1.0 : 0.7;\r
\r
    vec4 outerColor = darken(tint, 0.1);\r
    vec4 innerColor = tint;\r
\r
    if (colorDist > 1.0 - blurRate)\r
        alpha = (1.0 - colorDist) / blurRate;\r
\r
    if (skinType != 0.0) {\r
        vec4 color = mix(outerColor, innerColor, colorDist);\r
        if (selected > 0.0) {\r
            color = tint;\r
            totalAlpha = 1.0;\r
        }\r
\r
        color.a = 1.0;\r
        gl_FragColor = totalAlpha * alpha * color;\r
    } else {\r
        outerColor = darken(tint, 0.4);\r
        vec4 color = colorDist > 0.8 ? outerColor : innerColor;\r
        if (selected > 0.0) {\r
            color = tint;\r
\r
            if (colorDist > 0.8) {\r
                color = vec4(0.93, 0.67, 0.0, 1.0);\r
            }\r
\r
            totalAlpha = 1.0;\r
        }\r
\r
        if (isReverse > 0.0) {\r
            color = nodeTint;\r
        }\r
\r
        color.a = 1.0;\r
        gl_FragColor = totalAlpha * alpha * color;\r
    }\r
}`;class Ji{constructor(t,e=!1){S(this,"obj");S(this,"hitCircle");S(this,"hitCircleOverlay");S(this,"selected");S(this,"meshHead");S(this,"meshTail");S(this,"theThing");S(this,"numberSprite");S(this,"hitObject");S(this,"isSlider",!1);S(this,"cache",{tint:null,x:null,selected:null,skinType:null,baseHeight:null});this.isSlider=e,this.obj=new ut,this.obj.eventMode="static",this.hitObject=t;const s=Le.from({vertex:{source:Nr,entryPoint:"vsMain"},fragment:{source:Nr,entryPoint:"fsMain"}});s.autoAssignGlobalUniforms=!0,s.autoAssignLocalUniforms=!0;const n=ni.from({name:"timeline-shader",vertex:xf,fragment:Af}),r=$e.from({gl:n,gpu:s,resources:{customUniforms:{tint:{value:[0,0,0,1],type:"vec4<f32>"},selected:{value:0,type:"f32"},skinType:{value:p.SKINNING.type,type:"f32"},isReverse:{value:0,type:"f32"},nodeTint:{value:[0,0,0,1],type:"vec4<f32>"}}}}),o=Ji.createArc(-1,30*(118/128)),a=Ji.createArc(1,30*(118/128)),l=new Oi({geometry:o,shader:r}),c=new Oi({geometry:a,shader:r});this.meshHead=l,this.meshTail=c,this.theThing=new ut,this.theThing.addChild(l,c);const h=new Mt(st.LEGACY.HIT_CIRCLE.texture),u=new Mt(st.LEGACY.HIT_CIRCLE_OVERLAY.texture),d=new Mt(st.SELECTED.texture),f=new F1(t);h.anchor.set(.5,.5),u.anchor.set(.5,.5),d.anchor.set(.5,.5),d.scale.set(.5),this.hitCircle=h,this.hitCircle.tint=16777215,this.hitCircleOverlay=u,this.selected=d,this.numberSprite=f,this.obj.addChild(this.theThing),this.obj.addChild(h),this.obj.addChild(u),this.obj.addChild(f.obj),this.obj.addChild(d),this.obj.scale.set(Y.HEIGHT/1.5/this.hitCircle.height),this.obj.x=0,this.obj.y=Y.HEIGHT/2;const m=y=>{const{x:g,y:E}=this.obj.toLocal(y.global);p.SELECTED.includes(this.hitObject.time)||Math.abs(g)>Y.HEIGHT||(y.ctrlKey||(p.SELECTED=[]),p.SELECTED.includes(this.hitObject.time)||p.SELECTED.push(this.hitObject.time),Y.hitArea.isObjectSelecting=!0)};this.obj.on("mousedown",m),this.obj.on("touchstart",m)}addSelfToContainer(t){t.addChild(this.obj)}removeSelfFromContainer(t){t.removeChild(this.obj)}static createArc(t,e,s){t/=Math.abs(t);const n=[],r=[],o=[0,0],a=400;for(let c=0;c<a;c++){const h=c/a*Math.PI*t,u=(c+1)/a*Math.PI*t;n.push(...o,e*Math.sin(h),e*Math.cos(h),e*Math.sin(u),e*Math.cos(u)),r.push(0,1,1)}return new xe({attributes:{position:n,dist:r}})}updatePosition(t){const e=this.hitObject.time,s=t-e,r=Y.WIDTH/2-s/500*Y.ZOOM_DISTANCE;r!==this.cache.x&&(this.cache.x=r,this.obj.x=r)}updateSelected(){const t=this.hitObject.time,e=p.SELECTED.includes(t);if(e!==this.cache.selected){if(this.cache.selected=e,this.meshHead.shader.resources.customUniforms.uniforms.selected=e?1:0,this.meshTail.shader.resources.customUniforms.uniforms.selected=e?1:0,p.SKINNING.type==="0"){this.selected.visible=!1;return}this.selected.visible=e}}updateVisible(t){if(p.SKINNING.type===this.cache.skinType)return;this.cache.skinType=p.SKINNING.type;const e=p.SKINNING.type,n=at.SKIN_ENUM[p.SKINNING.type]!=="CUSTOM"?st.LEGACY:st.CUSTOM[at.SKIN_IDX];this.theThing.visible=e==="0"&&!(this.isSlider&&!t),this.hitCircle.visible=e!=="0",this.hitCircleOverlay.visible=e!=="0",this.meshHead.shader.resources.customUniforms.uniforms.skinType=p.SKINNING.type,this.meshTail.shader.resources.customUniforms.uniforms.skinType=p.SKINNING.type,this.hitCircle.texture=n.HIT_CIRCLE.texture,this.hitCircle.scale.set(n.HIT_CIRCLE.isHD?.5:1),this.hitCircleOverlay.texture=n.HIT_CIRCLE_OVERLAY.texture,this.hitCircleOverlay.scale.set(n.HIT_CIRCLE_OVERLAY.isHD?.5:1),t&&(this.meshHead.shader.resources.customUniforms.uniforms.isReverse=!0,this.meshTail.shader.resources.customUniforms.uniforms.isReverse=!0)}updateTint(t){const e=p.SLIDER_APPEARANCE.ignoreSkin?at.DEFAULT_COLORS:B.COLORS,s=p.SLIDER_APPEARANCE.ignoreSkin?this.hitObject.colourIdx:this.hitObject.colourHaxedIdx;if(e[s%e.length]===void 0||e[s%e.length]===this.cache.tint)return;this.cache.tint=e[s%e.length],this.hitCircle.tint=e[s%e.length];const n=s===-1?[1,1,1,1]:[...Object.values(Xe(`#${this.cache.tint.toString(16).padStart(6,"0")}`)).map(r=>r/255),1];if(t){const[r,o,a]=n;if(.299*r+.587*o+.114*a>.5){this.meshHead.shader.resources.customUniforms.uniforms.nodeTint=[.2,.2,.2,1],this.meshTail.shader.resources.customUniforms.uniforms.nodeTint=[.2,.2,.2,1];return}this.meshHead.shader.resources.customUniforms.uniforms.nodeTint=[.9,.9,.9,1],this.meshTail.shader.resources.customUniforms.uniforms.nodeTint=[.9,.9,.9,1];return}this.meshHead.shader.resources.customUniforms.uniforms.tint=n,this.meshTail.shader.resources.customUniforms.uniforms.tint=n}updateScale(t){if(this.cache.baseHeight!==Y.HEIGHT-(Y.SHOW_GREENLINE?30:0)){if(this.cache.baseHeight=Y.HEIGHT-(Y.SHOW_GREENLINE?30:0),this.obj.scale.set(this.cache.baseHeight/this.hitCircle.height*.9),this.obj.y=Y.HEIGHT/2,t){this.meshHead.scale.set(this.cache.baseHeight/60),this.meshTail.scale.set(this.cache.baseHeight/60);return}this.meshHead.scale.set(this.cache.baseHeight/60*2),this.meshTail.scale.set(this.cache.baseHeight/60*2)}}draw(t,e){this.updatePosition(t),this.updateSelected(),this.updateVisible(e),this.updateScale(e),this.updateTint(e),!e&&this.numberSprite.draw(t,this.hitObject.comboIdx)}}class B1 extends Ji{constructor(e,s){super(e);S(this,"hitObject");S(this,"slider");this.hitObject=e,this.slider=s,this.obj.removeChild(this.numberSprite.obj),this.numberSprite=new Mt(st.LEGACY.REVERSE_ARROW.arrow.texture),this.numberSprite.anchor.set(.5),this.numberSprite.scale.set(1),this.obj.addChildAt(this.numberSprite,2)}draw(e){super.draw(e,!0);const s=p.SLIDER_APPEARANCE.ignoreSkin?at.DEFAULT_COLORS:B.COLORS,n=p.SLIDER_APPEARANCE.ignoreSkin?this.slider.colourIdx:this.slider.colourHaxedIdx;this.hitCircle.tint=s[n%s.length];const r=at.SKIN_ENUM[p.SKINNING.type],o=r!=="CUSTOM"?st.LEGACY:st.CUSTOM[at.SKIN_IDX];if(this.numberSprite.texture=o.REVERSE_ARROW.arrow.texture,this.numberSprite.scale.set(o.REVERSE_ARROW.arrow.isHD?.5:1),r==="ARGON"){this.numberSprite.visible=!1;const[a,l,c]=n===-1?[1,1,1,1]:[...Object.values(Xe(`#${s[n%s.length].toString(16).padStart(6,"0")}`)).map(u=>u/255),1];.299*a+.587*l+.114*c>.5?(this.meshHead.shader.resources.customUniforms.uniforms.nodeTint=[.2,.2,.2,1],this.meshTail.shader.resources.customUniforms.uniforms.nodeTint=[.2,.2,.2,1]):(this.meshHead.shader.resources.customUniforms.uniforms.nodeTint=[.9,.9,.9,1],this.meshTail.shader.resources.customUniforms.uniforms.nodeTint=[.9,.9,.9,1]),this.meshHead.shader.resources.customUniforms.uniforms.isReverse=!0,this.meshTail.shader.resources.customUniforms.uniforms.isReverse=!0,this.meshHead.scale.set(Y.HEIGHT/(Y.SHOW_GREENLINE?1.5:1)/60/2),this.meshTail.scale.set(Y.HEIGHT/(Y.SHOW_GREENLINE?1.5:1)/60/2)}}}class Sn{constructor(t){S(this,"obj");S(this,"hitObject");S(this,"sliderHead");S(this,"sliderTail");S(this,"sliderReverses",[]);S(this,"meshHead");S(this,"meshTail");S(this,"meshBody");S(this,"ratio",1);S(this,"headPosition",0);var m;this.obj=new ut,this.obj.eventMode="static",this.x=0,this.radius=30*(118/128),this.hitObject=t,this.length=1,this.hitArea=new ft().rect(0,0,0,0),this.obj.addChild(this.hitArea);const e=Sn.createArc(-1,this.radius),s=Sn.createArc(1,this.radius),n=this.createLine(1),r=Le.from({vertex:{source:Nr,entryPoint:"vsMain"},fragment:{source:Nr,entryPoint:"fsMain"}});r.autoAssignGlobalUniforms=!0,r.autoAssignLocalUniforms=!0;const o=ni.from({name:"timeline-shader",vertex:xf,fragment:Af}),a=$e.from({gl:o,gpu:r,resources:{customUniforms:{tint:{value:[0,0,0,1],type:"vec4<f32>"},selected:{value:0,type:"f32"},skinType:{value:p.SKINNING.type,type:"f32"},isReverse:{value:0,type:"f32"},nodeTint:{value:[0,0,0,1],type:"vec4<f32>"}}}}),l=new Oi({geometry:e,shader:a}),c=new Oi({geometry:n,shader:a}),h=new Oi({geometry:s,shader:a});this.meshHead=l,this.meshBody=c,this.meshTail=h,this.meshHead.hitArea=new Ot(0,0,0,0),this.meshBody.hitArea=new Ot(0,0,0,0),this.meshTail.hitArea=new Ot(0,0,0,0),this.obj.addChild(l),this.obj.addChild(c),this.obj.addChild(h);const u=new Ji(t,!0),d=new Ji(t,!0);this.sliderHead=u,this.sliderTail=d,this.sliderReverses=((m=this.hitObject.revArrows)==null?void 0:m.map(y=>new B1(y,this.hitObject)))??[],this.obj.addChild(d.obj),this.sliderReverses.toReversed().forEach(y=>this.obj.addChild(y.obj)),this.obj.addChild(u.obj);const f=y=>{const{x:g,y:E}=this.obj.toLocal(y.global);return p.SELECTED.includes(this.hitObject.time)||g<this.headPosition-(Y.HEIGHT-20)/2||g>this.headPosition+this.length*this.ratio+Y.HEIGHT/1.5/2?!1:(y.ctrlKey||(p.SELECTED=[]),p.SELECTED.includes(this.hitObject.time)||p.SELECTED.push(this.hitObject.time),Y.hitArea.isObjectSelecting=!0,!0)};this.obj.on("mousedown",f),this.obj.on("touchstart",f),this.obj.on("mouseenter",y=>{this.hitObject.isHover=!0}),this.obj.on("mouseleave",y=>{this.hitObject.isHover=!1})}addSelfToContainer(t){t.addChild(this.obj)}removeSelfFromContainer(t){t.removeChild(this.obj)}draw(t){if(this.hitObject.ILLEGAL)return;const e=this.hitObject.time,s=t-e,n=p.SELECTED.includes(e),r=Y.WIDTH/2;this.length=(this.hitObject.endTime-this.hitObject.time)/500*Y.ZOOM_DISTANCE;const o=p.SLIDER_APPEARANCE.ignoreSkin?at.DEFAULT_COLORS:B.COLORS,a=p.SLIDER_APPEARANCE.ignoreSkin?this.hitObject.colourIdx:this.hitObject.colourHaxedIdx,l=a===-1?[1,1,1,1]:[...Object.values(Xe(`#${o[a%o.length].toString(16).padStart(6,"0")}`)).map(d=>d/255),1];let c=Math.max(r-s/500*Y.ZOOM_DISTANCE,0);this.headPosition=c;let h=r-s/500*Y.ZOOM_DISTANCE+this.length;h<0&&(c=h);const u=ot((h-c)/this.length,0,1);this.ratio=u,this.meshHead.position.set(c,Y.HEIGHT/2),this.meshHead.scale.set((Y.HEIGHT-(Y.SHOW_GREENLINE?30:0))/60*.9),this.meshHead.shader.resources.customUniforms.uniforms.tint=l,this.meshHead.shader.resources.customUniforms.uniforms.selected=n?1:0,this.meshHead.shader.resources.customUniforms.uniforms.skinType=p.SKINNING.type,this.meshBody.position.set(c,Y.HEIGHT/2),this.meshBody.scale.set(this.length*u,(Y.HEIGHT-(Y.SHOW_GREENLINE?30:0))/60*.9),this.meshBody.shader.resources.customUniforms.uniforms.tint=l,this.meshBody.shader.resources.customUniforms.uniforms.selected=n?1:0,this.meshBody.shader.resources.customUniforms.uniforms.skinType=p.SKINNING.type,this.meshTail.position.set(h,Y.HEIGHT/2),this.meshTail.scale.set((Y.HEIGHT-(Y.SHOW_GREENLINE?30:0))/60*.9),this.meshTail.shader.resources.customUniforms.uniforms.tint=l,this.meshTail.shader.resources.customUniforms.uniforms.selected=n?1:0,this.meshTail.shader.resources.customUniforms.uniforms.skinType=p.SKINNING.type,this.sliderHead.draw(t),this.sliderTail.draw(t,!0),this.sliderHead.obj.x=c,this.sliderTail.obj.x=h,this.hitArea.clear(),this.hitArea.rect(c,0,this.length*u,Y.HEIGHT).fill({color:16776960,alpha:1e-4}),this.sliderReverses.forEach(d=>d.draw(t)),a===-1&&(this.sliderHead.hitCircle.tint=14606046,this.sliderTail.hitCircle.tint=14606046),this.sliderHead.hitCircle.tint=o[a%o.length],this.sliderTail.hitCircle.tint=o[a%o.length]}static createArc(t,e,s){t/=Math.abs(t);const n=[],r=[],o=[0,0],a=400;for(let c=0;c<a;c++){const h=c/a*Math.PI*t,u=(c+1)/a*Math.PI*t;n.push(...o,e*Math.sin(h),e*Math.cos(h),e*Math.sin(u),e*Math.cos(u)),r.push(0,1,1)}return new xe({attributes:{position:n,dist:r}})}createLine(t){const e=[this.x,this.radius,this.x+t,this.radius,this.x,0,this.x,0,this.x+t,this.radius,this.x+t,0,this.x,0,this.x+t,0,this.x,-this.radius,this.x,-this.radius,this.x+t,0,this.x+t,-this.radius],s=[1,1,0,0,1,0,0,0,1,1,0,1];return new xe({attributes:{position:e,dist:s}})}}class U1{constructor({startObj:t,endObj:e}){S(this,"isHR",!1);S(this,"sprites",[]);this.startObj=t,this.endObj=e,this.container=new ut,this.calculate(),this.color=Math.floor(Math.random()*16777215),this.container.zIndex=-999,this.container.eventMode="none",this.graphics=new ft,this.container.addChild(this.graphics)}refreshSprites(){if(Number.isNaN(this.width)||this.width<80){this.sprites=[],this.container.removeChildren();return}const t=st.FOLLOWPOINT.texture,e=Math.floor((this.width-48)/(512/16));this.container.removeChildren(),this.sprites=Array(e).fill(!0).map((s,n)=>{const r=new Mt(t);return r.anchor.set(.5),r.scale.set(p.SCALE_RATE*(st.FOLLOWPOINT.isHD?.5:1)),r.eventMode="none",r.x=(1.5+n)*(512/16)*p.SCALE_RATE,this.container.addChild(r),r})}calculate(){this.startObj instanceof Pe&&(this.startTime=this.startObj.time-B.moddedStats.preempt),this.startObj instanceof Qt&&(this.startTime=this.startObj.endTime-B.moddedStats.preempt),this.readyTime=this.endObj.time-B.moddedStats.preempt,this.animTime=this.startObj.endTime,this.endTime=this.endObj.time;let{x:t,y:e}=this.startObj.endPosition,{x:s,y:n}=this.endObj.startPosition;p.MODS.HR&&(e=384-e,n=384-n),t+=this.startObj.stackHeight*B.moddedStats.stackOffset,e+=this.startObj.stackHeight*B.moddedStats.stackOffset,s+=this.endObj.stackHeight*B.moddedStats.stackOffset,n+=this.endObj.stackHeight*B.moddedStats.stackOffset,this.width=Math.hypot(s-t,n-e),this.rotation=Math.atan2(n-e,s-t),this.startX=t,this.startY=e,this.enX=s,this.endY=n,this.container.rotation=this.rotation,this.refreshSprites()}checkModChange(){p.MODS.HR!==this.isHR&&(this.isHR=p.MODS.HR,this.calculate())}updateOpacity(t){const e=this.endTime-this.animTime,s=800*Math.min(1,B.moddedStats.preempt/800),n=B.moddedStats.fadeIn;this.sprites.forEach((r,o)=>{const l=(48+32*o)/this.width,c=this.animTime+l*e,h=c-s;if(t<h+n){const u=wa(ot((t-h)/n,0,1));r.alpha=u,r.scale.set((1.5-.5*u)*p.SCALE_RATE*(st.FOLLOWPOINT.isHD?.5:1)),r.x=(l-.1*(1-u))*this.width*p.SCALE_RATE}if(t>c){const u=1-wa(ot((t-c)/n,0,1));r.alpha=u,r.scale.set(p.SCALE_RATE*(st.FOLLOWPOINT.isHD?.5:1)),r.x=l*this.width*p.SCALE_RATE}t>=h+n&&t<c&&(r.alpha=1,r.scale.set(p.SCALE_RATE*(st.FOLLOWPOINT.isHD?.5:1)),r.x=l*this.width*p.SCALE_RATE)})}draw(t){this.checkModChange(),this.container.x=this.startX*p.SCALE_RATE,this.container.y=this.startY*p.SCALE_RATE,this.updateOpacity(t)}}const J=class J{constructor(t,e){S(this,"objectsController");J.hasILLEGAL=!1,J.COLORS=at.DEFAULT_COLORS,J.loadMetadata(t.split(`
`)),t.split(`
`).filter(b=>b.includes("ApproachRate:")).length===0?J.stats.approachRate=parseFloat(t.split(`
`).filter(b=>b.includes("OverallDifficulty:")).at(0).replaceAll("OverallDifficulty:","")):J.stats.approachRate=parseFloat(t.split(`
`).filter(b=>b.includes("ApproachRate:")).at(0).replaceAll("ApproachRate:","")),J.stats.circleSize=parseFloat(t.split(`
`).filter(b=>b.includes("CircleSize:")).at(0).replaceAll("CircleSize:","")),J.stats.HPDrainRate=parseFloat(t.split(`
`).filter(b=>b.includes("HPDrainRate:")).at(0).replaceAll("HPDrainRate:","")),J.stats.stackLeniency=t.includes("StackLeniency: ")?parseFloat(t.split(`
`).filter(b=>b.includes("StackLeniency: ")).at(0).replaceAll("StackLeniency: ","")):.7,J.SAMPLE_SET=t.includes("SampleSet: ")?t.split(`
`).filter(b=>b.includes("SampleSet: ")).at(0).replaceAll("SampleSet: ",""):"Normal",J.stats.sliderTickRate=parseFloat(t.split(`
`).filter(b=>b.includes("SliderTickRate:")).at(0).replaceAll("SliderTickRate:","")),J.stats.overallDifficulty=parseFloat(t.split(`
`).filter(b=>b.includes("OverallDifficulty:")).at(0).replaceAll("OverallDifficulty:",""));const s=p.MODS.HR?1.3:1,n=p.MODS.EZ?.5:1;J.hitWindows={GREAT:Math.floor(80-6*ot(J.stats.overallDifficulty*s*n,0,10)),OK:Math.floor(140-8*ot(J.stats.overallDifficulty*s*n,0,10)),MEH:Math.floor(200-10*ot(J.stats.overallDifficulty*s*n,0,10))},J.stats.circleDiameter=2*(54.4-4.48*J.stats.circleSize)*236/256,J.stackThreshold=J.stats.preempt*J.stats.stackLeniency,t.indexOf("[Difficulty]")+13;const r=t.indexOf("[TimingPoints]")+15,o=t.indexOf("[Colours]")+10,a=t.indexOf("[HitObjects]")+13,l=parseFloat(t.split(`
`).find(b=>/^SliderMultiplier:/g.test(b)).replace("SliderMultiplier:",""))*100,c=t.slice(r,t.indexOf("[Colours]")!==-1?o-10:a-13).split(`
`).filter(b=>{const A=b.split(",");return b!==""&&A[1]>0}).map(b=>{const A=b.split(",");return{time:parseInt(A[0]),beatstep:parseFloat(A[1])}});J.beatStepsList=c;const h=t.slice(r,t.indexOf("[Colours]")!==-1?o-10:a-13).split(`
`).filter(b=>b!=="").map(b=>{const A=b.split(",");return{time:parseInt(A[0]),beatstep:parseFloat(A[1])>0?parseFloat(A[1]):void 0,svMultiplier:parseFloat(A[1])>0?1:parseFloat((-1/A[1]*100).toFixed(2)),sampleSet:parseInt(A[3]??"0"),sampleIdx:parseInt(A[4]??"0"),sampleVol:parseInt(A[5]??"100"),isKiai:parseInt(A[7]??0)!==0}});J.timingPointsList=h,h.forEach((b,A)=>{const C=new Cf(b);Y.beatLines.greenLines.push(C)}),J.kiaiList=h.filter((b,A)=>{var C;return!!(b.isKiai&&(!h[A-1]||!h[A-1].isKiai)||!b.isKiai&&((C=h[A-1])!=null&&C.isKiai)||b.isKiai&&A===h.length-1)}),J.mergedPoints=[...J.beatStepsList,...J.timingPointsList].sort((b,A)=>b.time<A.time?-1:b.time>A.time||b.beatstep?1:A.beatstep?-1:0),Pt.initTimingPoints(),Tt.initTimingPoints();let u=t.indexOf("[Colours]")!==-1?t.slice(o,a-13).split(`
`).filter(b=>b!==""&&b.match(/Combo[0-9]+\s:\s/g)).map(b=>`rgb(${b.replaceAll(b.match(/Combo[0-9]+\s:\s/g)[0],"")})`).map(b=>parseInt(b.replaceAll("rgb(","").replaceAll(")","").split(",").map(A=>parseInt(A).toString(16).padStart(2,"0")).join(""),16)):[];u.length===0&&(u=at.DEFAULT_COLORS),J.COLORS=at.DEFAULT_COLORS,J.COLORS=u;const d=t.split(`
`).filter(b=>/^2,[0-9]+,[0-9]+$/g.test(b)).map(b=>b.split(",").slice(1).map(A=>parseInt(A)));J.breakPeriods=d,Pt.initBreakKiai();let f=t.slice(a).split(`
`).filter(b=>b!==""),m=1,y=1,g=1,E=performance.now();const T=f.map((b,A)=>{const C=b.split(","),R=parseInt(C[2]);let O=J.findNearestTimingPoint(R,"timingPointsList"),M,w=null;const I=parseInt(C[3]).toString(2).padStart(8,"0").split("").reverse().map(D=>D==="1"),L=parseInt(parseInt(C[3]).toString(2).padStart(8,"0").split("").reverse().slice(4,7).reverse().join(""),2);return I[0]&&(M=J.constructHitCircle(C,O),w=new Ji(M.obj)),I[1]&&(M=J.constructSlider(C,h,c,l,b),w=new Sn(M.obj)),I[3]&&(M=J.constructSpinner(C,O),w=new Sn(M.obj)),I[2]&&A!==0&&(m=1,y++,g++),L!==0&&I[2]&&(g+=L),M.obj.comboIdx=m,M.obj.colourIdx=y,M.obj.colourHaxedIdx=g,M.obj instanceof Qt&&(M.obj.hitCircle.comboIdx=m,M.obj.hitCircle.colourIdx=y,M.obj.hitCircle.colourHaxedIdx=g),M.obj instanceof Ie&&(M.obj.comboIdx=1,M.obj.colourIdx=-1,M.obj.colourHaxedIdx=-1),m++,{...M,timelineObject:w}}).filter(b=>b);console.log(`Took: ${performance.now()-E}ms to finish objects construction.`),this.objectsController=new Si(T,u,d),J.updateStats(),J.updateModdedStats(),this.applyStacking(),this.objectsController.objectsList.forEach((b,A,C)=>{A!==this.objectsController.objectsList.length-1&&C[A+1].obj.comboIdx!==1&&(b.obj instanceof Ie||(b.obj.followPoint=new U1({startObj:b.obj,endObj:C[A+1].obj})))}),this.objectsController.slidersList.forEach(b=>{b.obj.hitCircle.stackHeight=b.obj.stackHeight}),p.WORKER.postMessage({type:"objects",objects:T.map((b,A)=>({idx:A,time:b.obj.time,endTime:b.obj.endTime,startTime:b.obj.startTime,killTime:b.obj.killTime}))});const _=(this.objectsController.objectsList.at(-1).obj.time-(d.reduce((b,A)=>b+(A[1]-A[0]),0)+this.objectsController.objectsList.at(0).obj.time))/1e3;J.difficultyMultiplier=Math.round((J.stats.HPDrainRate+J.stats.circleSize+J.stats.overallDifficulty+ot(this.objectsController.objectsList.length/_*8,0,16))/38*5),J.hasILLEGAL&&new di({message:"This beatmap contains illegal hitobjects. Therefore, Timeline will be disabled for this map",type:"warning",autoTimeout:!1}).notify()}static difficultyRange(t,e,s,n){return t>5?s+(n-s)*(t-5)/5:t<5?s-(s-e)*(5-t)/5:s}static reverseDifficultyRange(t,e,s,n){const r=(t-s)*5/(n-s)+5,o=5-(s-t)*5/(s-e);return r>5&&o>5?r:o<5&&r<5?o:5}static updateModdedStats(){const t=p.MODS.HR?1.4:1,e=p.MODS.EZ?.5:1,s=p.MODS.HR?1.3:1,n=Math.min(J.stats.circleSize*s*e,10),r=Math.min(J.stats.approachRate*t*e,10),o=Math.min(J.stats.HPDrainRate*t*e,10),a=Math.min(J.stats.overallDifficulty*t*e,10);p.WORKER.postMessage({type:"updateStats",mods:p.MODS,playbackRate:p.PLAYBACK_RATE,moddedStats:{circleSize:n,approachRate:r,HPDrainRate:o,overallDifficulty:a,preempt:J.difficultyRange(r,1800,1200,450),fadeIn:J.difficultyRange(r,1200,800,300),radius:54.4-4.48*n,stackOffset:-6.4*(1-.7*(n-5)/5)/2}}),J.moddedStats={...J.stats,circleSize:n,approachRate:r,HPDrainRate:o,overallDifficulty:a,preempt:J.difficultyRange(r,1800,1200,450),fadeIn:J.difficultyRange(r,1200,800,300),radius:54.4-4.48*n,stackOffset:-6.4*(1-.7*(n-5)/5)/2},J.stackThreshold=J.moddedStats.preempt*J.moddedStats.stackLeniency}static updateStats(){const{circleSize:t,approachRate:e}=J.stats;J.stats={...J.stats,preempt:J.difficultyRange(e,1800,1200,450),fadeIn:J.difficultyRange(e,1200,800,300),radius:54.4-4.48*t,stackOffset:-6.4*(1-.7*(t-5)/5)/2},J.stackThreshold=J.moddedStats.preempt*J.moddedStats.stackLeniency}static constructSpinner(t,e){const s=t.map(h=>h===""||!h?null:h),n=parseInt(s[2]),r=parseInt(s[5]),o=s[4],a=s.at(-1),l=ue.GetName(a,o,e),c=new jt(l,e.sampleVol/100);return{obj:new Ie(n,r,c),hitsounds:c}}static constructSlider(t,e,s,n,r){const o=parseInt(t[4]),a=parseInt(t[2]),l=J.findNearestTimingPoint(a,"timingPointsList",!0),c=J.findNearestTimingPoint(a,"timingPointsList"),{beatstep:h}=J.findNearestTimingPoint(a,"beatStepsList",!0),u=parseInt(t[6]),d=parseFloat(t[7]),f=a+u*d/c.svMultiplier/n*h,m=J.findNearestTimingPoint(f,"timingPointsList"),y=t[8],g=t[9],E=/^\d:\d.*/g.test(t.at(-1))?t.at(-1):"0:0",T=ue.GetName((g==null?void 0:g.split("|")[0])??E,(y==null?void 0:y.split("|")[0])??o,c),_=ue.GetName((g==null?void 0:g.split("|").at(-1))??E,(y==null?void 0:y.split("|").at(-1))??o,m),b=[...Array(u-1)].map((v,P)=>{const q=a+(P+1)*d/c.svMultiplier/n*h,$=J.findNearestTimingPoint(q,"timingPointsList"),et=ue.GetName((g==null?void 0:g.split("|")[P+1])??E,(y==null?void 0:y.split("|")[P+1])??o,$);return new jt(et,$.sampleVol/100)}),[A,C,,R]=t,O=t[5].slice(2),M=t[5][0],w={normal:parseInt(E.split(":")[0]),additional:parseInt(E.split(":")[1]),hitSoundIdx:o},{normalSet:I}=ue.GetHitSample(E,c),L=new jt([`${I}-sliderslide${c.sampleIdx}`],c.sampleVol/100),D=new jt([`${I}-sliderwhistle${c.sampleIdx}`],c.sampleVol/100),N={sliderHead:new jt(T,c.sampleVol/100),sliderTail:new jt(_,m.sampleVol/100),sliderReverse:b,sliderSlide:L,sliderWhistle:D,defaultSet:w};return{obj:new Qt(`${A}:${C}|${O}`,M,d,l.svMultiplier,n,h,a,u,N,r),hitsounds:N}}static constructHitCircle(t,e){const s=t.map(f=>f===""||!f?null:f),[n,r,o,a,l,...c]=s,h=c.at(-1),u=ue.GetName(h,l,e);parseInt(o)===208128&&console.log(e,u);const d=new jt(u,e.sampleVol/100);return{obj:new Pe(n,r,parseInt(o),d),hitsounds:d}}static findNearestTimingPoint(t,e,s){return J[e][J.findNearestTimingPointIndex(t,e,s)]}static findNearestTimingPointIndex(t,e,s){const n=s?0:2;let r=vs(J[e],t,(o,a)=>o.time<a+n?-1:o.time>a+n?1:0);for(;r>0&&J[e][r].time>t+n;)r--;for(;r+1<J[e].length&&J[e][r+1].time<=t+n;)r++;return J[e][r].time>t+n?0:r}static async loadProgressBar(){const t=document.createElement("div");t.classList.add("timingWrapper"),J.timingPointsList.forEach(e=>{const s=document.createElement("div");s.classList.add("greenLine"),s.style.left=`${e.time/p.BEATMAP_FILE.audioNode.duration*100}%`,t.appendChild(s)}),J.beatStepsList.forEach(e=>{const s=document.createElement("div");s.classList.add("redLine"),s.style.left=`${e.time/p.BEATMAP_FILE.audioNode.duration*100}%`,t.appendChild(s)}),document.querySelector(".timingPointsContainer").prepend(t),domtoimage.toPng(t).then(e=>{document.querySelector(".timingPointsContainer").removeChild(t),document.querySelector(".timingPointsContainer img").src=e})}static async loadTimingPoints(){[...document.querySelectorAll(".timingPoint")].forEach(t=>document.querySelector(".timingPanel").removeChild(t)),J.mergedPoints.forEach(t=>{const e=document.createElement("div");e.classList.add("timingPoint");const s=document.createElement("div");s.classList.add("timestamp");const n=document.createElement("div");n.classList.add("timingContent");const r=document.createElement("div");r.classList.add("timingFlair");const o=document.createElement("div");o.classList.add("timingValue"),n.append(r,o),e.append(s,n);let a=t.time;const l=a<0;a<0&&(a*=-1);const c=Math.floor(a/6e4),h=Math.floor((a-c*6e4)/1e3),u=a-c*6e4-h*1e3;if(s.textContent=`${l?"-":""}${c.toString().padStart(2,"0")}:${h.toString().padStart(2,"0")}:${u.toFixed(0).padStart(3,"0")}`,t.beatstep){o.textContent=`${(6e4/t.beatstep).toFixed(2)} BPM`,e.classList.add("beatStepPoint"),document.querySelector(".timingPanel").append(e);return}const d=document.createElement("div");d.classList.add("timingValue"),t.isKiai&&n.classList.add("kiai"),t.sampleIdx!==0?d.textContent=`${ue.HIT_SAMPLES[t.sampleSet][0].toUpperCase()}:C${t.sampleIdx}`:d.textContent=`${ue.HIT_SAMPLES[t.sampleSet][0].toUpperCase()}`;const f=document.createElement("div");f.classList.add("timingValue"),f.textContent=`${t.sampleVol}%`,n.append(d,f),o.textContent=`${t.svMultiplier.toFixed(2)}x`,e.classList.add("svPoint"),document.querySelector(".timingPanel").append(e)}),document.querySelector(".timings").textContent=`timings (${J.mergedPoints.length})`}static loadMetadata(t){const e=h=>{var u;return((u=t.filter(d=>d.includes(`${h}:`)).at(0))==null?void 0:u.replaceAll(`${h}:`,""))??""},s=e("Artist"),n=e("ArtistUnicode"),r=e("Title"),o=e("TitleUnicode"),a=e("Version"),l=e("Source"),c=e("Tags");St.artist=n,St.romanized_artist=s,St.title=o,St.romanized_title=r,St.difficulty_name=a,St.source=l,St.tag=c}applyStacking(){let t=this.objectsController.objectsList.length-1,e=0;const s=3;for(let n=t;n>0;n--){let r=n,o=this.objectsController.objectsList[n];if(!(o.obj.stackHeight!=0||o.obj instanceof Ie||o.obj.ILLEGAL)){if(o.obj instanceof Pe)for(;--r>=0;){const a=this.objectsController.objectsList[r],l=a.obj.endTime;if(o.obj.time-l>J.stackThreshold)break;if(r<e&&(a.obj.stackHeight=0,e=r),a.obj instanceof Qt&&this.calculateDistance([a.obj.angleList.at(-1).x,a.obj.angleList.at(-1).y],[parseInt(o.obj.originalX),parseInt(o.obj.originalY)])<s){let c=o.obj.stackHeight-a.obj.stackHeight+1;for(let h=r+1;h<=n;h++){const u=this.objectsController.objectsList[h];this.calculateDistance([a.obj.angleList.at(-1).x,a.obj.angleList.at(-1).y],u.obj instanceof Qt?[u.obj.angleList.at(0).x,u.obj.angleList.at(0).y]:[parseInt(u.obj.originalX),parseInt(u.obj.originalY)])&&(u.obj.stackHeight-=c)}break}this.calculateDistance(a.obj instanceof Qt?[a.obj.angleList.at(0).x,a.obj.angleList.at(0).y]:[parseInt(a.obj.originalX),parseInt(a.obj.originalY)],[parseInt(o.obj.originalX),parseInt(o.obj.originalY)])<s&&(a.obj.stackHeight=o.obj.stackHeight+1,o=a)}else if(o.obj instanceof Qt)for(;--r>=0;){const a=this.objectsController.objectsList[r];if(o.obj.time-a.obj.time>J.stackThreshold)break;this.calculateDistance(a.obj instanceof Qt?[a.obj.angleList.at(-1).x,a.obj.angleList.at(-1).y]:[parseInt(a.obj.originalX),parseInt(a.obj.originalY)],o.obj instanceof Qt?[o.obj.angleList.at(0).x,o.obj.angleList.at(0).y]:[parseInt(o.obj.originalX),parseInt(o.obj.originalY)])<s&&(a.obj.stackHeight=o.obj.stackHeight+1,o=a)}}}}calculateDistance(t,e){const s=t[0]-e[0],n=t[1]-e[1];return Math.sqrt(s**2+n**2)}render(){this.objectsController.render()}};S(J,"SAMPLE_SET","Normal"),S(J,"COLORS"),S(J,"HREF",null),S(J,"hasILLEGAL",!1),S(J,"difficultyMultiplier",1),S(J,"stats",{approachRate:5,circleSize:5,HPDrainRate:5,overallDifficulty:5,stackLeniency:7,circleDiameter:2*(54.4-4.48*5)*236/256,preempt:1200,fadeIn:800,sliderTickRate:1,radius:54.4-4.48*5,stackOffset:-6.4*(1-.7*0/5)/2}),S(J,"moddedStats",{approachRate:5,circleSize:5,HPDrainRate:5,overallDifficulty:5,stackLeniency:7,circleDiameter:2*(54.4-4.48*5)*236/256,preempt:1200,fadeIn:800,sliderTickRate:1,radius:54.4-4.48*5,stackOffset:-6.4*(1-.7*0/5)/2}),S(J,"hitWindows",{GREAT:80,OK:140,MEH:200}),S(J,"beatStepsList",[]),S(J,"timingPointsList",[]),S(J,"breakPeriods",[]),S(J,"kiaiList",[]),S(J,"mergedPoints",[]),S(J,"stackThreshold");let B=J;class Cf{constructor(t){S(this,"greenLine");S(this,"sv");S(this,"sample");this.greenLine=t;const e=new Ve({text:`${this.greenLine.svMultiplier.toFixed(2)}x`,style:{fontFamily:"Torus",fontSize:12,fontWeight:500,align:"center",tint:1447446}});let{width:s,height:n}=e;s+=10,n+=3,this.sv=new ut,this.svGraphics=new ft().roundRect(-s/2,0,s,n,10).fill(9040035),this.sv.addChild(this.svGraphics,e),this.sv.cullable=!0,e.x=0,e.y=1,e.anchor.set(.5,0),this.sv.y=0;let r=this.greenLine.sampleIdx!=0?`:C${this.greenLine.sampleIdx}`:"";const o=new Ve({text:`${(ue.HIT_SAMPLES[this.greenLine.sampleSet][0]??"").toUpperCase()}${r}`,style:{fontFamily:"Torus",fontSize:12,fontWeight:500,tint:1447446}});o.x=0,o.anchor.set(.5);let{width:a,height:l}=o;a+=10,l+=3,o.y=-l/2,this.sample=new ut,this.sampleGraphics=new ft().roundRect(-a/2,-l,a,l,10).fill(16449397),this.sample.addChild(this.sampleGraphics,o),this.sample.cullable=!0,this.sample.y=Y.HEIGHT}static findGreenLineInRange(t){var o;const e=Y.WIDTH/2/Y.ZOOM_DISTANCE*500+t,s=((o=Si.CURRENT_SV)==null?void 0:o.time)??0;if(e<s)return[];let n=vs(Y.beatLines.greenLines,s,(a,l)=>a.greenLine.time<l?-1:a.greenLine.time>l?1:0);for(;n>0&&Y.beatLines.greenLines[n].greenLine.time>=t-Y.WIDTH/2/Y.ZOOM_DISTANCE*500;)n--;const r=[];for(;n<Y.beatLines.greenLines.length&&Y.beatLines.greenLines[n].greenLine.time<=e;)r.push(Y.beatLines.greenLines[n++]);return r}draw(t){const e=Y.WIDTH/2,s=t-this.greenLine.time;this.sv.x=Math.max(e-s/500*Y.ZOOM_DISTANCE,this.sv.width/2+5),this.sample.x=Math.max(e-s/500*Y.ZOOM_DISTANCE,this.sample.width/2+5),this.sample.y=Y.HEIGHT}}const Hr=class Hr{constructor(){S(this,"obj");S(this,"ticks",[]);S(this,"tickTexture");S(this,"greenLines",[]);S(this,"drawList",[]);this.container=new ut,this.obj=new ft,this.container.addChild(this.obj)}getLineInRange(t,e,s){const n=vs(B[s],t,(c,h)=>c.time<h?-1:c.time>h?1:0),r=[],o=B[s][n];o.time>=t-e&&o.time<=t+e&&r.push(o);let a=n-1,l=n+1;for(;a>=0&&B[s][a].time>=t-e&&B[s][a].time<=t+e;)r.push(B[s][a--]);for(;l<B[s].length&&B[s][l].time>=t-e&&B[s][l].time<=t+e;)r.push(B[s][l++]);return r}draw(t){this.obj.clear();const{beatstep:e,time:s}=B.beatStepsList.findLast(y=>y.time<t)??B.beatStepsList[0],n=Y.WIDTH/2/Y.ZOOM_DISTANCE*500,r=this.getLineInRange(t,n,"timingPointsList").toSorted((y,g)=>y.time>g.time?1:y.time<g.time?-1:y.beatstep?1:g.beatstep?-1:0),o=parseInt(p.MAPPING.beatsnap),a=e/o,l=t-s,c=Math.round(l/a),h=s+c*a,u=a*(Y.ZOOM_DISTANCE/500),d=(t-h)*(Y.ZOOM_DISTANCE/500),f=Math.ceil(n/a),m=Y.WIDTH/2;for(let y=0;y<r.length;y++){const g=t-r[y].time,E=m-g/500*Y.ZOOM_DISTANCE,T=Y.HEIGHT;this.obj.setStrokeStyle({width:1,color:r[y].beatstep?14894675:1821728,alignment:.5,alpha:.9}).moveTo(E,T).lineTo(E,T-40).stroke()}for(let y=-f;y<=f;y++){const g=h+y*a-s,E=Math.round(g/e),T=s+E*e;let _=Math.round(e/Math.abs(T-(h+y*a)));(o===5||o===10)&&(_=5),_>48&&(_=1);const b=m+y*u-d,A=Y.HEIGHT;this.obj.setStrokeStyle({width:1,color:Hr.BEAT_LINE_COLOR[_]??9605778,alignment:.5}).moveTo(b,A).lineTo(b,A-10).stroke()}this.drawList.forEach(y=>{this.container.removeChild(y.sv),this.container.removeChild(y.sample)}),this.drawList=[],Y.SHOW_GREENLINE&&(this.drawList=Cf.findGreenLineInRange(t),this.drawList.forEach(y=>{this.container.addChild(y.sv),this.container.addChild(y.sample),y.draw(t)}))}};S(Hr,"BEAT_LINE_COLOR",{1:16777215,2:16711680,3:11994807,4:3307238,5:15132165,6:8666756,7:15132165,8:15132165,9:15132165});let Ma=Hr;class bh{constructor(){S(this,"x");S(this,"y");S(this,"w");S(this,"h");S(this,"isHover",!1);S(this,"container")}async init(t,e,s,n,r){if(this.x=t,this.y=e,this.w=s,this.h=n,this.graphics=new ft().rect(0,0,s,n).fill(p.COLOR_PALETTES.primary3),this.container=new ut,this.container.on("mouseenter",()=>{this.isHover=!0,this.draw()}),this.container.on("mouseleave",()=>{this.isHover=!1,this.draw()}),this.container.eventMode="static",this.container.x=this.x,this.container.y=this.y,this.container.addChild(this.graphics),r){const o=await bt.load(r),a=new Mt(o);this.container.addChild(a),a.anchor.set(.5),a.x=this.w/2,a.y=this.h/2,this.sprite=a}}setOnClick(t){this.container.on("click",t),this.container.on("tap",t)}draw(t){this.h=Y.MASTER_CONTAINER.h/2,this.container.x=this.x,this.container.y=this.y===0?0:Y.MASTER_CONTAINER.h/2,this.graphics.clear().rect(0,0,this.w,this.h).fill(this.isHover?p.COLOR_PALETTES.primary4:p.COLOR_PALETTES.primary3),this.sprite&&(this.sprite.scale.set(.5),this.sprite.x=this.w/2,this.sprite.y=this.h/2)}}class G1{constructor(){S(this,"graphics");S(this,"zoomIn");S(this,"zoomOut");S(this,"container")}async init(){this.graphics=new ft().rect(0,0,40,Y.HEIGHT).fill(p.COLOR_PALETTES.primary3),this.container=new ut,this.container.addChild(this.graphics),this.zoomIn=new bh,await this.zoomIn.init(0,0,40,Y.MASTER_CONTAINER.h/2,"static/plus2.svg"),this.zoomOut=new bh,await this.zoomOut.init(0,Y.MASTER_CONTAINER.h/2,40,Y.MASTER_CONTAINER.h/2,"static/minus.svg"),this.container.addChild(this.zoomIn.container),this.container.addChild(this.zoomOut.container),this.zoomIn.setOnClick(()=>{Y.ZOOM_DISTANCE=ot(Y.ZOOM_DISTANCE+1*20,20,800);const t=JSON.parse(localStorage.getItem("settings"));t.timeline.zoomRate=Y.ZOOM_DISTANCE,localStorage.setItem("settings",JSON.stringify(t)),p.WORKER.postMessage({type:"range",range:Y.WIDTH/2/Y.ZOOM_DISTANCE*500+Y.LOOK_AHEAD})}),this.zoomOut.setOnClick(()=>{Y.ZOOM_DISTANCE=ot(Y.ZOOM_DISTANCE-1*20,20,800);const t=JSON.parse(localStorage.getItem("settings"));t.timeline.zoomRate=Y.ZOOM_DISTANCE,localStorage.setItem("settings",JSON.stringify(t)),p.WORKER.postMessage({type:"range",range:Y.WIDTH/2/Y.ZOOM_DISTANCE*500+Y.LOOK_AHEAD})})}draw(t){this.graphics.clear().rect(0,0,40,Y.HEIGHT).fill(p.COLOR_PALETTES.primary3),this.zoomIn.draw(t),this.zoomOut.draw(t)}}const Q=class Q{static get SHOW_GREENLINE(){return this._SHOW_GREENLINE}static set SHOW_GREENLINE(t){if(this._SHOW_GREENLINE=t,this.HEIGHT_REDUCTION===60)return;if(t){const s=this.HEIGHT_REDUCTION;new wi.Tween({reduction:s}).to({reduction:s-30},200).onUpdate(({reduction:n})=>Q.HEIGHT_REDUCTION=n).easing(wi.Easing.Sinusoidal.InOut).start();return}const e=this.HEIGHT_REDUCTION;new wi.Tween({reduction:e}).to({reduction:0},200).onUpdate(({reduction:s})=>Q.HEIGHT_REDUCTION=s).easing(wi.Easing.Sinusoidal.InOut).start()}static async init(){Q.HEIGHT_REDUCTION=p.IS_FULLSCREEN?60:Q.SHOW_GREENLINE?-30:0,Q.MASTER_CONTAINER=new gi(0,0,p.APP.renderer.width,60-Q.HEIGHT_REDUCTION),Q.MASTER_CONTAINER.color=0,Q.MASTER_CONTAINER.alpha=.5,Q.WIDTH=Q.MASTER_CONTAINER.w,Q.HEIGHT=Q.MASTER_CONTAINER.h,Q.BASE_CONTAINER=new ut,Q.BASE_CONTAINER.x=40,Q.MASTER_CONTAINER.container.addChild(Q.BASE_CONTAINER),Q.hitArea=new fT,Q.BASE_CONTAINER.addChild(Q.hitArea.obj),Q.obj=new ut,Q.BASE_CONTAINER.addChild(Q.obj),Q.ZOOMER=new G1,await Q.ZOOMER.init(),Q.MASTER_CONTAINER.container.addChild(Q.ZOOMER.container),Q.centerLine=new ft().setStrokeStyle({width:1,color:16777215,alignment:1}).moveTo(-1,0).lineTo(-1,1).moveTo(1,0).lineTo(1,1).stroke(),Q.BASE_CONTAINER.addChild(Q.centerLine),Q.beatLines=new Ma,Q.BASE_CONTAINER.addChild(Q.beatLines.container),p.WORKER.postMessage({type:"range",range:Q.WIDTH/2/Q.ZOOM_DISTANCE*500+Q.LOOK_AHEAD})}static resize(){p.IS_FULLSCREEN&&p.EMIT_STACK.length===0||(innerWidth/innerHeight<1?Q.MASTER_CONTAINER.w!==p.APP.renderer.width&&(Q.MASTER_CONTAINER.w=p.APP.renderer.width):Q.MASTER_CONTAINER.w!==p.APP.renderer.width-p.REDUCTION/400*410&&(Q.MASTER_CONTAINER.w=p.APP.renderer.width-p.REDUCTION/400*410),Q.MASTER_CONTAINER.h=60-Q.HEIGHT_REDUCTION,Q.BASE_CONTAINER.x=40,Q.ZOOMER.draw(),Q.MASTER_CONTAINER.redraw(),!(Q.WIDTH===Q.MASTER_CONTAINER.w&&Q.HEIGHT===Q.MASTER_CONTAINER.h)&&(Q.WIDTH=Q.MASTER_CONTAINER.w,Q.HEIGHT=Q.MASTER_CONTAINER.h,p.WORKER.postMessage({type:"range",range:Q.WIDTH/2/Q.ZOOM_DISTANCE*500+Q.LOOK_AHEAD}),Q.hitArea.resize()))}static updateOrder({removed:t,addBack:e,addTop:s}){const n=p.BEATMAP_FILE.beatmapRenderData.objectsController.objectsList;t.forEach(r=>{Q.hitArea.obj.removeChild(n[r.idx].timelineObject.obj)}),e.forEach(r=>{Q.hitArea.obj.addChildAt(n[r.idx].timelineObject.obj,0)}),s.forEach(r=>{Q.hitArea.obj.addChild(n[r.idx].timelineObject.obj)})}static draw(t){var s,n;if(p.IS_FULLSCREEN||!((n=(s=p.BEATMAP_FILE)==null?void 0:s.beatmapRenderData)!=null&&n.objectsController.objectsList))return;Q.beatLines.draw(t),Q.hitArea.draw(t),Q.centerLine.x=Q.WIDTH/2,Q.centerLine.scale.set(1,Q.HEIGHT);const e=p.BEATMAP_FILE.beatmapRenderData.objectsController.objectsList;this.DRAW_LIST.forEach(r=>{var o,a;(a=(o=e[r.idx])==null?void 0:o.timelineObject)==null||a.draw(t)})}static destruct(){Q.hitArea.clearAll(),this.DRAW_LIST.length=0}};S(Q,"obj"),S(Q,"hitArea"),S(Q,"centerLine"),S(Q,"beatLines"),S(Q,"APP"),S(Q,"WIDTH"),S(Q,"HEIGHT"),S(Q,"ZOOM_DISTANCE",200),S(Q,"LOOK_AHEAD",300),S(Q,"DRAW_LIST",[]),S(Q,"_SHOW_GREENLINE",!1),S(Q,"MASTER_CONTAINER"),S(Q,"BASE_CONTAINER"),S(Q,"ZOOMER"),S(Q,"HEIGHT_REDUCTION",0);let Y=Q;document.querySelector("#mapInput").onkeydown=j1;function j1(i){i.key==="Enter"&&(Qr(!1),document.querySelector("#mapInput").blur())}document.querySelector("#map-dropper").onchange=()=>{const i=document.querySelector("#map-dropper").files[0];if(["osz","osr","osk"].includes(i.name.split(".").at(-1))){if(nt.reset(),i.name.split(".").at(-1)==="osr"){new nt(i).getReplayData();return}if(i.name.split(".").at(-1)==="osk"){at.import(i);return}document.querySelector("#close").disabled=!0,rl(i)}};document.querySelector("#choose-diff").onclick=()=>{document.querySelector(".difficultySelector").style.display="block"};document.querySelector("#close").onclick=()=>{document.querySelector(".difficultySelector").style.display="none"};function W1(){p.DIFF_FILE_NAME=this.dataset.filename,document.querySelector(".difficultySelector").style.display="none",Qr(!0)}async function rl(i){var a,l;p.DROP_BLOB=null,p.DIFF_FILE_NAME="";const t=i,e=new zip.BlobReader(t),s=new zip.ZipReader(e),n=await s.getEntries(),r=document.querySelector(".difficultyList");r.innerHTML="",document.querySelector(".difficultySelector").style.display="block";const o=[];for(const c of n){if(c.filename.split(".").at(-1)!=="osu")continue;const u=await(await c.getData(new zip.BlobWriter("text/plain"))).text(),d=(a=u.split(`
`).filter(_=>/Mode:\s[0-9]+/g.test(_)).at(0))==null?void 0:a.replace("Mode: ","");if(parseInt(d)!==0)continue;const f={addStacking:!0,mods:[]},m=we.parseBlueprint(u),y=we.buildBeatmap(m,f),g=we.calculateDifficultyAttributes(y,!0)[0],E=(l=u.split(`
`).filter(_=>/Version:.+/g.test(_)).at(0))==null?void 0:l.replace("Version:",""),T=wf({name:E,fileName:c.filename,starRating:(g==null?void 0:g.starRating)??0});o.push(T)}o.sort((c,h)=>-c.starRating+h.starRating);for(const c of o)r.appendChild(c.ele);p.DROP_BLOB=i,s.close()}async function V1(i){const t=await Zi.downloadCustom(i);rl(t)}function Qr(i,t){var r;window.cancelAnimationFrame(Si.requestID);const e=t??document.querySelector("#mapInput").value.trim();if(!i&&/[(http(s)?):\/\/(www\.)?a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/gi.test(e)&&!/^https:\/\/osu\.ppy\.sh\/(beatmapsets\/[0-9]+\#osu\/[0-9]+|b\/[0-9]+)|[0-9]+$/.test(e)){V1(e);return}if(!i&&!/^https:\/\/osu\.ppy\.sh\/(beatmapsets\/[0-9]+\#osu\/[0-9]+|b\/[0-9]+)|[0-9]+$/.test(e)){document.querySelector("#mapInput").value="",alert("This is not a valid URL or Beatmap ID");return}const s=e.split("/").at(-1);p.BEATMAP_FILE!==void 0&&((r=p.BEATMAP_FILE.audioNode)==null||r.pause());const n=window.location.origin;i||window.history.pushState({},"JoSu!",`${n}${n.includes("github.io")?"/beatmap-viewer-web":""}/?b=${s}`),p.BEATMAP_FILE=void 0,p.BEATMAP_FILE=new Zi(s??-1,i),document.querySelector("#mapInput").value=i?"":s}document.querySelector("#submit").addEventListener("click",()=>{document.querySelector("#submit").blur(),nt.reset(),Qr(!1)});async function z1(){if(await qt.removeFromObjStore(this.parentElement.dataset.customIndex),at.SKIN_IDX==this.parentElement.dataset.customIndex){const i=JSON.parse(localStorage.getItem("settings"));i.skinning.type="2",i.skinning.val=-1,localStorage.setItem("settings",JSON.stringify(i))}delete at.SKIN_LIST[this.parentElement.dataset.customIndex],at.changeSkin(),delete st.CUSTOM[this.parentElement.dataset.customIndex],delete jt.SAMPLES.CUSTOM[this.parentElement.dataset.customIndex],document.querySelector("#skinDropdown").close(),document.querySelector("#skinDropdown").style.display="",await ol()}function Rf(){const i=at.SKIN_ENUM[this.parentElement.dataset.skinId.toUpperCase()],t=JSON.parse(localStorage.getItem("settings"));t.skinning.type=i,t.skinning.val=this.parentElement.dataset.customIndex,localStorage.setItem("settings",JSON.stringify(t)),p.SKINNING.type=i,this.parentElement.dataset.skinId==="custom"&&(at.SKIN_IDX=this.parentElement.dataset.customIndex),at.changeSkin(),document.querySelector("#skinDropdown").close(),document.querySelector("#skinDropdown").style.display=""}async function ol(){const i=await qt.readObjStore("skins"),t=await qt.getAllKeys();[...document.querySelectorAll('[data-skin-id="custom"]')].forEach(s=>s.remove());const e=document.querySelector("#skinDropdown");await es(s=>{for(const[n,r]of i.entries()){const o=t[n],{ini:a,base64s:l,samples:c}=r,h=document.createElement("div");h.classList.add("skinSelection"),h.dataset.skinId="custom",h.dataset.customIndex=o;const u=document.createElement("button");u.classList.add("skinName"),u.textContent=a.NAME,u.onclick=Rf;const d=document.createElement("button");d.classList.add("deleteButton"),d.innerHTML='<img width="18" height="18" src="/static/delete-forever.png" alt="delete-forever"/>',d.onclick=z1,h.appendChild(u),h.appendChild(d),e.appendChild(h);for(const f of["HIT_CIRCLE","HIT_CIRCLE_OVERLAY","SLIDER_B","REVERSE_ARROW","DEFAULTS","SLIDER_FOLLOW_CIRCLE","APPROACH_CIRCLE"]){if(!l[f])continue;if(f==="DEFAULTS"){s(st.updateNumberTextures(l[f],o));continue}const{base64:m,isHD:y}=l[f];s(st.updateTextureFor(f,m,y,o))}s(at.loadHitsounds(c,o))}}),at.SKIN_LIST=i.reduce((s,n,r)=>(s[t[r]]=n,s),{})}async function $1(){if(await qt.initDatabase(),document.querySelector("#loadingText").textContent=`Initializing: Default Samples.
Might take a while on first load.`,await X1(),document.querySelector("#loadingText").textContent=`Initializing: Default Skins.
Might take a while on first load.`,await ol(),localStorage.getItem("settings")){const i=JSON.parse(localStorage.getItem("settings"));[...document.querySelectorAll('[name="mirror"]')].forEach(t=>{if(t.value===i.mirror.val){t.checked=!0,document.querySelector(".mirrorIndicator").textContent=`Too slow? Switch to another mirror (currently using: ${t.value==="custom"?"Custom":document.querySelector(`[for=${t.value}]`).textContent})`,document.querySelector(`[data-mirror=${t.value}]`).style.display="none";return}t.value!=="custom"&&(document.querySelector(`[data-mirror="${t.value}"]`).style.display="block")}),document.querySelector(".rendererSelector").textContent=[...document.querySelectorAll(".rendererSelection")].find(t=>t.dataset.renderer===i.renderer.val).textContent,document.querySelector("#resolution").value=i.renderer.resolution,document.querySelector("#resolutionVal").innerHTML=i.renderer.resolution.toFixed(2),p.RESOLUTION=i.renderer.resolution,document.querySelector("#aa").checked=i.renderer.aa,at.SKIN_IDX=i.skinning.val,at.changeSkin(),document.querySelector("#custom-mirror").value=i.mirror.custom,document.querySelector("#dim").value=i.background.dim,document.querySelector("#bgDimVal").innerHTML=`${parseInt(i.background.dim*100)}%`,Lt.changeOpacity(i.background.dim),p.ALPHA=i.background.dim,document.querySelector("#blur").value=i.background.blur,document.querySelector("#bgBlurVal").innerHTML=`${parseInt(i.background.blur/20*100)}%`,document.querySelector(".mapBG").style.filter=`blur(${i.background.blur}px)`,document.querySelector("#video").checked=i.background.video,document.querySelector("#transcode").checked=i.background.transcodeVideo,document.querySelector("#storyboard").checked=i.background.storyboard,p.IS_STORYBOARD=i.background.storyboard,xt.container.visible=p.IS_STORYBOARD,document.querySelector("#master").value=i.volume.master,document.querySelector("#masterVal").innerHTML=`${parseInt(i.volume.master*100)}%`,document.querySelector("#music").value=i.volume.music,document.querySelector("#musicVal").innerHTML=`${parseInt(i.volume.music*100)}%`,document.querySelector("#effect").value=i.volume.hs,document.querySelector("#effectVal").innerHTML=`${parseInt(i.volume.hs/.4*100)}%`,document.querySelector("#softoffset").value=i.mapping.offset,document.querySelector("#softoffsetVal").innerHTML=`${parseInt(i.mapping.offset)}ms`,document.querySelector("#disableBMHS").checked=i.volume.disableBMHS,document.querySelector("#showGreenLine").checked=i.mapping.showGreenLine,Object.keys(i.sliderAppearance).forEach(t=>{["snaking","sliderend","hitAnim","ignoreSkin","showGrid","disablePerfect"].includes(t)&&(document.querySelector(`#${t}`).checked=i.sliderAppearance[t])}),document.querySelector("#beat").value=i.mapping.beatsnap,document.querySelector("#beatVal").innerHTML=`1/${i.mapping.beatsnap}`,Y.SHOW_GREENLINE=i.mapping.showGreenLine,Y.ZOOM_DISTANCE=i.timeline.zoomRate}}function ot(i,t,e){return Math.max(Math.min(i,e),t)}const Y1=ff().domain([.1,1.25,2,2.5,3.3,4.2,4.9,5.8,6.7,7.7,9]).clamp(!0).range(["#4290FB","#4FC0FF","#4FFFD5","#7CFF4F","#F6F05C","#FF8068","#FF4E6F","#C645B8","#6563DE","#18158E","#000000"]).interpolate(mn.gamma(2.2)),al=i=>i<.1?"#AAAAAA":i>=9?"#000000":Y1(i),wf=i=>{const t=document.createElement("div");t.classList.add("diff");const e=document.createElement("div");e.classList.add("icon");const s=document.createElement("div");s.classList.add("colorRing"),s.style.border=`solid 4px ${al(i.starRating)}`,e.append(s);const n=document.createElement("div");n.classList.add("infoContainer");const r=document.createElement("div");r.classList.add("diffName");const o=document.createElement("div");return o.classList.add("starRating"),r.textContent=i.name,o.textContent=`Star Rating: ${i.starRating.toFixed(2)}`,n.append(r,o),t.append(e,n),t.dataset.filename=i.fileName,t.dataset.starrating=i.starRating,t.onclick=W1,{...i,ele:t}},ii=i=>Math.round((i+Number.EPSILON)*100)/100,xh=i=>{var o,a,l,c,h,u;const e=new Vibrant(i).swatches(),s=document.querySelector(":root"),n=((o=e.DarkMuted)==null?void 0:o.getRgb())??((a=e.DarkVibrant)==null?void 0:a.getRgb());if(n){const d=(.299*parseInt(n[0])+.587*parseInt(n[1])+.114*parseInt(n[2]))/255;let f=pe(`rgb(${parseInt(n[0])}, ${parseInt(n[1])}, ${parseInt(n[2])})`);if(d<.1){const y=.1/d,g=-Math.log(y)/Math.log(.7);f=f.brighter(g)}[f.darker(2).formatHex(),f.darker(1).formatHex(),f.formatHex(),f.brighter(.6).formatHex(),f.brighter(1.2).formatHex()].forEach((y,g)=>{s.style.setProperty(`--primary-${g+1}`,y),p.COLOR_PALETTES[`primary${g+1}`]=y}),p.STATS.container.color=p.COLOR_PALETTES.primary2,p.INFO.MASTER_CONTAINER.color=p.COLOR_PALETTES.primary3,ie.MASTER_CONTAINER.color=p.COLOR_PALETTES.primary4,ae.MASTER_CONTAINER.color=p.COLOR_PALETTES.primary3,se.MASTER_CONTAINER.color=p.COLOR_PALETTES.primary2,se.playButton.color=p.COLOR_PALETTES.primary2,se.prevButton.color=p.COLOR_PALETTES.primary2,se.nextButton.color=p.COLOR_PALETTES.primary2,se.infoButton.color=p.COLOR_PALETTES.primary2,Ii.obj.color=p.COLOR_PALETTES.primary1,Pt.MASTER_CONTAINER.color=p.COLOR_PALETTES.primary1,St.MASTER_CONTAINER.color=p.COLOR_PALETTES.primary3,St.container.color=p.COLOR_PALETTES.primary1,Y.ZOOMER.draw()}const r=((l=e.LightVibrant)==null?void 0:l.getRgb())??((c=e.LightMuted)==null?void 0:c.getRgb())??((h=e.Vibrant)==null?void 0:h.getRgb())??((u=e.Muted)==null?void 0:u.getRgb())??[255,255,255];if(r){const d=pe(`rgb(${parseInt(r[0])}, ${parseInt(r[1])}, ${parseInt(r[2])})`);s.style.setProperty("--accent-1",d.formatHex()),p.COLOR_PALETTES.accent1=d.formatHex()}Pt.restyle()};async function X1(){await es(i=>{for(const t of["ARGON","LEGACY"])for(const e of["normal","soft","drum"])for(const s of["hitnormal","hitwhistle","hitfinish","hitclap","slidertick","sliderwhistle","sliderslide"])i(async()=>{document.querySelector("#loadingText").innerHTML=`Initializing: Default Samples.
(${t}: ${e}-${s})
Might take a while on first load.`;const n=await qt.getDefaults("samples",`${e}-${s}`,t.toLowerCase()),r=await p.AUDIO_CTX.decodeAudioData(n);jt.SAMPLES[t][`${e}-${s}`]=r,jt.DEFAULT_SAMPLES[t][`${e}-${s}`]=r})})}async function q1(i,t,e){try{if(!e){jt.SAMPLES.MAP[`${i}${t}`]=null;return}const s=await p.AUDIO_CTX.decodeAudioData(e);jt.SAMPLES.MAP[`${i}${t}`]=s}catch{console.log(`Unable to decode ${i}${t}`)}}function K1(i){return new Promise(async(t,e)=>{const n=await(await fetch(i)).blob(),r=new FileReader;r.readAsDataURL(n),r.onload=()=>{const o=r.result;t(o)}})}const Qi=(i,t,e)=>{let s=0,n=i.length-1;for(;n>=s;){const r=s+Math.floor((n-s)/2);if(e(i[r],t)===0)return r;if(e(i[r],t)<0){s=r+1;continue}e(i[r],t)>0&&(n=r-1)}return-1},vs=(i,t,e)=>{let s=0,n=i.length-1,r=s+Math.floor((n-s)/2);for(;n>=s;){if(r=s+Math.floor((n-s)/2),e(i[r],t)===0)return r;if(e(i[r],t)<0){s=r+1;continue}e(i[r],t)>0&&(n=r-1)}return r},Ue=(i,t)=>Math.round(i*10**t)/10**t,Qs=(i,t)=>Math.sqrt((i.x-t.x)**2+(i.y-t.y)**2),Dr=(i,t)=>({x:i.x+t.x,y:i.y+t.y}),Oa=i=>({x:i.x,y:384-i.y}),Z1=(i,t,e)=>{const s=t.x-i.x,n=t.y-i.y;return{x:i.x+s*e,y:i.y+n*e}},hr=(i,t)=>t.includes("DoubleTime")?i/1.5:t.includes("HalfTime")?i/.75:i,J1=i=>{const t={...i};return t.x-=256,t.y-=192,t},bi=i=>1-Math.pow(1-i,5),ji=i=>Math.sin(i*Math.PI/2),Q1=i=>{const t=2*Math.PI/3;return i===0?0:i===1?1:Math.pow(2,-10*i)*Math.sin((i*10-.75)*t)+1},ts=i=>Math.pow(2,-10*i)*Math.sin((.5*i-.075)*(2*Math.PI)/.3)+1,In=i=>Math.pow(2,-10*i)*Math.sin((.25*i-.075)*(2*Math.PI)/.3)+1;async function es(i){const t=[];return await i(s=>t.push(typeof s=="function"?s():s)),await Promise.all(t)}function tC(){var i=window.navigator.userAgent,t=window.navigator.platform,e=["Macintosh","MacIntel","MacPPC","Mac68K"],s=["Win32","Win64","Windows","WinCE"],n=["iPhone","iPad","iPod"],r=null;return e.indexOf(t)!==-1?r="Mac OS":n.indexOf(t)!==-1?r="iOS":s.indexOf(t)!==-1?r="Windows":/Android/.test(i)?r="Android":!r&&/Linux/.test(t)&&(r="Linux"),r}const ci=class ci{constructor(t,e,s,n){S(this,"val");S(this,"pos");S(this,"stackHeight");S(this,"time");S(this,"disablePerfect",null);S(this,"obj");S(this,"text");this.time=t,this.val=e,this.pos=n,this.stackHeight=s;const r=new Ve({text:`${ci.judge[e].text}`,style:{fontFamily:"Torus",fontSize:10,fontWeight:500,fill:ci.judge[e].color,align:"center",letterSpacing:4}});r.anchor.set(.5);const o=new ut;o.addChild(r),this.obj=o,this.text=r,this.obj.alpha=0}draw(t){if(this.val===300&&this.disablePerfect!==p.SLIDER_APPEARANCE.disablePerfect){if(this.disablePerfect=p.SLIDER_APPEARANCE.disablePerfect,this.disablePerfect){this.obj.visible=!1;return}this.obj.visible=!0}if(t<this.time||t>=this.time+ci.ANIM_DURATION){this.obj.alpha=0;return}const e=ot((t-this.time)/ci.ANIM_DURATION,0,1);if(this.val!==0){const s=1+.4*bi(ot((t-this.time)/800,0,1)),n=1-e**5;this.obj.scale.set(s),this.obj.alpha=n}if(this.val===0){const s=1.6-.6*ji(ot((t-this.time)/100,0,1)),n=1-e**5;this.obj.scale.set(s),this.obj.alpha=n,this.text.y=100*e**5,this.text.angle=40*e**5}}};S(ci,"FADE_OUT_DURATION",100),S(ci,"ANIM_DURATION",800),S(ci,"judge",{300:{text:"GREAT",color:7123942},100:{text:"OK",color:7135363},50:{text:"MEH",color:14079593},0:{text:"MISSED",color:16075081}});let va=ci;const Jn={LOWER_7:127,UPPER_1:128},eC=i=>Number.isSafeInteger(i);class Ah{static decode(t,e=0){const s=this.$scanForNullBytes(t,e);let n=0,r=0;for(let o=0;o<=s-e;o++){const a=t[e+o]&Jn.LOWER_7;n|=a<<r,r+=7}return n}static encode(t){if(this.check(t),t<0)throw new Error(`An unsigned number must NOT be negative, ${t} is!`);let e=[],s=t;do{let n=s&Jn.LOWER_7;s>>=7,s&&(n=n|Jn.UPPER_1),e.push(n)}while(s);return Uint8Array.from(e)}static check(t){if(!eC(t))throw new Error(`${t} is not a safe integer!`)}static $scanForNullBytes(t,e=0){let s=e,n=0;do{if(s>=t.byteLength)throw new Error("This is not a LEB128-encoded Uint8Array, no ending found!");n=t.slice(s,s+1)[0],s++}while(n&Jn.UPPER_1);return s-1}static getLength(t,e=0){return this.$scanForNullBytes(t,e)-e}}class iC{constructor(t){S(this,"gamemode");S(this,"version");S(this,"md5map");S(this,"playerName");S(this,"md5replay");S(this,"accuraciesCount",{count300:0,count300k:0,count100:0,count100k:0,count500:0,count0:0});S(this,"score");S(this,"maxCombo");S(this,"perfect");S(this,"mods");S(this,"healthbar",[]);S(this,"timestamp");S(this,"replayData");S(this,"scoreID");S(this,"buffer");S(this,"offset");this.buffer=t}checkOffset(){if(this.offset>=this.buffer.byteLength)throw new Error("Replay data ended unexpectedly")}parseIntLE(t){let e=0;for(let s=t.length-1;s>=0;s--)e*=256,e+=t[s];return e}readByte(){this.checkOffset();let t=this.parseIntLE(this.buffer.slice(this.offset,this.offset+1));return this.offset+=1,t}readInt16(){this.checkOffset();let t=this.parseIntLE(this.buffer.slice(this.offset,this.offset+2));return this.offset+=2,t}readInt32(){this.checkOffset();let t=this.parseIntLE(this.buffer.slice(this.offset,this.offset+4));return this.offset+=4,t}readInt64(){this.checkOffset();let t=this.parseIntLE(this.buffer.slice(this.offset,this.offset+8));return this.offset+=8,t}readString(){this.checkOffset();const t=this.buffer[this.offset]===11;if(this.offset++,t){const e=Ah.getLength(this.buffer,this.offset),s=Ah.decode(this.buffer,this.offset);this.offset+=e+1;const n=this.buffer.slice(this.offset,this.offset+s).toString();return this.offset+=s,n}else return""}readBinary(t){this.checkOffset();const e=this.buffer.slice(this.offset,this.offset+t);return this.offset+=t,e}parseHealthbar(t){return t.split(",").filter(s=>s).map(s=>s.trim()).map(s=>{const[n,r]=s.split("|").map(o=>+o);return{timestamp:n,percentage:r}})}async deserialize(t=!0){this.offset=0,this.gamemode=this.version=this.score=this.maxCombo=this.perfect=this.scoreID=null,this.accuracies={count300k:0,count300:0,count100k:0,count100:0,count50:0,countMiss:0},this.gamemode=this.readByte(),this.version=this.readInt32(),this.md5map=this.readString(),this.player=this.readString(),this.md5replay=this.readString(),this.accuracies={count300:this.readInt16(),count100:this.readInt16(),count50:this.readInt16(),count300k:this.readInt16(),count100k:this.readInt16(),countMiss:this.readInt16()},this.score=this.readInt32(),this.maxCombo=this.readInt16(),this.perfect=this.readByte(),this.mods=this.readInt32(),this.healthbar=this.parseHealthbar(this.readString());let e=(BigInt(this.readInt64())-sC)/10000n;if(this.timestamp=new Date(Number(e)),t){let s=this.readInt32(),n=this.readBinary(s),r=LZMA.decompress(n);r instanceof Uint8Array?this.replayData=new TextDecoder().decode(r):this.replayData=r}return this}}const sC=621355968000000000n,Z=class Z{async getMapData(t){return(await Ut.get(`https://preview.tryz.id.vn/api/h/${t}`)).data}getIsOldVersion(t){var o,a,l,c,h;let e=t.toString();const s=parseInt(((o=e.match(/.{1,4}/g))==null?void 0:o[0])??"0"),n=parseInt(((l=(a=e.match(/.{1,4}/g))==null?void 0:a[1].match(/.{1,2}/g))==null?void 0:l[0])??"0"),r=parseInt(((h=(c=e.match(/.{1,4}/g))==null?void 0:c[1].match(/.{1,2}/g))==null?void 0:h[1])??"0");return s<=2019&&n<5&&r<10}static eval(){var s;let t=0,e=1;for(Z.EVAL_LIST=[];e<Z.CURSOR_DATA.length&&!(t>=p.BEATMAP_FILE.beatmapRenderData.objectsController.objectsList.length);){const n=p.BEATMAP_FILE.beatmapRenderData.objectsController.objectsList[t].obj;if(Z.CURSOR_DATA[e],((s=Z.EVAL_LIST.at(-1))==null?void 0:s.time)===n.time){t++;continue}const r=n.eval(e);if(r===null){e++;continue}if(Z.EVAL_LIST.push({time:n.time,eval:r.val,sv2Eval:r.valV2,inputTime:r.val===0?null:r.inputTime,type:n.constructor.name,checkPointState:r.checkPointState,bonus:r.bonus,bonusV2:r.bonusV2,delta:r.delta}),r.val===0?(n instanceof Pe&&(n.hitTime=n.time+240+1,n.endTime=n.time+B.hitWindows.MEH),n instanceof Qt&&(n.hitTime=n.time+n.sliderTime+240+1,n.hitCircle.hitTime=n.hitCircle.endTime+1,n.hitCircle.endTime=n.hitCircle.time+B.hitWindows.MEH)):n instanceof Ie||(n.hitTime=r.inputTime),!(n instanceof Ie)){let o=n.hitTime;n instanceof Pe&&n.hitTime>n.endTime&&(o=n.endTime),n instanceof Qt&&(o=n.time+n.sliderTime*n.repeat);const a=n instanceof Pe?{x:n.originalX,y:n.originalY}:{x:n.realTrackPoints.at(-1).x,y:n.realTrackPoints.at(-1).y},l=new va(o,Z.MODS.includes("ScoreV2")?r.valV2:r.val,n.stackHeight,a);n.judgement=l,n.judgementContainer.removeChildren(),n.judgementContainer.addChild(l.obj),p.BEATMAP_FILE.beatmapRenderData.objectsController.judgementList.push(l)}e++,t++}}static calculateScore(){let t=0,e=0;const s=Z.EVAL_LIST.filter(E=>E.delta!==void 0).map(E=>hr(E.delta,Z.MODS)),r=s.reduce((E,T)=>E+T,0)/s.length,o=s.reduce((E,T)=>E+(T-r)**2,0),a=Ue(Math.sqrt(o/(s.length-1))*10,2),l=Z.MODS.includes("ScoreV2")?Z.MOD_MULTIPLIER.V2:Z.MOD_MULTIPLIER.V1,c=Z.EVAL_LIST.reduce((E,T)=>{if(T.type!=="Slider"){if(e++,T.eval===0)return t=0,E.acc.V1.h0++,E.acc.V2.h0++,E;const L=Math.round(T.eval*(1+Math.max(0,t-1)*B.difficultyMultiplier*l/25));return t++,t>Z.maxCombo&&(Z.maxCombo=t),T.eval===300&&(E.acc.V1.h300++,E.acc.V2.h300++),T.eval===100&&(E.acc.V1.h100++,E.acc.V2.h100++),T.eval===50&&(E.acc.V1.h50++,E.acc.V2.h50++),Z.comboPortion+=T.eval*(1+t/10),Z.maxComboPortion+=300*(1+e/10),{V1:E.V1+L,V1_S:E.V1_S+L,acc:E.acc,bonus:E.bonus+(T.bonus??0),bonusV2:E.bonusV2+(T.bonusV2??0)}}let _=0,b=0,A=0,C=0,R=T.eval,O=T.sv2Eval,M=e;T.checkPointState.filter(L=>L.type!=="Slider Tick").forEach(L=>{M++,Z.maxComboPortion+=30*(1+M/10)}),T.checkPointState.filter(L=>L.type==="Slider Tick").forEach(L=>{M++,Z.maxComboPortion+=10*(1+M/10)}),T.checkPointState.forEach(L=>{if(e++,L.eval===1){switch(t++,L.type){case"Slider Head":A+=30,Z.comboPortion+=30*(1+t/10);break;case"Slider Tick":_+=10,Z.comboPortion+=10*(1+t/10);break;case"Slider Repeat":b+=30,Z.comboPortion+=30*(1+t/10);break;case"Slider End":C+=30,Z.comboPortion+=30*(1+t/10)}O<50&&(O=50),t>Z.maxCombo&&(Z.maxCombo=t)}else L.type!=="Slider End"?(t=0,O>50&&(O=50)):(R>100&&(R=100),O>100&&(O=100))});const w=Math.round(R*(1+Math.max(0,t-1)*B.difficultyMultiplier*l/25)+A+_+b+C),I=Math.round(O*(1+Math.max(0,t-1)*B.difficultyMultiplier*l/25)+A+_+b+C);return R===300&&E.acc.V1.h300++,O===300&&E.acc.V2.h300++,R===100&&E.acc.V1.h100++,O===100&&E.acc.V2.h100++,R===50&&E.acc.V1.h50++,O===50&&E.acc.V2.h50++,R===0&&E.acc.V1.h0++,O===0&&E.acc.V2.h0++,Z.comboPortion+=O*(1+t/10),Z.maxComboPortion+=300*(1+e/10),{V1:E.V1+w,V1_S:E.V1_S+I,acc:E.acc,bonus:E.bonus,bonusV2:E.bonusV2}},{V1:0,V1_S:0,acc:{V1:{h300:0,h100:0,h50:0,h0:0},V2:{h300:0,h100:0,h50:0,h0:0}},bonus:0,bonusV2:0}),h=(c.acc.V1.h300+c.acc.V1.h100/3+c.acc.V1.h50/6)/(c.acc.V1.h300+c.acc.V1.h100+c.acc.V1.h50+c.acc.V1.h0),u=(c.acc.V2.h300+c.acc.V2.h100/3+c.acc.V2.h50/6)/(c.acc.V2.h300+c.acc.V2.h100+c.acc.V2.h50+c.acc.V2.h0),d=Math.round(7e5*(c.V1_S/B.maxScore)+3e5*u**10),f=Math.round(7e5*(Z.comboPortion/Z.maxComboPortion)+3e5*u**10),m={...c,accV1:h,accV2:u,UR:a,V2:d,V2_new:f},y=(Z.MODS.includes("ScoreV2")?m.V2_new+m.bonusV2:m.V1+m.bonus)-Z.REPLAY_DATA.score,g=(Z.MODS.includes("ScoreV2")?m.bonusV2:m.bonus)-y;console.log("MAX_COMBO:".padEnd(15),Z.maxCombo,"/",B.maxCombo),console.log("ACC_V1:".padEnd(15),Ue(m.accV1*100,2)),console.log("".padEnd(15,""),`${m.acc.V1.h300} / ${m.acc.V1.h100} / ${m.acc.V1.h50} / ${m.acc.V1.h0}`),console.log("ACC_V2:".padEnd(15),Ue(m.accV2*100,2)),console.log("".padEnd(15,""),`${m.acc.V2.h300} / ${m.acc.V2.h100} / ${m.acc.V2.h50} / ${m.acc.V2.h0}`),console.log("UNSTABLE_RATE:".padEnd(15),m.UR),console.log("CALC_DIFF:".padEnd(15),y),console.log("".padEnd(30,"=")),Z.MODS.includes("ScoreV2")?(console.log("SCORE_V1 (calculated):".padEnd(50),m.V1+m.bonus),console.log("SCORE_V1 (slider accuracy evaluated):".padEnd(50),m.V1_S+m.bonus),console.log("SCORE_V2 (calculated):".padEnd(50),Math.round(m.V2_new*Z.MOD_MULTIPLIER.V2)+m.bonusV2),console.log("SCORE_V2 (from replay):".padEnd(50),Z.REPLAY_DATA.score),console.log("SPINNER_BONUS (expected):".padEnd(50),g),console.log("SPINNER_BONUS (calculated):".padEnd(50),m.bonusV2)):(console.log("SCORE_V1 (from replay):".padEnd(50),Z.REPLAY_DATA.score),console.log("SCORE_V1 (calculated):".padEnd(50),m.V1+m.bonus),console.log("SCORE_V1 (slider accuracy evaluated):".padEnd(50),m.V1_S+m.bonus),console.log("SCORE_V2 (old method):".padEnd(50),Math.round(m.V2*Z.MOD_MULTIPLIER.V2)+m.bonusV2),console.log("SCORE_V2 (calculated):".padEnd(50),Math.round(m.V2_new*Z.MOD_MULTIPLIER.V2)+m.bonusV2),console.log("SPINNER_BONUS (expected):".padEnd(50),g),console.log("SPINNER_BONUS (calculated):".padEnd(50),m.bonus))}async getPlayer(){if(console.log(Z.REPLAY_DATA.player),!Z.REPLAY_DATA.player)return;const t=(await Ut.get(`https://preview.tryz.id.vn/api/u/${Z.REPLAY_DATA.player}`)).data;console.log(t),JSON.stringify(t)!=="{}"&&(document.querySelector(".thePlayer").style.backgroundImage=`url(${t.cover_url})`,document.querySelector(".playerName").textContent=t.username,document.querySelector(".playerAva").src=t.avatar_url,document.querySelector(".thePlayer").style.display="flex")}async getReplayData(){var t,e;try{document.querySelector(".loading").style.display="",document.querySelector(".loading").style.opacity=1,document.querySelector("#loadingText").textContent="Parsing Score";const s=await new Response(Z.BLOB).arrayBuffer(),n=buffer.Buffer.from(s),o=await new iC(n).deserialize();Z.REPLAY_DATA=o,Z.IS_OLD_VER=this.getIsOldVersion(o.version);let a=0;Z.CURSOR_DATA=o.replayData.split(",").filter(h=>h!=="").map((h,u)=>{const d=h.split("|");return d[0]==="-12345"?{time:0,x:0,y:0,inputArray:[],idx:u}:(a+=parseFloat(d[0]),{time:a,x:parseFloat(d[1]),y:parseFloat(d[2]),inputArray:parseInt(d[3]).toString(2).padStart(5,"0").split("").reduce((f,m,y)=>m==="1"&&y!==0?f.concat([Z.INPUT_LIST[y]]):f,[]),idx:u})}),Z.MODS=Z.REPLAY_DATA.mods.toString(2).padStart(31,"0").split("").reduce((h,u,d)=>(u==="1"&&h.push(Z.MOD_LIST[Z.MOD_LIST.length-1-d]),h),[]),p.MODS.HD=Z.MODS.includes("Hidden"),p.MODS.HR=Z.MODS.includes("HardRock"),p.MODS.EZ=Z.MODS.includes("Easy"),p.MODS.DT=Z.MODS.includes("DoubleTime")&&!Z.MODS.includes("Nightcore"),p.MODS.NC=Z.MODS.includes("Nightcore"),p.MODS.HT=Z.MODS.includes("HalfTime");const l=!p.MODS.DT&&!p.MODS.NC?1:1.5,c=p.MODS.HT?.75:1;if(p.PLAYBACK_RATE=1*l*c,document.querySelector(".loading").style.opacity=0,document.querySelector(".loading").style.display="none",Z.REPLAY_DATA.md5map!==((t=p.BEATMAP_FILE)==null?void 0:t.md5Map)){console.log(Z.REPLAY_DATA.md5map,(e=p.BEATMAP_FILE)==null?void 0:e.md5Map);const h=await this.getMapData(Z.REPLAY_DATA.md5map);if(!h.beatmap_id)throw"Map is not available online!";Qr(!1,h.beatmap_id);return}B.updateModdedStats(),p.BEATMAP_FILE.beatmapRenderData.applyStacking(),document.querySelector("#HD").checked=p.MODS.HD,document.querySelector("#HR").checked=p.MODS.HR,document.querySelector("#EZ").checked=p.MODS.EZ,document.querySelector("#DT").checked=p.MODS.DT,document.querySelector("#NC").checked=p.MODS.NC,document.querySelector("#HT").checked=p.MODS.HT,document.querySelector("#DC").checked=p.MODS.DC,Z.MOD_MULTIPLIER=Z.MODS.reduce((h,u)=>({V1:h.V1*(Z.modsMultiplierList.V1[u]??1),V2:h.V2*(Z.modsMultiplierList.V2[u]??1)}),{V1:1,V2:1}),Z.eval(),document.querySelector("#HD").disabled=!0,document.querySelector("#HR").disabled=!0,document.querySelector("#DT").disabled=!0,document.querySelector("#NC").disabled=!0,document.querySelector("#EZ").disabled=!0,document.querySelector("#HT").disabled=!0,document.querySelector("#DC").disabled=!0,Or([p.MODS.HR,p.MODS.EZ,p.MODS.DT||p.MODS.NC,p.MODS.HT||p.MODS.DC]),console.log(Z.calculateScore())}catch(s){Z.reset(),alert(s),console.error(s),document.querySelector(".loading").style.opacity=0,document.querySelector(".loading").style.display="none"}}static reset(){Z.BLOB=null,Z.REPLAY_DATA=null,Z.CURSOR_DATA=null,Z.EVAL_LIST=[],Z.comboPortion=0,Z.maxComboPortion=0,Z.maxCombo=0,p.CURSOR.obj.alpha=0}constructor(t){Z.BLOB=t,Z.REPLAY_DATA=null,Z.CURSOR_DATA=null,Z.EVAL_LIST=[],Z.comboPortion=0,Z.maxComboPortion=0,Z.maxCombo=0,p.CURSOR.obj.alpha=1}};S(Z,"BLOB"),S(Z,"REPLAY_DATA"),S(Z,"CURSOR_DATA"),S(Z,"MODS"),S(Z,"IS_OLD_VER"),S(Z,"EVAL_LIST",[]),S(Z,"MOD_MULTIPLIER"),S(Z,"maxCombo",0),S(Z,"comboPortion",0),S(Z,"maxComboPortion",0),S(Z,"INPUT_LIST",["SMOKE","K2","K1","M2","M1"]),S(Z,"MOD_LIST",["NoFail","Easy","TouchDevice","Hidden","HardRock","SuddenDeath","DoubleTime","Relax","HalfTime","Nightcore","Flashlight","Autoplay","SpunOut","Autopilot","Perfect","Key4","Key5","Key6","Key7","Key8","FadeIn","Random","Cinema","Target","Key9","KeyCoop","Key1","Key3","Key2","ScoreV2","Mirror"]),S(Z,"modsMultiplierList",{V1:{NoFail:.5,Easy:.5,HalfTime:.3,HardRock:1.06,Hidden:1.06,DoubleTime:1.12,Flashlight:1.12},V2:{NoFail:1,Easy:.5,HalfTime:.3,HardRock:1.1,Hidden:1.06,DoubleTime:1.2,Flashlight:1.12}});let nt=Z;const Qn=.3;class nC{constructor(){S(this,"obj");S(this,"cursor");S(this,"trailList")}async init(){const t=new ut,[e,s]=await Promise.all([bt.load("/static/cursor.png"),bt.load("/static/cursortrail.png")]);this.cursor=Mt.from(e),this.cursor.anchor.set(.5),this.cursor.width=128*(1024/640),this.cursor.height=128*(1024/640),this.cursor.scale.set(Qn);const n=[...Array(10).keys()].map(()=>Mt.from(s));this.trailList=n,n.forEach(r=>{r.anchor.set(.5),r.width=64*(1024/640),r.height=64*(1024/640),r.scale.set(Qn),t.addChild(r)}),t.addChild(this.cursor),t.x=p.OFFSET_X,t.y=p.OFFSET_Y,this.obj=t,this.obj.alpha=0}update(t,e,s){nt.CURSOR_DATA&&(this.obj.x=p.OFFSET_X,this.obj.y=p.OFFSET_Y,this.obj.scale.set(p.SCALE_RATE),this.cursor.x=e,this.cursor.y=s,this.cursor.scale.set(Qn),t--,this.trailList.toReversed().forEach((n,r)=>{if(t<0)return;const o=nt.CURSOR_DATA[t].x,a=nt.CURSOR_DATA[t].y;n.x=o,n.y=a,n.scale.set(Qn*2),n.alpha=1-r/this.trailList.length,t--}))}}class rC{constructor(){S(this,"onHover",!1);this._title="",this._artist="",this._difficulty="",this._mapper="",this.titleArtist=new je({text:`${this._artist} - ${this._title}`,style:{fontFamily:"Torus",fontWeight:600,fontSize:20,fill:16777215,wordWrap:!0}}),this.diffMapper=new je({text:`Difficulty: ${this._difficulty} - Mapset by ${this._mapper} `,style:{fontFamily:"Torus",fontWeight:500,fontSize:14,fill:16777215,wordWrap:!0}}),this.MASTER_CONTAINER=new gi(0,0,Math.max(this.titleArtist.width,this.diffMapper.width),this.titleArtist.height+5+this.diffMapper.height),this.MASTER_CONTAINER.borderBox=!1,this.MASTER_CONTAINER.padding=20,this.MASTER_CONTAINER.container.label="TitleArtist",this.flex=new dn,this.flex.flexDirection="row",this.flex.gap=5,this.flex.justifyContent="start",this.titleArtist.style.wordWrapWidth=p.WRAPPER.w-this.MASTER_CONTAINER.padding*2,this.diffMapper.style.wordWrapWidth=p.WRAPPER.w-this.MASTER_CONTAINER.padding*2,this.flex.addChild(this.titleArtist,this.diffMapper),this.MASTER_CONTAINER.overflow="visible",this.MASTER_CONTAINER.container.addChild(this.flex.container),this.MASTER_CONTAINER.container.eventMode="static",this.MASTER_CONTAINER.container.on("mouseenter",t=>{B.HREF&&(this.titleArtist.color=16759552,this.diffMapper.color=16759552)}),this.MASTER_CONTAINER.container.on("mouseleave",t=>{this.titleArtist.color=16777215,this.diffMapper.color=16777215}),this.MASTER_CONTAINER.container.on("click",t=>{B.HREF&&open(B.HREF)}),this.MASTER_CONTAINER.container.on("tap",t=>{B.HREF&&open(B.HREF)}),this.update()}get title(){return this._title}set title(t){this._title=t,this.titleArtist.text=`${this._artist} - ${this._title}`,this.update()}get artist(){return this._artist}set artist(t){this._artist=t,this.titleArtist.text=`${this._artist} - ${this._title}`,this.update()}get difficulty(){return this._difficulty}set difficulty(t){this._difficulty=t,this.diffMapper.text=`Difficulty: ${this._difficulty} - Mapset by ${this._mapper}`,this.update()}get mapper(){return this._mapper}set mapper(t){this._mapper=t,this.diffMapper.text=`Difficulty: ${this._difficulty} - Mapset by ${this._mapper}`,this.update()}resizeWidth(){innerWidth/innerHeight<1?this.MASTER_CONTAINER.w=p.WRAPPER.w:this.MASTER_CONTAINER.w=Math.max(this.titleArtist.width,this.diffMapper.width)}resizeHeight(){this.MASTER_CONTAINER.h=this.titleArtist.height+5+this.diffMapper.height}resize(){this.resizeWidth(),this.resizeHeight()}update(){var t,e,s;innerHeight>innerWidth?(this.titleArtist._sprite.style.fontSize=20,this.diffMapper._sprite.style.fontSize=14,this.titleArtist._sprite.style.whiteSpace="pre",this.diffMapper._sprite.style.whiteSpace="pre"):(this.titleArtist._sprite.style.fontSize=24,this.diffMapper._sprite.style.fontSize=16,this.titleArtist._sprite.style.whiteSpace="normal",this.diffMapper._sprite.style.whiteSpace="normal"),this.titleArtist._sprite.style.wordWrapWidth=p.WRAPPER.w-this.MASTER_CONTAINER.padding*2,this.diffMapper._sprite.style.wordWrapWidth=p.WRAPPER.w-this.MASTER_CONTAINER.padding*2,this.titleArtist.update(),this.diffMapper.update(),this.flex.update(),this.resize(),innerWidth/innerHeight<1?(this.MASTER_CONTAINER.color=p.COLOR_PALETTES.primary3,this.MASTER_CONTAINER.alpha=1,this.MASTER_CONTAINER.y=p.MASTER_CONTAINER.h):(this.MASTER_CONTAINER.alpha=0,this.MASTER_CONTAINER.y=0),this.MASTER_CONTAINER.redraw(),innerWidth/innerHeight<1&&((e=(t=p.BEATMAP_FILE)==null?void 0:t.audioNode)==null||e.getCurrentTime(),(s=p.STATS)==null||s.update(),ie.rePosition(),ae.forceUpdate(),se.forceUpdate(),Pt.forceResize())}}class oC{constructor(){S(this,"container");S(this,"flex");this._CS=0,this._AR=0,this._OD=0,this._HP=0,this._SR=0,this.style={fontFamily:"Torus",fontWeight:500,fontSize:12,fill:16777215},this.CSSprite=new je({text:`CS ${this._CS}`,style:this.style}),this.ARSprite=new je({text:`AR ${this._AR}`,style:this.style}),this.ODSprite=new je({text:`OD ${this._OD}`,style:this.style}),this.HPSprite=new je({text:`HP ${this._HP}`,style:this.style}),this.SRSprite=new je({text:`${this._SR}`,style:this.style}),this.srContainer=new Er,this.srContainer.addChild(this.SRSprite),this.srContainer.color=3024933,this.srContainer.paddingX=10,this.srContainer.paddingY=5,this.srContainer.borderRadius=20,this.flex=new dn,this.flex.gap=20,this.flex.addChild(this.CSSprite.sprite,this.ARSprite.sprite,this.ODSprite.sprite,this.HPSprite.sprite,this.srContainer.container),this.container=new Er,this.container.paddingX=15,this.container.paddingY=5,this.container.color=p.COLOR_PALETTES.primary2,this.container.borderRadius=20,this.container.placeItemsCenter=!0,this.container.addChild(this.flex.container),this.update()}get CS(){return this._CS}set CS(t){this._CS=t,this.CSSprite.text=`CS ${t}`,this.update()}get AR(){return this._AR}set AR(t){this._AR=t,this.ARSprite.text=`AR ${t}`,this.update()}get OD(){return this._OD}set OD(t){this._OD=t,this.ODSprite.text=`OD ${t}`,this.update()}get HP(){return this._HP}set HP(t){this._HP=t,this.HPSprite.text=`HP ${t}`,this.update()}get SR(){return this._SR}set SR(t){this._SR=t,this.SRSprite.text=`${t}`,this.update()}update(){this.CSSprite.style.fontSize=12,this.ARSprite.style.fontSize=12,this.ODSprite.style.fontSize=12,this.HPSprite.style.fontSize=12,this.SRSprite.style.fontSize=12,this.CSSprite.update(),this.ARSprite.update(),this.ODSprite.update(),this.HPSprite.update(),this.SRSprite.update(),this.srContainer.update(),this.flex.update(),innerWidth/innerHeight<1?(this.container.x=0,this.container.y=p.INFO.MASTER_CONTAINER.y+p.INFO.MASTER_CONTAINER.h+p.INFO.MASTER_CONTAINER.padding*2,this.container.borderRadius=0,this.container.width=p.WRAPPER.w,this.flex.gap=40):(this.container.width=void 0,this.container.x=p.WRAPPER.w-this.container.width-10,this.container.y=10,this.container.borderRadius=20,this.flex.gap=20),this.container.update()}}function aC(i){return new Worker("/dist/assets/Worker-C8l9KCSb.js",{name:i==null?void 0:i.name})}const lC=oe.get("fullscreen")==="true",x=class x{static get RESOLUTION(){return this._RESOLUTION}static set RESOLUTION(t){this._RESOLUTION=t,this.EMIT_STACK.push(!0)}static addToContainer(t){t.forEach(e=>{e&&x.CONTAINER.addChild(e.obj)})}static get IS_HOVERING_PROGRESS(){return x._IS_HOVERING_PROGRESS}static set IS_HOVERING_PROGRESS(t){x._IS_HOVERING_PROGRESS=t,x.IS_FULLSCREEN&&(t?x.FPS.y=x.MASTER_CONTAINER.h-70:x.FPS.y=x.MASTER_CONTAINER.h-10)}static removeFromContainer(t){t.forEach(e=>{e&&x.CONTAINER.removeChild(e.obj)})}static async CursorInit(){const t=new nC;return await t.init(),t}static async FPSInit(){await bt.load({src:"/static/NICOLATTE.ttf",loadParser:"loadWebFont"});const t={fontFamily:"Nicolatte",align:"right",fontSize:15,fill:"white",fontWeight:600,letterSpacing:1},e=new Od({text:`0fps
Infinite ms`,style:{...t}});return e.anchor.set(1,1),e.x=x.MASTER_CONTAINER.w-10,e.y=x.MASTER_CONTAINER.h-10,e}static dragWindowInit(){const t=new ft().setStrokeStyle({width:2,color:16777215,alpha:1,alignment:0});return t.x=x.OFFSET_X,t.y=x.OFFSET_Y,t.alpha=0,t}static gridInit(){const t=new ft().setStrokeStyle({width:1,color:16777215,alpha:.1,alignment:.5}).rect(0,0,512,384).stroke(),e=512/16,s=384/12;for(let l=0;l<16;l++)for(let c=0;c<12;c++)t.rect(l*e,c*s,e,s).stroke();t.setStrokeStyle({width:1,color:16777215,alpha:.2,alignment:.5}).moveTo(256,0).lineTo(256,384).stroke(),t.setStrokeStyle({width:1,color:16777215,alpha:.2,alignment:.5}).moveTo(0,192).lineTo(512,192).stroke();const n=x.APP.renderer.generateTexture(t),r=new Mt(n);r.width=512,r.height=384,r.x=x.OFFSET_X,r.y=x.OFFSET_Y,r.alpha=1,r.scale.set(x.SCALE_RATE),r.eventMode="static",x.SLIDER_APPEARANCE.showGrid?r.alpha=1:r.alpha=.01;const o=l=>{if(!x.BEATMAP_FILE||!x.BEATMAP_FILE.isLoaded)return;const c=x.BEATMAP_FILE.audioNode.getCurrentTime();let{x:h,y:u}=l.global;h-=x.OFFSET_X,u-=x.OFFSET_Y+x.MASTER_CONTAINER.y+x.WRAPPER.y,h/=x.SCALE_RATE,u/=x.SCALE_RATE;const d=x.BEATMAP_FILE.beatmapRenderData.objectsController.filtered.filter(m=>mh(h,u,m)).map(m=>x.BEATMAP_FILE.beatmapRenderData.objectsController.objectsList[m.idx]),f=d.length?d.reduce((m,y)=>{const g=Math.abs(m.time-c),E=Math.abs(y.time-c);return g>E?y:m}):void 0;f?l.ctrlKey?x.SELECTED=x.SELECTED.concat([f.obj.time]).filter((m,y,g)=>g.indexOf(m)===y):x.SELECTED=[f.obj.time]:x.DID_MOVE||(x.SELECTED=[]),x.DID_MOVE=!1};x.MASTER_CONTAINER.masterContainer.on("click",l=>{o(l)}),x.MASTER_CONTAINER.masterContainer.on("touchstart",l=>{o(l)}),x.MASTER_CONTAINER.masterContainer.on("touchend",l=>{}),x.MASTER_CONTAINER.masterContainer.on("mousedown",l=>{if(!x.BEATMAP_FILE||!x.BEATMAP_FILE.isLoaded)return;let{x:c,y:h}=l.global;c-=x.OFFSET_X,h-=x.OFFSET_Y+x.MASTER_CONTAINER.y+x.WRAPPER.y,c/=x.WIDTH/512,h/=x.WIDTH/512,x.IS_DRAGGING=!0,x.DRAGGING_START=x.BEATMAP_FILE.audioNode.getCurrentTime(),x.START_X=c,x.START_Y=h,x.DRAG_WINDOW.clear(),x.DRAG_WINDOW.setStrokeStyle({width:1,color:16777215,alpha:1,alignment:0}),x.DRAG_WINDOW.rect(c,h,0,0).fill({color:16777215,alpha:.2}).stroke(),x.DRAG_WINDOW.alpha=1}),x.MASTER_CONTAINER.masterContainer.on("mouseup",l=>{!x.BEATMAP_FILE||!x.BEATMAP_FILE.isLoaded||(x.IS_DRAGGING=!1,x.DRAG_WINDOW.alpha=0)}),x.MASTER_CONTAINER.masterContainer.on("mousemove",l=>{if(!x.BEATMAP_FILE||!x.BEATMAP_FILE.isLoaded)return;let{x:c,y:h}=l.global;c-=x.OFFSET_X,h-=x.OFFSET_Y+x.MASTER_CONTAINER.y+x.WRAPPER.y,c/=x.SCALE_RATE,h/=x.SCALE_RATE,x.IS_DRAGGING&&(x.DID_MOVE=!0,x.DRAGGING_END=x.BEATMAP_FILE.audioNode.getCurrentTime(),x.CURRENT_X=c,x.CURRENT_Y=h,Ia(l),x.DRAG_WINDOW.clear(),x.DRAG_WINDOW.setStrokeStyle({width:1,color:16777215,alpha:1,alignment:0}),x.DRAG_WINDOW.rect(Math.min(x.START_X,c)*x.WIDTH/512,Math.min(x.START_Y,h)*x.WIDTH/512,Math.abs(c-x.START_X)*x.WIDTH/512,Math.abs(h-x.START_Y)*x.WIDTH/512).fill({color:16777215,alpha:.2}).stroke());const u=x.BEATMAP_FILE.audioNode.getCurrentTime(),d=x.BEATMAP_FILE.beatmapRenderData.objectsController.filtered.filter(m=>x.BEATMAP_FILE.beatmapRenderData.objectsController.objectsList[m.idx].obj instanceof Qt&&mh(c,h,m)).map(m=>x.BEATMAP_FILE.beatmapRenderData.objectsController.objectsList[m.idx]),f=d.reduce((m,y)=>Math.abs(y.obj.time-u)<Math.abs(m.obj.time-u)?y:m,d[0]??null);x.BEATMAP_FILE.beatmapRenderData.objectsController.slidersList.forEach(m=>m.obj.isHover=!1),f&&(f.obj.isHover=!0)});let a;return x.MASTER_CONTAINER.masterContainer.on("touchend",l=>{if(x.IS_FULLSCREEN){if(!x.IS_HOVERING_PROGRESS){x.IS_HOVERING_PROGRESS=!0,a=setTimeout(()=>{x.IS_HOVERING_PROGRESS=!1},5e3);return}clearTimeout(a),x.IS_HOVERING_PROGRESS=!1}}),r}static containerInit(){const t=new ut;return t.label="Playfield",t.x=x.OFFSET_X,t.y=x.OFFSET_Y,t.eventMode="none",t.sortableChildren=!0,t}static appResize(){innerWidth/innerHeight<1||x.IS_FULLSCREEN?x.WRAPPER.borderRadius=0:x.WRAPPER.borderRadius=10,x.appSizeSetup(),x.gameSizeSetup(),this.EMIT_STACK.length!==0&&(x.APP.renderer.resolution=x.RESOLUTION,x.GRID.x=x.OFFSET_X,x.GRID.y=x.OFFSET_Y,x.GRID.scale.set(x.SCALE_RATE),x.CONTAINER.x=x.OFFSET_X,x.CONTAINER.y=x.OFFSET_Y,x.DRAG_WINDOW.x=x.OFFSET_X,x.DRAG_WINDOW.y=x.OFFSET_Y,x.FPS.x=x.MASTER_CONTAINER.w-10,x.FPS.y=x.MASTER_CONTAINER.h-10,x.FPS.style.fontSize=15,x.INFO.update(),x.STATS.update(),Lt.updateSize())}static appSizeSetup(){var n,r;let{width:t,height:e}=getComputedStyle(document.querySelector(".contentWrapper"));t=Math.round(parseInt(t)),e=Math.round(parseInt(e));const s=e;x.COMPUTED_HEIGHT=s,innerWidth/innerHeight<1&&(e=Math.round(Math.max(e,(((n=Pt==null?void 0:Pt.MASTER_CONTAINER)==null?void 0:n.y)??0)+(((r=Pt==null?void 0:Pt.MASTER_CONTAINER)==null?void 0:r.h)??0)+70)),s!==e&&document.querySelector(".contentWrapper").style.height!==e&&(document.querySelector(".contentWrapper").style.height=`${e}px`)),!(x.APP.renderer.width===t&&x.APP.renderer.height===e)&&(this.EMIT_STACK.push(!0),x.APP.renderer.resize(t,e))}static async appInit(){x.APP=new qu;const t=JSON.parse(localStorage.getItem("settings")),e=t.renderer.val,s={antialias:t.renderer.aa,resolution:t.renderer.resolution,autoDensity:!0,backgroundAlpha:0,resizeTo:document.querySelector(".contentWrapper")};e==="webgl"&&(s.preference="webgl"),e==="webgpu"&&(s.preference="webgpu"),await x.APP.init(s),x.APP.renderer.gl&&console.log("USING WEBGL 2"),x.APP.renderer.gpu&&console.log("USING WEBGPU"),x.appSizeSetup(),x.gameInit()}static gameSizeSetup(){x.WRAPPER.y=0,innerWidth/innerHeight<1?x.WRAPPER.w!==x.APP.renderer.width&&(x.WRAPPER.w=x.APP.renderer.width,this.EMIT_STACK.push(!0)):x.WRAPPER.w!==x.APP.renderer.width-x.REDUCTION/400*410&&(x.WRAPPER.w=x.APP.renderer.width-x.REDUCTION/400*410,this.EMIT_STACK.push(!0)),x.WRAPPER.h!==x.APP.renderer.height&&(x.WRAPPER.h=x.APP.renderer.height,this.EMIT_STACK.push(!0)),x.MASTER_CONTAINER.w!==x.WRAPPER.w&&(x.MASTER_CONTAINER.w=x.WRAPPER.w,this.EMIT_STACK.push(!0)),innerWidth/innerHeight<1?x.MASTER_CONTAINER.h!==x.WRAPPER.w*(3/4)&&(x.MASTER_CONTAINER.h=x.WRAPPER.w*(3/4),this.EMIT_STACK.push(!0)):x.MASTER_CONTAINER.h!==x.WRAPPER.h-(60-(x.IS_FULLSCREEN?60:0))-(60-Y.HEIGHT_REDUCTION)&&(x.MASTER_CONTAINER.h=x.WRAPPER.h-(60-(x.IS_FULLSCREEN?60:0))-(60-Y.HEIGHT_REDUCTION),this.EMIT_STACK.push(!0)),x.MASTER_CONTAINER.y!==60-Y.HEIGHT_REDUCTION&&(x.MASTER_CONTAINER.y=60-Y.HEIGHT_REDUCTION,this.EMIT_STACK.push(!0)),!(x.WIDTH===x.MASTER_CONTAINER.w&&x.HEIGHT===x.MASTER_CONTAINER.h)&&(x.WIDTH=x.MASTER_CONTAINER.w,x.HEIGHT=x.MASTER_CONTAINER.h,x.WIDTH/512>x.HEIGHT/384?x.WIDTH=x.HEIGHT/384*512:x.HEIGHT=x.WIDTH/512*384,x.WIDTH*=.8,x.HEIGHT*=.8,x.OFFSET_X=(x.MASTER_CONTAINER.w-x.WIDTH)/2,x.OFFSET_Y=(x.MASTER_CONTAINER.h-x.HEIGHT)/2,x.SCALE_RATE=x.WIDTH/512,x.SB_SCALE_RATE=x.MASTER_CONTAINER.h/480,x.SB_OFFSET_X=-(x.MASTER_CONTAINER.h*4/3-x.MASTER_CONTAINER.w)/2,x.SB_OFFSET_Y=0)}static gameInit(){x.WRAPPER=new gi(0,x.IS_FULLSCREEN?0:70,x.APP.renderer.width,x.APP.renderer.height-(x.IS_FULLSCREEN,0)),x.WRAPPER.masterContainer.label="WRAPPER_MASTER",x.WRAPPER.container.label="WRAPPER_CONTAINER",x.WRAPPER.color=0,x.WRAPPER.alpha=.01,x.WRAPPER.borderRadius=10,x.WRAPPER.masterContainer.eventMode="dynamic",x.WRAPPER.masterContainer.on("touchstart",e=>{x.START_DRAG_Y=e.global.y,x.IS_DRAGSCROLL=!0}),x.WRAPPER.masterContainer.on("touchmove",e=>{if(!x.IS_DRAGSCROLL)return;const s=e.global.y-x.START_DRAG_Y;window.scrollBy(0,-s),x.START_DRAG_Y=e.global.y}),x.WRAPPER.masterContainer.on("touchend",e=>{x.START_DRAG_Y=0,x.IS_DRAGSCROLL=!1}),x.WRAPPER.masterContainer.on("mousemove",e=>{const{y:s}=e.global;x.IS_HOVERING_PROGRESS=s-x.WRAPPER.y>=x.WRAPPER.h-60});const t=e=>{const{x:s,y:n}=x.WRAPPER.masterContainer.toLocal(e.global),r=ie.MASTER_CONTAINER.x,o=ie.MASTER_CONTAINER.x+ie.MASTER_CONTAINER.w,a=ie.MASTER_CONTAINER.y,l=ie.MASTER_CONTAINER.y+ie.MASTER_CONTAINER.h;(s<r||s>o||n<a||n>l)&&document.querySelector(".seekTo").open&&Jr()};x.WRAPPER.masterContainer.on("tap",e=>{x.SHOW_METADATA&&!St.ON_ANIM&&Xr(),x.SHOW_TIMING_PANEL&&!Tt.ON_ANIM&&yn(),t(e)}),x.WRAPPER.masterContainer.on("click",e=>{t(e)}),x.MASTER_CONTAINER=new gi(0,60,x.APP.renderer.width,x.APP.renderer.height-60),x.MASTER_CONTAINER.masterContainer.label="MASTER_MASTER_CONTAINER",x.MASTER_CONTAINER.container.label="MASTER_CONTAINER",x.MASTER_CONTAINER.overflow="visible",x.gameSizeSetup()}static async init(){await x.appInit(),await es(e=>{x.BACKGROUND=Lt.init(),x.CONTAINER=x.containerInit(),x.GRID=x.gridInit(),x.DRAG_WINDOW=x.dragWindowInit(),e(async()=>x.FPS=await x.FPSInit()),e(async()=>x.CURSOR=await x.CursorInit()),x.INFO=new rC("","","",""),x.STATS=new oC}),x.MASTER_CONTAINER.container.addChild(x.GRID),x.MASTER_CONTAINER.container.addChild(x.DRAG_WINDOW),x.MASTER_CONTAINER.container.addChild(x.CONTAINER),x.MASTER_CONTAINER.container.addChild(x.FPS),x.MASTER_CONTAINER.container.addChild(x.CURSOR.obj),xt.init(),Lt.container.addChild(xt.container),Lt.container.addChild(Lt.dim),Lt.container.addChild(Lt.mask),x.WRAPPER.container.addChild(Lt.container),x.APP.stage.addChild(x.WRAPPER.masterContainer),x.WRAPPER.container.addChild(x.MASTER_CONTAINER.masterContainer),x.MASTER_CONTAINER.container.addChild(x.INFO.MASTER_CONTAINER.masterContainer),x.MASTER_CONTAINER.container.addChild(x.STATS.container.container),ie.init(),x.WRAPPER.container.addChild(ie.MASTER_CONTAINER.masterContainer),ae.init(),x.WRAPPER.container.addChild(ae.MASTER_CONTAINER.masterContainer),await es(e=>{e(se.init()),e(Ii.init()),e(Y.init()),e(Be.init())}),x.WRAPPER.container.addChild(se.MASTER_CONTAINER.container),Pt.init(),x.WRAPPER.container.addChild(Pt.MASTER_CONTAINER.masterContainer),x.WRAPPER.container.addChild(Ii.obj.container),x.WRAPPER.container.addChild(Y.MASTER_CONTAINER.masterContainer),Tt.init(),x.APP.stage.addChild(Tt.MASTER_CONTAINER.masterContainer),St.init(),x.APP.stage.addChild(St.MASTER_CONTAINER.masterContainer),x.APP.stage.addChild(Be.container);const t=e=>{if(x.IS_DRAGGING&&x.CURRENT_X!==-1&&x.CURRENT_Y!==-1&&(x.DRAGGING_END=x.BEATMAP_FILE.audioNode.getCurrentTime(),Ia()),!e.altKey){if(!e.ctrlKey){e.deltaY>0&&Cs(e.shiftKey,!0),e.deltaY<0&&Cs(e.shiftKey,!1);return}e.deltaY>0&&(document.querySelector("#beat").value=Math.max(parseInt(document.querySelector("#beat").value)-1,1)),e.deltaY<0&&(document.querySelector("#beat").value=Math.min(parseInt(document.querySelector("#beat").value)+1,16)),Sf(document.querySelector("#beat")),new di({message:`Beatsnap Divisor changed to 1/${document.querySelector("#beat").value}`}).notify()}};x.WRAPPER.masterContainer.on("wheel",t,{capture:!0,passive:!1}),Y.MASTER_CONTAINER.masterContainer.on("wheel",e=>{if(!e.altKey){t(e);return}e.deltaY>0&&(Y.ZOOM_DISTANCE=ot(Y.ZOOM_DISTANCE-20,20,800)),e.deltaY<0&&(Y.ZOOM_DISTANCE=ot(Y.ZOOM_DISTANCE+20,20,800))},{capture:!0,passive:!1}),document.querySelector(".contentWrapper").prepend(x.APP.canvas),globalThis.__PIXI_APP__=x.APP,jt.masterGainNode=x.AUDIO_CTX.createGain(),jt.masterGainNode.gain.value=x.HS_VOL*x.MASTER_VOL,jt.masterGainNode.connect(x.AUDIO_CTX.destination),vr.loadInBackground(),x.INIT=!0,x.WORKER.onmessage=e=>{var s;if(e.data.type==="updateMs"){const{deltaMs:n}=e.data;x.WORKER_DELTA_MS=n;return}if(e.data.type==="updateOrder"){if(!((s=x.BEATMAP_FILE)!=null&&s.beatmapRenderData))return;const{objects:n,currentTime:r,lastTime:o,timeline:a}=e.data;x.BEATMAP_FILE.beatmapRenderData.objectsController.addTop=n.addTop,x.BEATMAP_FILE.beatmapRenderData.objectsController.addBack=n.addBack,x.BEATMAP_FILE.beatmapRenderData.objectsController.removed=n.removed,x.BEATMAP_FILE.beatmapRenderData.objectsController.filtered=n.filtered,x.BEATMAP_FILE.beatmapRenderData.objectsController.fpBoundary=n.fpBoundary,x.BEATMAP_FILE.beatmapRenderData.objectsController.addedFp=n.addedFp,x.BEATMAP_FILE.beatmapRenderData.objectsController.removedFp=n.removedFp,x.BEATMAP_FILE.beatmapRenderData.objectsController.updateOrder(),x.BEATMAP_FILE.beatmapRenderData.objectsController.playHitsounds(r,o),Y.updateOrder(a),Y.DRAW_LIST=a.filtered;return}}}};S(x,"INIT",!1),S(x,"APP"),S(x,"WRAPPER"),S(x,"MASTER_CONTAINER"),S(x,"CONTAINER"),S(x,"GRID"),S(x,"DRAG_WINDOW"),S(x,"FPS"),S(x,"CURSOR"),S(x,"_RESOLUTION",1),S(x,"WIDTH"),S(x,"HEIGHT"),S(x,"SLIDER_ACCURACY",1/500),S(x,"OFFSET_X"),S(x,"OFFSET_Y"),S(x,"SCALE_RATE",1),S(x,"SB_SCALE_RATE",1),S(x,"SB_OFFSET_X",0),S(x,"SB_OFFSET_Y",0),S(x,"IS_CLICKED",!1),S(x,"IS_DRAGGING",!1),S(x,"IS_RESIZING",!1),S(x,"DID_MOVE",!1),S(x,"START_X",0),S(x,"START_Y",0),S(x,"CURRENT_X",-1),S(x,"CURRENT_Y",-1),S(x,"DRAGGING_START",0),S(x,"DRAGGING_END",0),S(x,"IS_DRAGSCROLL",!1),S(x,"START_DRAG_Y",0),S(x,"AUDIO_CTX",new AudioContext),S(x,"PLAYBACK_RATE",1),S(x,"SELECTED",[]),S(x,"MODS",{HD:!1,HR:!1,EZ:!1,DT:!1,HT:!1}),S(x,"SLIDER_APPEARANCE"),S(x,"SKINNING"),S(x,"MAPPING"),S(x,"MASTER_VOL"),S(x,"MUSIC_VOL"),S(x,"HS_VOL"),S(x,"DISABLE_BMHS"),S(x,"DIFF_FILE_NAME",""),S(x,"DROP_BLOB",null),S(x,"BEATMAP_FILE"),S(x,"COLOR_PALETTES",{accent1:8962256,primary1:1514015,primary2:3028032,primary3:3883602,primary4:4410462,primary5:5002858}),S(x,"SHOW_METADATA",!1),S(x,"SHOW_TIMING_PANEL",!1),S(x,"REDUCTION",0),S(x,"COMPUTED_HEIGHT",0),S(x,"DEVE_RATIO",1),S(x,"EMIT_STACK",[]),S(x,"IS_SEEKING",!1),S(x,"ALPHA",1),S(x,"IS_FULLSCREEN",lC),S(x,"_IS_HOVERING_PROGRESS",!1),S(x,"WORKER_DELTA_MS",0),S(x,"IS_VIDEO",!1),S(x,"IS_STORYBOARD",!1),S(x,"SHOULD_PLAY_HITSOUND",!0),S(x,"WORKER",new aC);let p=x;document.querySelector(".loading").style.opacity=1;document.querySelector("#loadingText").textContent=`Initializing
Might take a while on first load.`;Cn.install({name:"Torus",style:{fontSize:15,align:"right",fill:"white",fontFamily:"Torus",fontWeight:400},chars:[["a","z"],["A","Z"],["0","9"],`. :
`]});Cn.install({name:"Torus16",style:{fontSize:16,align:"center",fill:"white",fontFamily:"Torus",fontWeight:400},chars:[["a","z"],["A","Z"],["0","9"],`. :
`]});Cn.install({name:"Nicolatte",style:{fontSize:15,align:"right",fill:"white",fontFamily:"Nicolatte",fontWeight:600,letterSpacing:5},chars:[["a","z"],["A","Z"],["0","9"],`. :
`]});function cC(){const i={renderer:{val:"webgl",resolution:1,aa:!1},mirror:{val:"nerinyan",custom:""},mapping:{beatsnap:4,offset:0,showGreenLine:!1},background:{dim:.8,blur:0,video:!1,storyboard:!1,transcodeVideo:!1},volume:{master:1,music:.5,hs:.2,disableBMHS:!1},skinning:{type:"0",val:"-1"},sliderAppearance:{snaking:!0,sliderend:!0,hitAnim:!0,ignoreSkin:!1,showGrid:!0,disablePerfect:!1},timeline:{zoomRate:200}};if(!localStorage.getItem("settings"))localStorage.setItem("settings",JSON.stringify(i));else{const t=JSON.parse(localStorage.getItem("settings"));Object.keys(i).forEach(e=>{t[e]===void 0&&(t[e]=i[e]),Object.keys(i[e]).forEach(s=>{t[e][s]===void 0&&(t[e][s]=i[e][s])})}),localStorage.setItem("settings",JSON.stringify(t))}}(async()=>{try{const t=await navigator.gpu.requestAdapter(),e=t&&await t.requestDevice(),s=e==null?void 0:e.limits.maxSampledTexturesPerShaderStage;s&&(ed.defaultOptions.maxTextures=s)}catch(t){console.warn("Failed to configure Batcher with WebGPU limits:",t)}oe.get("fullscreen")==="true"&&(document.body.style.padding=0,document.querySelector("#inputContainer").style.maxHeight=0,document.querySelector("#inputContainer").style.padding=0,document.querySelector("#inputContainer").style.margin=0),cC();const i=JSON.parse(localStorage.getItem("settings"));if(p.MASTER_VOL=i.volume.master,p.MUSIC_VOL=i.volume.music,p.HS_VOL=i.volume.hs,p.DISABLE_BMHS=i.volume.disableBMHS,p.SLIDER_APPEARANCE=i.sliderAppearance,p.SKINNING=i.skinning,p.MAPPING=i.mapping,p.IS_VIDEO=i.background.video,await p.init(),await $1(),await st.generateDefaultTextures(),document.querySelector(".loading").style.opacity=0,document.querySelector(".loading").style.display="none",document.querySelector(".switchMirrorContainer").style.display="flex",document.body.addEventListener("keydown",t=>{switch(t.key){case"F6":{t.preventDefault();break}case"F4":{t.preventDefault();break}case"o":{t.ctrlKey&&t.preventDefault();break}}}),document.body.addEventListener("keyup",t=>{switch(t.key){case"F6":{t.preventDefault(),yn();break}case"F4":{t.preventDefault(),Xr();break}case"o":{t.ctrlKey&&(t.preventDefault(),nl());break}}}),document.querySelector(".contentWrapper").addEventListener("wheel",t=>{t.ctrlKey&&t.preventDefault()},{capture:!0,passive:!1}),/#[(http(s)?):\/\/(www\.)?a-zA-Z0-9@:%._\+~#=-]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/gi.test(window.location.hash)){const t=window.location.hash.slice(1);console.log(t);const e=await Zi.downloadCustom(t);rl(e)}if(oe.get("b")&&/[0-9]+/g.test(oe.get("b"))){p.BEATMAP_FILE=new Zi(oe.get("b")),document.querySelector("#mapInput").value=oe.get("b");return}})();export{gs as $,zu as A,Jt as B,ut as C,Wt as D,lt as E,Hu as F,Le as G,au as H,ze as I,Ss as J,Gl as K,Mt as L,At as M,O0 as N,xn as O,me as P,Xt as Q,on as R,pr as S,kn as T,Qo as U,Ot as V,X0 as W,Wl as X,uo as Y,Vl as Z,t0 as _,Ke as a,Kt as a0,Jm as a1,hu as a2,Ya as a3,$u as a4,dt as a5,Rt as a6,Q0 as a7,sa as a8,xe as a9,Tg as aa,Wg as ab,zg as ac,Kg as ad,Jg as ae,Qg as af,ld as ag,oT as ah,nc as ai,ic as aj,pa as ak,de as al,eS as am,Vt as an,ft as ao,_m as ap,Es as aq,Bc as ar,ud as as,gg as b,Mi as c,nr as d,ne as e,sc as f,fg as g,hT as h,Ha as i,ju as j,_u as k,Ne as l,Nu as m,un as n,jg as o,Vg as p,Xg as q,Dm as r,Zg as s,$e as t,_t as u,Em as v,Bt as w,ni as x,ey as y,Oe as z};
//# sourceMappingURL=index-DU210eej.js.map
