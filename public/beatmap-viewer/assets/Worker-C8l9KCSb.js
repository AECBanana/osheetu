var R=Object.defineProperty;var P=(f,e,i)=>e in f?R(f,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):f[e]=i;var d=(f,e,i)=>P(f,typeof e!="symbol"?e+"":e,i);(function(){"use strict";function f(n,a,h){let c=0,s=n.length-1;for(;s>=c;){const l=c+Math.floor((s-c)/2);if(h(n[l],a)===0)return l;if(h(n[l],a)<0){c=l+1;continue}h(n[l],a)>0&&(s=l-1)}return-1}const i=class i{static getCurrentTime(){return this.isPlaying?this.currentTime+(performance.now()-this.absStartTime)*i.playbackRate+(i.mods.DT?-40:0):this.currentTime+(i.mods.DT?-40:0)}static getObjects(){const a=this.getCurrentTime(),h=this.moddedStats.preempt,c=(t,r)=>t.endTime<r-i.range?-1:t.time>r+i.range?1:0,s=[],l=[],m=f(this.objects,a,c);if(m!==-1){let t=m-1,r=m+1;for(;t>=0&&c(this.objects[t],a)===0;)s.push(this.objects[t]),l.push(this.objects[t]),t--;for(s.reverse(),s.push(this.objects[m]);r<=this.objects.length-1&&c(this.objects[r],a)===0;)s.push(this.objects[r]),l.push(this.objects[r]),r++;s.reverse(),t>=0&&l.push(this.objects[t]),r<=this.objects.length-1&&l.push(this.objects[r])}const g=[];this.filteredTimeline.forEach(t=>{if(s.length>0){const r=s.at(-1),u=s.at(0);if(t.time<=u.time&&t.time>=r.time)return}g.push(t)});const p=[],b=[];this.filteredTimeline.length>0?s.forEach(t=>{t.time>this.filteredTimeline.at(0).time&&b.push(t),t.time<this.filteredTimeline.at(-1).time&&p.push(t)}):p.push(...s),this.filteredTimeline=[...s];const o=s.filter(t=>t.killTime+800>=a&&t.time-h<=a),T=[];this.filtered.forEach(t=>{if(o.length>0){const r=o.at(-1),u=o.at(0);if(t.time<=u.time&&t.time>=r.time)return}T.push(t)});const y=[],S=[];this.filtered.length>0?o.forEach(t=>{t.time>this.filtered.at(0).time&&S.push(t),t.time<this.filtered.at(-1).time&&y.push(t)}):y.push(...o),this.filtered=[...o];const k=[];this.fpBoundary.forEach(t=>{l.find(r=>t.idx===r.idx||o.find(u=>t.idx===u.idx))||k.push(t)});const j=l.filter(t=>!this.fpBoundary.some(r=>r.idx===t.idx));return this.fpBoundary=l,{timeline:{removed:g,addBack:b,addTop:p,filtered:this.filteredTimeline},playfield:{removed:T,addBack:S,addTop:y,fpBoundary:l,removedFp:k,addedFp:j,filtered:this.filtered}}}static loop(){this._renderStart=performance.now();const a=this._renderStart-this._lastRenderTime;if(this._msQueue.push(a),this.objects.length>0){const{timeline:h,playfield:c}=this.getObjects(),s=this.getCurrentTime();postMessage({type:"updateOrder",objects:{...c},timeline:{...h},currentTime:s,lastTime:this.lastTime}),this.lastTime=s}this._msQueue.length>100&&this._msQueue.slice(-100),postMessage({type:"updateMs",deltaMs:this._msQueue.reduce((h,c,s)=>h+c*((s+1)/this._msQueue.length),0)/((1/this._msQueue.length+1)*(this._msQueue.length/2))}),this._lastRenderTime=this._renderStart}};d(i,"isPlaying",!1),d(i,"currentTime",1),d(i,"absStartTime",0),d(i,"lastTime",0),d(i,"playbackRate",1),d(i,"objects",[]),d(i,"filtered",[]),d(i,"fpBoundary",[]),d(i,"filteredTimeline",[]),d(i,"range",0),d(i,"moddedStats",{approachRate:5,circleSize:5,HPDrainRate:5,overallDifficulty:5,stackLeniency:7,circleDiameter:2*(54.4-4.48*5)*236/256,preempt:1200,fadeIn:800,sliderTickRate:1,radius:54.4-4.48*5,stackOffset:-6.4*(1-.7*0/5)/2}),d(i,"mods",{HR:!1,EZ:!1}),d(i,"_renderStart",0),d(i,"_lastRenderTime",0),d(i,"_msQueue",[]);let e=i;onmessage=n=>{if(n.data.type==="start"&&(e.isPlaying=!0,e.absStartTime=performance.now()),n.data.type==="stop"&&(e.isPlaying=!1,e.currentTime+=(performance.now()-e.absStartTime)*e.playbackRate),n.data.type==="seek"){const{time:a}=n.data;e.currentTime=a}if(n.data.type==="objects"){const{objects:a}=n.data;e.objects=a}if(n.data.type==="updateStats"){const{mods:a,moddedStats:h,playbackRate:c}=n.data;e.mods=a,e.moddedStats=h,e.playbackRate=c}if(n.data.type==="clear"&&(e.objects=[],e.filtered=[],e.isPlaying=!1,e.currentTime=1,e.lastTime=0),n.data.type==="range"){const{range:a}=n.data;e.range=a}},setInterval(()=>e.loop(),0)})();
//# sourceMappingURL=Worker-C8l9KCSb.js.map
